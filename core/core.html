<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2016-06-08 Wed 00:55 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>小蟬之核 / core of cicada-nymph</title>
<meta name="generator" content="Org-mode" />
<meta name="author" content="謝宇恆 / XIE Yuheng" />
<link rel="stylesheet" href="http://xieyuheng.github.io/asset/css/page.css" type="text/css" media="screen" />
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="preamble" class="status">
長悲嘆而掩面兮 憐其獨於夢睹
</div>
<div id="content">
<h1 class="title">小蟬之核 / core of cicada-nymph</h1>
<div id="table-of-contents">
<h2>overview</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org3aa336d"><span class="done todo">todo</span> </a>
<ul>
<li><a href="#org626fe83"><span class="todo _gt__lt_">&gt;&lt;</span> code generation for interfaces of data-structure</a></li>
<li><a href="#orge1d4e84"><span class="todo _gt__lt_">&gt;&lt;</span> the size of file</a></li>
<li><a href="#orgdf6ad93"><span class="todo _gt__lt_">&gt;&lt;</span> better structure for IO functions</a></li>
<li><a href="#org22a6fa5"><span class="todo _gt__lt_">&gt;&lt;</span> write-with-color</a></li>
<li><a href="#orgbb94602">type check</a></li>
<li><a href="#orgcf932e7"><span class="todo _gt__lt_">&gt;&lt;</span> view the core as a special module</a></li>
<li><a href="#org677f601">optimize with type info</a></li>
<li><a href="#orgab34a64">fast tangle</a></li>
<li><a href="#org5fa9d10">debug-REPL</a></li>
<li><a href="#orgd714ef0">漢語 alias</a></li>
<li><a href="#org4418c79">language-level support for creating and managing processes</a></li>
</ul>
</li>
<li><a href="#org8ca26a9">module-meta</a>
<ul>
<li><a href="#org9197edd">core-test</a></li>
</ul>
</li>
<li><a href="#orgdfadbb1">writers</a>
<ul>
<li><a href="#org7a7b1bb"><span class="todo note">note</span> name of writers</a></li>
<li><a href="#org69a03f">.l .i .b</a></li>
</ul>
</li>
<li><a href="#org5082563">jojo-compiler-syntax</a>
<ul>
<li><a href="#org7482375"><span class="todo _">記</span> 條件轉跳</a></li>
<li><a href="#org987027d">literal-word:[if|else|then]?</a></li>
<li><a href="#org3e39ade">jojo-compiler-syntax:if</a></li>
<li><a href="#org456f2e7">jojo-compiler-syntax:else</a></li>
<li><a href="#org623bee1">jojo-compiler-syntax:then</a></li>
<li><a href="#org62dcb41"><span class="done test">test</span> if &amp; else &amp; then</a></li>
<li><a href="#org5187194"><span class="done test">test</span> if &amp; else &amp; then by factorial</a></li>
<li><a href="#org43adaa8">literal-word:loop?</a></li>
<li><a href="#orgea2f886">jojo-compiler-syntax:loop</a></li>
<li><a href="#org767fddc">literal-word:recur?</a></li>
<li><a href="#org45b142d">jojo-compiler-syntax:recur</a></li>
<li><a href="#orgcbf2a14"><span class="done test">test</span> loop &amp; recur by factorial</a></li>
<li><a href="#org1e9998e"><span class="done test">test</span> recur by fibonacci</a></li>
<li><a href="#org2b53378">more,syntax-rule-set:jojo-compiler</a></li>
</ul>
</li>
<li><a href="#orgafaed97">name &amp; name-hash-table</a>
<ul>
<li><a href="#org3103a28"><span class="todo note">note</span> </a></li>
<li><a href="#orgbb35fd2">allocate</a>
<ul>
<li><a href="#org20944ec"><span class="todo note">note</span> </a></li>
<li><a href="#org8f2422e">allocate-memory</a></li>
</ul>
</li>
<li><a href="#orgb852bb1"><b>name-hash-table</b></a></li>
<li><a href="#orgcc84f3a"><b>name-hash-table,string-area</b></a></li>
<li><a href="#org5476bb1">name-hash-table,string-area,stay</a></li>
<li><a href="#orgbe24600">make-string,for-name</a></li>
<li><a href="#orgd3527a5">name</a>
<ul>
<li><a href="#org4d952e2"><span class="todo note">note</span> </a></li>
<li><a href="#org853f018">name-&gt;address</a></li>
<li><a href="#orgd0884b8">name,used?</a></li>
<li><a href="#org8d82041">name,used-as-jo?</a></li>
<li><a href="#org9239bac">name-&gt;string</a></li>
<li><a href="#orgb22ab28">name,get-orbit-length</a></li>
<li><a href="#orga225771">name,get-orbiton</a></li>
<li><a href="#orgd330c77">name,get-jo</a></li>
<li><a href="#org62a4045">name,set-string</a></li>
<li><a href="#orga497c53">name,set-orbit-length</a></li>
<li><a href="#orge621bc1">name,set-orbiton</a></li>
<li><a href="#orgd451ed1">name,set-jo</a></li>
<li><a href="#org7dbf3b5">name,no-collision?</a></li>
</ul>
</li>
<li><a href="#org52e0d4d">name-hash-table</a>
<ul>
<li><a href="#orgd36cf98"><span class="todo note">note</span> interface</a></li>
<li><a href="#org631bdee">name-hash-table,hash</a></li>
<li><a href="#org10e90e2">string-&gt;finite-carry-sum</a></li>
<li><a href="#org826398">name-hash-table,search</a></li>
<li><a href="#orga4c3874">name-hash-table,insert</a></li>
<li><a href="#org1959eff">string-&gt;name</a></li>
<li><a href="#org71a2899"><span class="todo note">note</span> about report</a></li>
<li><a href="#orga1bc275">name-hash-table,report</a></li>
<li><a href="#org97943d9"><span class="done test">test</span> string-&gt;name &amp; name-&gt;string</a></li>
<li><a href="#org84e9724">name-hash-table,find-jo</a></li>
<li><a href="#org6f4964e"><span class="done test">test</span> name-hash-table,find-jo</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org99903e">global-naming-stack &amp; name-record</a>
<ul>
<li><a href="#org5abfd52"><span class="todo note">note</span> global-naming-stack</a></li>
<li><a href="#org1e83fd9"><span class="todo note">note</span> name-record</a></li>
<li><a href="#orgcaa7cf6"><b>global-naming-stack</b></a></li>
<li><a href="#orgc23f82b">name-record:[get|set]-old-jo</a></li>
<li><a href="#org75db36a">name-record:[get|set]-name</a></li>
<li><a href="#org97aec31">name-record:[get|set]-new-jo</a></li>
<li><a href="#orgdca0c1d">global-naming-stack:record-jo</a></li>
<li><a href="#org4b8327a">global-naming-stack:delete-last-record</a></li>
<li><a href="#org4639ec6">jo,find-name</a></li>
<li><a href="#org5ceb84b">name-hash-table,record-jo,by-link</a></li>
</ul>
</li>
<li><a href="#org61d6957">jojo-compiler-syntax:quote</a>
<ul>
<li><a href="#org6a8066c">quote-word?</a></li>
<li><a href="#org5b6c4ea">jojo-compiler-syntax:quote</a></li>
<li><a href="#orgbbe92e5">more,syntax-rule-set:jojo-compiler</a></li>
<li><a href="#org4f3f072"><span class="done test">test</span> jojo-compiler-syntax:quote</a></li>
</ul>
</li>
<li><a href="#orgcd46c22">scope-stack &amp; offset-record</a>
<ul>
<li><a href="#orgdd109eb"><b>scope-stack</b></a></li>
<li><a href="#org79987e9"><span class="todo note">note</span> offset-record</a></li>
<li><a href="#org7809636">offset-record,[get|set]-name</a></li>
<li><a href="#org995d593">offset-record,[get|set]-offset</a></li>
<li><a href="#org9532775">offset-record,scope-delimiter?</a></li>
<li><a href="#org2bf9317">scope-stack:find</a></li>
<li><a href="#org2cea4c3">scope-stack:get-current-offset</a></li>
</ul>
</li>
<li><a href="#org84adbee">await &amp; awake</a>
<ul>
<li><a href="#orge557931"><span class="todo note">note</span> notation</a></li>
<li><a href="#orgf12ab38"><b>awaiting-stack</b></a></li>
<li><a href="#org82a1e2d"><span class="todo note">note</span> action</a></li>
<li><a href="#org3cd99f1">action,[get|set]-function</a></li>
<li><a href="#org6ad0b47">action,[get|set]-argument-stack-pointer</a></li>
<li><a href="#org2218415">action,[get|set]-return-stack-pointer</a></li>
<li><a href="#orgd94f638">action,[get|set]-name</a></li>
<li><a href="#orgf13a4c">drop-awaiting-stack</a></li>
<li><a href="#org171e938">awaiting-stack:find</a></li>
<li><a href="#org2b49adb">await</a></li>
<li><a href="#org1adf103">action,apply</a></li>
<li><a href="#org12d6565">action,reset-the-stack</a></li>
<li><a href="#org4e752b5">awake</a></li>
<li><a href="#org6f05061"><span class="done test">test</span> await &amp; awake</a></li>
</ul>
</li>
<li><a href="#org7bdf7e1">basic-REPL</a>
<ul>
<li><a href="#org5062c6c">syntax-rule-set:*word-interpreter*</a></li>
<li><a href="#org477b069">word-interpreter</a></li>
<li><a href="#orgb1a76af">word-interpreter-syntax:bye</a></li>
<li><a href="#orgcd5dc6b">bye,basic-REPL</a></li>
<li><a href="#org8952bf4">basic-REPL&#xa0;&#xa0;&#xa0;<span class="tag"><span class="redefine">redefine</span></span></a></li>
<li><a href="#org87e5cf4">number with base</a>
<ul>
<li><a href="#org67e9dab"><span class="todo _">記</span> 原理</a></li>
<li><a href="#orgb686728">remove-byte!</a></li>
<li><a href="#orgf710ab9"><span class="done test">test</span> remove-byte!</a></li>
<li><a href="#org72db2c7">latin-byte?</a></li>
<li><a href="#org64ed7da">latin-byte-&gt;number</a></li>
<li><a href="#org315c312">number-&gt;latin-byte</a></li>
<li><a href="#org626d2fc">wild-digit-string?</a></li>
<li><a href="#orgc47f2b6">wild-integer-string?</a></li>
<li><a href="#orgaae8b4a"><span class="done test">test</span> wild-integer-string?</a></li>
<li><a href="#orgba5b956">base#wild-integer-string?</a></li>
<li><a href="#orgcdd2555"><span class="done test">test</span> base#wild-integer-string?</a></li>
<li><a href="#orga5f042">base#wild-integer-string-&gt;base-string</a></li>
<li><a href="#org75647c">base#wild-integer-string-&gt;wild-integer-string</a></li>
<li><a href="#orgda4faff"><span class="done test">test</span> base#wild-integer-string-&gt;base-string</a></li>
<li><a href="#orga5c946d">wild-integer-string-&gt;integer,with-base</a></li>
<li><a href="#orgf836ecc">base#wild-integer-string-&gt;integer</a></li>
<li><a href="#org6ad80f8"><span class="done test">test</span> base#wild-integer-string-&gt;integer</a></li>
<li><a href="#org18a195a"><span class="todo note">note</span> writers</a></li>
<li><a href="#org6ac3e43">.#</a></li>
<li><a href="#org8c9a7b3">.#2 .#8 .#16</a></li>
<li><a href="#org4ef800e"><span class="done test">test</span> .#</a></li>
</ul>
</li>
<li><a href="#org6734155">init,syntax-rule-set:basic-REPL</a></li>
<li><a href="#orgd0614a9"><span class="done test">test</span> REPL</a></li>
</ul>
</li>
<li><a href="#orgfc36f80">jojo-compiler</a>
<ul>
<li><a href="#org592f3ac">jojo-compiler,dispatch-word&#xa0;&#xa0;&#xa0;<span class="tag"><span class="redefine">redefine</span></span></a></li>
<li><a href="#org4c1deb1">jojo-compiler,dispatch-word,fail</a></li>
<li><a href="#org8e4a9ef">jojo-compiler&#xa0;&#xa0;&#xa0;<span class="tag"><span class="redefine">redefine</span></span></a></li>
</ul>
</li>
<li><a href="#orgdaec151">define-function</a>
<ul>
<li><a href="#org8d6f8c2">init,name-hash-table,by-link</a></li>
<li><a href="#org9a377fd">n-string-&gt;buffer!</a></li>
<li><a href="#orgd2ea030"><span class="done test">test</span> n-string-&gt;buffer!</a></li>
<li><a href="#org4606da5">undo-jojo-compiler</a></li>
<li><a href="#org26f133e">define-function&#xa0;&#xa0;&#xa0;<span class="tag"><span class="redefine">redefine</span></span></a></li>
<li><a href="#org7f5208f"><span class="done test">test</span> function</a></li>
</ul>
</li>
<li><a href="#orgdc59d5"><b>to use the new naming mechanism</b></a>
<ul>
<li><a href="#orge707ea"><span class="todo note">note</span> </a></li>
<li><a href="#orgfdb30c">switch</a></li>
</ul>
</li>
<li><a href="#orga9ca966">fix syntax about local-variable</a>
<ul>
<li><a href="#org22f01f5">jojo-compiler-syntax:local-variable-get&#xa0;&#xa0;&#xa0;<span class="tag"><span class="redefine">redefine</span></span></a></li>
<li><a href="#org5f4d59d">jojo-compiler-syntax:local-variable-set&#xa0;&#xa0;&#xa0;<span class="tag"><span class="redefine">redefine</span></span></a></li>
<li><a href="#org4bd0743">jojo-compiler-syntax:if&#xa0;&#xa0;&#xa0;<span class="tag"><span class="redefine">redefine</span></span></a></li>
<li><a href="#orgad2dcc5">jojo-compiler-syntax:else&#xa0;&#xa0;&#xa0;<span class="tag"><span class="redefine">redefine</span></span></a></li>
<li><a href="#orgf034c83">jojo-compiler-syntax:then&#xa0;&#xa0;&#xa0;<span class="tag"><span class="redefine">redefine</span></span></a></li>
<li><a href="#org29fff49">more,syntax-rule-set:jojo-compiler</a></li>
</ul>
</li>
<li><a href="#org462763b">argument-stack:print</a>
<ul>
<li><a href="#orgd2decc4">argument-stack:print</a></li>
<li><a href="#orgaf74e49">argument-stack:pretty-print</a></li>
</ul>
</li>
<li><a href="#orga68b50b">define-variable,with-tos</a>
<ul>
<li><a href="#org19ecfd">define-variable,with-tos&#xa0;&#xa0;&#xa0;<span class="tag"><span class="redefine">redefine</span></span></a></li>
<li><a href="#org5341827"><span class="done test">test</span> define-variable,with-tos</a></li>
</ul>
</li>
<li><a href="#org73f5cf9">alias</a>
<ul>
<li><a href="#org13a1a0f"><span class="todo note">note</span> </a></li>
<li><a href="#orgfd943fd">alias</a></li>
<li><a href="#orgb2c5a7"><span class="done test">test</span> alias</a></li>
</ul>
</li>
<li><a href="#org2306044">jojo-compiler-syntax:square-bar</a>
<ul>
<li><a href="#org14525b">string:find-word</a></li>
<li><a href="#org99ae5e1"><span class="done test">test</span> string:find-word</a></li>
<li><a href="#orgd3c9e1e"><span class="todo note">note</span> side-effect</a></li>
<li><a href="#org636d250"><span class="todo note">note</span> scope of named-local-variable</a></li>
<li><a href="#org2fae1eb">literal-word:square-bar?</a></li>
<li><a href="#org8c8eaf4">literal-word:square-ket?</a></li>
<li><a href="#orge272ccc"><span class="todo note">note</span> memory usage</a></li>
<li><a href="#org4a78dde">jojo-compiler-syntax:square-bar</a></li>
<li><a href="#org94b9d23">jojo-compiler-syntax:square-ket</a></li>
<li><a href="#org6b7f8b6">more,syntax-rule-set:jojo-compiler</a></li>
<li><a href="#org381548"><span class="done test">test</span> square-bar &amp; square-ket by factorial</a></li>
</ul>
</li>
<li><a href="#org1652470">jojo-compiler-syntax:name</a>
<ul>
<li><a href="#org7162372">jojo-compiler-syntax:name</a></li>
<li><a href="#org2907900">more,syntax-rule-set:jojo-compiler</a></li>
<li><a href="#org90d264b"><span class="done test">test</span> jojo-compiler-syntax:name</a></li>
</ul>
</li>
<li><a href="#orgb333db2">jojo-compiler-syntax:base#wild-integer-string</a>
<ul>
<li><a href="#org53905f">jojo-compiler-syntax:base#wild-integer-string</a></li>
<li><a href="#org2520fdc">more,syntax-rule-set:jojo-compiler</a></li>
</ul>
</li>
<li><a href="#orga3526f0">word-interpreter-syntax</a>
<ul>
<li><a href="#orgf86cc27">jo&#xa0;&#xa0;&#xa0;<span class="tag"><span class="syntax">syntax</span></span></a>
<ul>
<li><a href="#org8b05ea8">word-interpreter-syntax:jo</a></li>
<li><a href="#org9b44af6">more,syntax-rule-set:basic-REPL</a></li>
</ul>
</li>
<li><a href="#org580ddac">if &amp; else &amp; then&#xa0;&#xa0;&#xa0;<span class="tag"><span class="syntax">syntax</span></span></a>
<ul>
<li><a href="#org1725db"><span class="todo note">note</span> ending jo</a></li>
<li><a href="#orgb386043"><span class="todo note">note</span> (end) in REPL</a></li>
<li><a href="#org3c691db">word-interpreter-syntax:if,meet-true</a></li>
<li><a href="#org2b4116d">word-interpreter-syntax:if,meet-false</a></li>
<li><a href="#orga3fcfad">word-interpreter-syntax:if</a></li>
<li><a href="#org2259445">syntax-rule:add to syntax-rule-set:*word-interpreter*</a></li>
<li><a href="#org4ae9359"><span class="done test">test</span> word-interpreter-syntax:if &amp; else &amp; then</a></li>
</ul>
</li>
<li><a href="#org6c420ac"><b>circular-string-area</b></a>
<ul>
<li><a href="#orge1a320b"><span class="todo note">note</span> </a></li>
<li><a href="#orgac1b098">allocate-memory</a></li>
</ul>
</li>
<li><a href="#org33afd6e">double-quote&#xa0;&#xa0;&#xa0;<span class="tag"><span class="syntax">syntax</span></span></a>
<ul>
<li><a href="#org2ecdcaa">circular-string-area,stay</a></li>
<li><a href="#org1923d43">word-interpreter-syntax:double-quote</a></li>
<li><a href="#orgb34d453">syntax-rule:add to syntax-rule-set:*word-interpreter*</a></li>
<li><a href="#org8448b04"><span class="done test">test</span> word-interpreter-syntax:double-quote</a></li>
</ul>
</li>
<li><a href="#orgbbd4bd0">address&#xa0;&#xa0;&#xa0;<span class="tag"><span class="syntax">syntax</span></span></a>
<ul>
<li><a href="#org432b9cc">word-interpreter-syntax:address</a></li>
<li><a href="#org923ab7">syntax-rule:add to syntax-rule-set:*word-interpreter*</a></li>
<li><a href="#org669bfd2"><span class="done test">test</span> word-interpreter-syntax:address</a></li>
</ul>
</li>
<li><a href="#org37ff73d">literal-word:name?</a></li>
<li><a href="#org8fa9a10">name&#xa0;&#xa0;&#xa0;<span class="tag"><span class="syntax">syntax</span></span></a>
<ul>
<li><a href="#org3d4f3f9">word-interpreter-syntax:name</a></li>
<li><a href="#orgb54de49">syntax-rule:add to syntax-rule-set:*word-interpreter*</a></li>
<li><a href="#org5f45a6e"><span class="done test">test</span> word-interpreter-syntax:name</a></li>
</ul>
</li>
<li><a href="#org4c03143">quote</a>
<ul>
<li><a href="#org7b8ebe9">word-interpreter-syntax:quote</a></li>
<li><a href="#org7853e9c">syntax-rule:add to syntax-rule-set:*word-interpreter*</a></li>
<li><a href="#org367ecee"><span class="done test">test</span> word-interpreter-syntax:quote</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org7f7cc6d"><b>a little test</b></a>
<ul>
<li><a href="#org5dcc892">nested comment</a></li>
<li><a href="#orgd5ee686">return structured value</a></li>
</ul>
</li>
<li><a href="#org9b9f929">syntax-rule-set &amp; syntax-rule</a>
<ul>
<li><a href="#orgd2ceaec"><span class="done test">test</span> endianness of n-get &amp; n-set</a></li>
<li><a href="#orge9bfa9c">syntax-rule-set:list</a></li>
<li><a href="#orgf943896">syntax-rule:sub</a></li>
<li><a href="#org819e880"><span class="done test">test</span> </a></li>
<li><a href="#orgcecd6bd">syntax-rule-set:mixin</a></li>
<li><a href="#org294dce1">syntax-rule-set:mixout</a></li>
</ul>
</li>
<li><a href="#org534f00e">stack-REPL</a>
<ul>
<li><a href="#org81f91b0"><span class="todo note">note</span> </a></li>
<li><a href="#org1ee987d">stack-REPL</a></li>
</ul>
</li>
<li><a href="#org46715f6">eval-string</a>
<ul>
<li><a href="#orgd97d669"><span class="todo note">note</span> </a></li>
<li><a href="#orgfd595fa">eval-string</a></li>
<li><a href="#orgc2bfb8b"><span class="done test">test</span> eval-string</a></li>
</ul>
</li>
<li><a href="#orgacf852e">define-variable</a>
<ul>
<li><a href="#orgf9d6e9e"><span class="todo note">note</span> string allocation</a></li>
<li><a href="#org307c336">syntax,double-quote,define-variable</a></li>
<li><a href="#org9e078ac">define-variable</a></li>
<li><a href="#org9c2d21e"><span class="done test">test</span> </a></li>
</ul>
</li>
<li><a href="#orga23c480">system misc</a>
<ul>
<li><a href="#org6f4ff79"><span class="todo note">note</span> linux</a></li>
<li><a href="#org5e04b51">init-syscall-number&#xa0;&#xa0;&#xa0;<span class="tag"><span class="32bit">32bit</span></span></a></li>
<li><a href="#orgcbc28e3">init-syscall-number&#xa0;&#xa0;&#xa0;<span class="tag"><span class="64bit">64bit</span></span></a></li>
<li><a href="#org3dddc89">error-code-&gt;string</a></li>
<li><a href="#org1da1365">file-type-code-&gt;string</a></li>
</ul>
</li>
<li><a href="#org2069433">port</a>
<ul>
<li><a href="#org3784383"><span class="todo _">記</span> 關於輸入輸出</a></li>
<li><a href="#org7738662"><span class="todo note">note</span> linux header</a></li>
<li><a href="#org919be60"><span class="todo note">note</span> interface</a></li>
<li><a href="#org9ac93c7"><span class="todo note">note</span> syscall with string arguments</a></li>
<li><a href="#org882c8da">port:open</a></li>
<li><a href="#org774bdfd">port:create</a></li>
<li><a href="#orgd222dc0">port:update</a></li>
<li><a href="#org92121cd">port:close</a></li>
<li><a href="#org8f80526">port:read</a></li>
<li><a href="#org572bad4">port:write</a></li>
<li><a href="#org6215533"><span class="done test">test</span> </a></li>
</ul>
</li>
<li><a href="#orgb173f6e">file</a>
<ul>
<li><a href="#org387d701"><span class="todo note">note</span> interface</a></li>
<li><a href="#orgb6b95b9"><span class="todo _">記</span> 元數據</a></li>
<li><a href="#orgfc64b28"></a></li>
<li><a href="#orgc65f64d"></a></li>
<li><a href="#org2e34d57"></a></li>
<li><a href="#org8a95fcc"></a></li>
<li><a href="#org221a49c"><span class="done test">test</span> file</a></li>
</ul>
</li>
<li><a href="#org26c7f79">directory</a>
<ul>
<li><a href="#org1ad45a4">directory:create</a></li>
<li><a href="#orgeeb151d">directory:remove</a></li>
<li><a href="#org94eb13f"><span class="done test">test</span> </a></li>
<li><a href="#org39bceef">system-getdents64</a></li>
<li><a href="#org7d6fba8"><span class="done test">test</span> </a></li>
<li><a href="#orge630e37">directory:empty?</a></li>
<li><a href="#org97f1790"><span class="done test">test</span> </a></li>
<li><a href="#org67c84a1">directory:map</a></li>
<li><a href="#orgc9bfb40"><span class="done test">test</span> </a></li>
<li><a href="#org64ad2ff">directory:list-file</a></li>
<li><a href="#orgbc93e15">directory:list-directory</a></li>
<li><a href="#orgc76a295"><span class="done test">test</span> </a></li>
<li><a href="#org634eda6">directory:find-file</a></li>
<li><a href="#orge030639">directory:find-directory</a></li>
<li><a href="#orge234c64"><span class="done test">test</span> </a></li>
</ul>
</li>
<li><a href="#orgd7136a5">system environment</a>
<ul>
<li><a href="#orgf7e8bcb"><span class="todo note">note</span> linux</a>
<ul>
<li><a href="#org9034786">one directory</a></li>
<li><a href="#org85bd4e4">pid</a></li>
</ul>
</li>
<li><a href="#org6c1e4df">[init|get]-pid</a></li>
<li><a href="#orga1dc1ce">[init|get]-command-line</a></li>
<li><a href="#orga622f46">[init|get]-environment-variable-list</a></li>
<li><a href="#org1857772">find-environment-variable</a></li>
<li><a href="#org447d921">initialize system environment</a></li>
<li><a href="#org702929a"><b>home-directory</b></a></li>
<li><a href="#org9899db">report:environment-variable</a></li>
<li><a href="#orgdeba68c">report:command-line</a></li>
</ul>
</li>
<li><a href="#org3aa1bc7">work-directory</a>
<ul>
<li><a href="#org3bc9c4b">work-directory:get</a></li>
<li><a href="#org123d65d">work-directory:change</a></li>
<li><a href="#org82224b7">pwd</a></li>
<li><a href="#orgfc45127">cd</a></li>
<li><a href="#org4e6a566"><span class="done test">test</span> </a></li>
</ul>
</li>
<li><a href="#org5299cb9">path</a>
<ul>
<li><a href="#orgb4187f3">system-stat</a></li>
<li><a href="#org98d5611"><span class="done test">test</span> </a></li>
<li><a href="#org5cdd2c0"><span class="todo note">note</span> predicate</a></li>
<li><a href="#org60633be">path:nothing?</a></li>
<li><a href="#orgbe69d56">path:file?</a></li>
<li><a href="#orgda036e4">path:directory?</a></li>
<li><a href="#org7c334fe"><span class="done test">test</span> </a></li>
<li><a href="#org1e05c36"><span class="todo _">記</span> 字符串的謂詞</a></li>
<li><a href="#orgd85852c"><span class="todo _">記</span> unix 路徑格式</a></li>
<li><a href="#org505d47b">path:relative?</a></li>
<li><a href="#org30f7773">path:full?</a></li>
<li><a href="#org61af09e"><span class="done test">test</span> path:full?</a></li>
</ul>
</li>
<li><a href="#orgeb875fb">poi</a>
<ul>
<li><a href="#orgac615f1"><span class="todo _">記</span> </a></li>
<li><a href="#orgeca620b"><span class="todo note">note</span> </a></li>
<li><a href="#org54475b9"><b>poi-directory</b></a></li>
<li><a href="#org356dc7c">poi:find</a></li>
<li><a href="#org1bd6421">poi:add</a></li>
<li><a href="#orgb640688">poi:sub</a></li>
<li><a href="#orgcea954a">poi:up</a></li>
<li><a href="#org3632417">poi:list</a></li>
<li><a href="#orga3386e7">poi:help</a></li>
<li><a href="#org1026158"><span class="done test">test</span> </a></li>
</ul>
</li>
<li><a href="#orgff72102">word-interpreter-syntax:path</a>
<ul>
<li><a href="#org5c36035"><del>word</del>?</a></li>
<li><a href="#org7b3d9b4"><del>word</del>-&gt;word</a></li>
<li><a href="#orgf6056a6"><span class="done test">test</span> </a></li>
<li><a href="#org97d2a86"><span class="todo note">note</span> </a></li>
<li><a href="#orgb4778a9"><span class="todo note">note</span> format</a></li>
<li><a href="#org30d001f">path-syntax-word-&gt;path</a></li>
<li><a href="#orgf511abe">word-interpreter-syntax:path</a></li>
<li><a href="#org896f64">more,syntax-rule-set:basic-REPL</a></li>
<li><a href="#org409f0fd"><span class="done test">test</span> </a></li>
</ul>
</li>
<li><a href="#orgcbcb777">string</a>
<ul>
<li><a href="#orgc39b80">string:full-of-the-same-byte?</a></li>
<li><a href="#org8ba7ebf"><span class="done test">test</span> string:full-of-the-same-byte?</a></li>
<li><a href="#org4238d1">string:any-word</a></li>
<li><a href="#org2404a50">string:every-word</a></li>
<li><a href="#orgd5accf5"><span class="done test">test</span> string:every-word</a></li>
<li><a href="#orgbfaa93c">string:word-end-back</a></li>
<li><a href="#orged57417">string:word-begin-back</a></li>
<li><a href="#orgdc21eb">string:word-back</a></li>
<li><a href="#org811dcc6"><span class="done test">test</span> string:word-back</a></li>
</ul>
</li>
<li><a href="#org64603e1">reading-stack</a>
<ul>
<li><a href="#org8f80a51">unread-word</a></li>
<li><a href="#orgf51590"><span class="done test">test</span> </a></li>
</ul>
</li>
<li><a href="#org611128c"><span class="todo _">記</span> 模塊</a>
<ul>
<li><a href="#orgcfc37ab">元數據 之 語法</a></li>
<li><a href="#org39ab698">減載</a></li>
<li><a href="#orgc8b3e11">加載棧</a></li>
<li><a href="#orgff7202e">模塊命名棧 與 全局命名棧</a></li>
<li><a href="#orge5a17f3">模塊與文件一一對應</a></li>
<li><a href="#org16936e7">循環引入</a></li>
</ul>
</li>
<li><a href="#orgd0ccabf">module-naming-stack</a>
<ul>
<li><a href="#org5248c4"><span class="todo note">note</span> module-naming-stack</a></li>
<li><a href="#org98bd43b"><span class="todo note">note</span> name-record</a></li>
<li><a href="#org4564e79"><b>module-naming-stack</b></a></li>
</ul>
</li>
<li><a href="#org4338504">moi</a>
<ul>
<li><a href="#org16594e7"><span class="todo note">note</span> </a></li>
<li><a href="#orgf2c683d"><b>module-directory</b></a></li>
<li><a href="#org106acd0">moi:find</a></li>
<li><a href="#org4c2b0eb">moi:add</a></li>
<li><a href="#org554d619">moi:sub</a></li>
<li><a href="#org1b6093f">moi:up</a></li>
<li><a href="#org739f496">moi:list</a></li>
<li><a href="#org64bc8fb">moi:help</a></li>
<li><a href="#org606a19d"><span class="done test">test</span> </a></li>
</ul>
</li>
<li><a href="#orgfe67d59">module-stack &amp; module-info</a>
<ul>
<li><a href="#orga75a77"><span class="todo _">記</span> 用法</a></li>
<li><a href="#org4236ed7"><b>module-stack</b></a></li>
<li><a href="#orgfc0b18"><span class="todo note">note</span> &lt;module-info&gt;</a></li>
<li><a href="#orgabb1490">module-</a></li>
<li><a href="#org56e12a2">module-</a></li>
<li><a href="#org132782c">module-</a></li>
<li><a href="#orgc1b37c7">module-</a></li>
<li><a href="#orga5b3714">module-</a></li>
<li><a href="#org91607a6">module-</a></li>
<li><a href="#org83aa180">module-</a></li>
<li><a href="#org91262bf">module-stack:find</a></li>
</ul>
</li>
<li><a href="#orgced406f">importing-stack &amp; importing-record</a>
<ul>
<li><a href="#orge96cf6e"><span class="todo _">記</span> 用法</a></li>
<li><a href="#orgf166db8"><b>importing-stack</b> &amp; <b>testing-flag</b></a></li>
<li><a href="#org2537608"><span class="todo note">note</span> &lt;importing-record&gt;</a></li>
<li><a href="#org3c87d19">importing-record:[get|set]-name</a></li>
<li><a href="#orgb247ae7">importing-record:[get|set]-testing-flag</a></li>
<li><a href="#org35e358f">importing-stack:find</a></li>
<li><a href="#org3734eda">importing-stack:drop</a></li>
<li><a href="#org84a0a5e">t</a></li>
</ul>
</li>
<li><a href="#org818676c">global-naming-stack &amp; module-naming-stack</a>
<ul>
<li><a href="#orgccf3350">---------------------------------</a></li>
<li><a href="#org3b93677"><span class="todo _">記</span> 接口</a></li>
<li><a href="#orgc8555b1">---------------------------------</a></li>
<li><a href="#orgd090763">module-naming-stack:record-jo</a></li>
<li><a href="#org2c2dda1">module-naming-stack:delete-last-record</a></li>
<li><a href="#orgd4604e0">---------------------------------</a></li>
<li><a href="#org4b2eb64">global-naming-stack:clear-naming</a></li>
<li><a href="#orga461dff">module-naming-stack:clear-naming</a></li>
<li><a href="#org26ef046">---------------------------------</a></li>
<li><a href="#org2d56cfa">global-naming-stack:prefix-naming</a></li>
<li><a href="#orge464ac7">module-naming-stack:expose-naming</a></li>
<li><a href="#org1644c23">---------------------------------</a></li>
</ul>
</li>
<li><a href="#org405da1b">undo</a>
<ul>
<li><a href="#orga4ae344"><span class="todo _">記</span> 撤銷</a></li>
<li><a href="#orge1dd05c"><span class="todo note">note</span> global states</a></li>
<li><a href="#orgfee5774"><b>undo-stack</b></a></li>
<li><a href="#orgd0b0fc1"><span class="todo note">note</span> undo-point</a></li>
<li><a href="#org9a843a7">interface of &lt;undo-point&gt;</a>
<ul>
<li><a href="#orgdd77cab">undo-point:[get|set]-jojo-area</a></li>
<li><a href="#orgdfe2ee1">undo-point:[get|set]-string-area</a></li>
<li><a href="#orge22f1a4">undo-point:[get|set]-global-naming-stack</a></li>
<li><a href="#orgaad8958">undo-point:[get|set]-module-naming-stack</a></li>
<li><a href="#orga1174ee">undo-point:[get|set]-syntax-backup-area</a></li>
<li><a href="#org56d1ff2">undo-point:[get|set]-number-of-syntax-rule-sets</a></li>
<li><a href="#org60c266e">undo-point:[get|set]-importing-stack</a></li>
</ul>
</li>
<li><a href="#org339686a"><b>syntax-backup-area</b></a></li>
<li><a href="#org274a10d">undo-point:create</a>
<ul>
<li><a href="#org4411365"><span class="todo _">記</span> </a></li>
<li><a href="#org6dfe7e9">undo-point:create,copy-syntax,one-syntax-rule-set</a></li>
<li><a href="#org1c3f547">undo-point:create,copy-syntax</a></li>
<li><a href="#orgcf7eeef">undo-point:create</a></li>
</ul>
</li>
<li><a href="#org4d75772">undo-point:restore</a>
<ul>
<li><a href="#orgbaf1eda">undo-point:restore-jojo-area</a></li>
<li><a href="#org6d0f673">undo-point:restore-string-area</a></li>
<li><a href="#org3a7eb58">undo-point:restore-global-naming-stack</a></li>
<li><a href="#org84a5022">undo-point:restore-module-naming-stack</a></li>
<li><a href="#org7c5a3f1"><span class="todo _">記</span> 語法棧的備份</a></li>
<li><a href="#org368c511">undo-point:restore-syntax-backup-area,set-syntax</a></li>
<li><a href="#org9a3dd91">undo-point:restore-syntax-backup-area</a></li>
<li><a href="#org2e297c1">undo-point:restore-importing-stack</a></li>
<li><a href="#org499ff59">undo-point:restore-undo-stack</a></li>
</ul>
</li>
<li><a href="#org949d9d8">undo</a></li>
<li><a href="#org3f25ca9"><span class="done test">test</span> undo</a></li>
<li><a href="#org7f156c1"><span class="done test">test</span> undo with syntax-stack</a></li>
<li><a href="#org8b28949"><span class="done test">test</span> undo with alias</a></li>
</ul>
</li>
<li><a href="#org9e4dd80">pre-module:*syntax-rule-set*</a></li>
<li><a href="#org3c443af">syntax-rule-set:*post-module*</a></li>
<li><a href="#org98b5029">module-buffer</a>
<ul>
<li><a href="#orgb8e5fc1">module-meta-begin-word?</a></li>
<li><a href="#orge3b2384">module-meta-end-word?</a></li>
<li><a href="#org86764b8">module-meta-word?</a></li>
<li><a href="#org1a0ae7d"><span class="done test">test</span> module-meta-begin-word? &amp; module-meta-begin-word?</a></li>
<li><a href="#org67ec8db"><span class="todo _">記</span> 謂詞</a></li>
<li><a href="#org90d3d08">module-buffer:good-format?</a></li>
<li><a href="#orge6bc31b"><span class="done test">test</span> module-buffer:good-format?</a></li>
<li><a href="#orgea6e15f">module-buffer:get-code-string</a></li>
<li><a href="#org712d117">module-buffer:get-meta-string</a></li>
<li><a href="#org7771e6e"><span class="done test">test</span> module-buffer:get-meta-string</a></li>
</ul>
</li>
<li><a href="#orga199856">import &amp; load &amp; load-with-test</a>
<ul>
<li><a href="#org4881da3"><span class="todo _">記</span> 避免相互遞歸函數</a></li>
<li><a href="#org57db903">name-&gt;module-prefix</a></li>
<li><a href="#orgb6d8084">import</a></li>
<li><a href="#orgc208737">module-syntax:unknow-meta-word</a></li>
<li><a href="#org9e0d9c7">pre-module-syntax</a>
<ul>
<li><a href="#org1936211">meta-literal-word:import?</a></li>
<li><a href="#orgfcd6b17">pre-module-syntax:import</a></li>
<li><a href="#org1a6f872">add syntax-rule</a></li>
</ul>
</li>
<li><a href="#org87ce485">post-module-syntax</a>
<ul>
<li><a href="#orge7761b4">meta-literal-word:do?</a></li>
<li><a href="#orge814897">post-module-syntax:do</a></li>
<li><a href="#org7e95f13">add syntax-rule</a></li>
</ul>
</li>
<li><a href="#org6801312"><span class="done test">test</span> </a></li>
<li><a href="#orgea6f7d0">load</a></li>
<li><a href="#org8033100"><span class="done test">test</span> </a></li>
<li><a href="#orgfb1d524">load-with-test</a></li>
<li><a href="#org52ac418"><span class="done test">test</span> -function</a></li>
<li><a href="#org51457d0"><span class="done test">test</span> -variable</a></li>
<li><a href="#org22e70e6"><span class="done test">test</span> -variable,with-tos</a></li>
<li><a href="#orgf1886bf"><span class="done test">test</span> -do</a></li>
<li><a href="#orgefe96d4">the function test</a></li>
<li><a href="#org34d2ec3"><span class="done test">test</span> </a></li>
<li><a href="#orgde6f122"><span class="done test">test</span> with gamber</a></li>
</ul>
</li>
<li><a href="#orga38a681">type</a></li>
<li><a href="#orgbf0f042">report</a>
<ul>
<li><a href="#org9fbff4e">report:memory</a></li>
<li><a href="#org73e7c4d">report:syntax</a></li>
<li><a href="#org43799f9">global-naming-stack:list-by-jo-predicate</a></li>
<li><a href="#org994075d">report:global-naming-stack</a></li>
<li><a href="#org961b5fb">report:system</a></li>
</ul>
</li>
<li><a href="#org73632e5">hi</a></li>
<li><a href="#org37c1f6b">help</a></li>
<li><a href="#org6367c68">command line interface</a>
<ul>
<li><a href="#org12a881e">command-function:unknow-function</a></li>
<li><a href="#org6ce1b74">command-function:stack-REPL</a></li>
<li><a href="#orgc81726d">command-function:basic-REPL</a></li>
<li><a href="#org2a63621">command-function:poi</a></li>
<li><a href="#org6c5ba34">command-function:moi</a></li>
<li><a href="#org397a37f">command-function:load</a></li>
<li><a href="#org83f5ad0">command-function:load-with-test</a></li>
<li><a href="#org5f7c27d">command-function:no-function</a></li>
<li><a href="#org48579ef">command:dispatch</a></li>
</ul>
</li>
<li><a href="#org1506532"><b>the story begin</b></a></li>
<li><a href="#org14b3db5"><span class="done test">test</span> </a></li>
</ul>
</div>
</div>

<div id="outline-container-org3aa336d" class="outline-2">
<h2 id="org3aa336d"><span class="done todo">todo</span> </h2>
<div class="outline-text-2" id="text-org3aa336d">
</div><div id="outline-container-org626fe83" class="outline-3">
<h3 id="org626fe83"><span class="todo _gt__lt_">&gt;&lt;</span> code generation for interfaces of data-structure</h3>
</div>

<div id="outline-container-orge1d4e84" class="outline-3">
<h3 id="orge1d4e84"><span class="todo _gt__lt_">&gt;&lt;</span> the size of file</h3>
</div>

<div id="outline-container-orgdf6ad93" class="outline-3">
<h3 id="orgdf6ad93"><span class="todo _gt__lt_">&gt;&lt;</span> better structure for IO functions</h3>
<div class="outline-text-3" id="text-orgdf6ad93">
<ul class="org-ul">
<li><p>only one error-code-&gt;string is not enough</p></li></ul>
</div>
</div>

<div id="outline-container-org22a6fa5" class="outline-3">
<h3 id="org22a6fa5"><span class="todo _gt__lt_">&gt;&lt;</span> write-with-color</h3>
<div class="outline-text-3" id="text-org22a6fa5">
<ul class="org-ul">
<li><p>for better report</p></li></ul>
</div>
</div>

<div id="outline-container-orgbb94602" class="outline-3">
<h3 id="orgbb94602">type check</h3>
</div>

<div id="outline-container-orgcf932e7" class="outline-3">
<h3 id="orgcf932e7"><span class="todo _gt__lt_">&gt;&lt;</span> view the core as a special module</h3>
<div class="outline-text-3" id="text-orgcf932e7">
<ul class="org-ul">
<li><p>re-import core every time</p></li></ul>
</div>
</div>

<div id="outline-container-org677f601" class="outline-3">
<h3 id="org677f601">optimize with type info</h3>
</div>

<div id="outline-container-orgab34a64" class="outline-3">
<h3 id="orgab34a64">fast tangle</h3>
</div>

<div id="outline-container-org5fa9d10" class="outline-3">
<h3 id="org5fa9d10">debug-REPL</h3>
</div>

<div id="outline-container-orgd714ef0" class="outline-3">
<h3 id="orgd714ef0">漢語 alias</h3>
</div>

<div id="outline-container-org4418c79" class="outline-3">
<h3 id="org4418c79">language-level support for creating and managing processes</h3>
</div>
</div>


<div id="outline-container-org8ca26a9" class="outline-2">
<h2 id="org8ca26a9">module-meta</h2>
<div class="outline-text-2" id="text-org8ca26a9">
</div><div id="outline-container-org9197edd" class="outline-3">
<h3 id="org9197edd">core-test</h3>
<div class="outline-text-3" id="text-org9197edd">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ef5939; font-weight: bold;">::::::::</span>
<span style="color: #a6e22e; font-weight: bold;">author:</span> XIE Yuheng
<span style="color: #a6e22e; font-weight: bold;">do:</span> <span style="color: #e6db74;">"* (core-test) finished"</span> .s .l
<span style="color: #ae81ff; font-weight: bold;">========</span>
</pre>
</div>
</div>
</div>
</div>


<div id="outline-container-orgdfadbb1" class="outline-2">
<h2 id="orgdfadbb1">writers</h2>
<div class="outline-text-2" id="text-orgdfadbb1">
</div><div id="outline-container-org7a7b1bb" class="outline-3">
<h3 id="org7a7b1bb"><span class="todo note">note</span> name of writers</h3>
<div class="outline-text-3" id="text-org7a7b1bb">
<ul class="org-ul">
<li><p>the use of "." as prefix</p><p>is inherited from Forth</p></li>
<li><p><p></p><p>table</p><p></p></p><p><table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides"></p><p></p><p></p><p><colgroup></p><p><col  class="org-left" /></p><p></p><p><col  class="org-left" /></p><p></p><p><col  class="org-left" /></p><p></colgroup></p><p><tbody></p><p><tr></p><p><td class="org-left">.</td></p><p><td class="org-left">pretty_write_integer</td></p><p><td class="org-left">assembly</td></p><p></tr></p><p></p><p><tr></p><p><td class="org-left">.i</td></p><p><td class="org-left">write_integer</td></p><p><td class="org-left">core</td></p><p></tr></p><p></p><p><tr></p><p><td class="org-left">.s</td></p><p><td class="org-left">write_string</td></p><p><td class="org-left">assembly</td></p><p></tr></p><p></p><p><tr></p><p><td class="org-left">.l</td></p><p><td class="org-left">linefeed</td></p><p><td class="org-left">core</td></p><p></tr></p><p></p><p><tr></p><p><td class="org-left">.b</td></p><p><td class="org-left">write-byte</td></p><p><td class="org-left">&#xa0;</td></p><p></tr></p><p></tbody></p><p></table></p></li></ul>
</div>
</div>

<div id="outline-container-org69a03f" class="outline-3">
<h3 id="org69a03f">.l .i .b</h3>
<div class="outline-text-3" id="text-org69a03f">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">.l</span>
  <span style="color: #FF8888;">&lt;&lt; -- &gt;&gt;</span>
  <span style="color: #fd971f; font-weight: bold;">10</span> write-byte
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>

<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">.i</span>
  <span style="color: #FF8888;">&lt;&lt; -- &gt;&gt;</span>
  write-integer
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>

<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">.b</span>
  <span style="color: #FF8888;">&lt;&lt; byte -- &gt;&gt;</span>
  write-byte
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org5082563" class="outline-2">
<h2 id="org5082563">jojo-compiler-syntax</h2>
<div class="outline-text-2" id="text-org5082563">
</div><div id="outline-container-org7482375" class="outline-3">
<h3 id="org7482375"><span class="todo _">記</span> 條件轉跳</h3>
<div class="outline-text-3" id="text-org7482375">
<ul class="org-ul">
<li><p>one predicate can make two branchs</p><p>three predicates can make four branchs</p><p>three predicates may only make three branchs</p><p>but indeed there must be an invisible branch</p></li></ul>
</div>
</div>

<div id="outline-container-org987027d" class="outline-3">
<h3 id="org987027d">literal-word:[if|else|then]?</h3>
<div class="outline-text-3" id="text-org987027d">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">literal-word:if?</span>
  <span style="color: #FF8888;">&lt;&lt; word[address, length] -- bool &gt;&gt;</span>
  <span style="color: #e6db74;">"if"</span> <span style="color: #ffffff; font-weight: bold;">string:</span>equal?
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>

<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">literal-word:else?</span>
  <span style="color: #FF8888;">&lt;&lt; word[address, length] -- bool &gt;&gt;</span>
  <span style="color: #e6db74;">"else"</span> <span style="color: #ffffff; font-weight: bold;">string:</span>equal?
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>

<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">literal-word:then?</span>
  <span style="color: #FF8888;">&lt;&lt; word[address, length] -- bool &gt;&gt;</span>
  <span style="color: #e6db74;">"then"</span> <span style="color: #ffffff; font-weight: bold;">string:</span>equal?
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org3e39ade" class="outline-3">
<h3 id="org3e39ade">jojo-compiler-syntax:if</h3>
<div class="outline-text-3" id="text-org3e39ade">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">jojo-compiler-syntax:if</span>
  <span style="color: #FF8888;">&lt;&lt; jo, string[address, length], literal-word:if --</span>
<span style="color: #FF8888;">     address, jo, string[address, length] &gt;&gt;</span>
  drop2
  <span style="color: #f92672; font-weight: bold;">jo</span> <span style="color: #ffffff; font-weight: bold;">instruction,false?</span>branch
    jojo-area,stay
  <span style="color: #fd971f; font-weight: bold;">*jojo-area,current-free-address*</span> xxx<span style="color: #b0b1a3;">|</span>swap<span style="color: #b0b1a3;">|</span>x
  <span style="color: #fd971f; font-weight: bold;">0</span> jojo-area,stay
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org456f2e7" class="outline-3">
<h3 id="org456f2e7">jojo-compiler-syntax:else</h3>
<div class="outline-text-3" id="text-org456f2e7">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">jojo-compiler-syntax:else</span>
  <span style="color: #FF8888;">&lt;&lt; address, jo, string[address, length], literal-word:else --</span>
<span style="color: #FF8888;">     address, jo, string[address, length] &gt;&gt;</span>
  drop2
  <span style="color: #f92672; font-weight: bold;">jo</span> instruction,branch
     jojo-area,stay
  x<span style="color: #b0b1a3;">|</span>swap<span style="color: #b0b1a3;">|</span>xxx
  <span style="color: #fd971f; font-weight: bold;">*jojo-area,current-free-address*</span> xxxx<span style="color: #b0b1a3;">|</span>swap<span style="color: #b0b1a3;">|</span>x
  <span style="color: #fd971f; font-weight: bold;">0</span> jojo-area,stay
  <span style="color: #FF8888;">&lt;&lt; address, string[address, length], address &gt;&gt;</span>
  <span style="color: #fd971f; font-weight: bold;">*jojo-area,current-free-address*</span>
  over sub <span style="color: #fd971f; font-weight: bold;">*cell-size*</span> div
  swap set
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org623bee1" class="outline-3">
<h3 id="org623bee1">jojo-compiler-syntax:then</h3>
<div class="outline-text-3" id="text-org623bee1">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">jojo-compiler-syntax:then</span>
  <span style="color: #FF8888;">&lt;&lt; address, jo, string[address, length], literal-word:then --</span>
<span style="color: #FF8888;">     jo, string[address, length] &gt;&gt;</span>
  drop2
  x<span style="color: #b0b1a3;">|</span>swap<span style="color: #b0b1a3;">|</span>xxx
  <span style="color: #fd971f; font-weight: bold;">*jojo-area,current-free-address*</span>
  over sub <span style="color: #fd971f; font-weight: bold;">*cell-size*</span> div
  swap set
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org62dcb41" class="outline-3">
<h3 id="org62dcb41"><span class="done test">test</span> if &amp; else &amp; then</h3>
<div class="outline-text-3" id="text-org62dcb41">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">.12</span>
  <span style="color: #FF8888;">&lt;&lt; 1 2 -- &gt;&gt;</span>
  <span style="color: #fd971f; font-weight: bold;">2</span> <span style="color: #ffffff; font-weight: bold;">equal?</span> <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #e6db74;">"(^-^)"</span> .s
    <span style="color: #fd971f; font-weight: bold;">1</span> <span style="color: #ffffff; font-weight: bold;">equal?</span> <span style="color: #f92672; font-weight: bold;">if</span>
      <span style="color: #e6db74;">"\^o^/"</span> .s
    <span style="color: #f92672; font-weight: bold;">else</span>
      <span style="color: #e6db74;">"_____"</span> .s
    <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #f92672; font-weight: bold;">else</span>
    <span style="color: #e6db74;">"_____"</span> .s
    <span style="color: #fd971f; font-weight: bold;">1</span> <span style="color: #ffffff; font-weight: bold;">equal?</span> <span style="color: #f92672; font-weight: bold;">if</span>
      <span style="color: #e6db74;">"\^o^/"</span> .s
    <span style="color: #f92672; font-weight: bold;">else</span>
      <span style="color: #e6db74;">"_____"</span> .s
    <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #1ef15f; font-weight: bold;">test-function</span>

<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #e6db74;">"* (testing) nested if &amp; else &amp; then"</span> .s .l
  <span style="color: #fd971f; font-weight: bold;">1</span> <span style="color: #fd971f; font-weight: bold;">2</span> .12 .l
  <span style="color: #fd971f; font-weight: bold;">6</span> <span style="color: #fd971f; font-weight: bold;">2</span> .12 .l
  <span style="color: #fd971f; font-weight: bold;">1</span> <span style="color: #fd971f; font-weight: bold;">6</span> .12 .l
  <span style="color: #fd971f; font-weight: bold;">6</span> <span style="color: #fd971f; font-weight: bold;">6</span> .12 .l
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #1ef15f; font-weight: bold;">test-do</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org5187194" class="outline-3">
<h3 id="org5187194"><span class="done test">test</span> if &amp; else &amp; then by factorial</h3>
<div class="outline-text-3" id="text-org5187194">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">factorial</span>
  <span style="color: #FF8888;">&lt;&lt; number -- number &gt;&gt;</span>
  dup
  <span style="color: #ffffff; font-weight: bold;">one?</span> <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  dup sub1 factorial
  mul
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #1ef15f; font-weight: bold;">test-function</span>

<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #e6db74;">"* (testing) if &amp; else &amp; then by factorial"</span> .s .l
  <span style="color: #fd971f; font-weight: bold;">1</span> factorial <span style="color: #fd971f; font-weight: bold;">1</span>   <span style="color: #ffffff; font-weight: bold;">equal?</span>
  <span style="color: #fd971f; font-weight: bold;">2</span> factorial <span style="color: #fd971f; font-weight: bold;">2</span>   <span style="color: #ffffff; font-weight: bold;">equal?</span> and
  <span style="color: #fd971f; font-weight: bold;">3</span> factorial <span style="color: #fd971f; font-weight: bold;">6</span>   <span style="color: #ffffff; font-weight: bold;">equal?</span> and
  <span style="color: #fd971f; font-weight: bold;">4</span> factorial <span style="color: #fd971f; font-weight: bold;">24</span>  <span style="color: #ffffff; font-weight: bold;">equal?</span> and
  <span style="color: #fd971f; font-weight: bold;">5</span> factorial <span style="color: #fd971f; font-weight: bold;">120</span> <span style="color: #ffffff; font-weight: bold;">equal?</span> and
  <span style="color: #fd971f; font-weight: bold;">6</span> factorial <span style="color: #fd971f; font-weight: bold;">720</span> <span style="color: #ffffff; font-weight: bold;">equal?</span> and <span style="color: #1ef15f; font-weight: bold;">test</span>
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #1ef15f; font-weight: bold;">test-do</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org43adaa8" class="outline-3">
<h3 id="org43adaa8">literal-word:loop?</h3>
<div class="outline-text-3" id="text-org43adaa8">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">literal-word:loop?</span>
  <span style="color: #FF8888;">&lt;&lt; word[address, length] -- bool &gt;&gt;</span>
  <span style="color: #e6db74;">"loop"</span> <span style="color: #ffffff; font-weight: bold;">string:</span>equal?
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgea2f886" class="outline-3">
<h3 id="orgea2f886">jojo-compiler-syntax:loop</h3>
<div class="outline-text-3" id="text-orgea2f886">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">jojo-compiler-syntax:loop</span>
  <span style="color: #FF8888;">&lt;&lt; jo, string[address, length], literal-word:loop --</span>
<span style="color: #FF8888;">     jo, string[address, length] &gt;&gt;</span>
  drop2
  <span style="color: #f92672; font-weight: bold;">jo</span> <span style="color: #00ffff; font-weight: bold;">tail-call</span>
    jojo-area,stay
  x<span style="color: #b0b1a3;">|</span>over<span style="color: #b0b1a3;">|</span>xx
    jojo-area,stay
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org767fddc" class="outline-3">
<h3 id="org767fddc">literal-word:recur?</h3>
<div class="outline-text-3" id="text-org767fddc">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">literal-word:recur?</span>
  <span style="color: #FF8888;">&lt;&lt; word[address, length] -- bool &gt;&gt;</span>
  <span style="color: #e6db74;">"recur"</span> <span style="color: #ffffff; font-weight: bold;">string:</span>equal?
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org45b142d" class="outline-3">
<h3 id="org45b142d">jojo-compiler-syntax:recur</h3>
<div class="outline-text-3" id="text-org45b142d">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">jojo-compiler-syntax:recur</span>
  <span style="color: #FF8888;">&lt;&lt; jo, string[address, length], literal-word:recur --</span>
<span style="color: #FF8888;">     jo, string[address, length] &gt;&gt;</span>
  drop2
  x<span style="color: #b0b1a3;">|</span>over<span style="color: #b0b1a3;">|</span>xx
    jojo-area,stay
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgcbf2a14" class="outline-3">
<h3 id="orgcbf2a14"><span class="done test">test</span> loop &amp; recur by factorial</h3>
<div class="outline-text-3" id="text-orgcbf2a14">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">recur-factorial</span>
  <span style="color: #FF8888;">&lt;&lt; number -- number &gt;&gt;</span>
  dup
  <span style="color: #ffffff; font-weight: bold;">one?</span> <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  dup sub1 <span style="color: #f92672; font-weight: bold;">recur</span> mul
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #1ef15f; font-weight: bold;">test-function</span>

<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #e6db74;">"* (testing) recur by factorial"</span> .s .l
  <span style="color: #fd971f; font-weight: bold;">1</span> recur-factorial <span style="color: #fd971f; font-weight: bold;">1</span>   <span style="color: #ffffff; font-weight: bold;">equal?</span>
  <span style="color: #fd971f; font-weight: bold;">2</span> recur-factorial <span style="color: #fd971f; font-weight: bold;">2</span>   <span style="color: #ffffff; font-weight: bold;">equal?</span> and
  <span style="color: #fd971f; font-weight: bold;">3</span> recur-factorial <span style="color: #fd971f; font-weight: bold;">6</span>   <span style="color: #ffffff; font-weight: bold;">equal?</span> and
  <span style="color: #fd971f; font-weight: bold;">4</span> recur-factorial <span style="color: #fd971f; font-weight: bold;">24</span>  <span style="color: #ffffff; font-weight: bold;">equal?</span> and
  <span style="color: #fd971f; font-weight: bold;">5</span> recur-factorial <span style="color: #fd971f; font-weight: bold;">120</span> <span style="color: #ffffff; font-weight: bold;">equal?</span> and
  <span style="color: #fd971f; font-weight: bold;">6</span> recur-factorial <span style="color: #fd971f; font-weight: bold;">720</span> <span style="color: #ffffff; font-weight: bold;">equal?</span> and <span style="color: #1ef15f; font-weight: bold;">test</span>
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #1ef15f; font-weight: bold;">test-do</span>

<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">loop-factorial,loop</span>
  <span style="color: #FF8888;">&lt;&lt; counter, product -- product &gt;&gt;</span>
  over <span style="color: #ffffff; font-weight: bold;">one?</span> <span style="color: #f92672; font-weight: bold;">if</span>
    swap drop
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  over mul
  swap sub1 swap
  <span style="color: #00ffff; font-weight: bold;">loop</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>

<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">loop-factorial</span>
  <span style="color: #FF8888;">&lt;&lt; number -- number &gt;&gt;</span>
  <span style="color: #fd971f; font-weight: bold;">1</span> loop-factorial,loop
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>

<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #e6db74;">"* (testing) loop by factorial"</span> .s .l
  <span style="color: #fd971f; font-weight: bold;">1</span> loop-factorial <span style="color: #fd971f; font-weight: bold;">1</span>   <span style="color: #ffffff; font-weight: bold;">equal?</span>
  <span style="color: #fd971f; font-weight: bold;">2</span> loop-factorial <span style="color: #fd971f; font-weight: bold;">2</span>   <span style="color: #ffffff; font-weight: bold;">equal?</span> and
  <span style="color: #fd971f; font-weight: bold;">3</span> loop-factorial <span style="color: #fd971f; font-weight: bold;">6</span>   <span style="color: #ffffff; font-weight: bold;">equal?</span> and
  <span style="color: #fd971f; font-weight: bold;">4</span> loop-factorial <span style="color: #fd971f; font-weight: bold;">24</span>  <span style="color: #ffffff; font-weight: bold;">equal?</span> and
  <span style="color: #fd971f; font-weight: bold;">5</span> loop-factorial <span style="color: #fd971f; font-weight: bold;">120</span> <span style="color: #ffffff; font-weight: bold;">equal?</span> and
  <span style="color: #fd971f; font-weight: bold;">6</span> loop-factorial <span style="color: #fd971f; font-weight: bold;">720</span> <span style="color: #ffffff; font-weight: bold;">equal?</span> and <span style="color: #1ef15f; font-weight: bold;">test</span>
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #1ef15f; font-weight: bold;">test-do</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org1e9998e" class="outline-3">
<h3 id="org1e9998e"><span class="done test">test</span> recur by fibonacci</h3>
<div class="outline-text-3" id="text-org1e9998e">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #FF8888;">&lt;&lt; 0 1 1 2 3 5 8 13 21 34 55 89 144 233 &gt;&gt;</span>

<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">fibonacci</span>
  <span style="color: #FF8888;">&lt;&lt; number -- number &gt;&gt;</span>
  dup <span style="color: #ffffff; font-weight: bold;">zero?</span> <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  dup <span style="color: #ffffff; font-weight: bold;">one?</span> <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  dup sub1 <span style="color: #f92672; font-weight: bold;">recur</span>
  swap sub1 sub1 <span style="color: #f92672; font-weight: bold;">recur</span>
  add
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>

<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #e6db74;">"* test recur by fibonacci"</span> .s .l
  <span style="color: #fd971f; font-weight: bold;">0</span>  fibonacci <span style="color: #fd971f; font-weight: bold;">0</span>    <span style="color: #ffffff; font-weight: bold;">equal?</span>
  <span style="color: #fd971f; font-weight: bold;">1</span>  fibonacci <span style="color: #fd971f; font-weight: bold;">1</span>    <span style="color: #ffffff; font-weight: bold;">equal?</span> and
  <span style="color: #fd971f; font-weight: bold;">2</span>  fibonacci <span style="color: #fd971f; font-weight: bold;">1</span>    <span style="color: #ffffff; font-weight: bold;">equal?</span> and
  <span style="color: #fd971f; font-weight: bold;">3</span>  fibonacci <span style="color: #fd971f; font-weight: bold;">2</span>    <span style="color: #ffffff; font-weight: bold;">equal?</span> and
  <span style="color: #fd971f; font-weight: bold;">4</span>  fibonacci <span style="color: #fd971f; font-weight: bold;">3</span>    <span style="color: #ffffff; font-weight: bold;">equal?</span> and
  <span style="color: #fd971f; font-weight: bold;">5</span>  fibonacci <span style="color: #fd971f; font-weight: bold;">5</span>    <span style="color: #ffffff; font-weight: bold;">equal?</span> and
  <span style="color: #fd971f; font-weight: bold;">6</span>  fibonacci <span style="color: #fd971f; font-weight: bold;">8</span>    <span style="color: #ffffff; font-weight: bold;">equal?</span> and
  <span style="color: #fd971f; font-weight: bold;">7</span>  fibonacci <span style="color: #fd971f; font-weight: bold;">13</span>   <span style="color: #ffffff; font-weight: bold;">equal?</span> and
  <span style="color: #fd971f; font-weight: bold;">8</span>  fibonacci <span style="color: #fd971f; font-weight: bold;">21</span>   <span style="color: #ffffff; font-weight: bold;">equal?</span> and
  <span style="color: #fd971f; font-weight: bold;">9</span>  fibonacci <span style="color: #fd971f; font-weight: bold;">34</span>   <span style="color: #ffffff; font-weight: bold;">equal?</span> and
  <span style="color: #fd971f; font-weight: bold;">10</span> fibonacci <span style="color: #fd971f; font-weight: bold;">55</span>   <span style="color: #ffffff; font-weight: bold;">equal?</span> and
  <span style="color: #fd971f; font-weight: bold;">11</span> fibonacci <span style="color: #fd971f; font-weight: bold;">89</span>   <span style="color: #ffffff; font-weight: bold;">equal?</span> and
  <span style="color: #fd971f; font-weight: bold;">12</span> fibonacci <span style="color: #fd971f; font-weight: bold;">144</span>  <span style="color: #ffffff; font-weight: bold;">equal?</span> and
  <span style="color: #fd971f; font-weight: bold;">13</span> fibonacci <span style="color: #fd971f; font-weight: bold;">233</span>  <span style="color: #ffffff; font-weight: bold;">equal?</span> and
  <span style="color: #fd971f; font-weight: bold;">14</span> fibonacci <span style="color: #fd971f; font-weight: bold;">377</span>  <span style="color: #ffffff; font-weight: bold;">equal?</span> and
  <span style="color: #fd971f; font-weight: bold;">15</span> fibonacci <span style="color: #fd971f; font-weight: bold;">610</span>  <span style="color: #ffffff; font-weight: bold;">equal?</span> and
  <span style="color: #fd971f; font-weight: bold;">16</span> fibonacci <span style="color: #fd971f; font-weight: bold;">987</span>  <span style="color: #ffffff; font-weight: bold;">equal?</span> and
  <span style="color: #fd971f; font-weight: bold;">17</span> fibonacci <span style="color: #fd971f; font-weight: bold;">1597</span> <span style="color: #ffffff; font-weight: bold;">equal?</span> and
  <span style="color: #fd971f; font-weight: bold;">18</span> fibonacci <span style="color: #fd971f; font-weight: bold;">2584</span> <span style="color: #ffffff; font-weight: bold;">equal?</span> and
  <span style="color: #fd971f; font-weight: bold;">19</span> fibonacci <span style="color: #fd971f; font-weight: bold;">4181</span> <span style="color: #ffffff; font-weight: bold;">equal?</span> and
  <span style="color: #fd971f; font-weight: bold;">20</span> fibonacci <span style="color: #fd971f; font-weight: bold;">6765</span> <span style="color: #ffffff; font-weight: bold;">equal?</span> and <span style="color: #1ef15f; font-weight: bold;">test</span>
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #1ef15f; font-weight: bold;">test-do</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org2b53378" class="outline-3">
<h3 id="org2b53378">more,syntax-rule-set:jojo-compiler</h3>
<div class="outline-text-3" id="text-org2b53378">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">more,syntax-rule-set:jojo-compiler</span>
  <span style="color: #FF8888;">&lt;&lt; -- &gt;&gt;</span>
  <span style="color: #fd971f; font-weight: bold;">jojo-compiler:*syntax-rule-set*</span>
  dup <span style="color: #f92672; font-weight: bold;">jo</span> <span style="color: #ffffff; font-weight: bold;">literal-word:</span>if?    <span style="color: #f92672; font-weight: bold;">jo</span> <span style="color: #ffffff; font-weight: bold;">jojo-compiler-syntax:</span>if    <span style="color: #ffffff; font-weight: bold;">syntax-rule:</span>add
  dup <span style="color: #f92672; font-weight: bold;">jo</span> <span style="color: #ffffff; font-weight: bold;">literal-word:</span>else?  <span style="color: #f92672; font-weight: bold;">jo</span> <span style="color: #ffffff; font-weight: bold;">jojo-compiler-syntax:</span>else  <span style="color: #ffffff; font-weight: bold;">syntax-rule:</span>add
  dup <span style="color: #f92672; font-weight: bold;">jo</span> <span style="color: #ffffff; font-weight: bold;">literal-word:</span>then?  <span style="color: #f92672; font-weight: bold;">jo</span> <span style="color: #ffffff; font-weight: bold;">jojo-compiler-syntax:</span>then  <span style="color: #ffffff; font-weight: bold;">syntax-rule:</span>add
  dup <span style="color: #f92672; font-weight: bold;">jo</span> <span style="color: #ffffff; font-weight: bold;">literal-word:</span>loop?  <span style="color: #f92672; font-weight: bold;">jo</span> <span style="color: #ffffff; font-weight: bold;">jojo-compiler-syntax:</span>loop  <span style="color: #ffffff; font-weight: bold;">syntax-rule:</span>add
      <span style="color: #f92672; font-weight: bold;">jo</span> <span style="color: #ffffff; font-weight: bold;">literal-word:</span>recur? <span style="color: #f92672; font-weight: bold;">jo</span> <span style="color: #ffffff; font-weight: bold;">jojo-compiler-syntax:</span>recur <span style="color: #ffffff; font-weight: bold;">syntax-rule:</span>add
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
<span style="color: #ffffff; font-weight: bold;">more,syntax-rule-set:</span>jojo-compiler
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgafaed97" class="outline-2">
<h2 id="orgafaed97">name &amp; name-hash-table</h2>
<div class="outline-text-2" id="text-orgafaed97">
</div><div id="outline-container-org3103a28" class="outline-3">
<h3 id="org3103a28"><span class="todo note">note</span> </h3>
<div class="outline-text-3" id="text-org3103a28">
<ul class="org-ul">
<li><p>the name-hash-table</p><p>is used both in cicada-nymph and cicada-language</p></li></ul>
</div>
</div>

<div id="outline-container-orgbb35fd2" class="outline-3">
<h3 id="orgbb35fd2">allocate</h3>
<div class="outline-text-3" id="text-orgbb35fd2">
</div><div id="outline-container-org20944ec" class="outline-4">
<h4 id="org20944ec"><span class="todo note">note</span> </h4>
<div class="outline-text-4" id="text-org20944ec">
<ul class="org-ul">
<li><p>an interface of <b>un-initialized-memory</b></p></li></ul>
</div>
</div>

<div id="outline-container-org8f2422e" class="outline-4">
<h4 id="org8f2422e">allocate-memory</h4>
<div class="outline-text-4" id="text-org8f2422e">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">allocate-memory</span>
  <span style="color: #FF8888;">&lt;&lt; size -- address &gt;&gt;</span>
  dup <span style="color: #fd971f; font-weight: bold;">*un-initialized-memory,current-free-address*</span> clear-memory
  <span style="color: #fd971f; font-weight: bold;">*un-initialized-memory,current-free-address*</span> swap <span style="color: #FF8888;">&lt;&lt; address as return value &gt;&gt;</span>
  <span style="color: #f92672; font-weight: bold;">address</span> <span style="color: #fd971f; font-weight: bold;">*un-initialized-memory,current-free-address*</span> add-set
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgb852bb1" class="outline-3">
<h3 id="orgb852bb1"><b>name-hash-table</b></h3>
<div class="outline-text-3" id="text-orgb852bb1">
<ul class="org-ul">
<li><p>the following are some prime number</p><p>ready to be used</p><p><ul class="org-ul"></p><p><li><p>1000003   about 976 k</p></li></p><p><li><p>1000033</p></li></p><p><li><p>1000333</p></li></p><p><li><p>100003    about 97 k</p></li></p><p><li><p>100333</p></li></p><p><li><p>997</p></li></p><p><li><p>499</p></li></ul></p></li></ul>
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #fd971f; font-weight: bold;">100333</span>
<span style="color: #FF8888;">&lt;&lt; drop 13 &gt;&gt;</span>
<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #fd971f; font-weight: bold;">*name-hash-table,size*</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #a1ab3a; font-weight: bold;">define-variable,with-tos</span>

<span style="color: #fd971f; font-weight: bold;">*cell-size*</span> <span style="color: #fd971f; font-weight: bold;">5</span> mul
<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #fd971f; font-weight: bold;">*name-hash-table,unit*</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #a1ab3a; font-weight: bold;">define-variable,with-tos</span>

<span style="color: #fd971f; font-weight: bold;">*name-hash-table,size*</span>
<span style="color: #fd971f; font-weight: bold;">*name-hash-table,unit*</span> mul <span style="color: #AE7C3B; font-weight: bold;">allocate-memory</span>
<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #fd971f; font-weight: bold;">*name-hash-table*</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #a1ab3a; font-weight: bold;">define-variable,with-tos</span>

<span style="color: #fd971f; font-weight: bold;">0</span>
<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #fd971f; font-weight: bold;">*name-hash-table,counter*</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #a1ab3a; font-weight: bold;">define-variable,with-tos</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgcc84f3a" class="outline-3">
<h3 id="orgcc84f3a"><b>name-hash-table,string-area</b></h3>
<div class="outline-text-3" id="text-orgcc84f3a">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #fd971f; font-weight: bold;">*name-hash-table,size*</span> <span style="color: #fd971f; font-weight: bold;">32</span> mul
<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #fd971f; font-weight: bold;">*name-hash-table,string-area,size*</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #a1ab3a; font-weight: bold;">define-variable,with-tos</span>

<span style="color: #fd971f; font-weight: bold;">*name-hash-table,string-area,size*</span>
<span style="color: #AE7C3B; font-weight: bold;">allocate-memory</span>
<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #fd971f; font-weight: bold;">*name-hash-table,string-area*</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #a1ab3a; font-weight: bold;">define-variable,with-tos</span>

<span style="color: #fd971f; font-weight: bold;">*name-hash-table,string-area*</span>
<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #fd971f; font-weight: bold;">*name-hash-table,string-area,current-free-address*</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #a1ab3a; font-weight: bold;">define-variable,with-tos</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org5476bb1" class="outline-3">
<h3 id="org5476bb1">name-hash-table,string-area,stay</h3>
<div class="outline-text-3" id="text-org5476bb1">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">name-hash-table,string-area,stay</span>
  <span style="color: #FF8888;">&lt;&lt; string[address, length] -- &gt;&gt;</span>
  tuck
  <span style="color: #fd971f; font-weight: bold;">*name-hash-table,string-area,current-free-address*</span>
  string<span style="color: #b0b1a3;">-&gt;</span>buffer!
  <span style="color: #f92672; font-weight: bold;">address</span> <span style="color: #fd971f; font-weight: bold;">*name-hash-table,string-area,current-free-address*</span>
  add-set
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgbe24600" class="outline-3">
<h3 id="orgbe24600">make-string,for-name</h3>
<div class="outline-text-3" id="text-orgbe24600">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">make-string,for-name</span>
  <span style="color: #FF8888;">&lt;&lt; string[address, length] -- string-copy[address, length] &gt;&gt;</span>
  <span style="color: #fd971f; font-weight: bold;">*name-hash-table,string-area,current-free-address*</span>
  xx<span style="color: #b0b1a3;">|</span>swap<span style="color: #b0b1a3;">|</span>x
  tuck
  name-hash-table,string-area,stay
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd3527a5" class="outline-3">
<h3 id="orgd3527a5">name</h3>
<div class="outline-text-3" id="text-orgd3527a5">
</div><div id="outline-container-org4d952e2" class="outline-4">
<h4 id="org4d952e2"><span class="todo note">note</span> </h4>
<div class="outline-text-4" id="text-org4d952e2">
<ul class="org-ul">
<li><p>a name is an index into name-hash-table</p></li>
<li><p>an entry can be viewed</p><p><ol class="org-ol"></p><p><li>as a point</li></p><p><li>as an orbit</li></ol></p></li>
<li><p><p></p><p>in a name entry we have the following fields</p><p></p></p><p><table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides"></p><p></p><p></p><p><colgroup></p><p><col  class="org-left" /></p><p></p><p><col  class="org-left" /></p><p></colgroup></p><p><thead></p><p><tr></p><p><th scope="col" class="org-left">name</th></p><p><th scope="col" class="org-left">name-string-address</th></p><p></tr></p><p></p><p><tr></p><p><th scope="col" class="org-left">&#xa0;</th></p><p><th scope="col" class="org-left">name-string-length</th></p><p></tr></p><p></thead></p><p><tbody></p><p><tr></p><p><td class="org-left">&#xa0;</td></p><p><td class="org-left">orbit-length</td></p><p></tr></p><p></p><p><tr></p><p><td class="org-left">&#xa0;</td></p><p><td class="org-left">orbiton</td></p><p></tr></p><p></p><p><tr></p><p><td class="org-left">&#xa0;</td></p><p><td class="org-left">jo</td></p><p></tr></p><p></tbody></p><p></table></p><p><ol class="org-ol"></p><p><li>name-string-address</p><p>0 denotes name not used</li></p><p><li>orbit-length</p><p>as an orbit</p><p>its length gets updated</li></p><p><li>as a point</p><p>it is on an orbit</li></p><p><li>jo</p><p>0 denotes name not used as jo</li></ol></p></li></ul>
</div>
</div>

<div id="outline-container-org853f018" class="outline-4">
<h4 id="org853f018">name-&gt;address</h4>
<div class="outline-text-4" id="text-org853f018">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">name-&gt;address</span>
  <span style="color: #FF8888;">&lt;&lt; name -- address &gt;&gt;</span>
  <span style="color: #fd971f; font-weight: bold;">*name-hash-table,unit*</span> mul
  <span style="color: #fd971f; font-weight: bold;">*name-hash-table*</span> add
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd0884b8" class="outline-4">
<h4 id="orgd0884b8">name,used?</h4>
<div class="outline-text-4" id="text-orgd0884b8">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">name,used?</span>
  <span style="color: #FF8888;">&lt;&lt; name -- bool &gt;&gt;</span>
  name<span style="color: #b0b1a3;">-&gt;</span>address
  get <span style="color: #ffffff; font-weight: bold;">zero?</span> <span style="color: #ffffff; font-weight: bold;">false?</span>
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org8d82041" class="outline-4">
<h4 id="org8d82041">name,used-as-jo?</h4>
<div class="outline-text-4" id="text-org8d82041">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">name,used-as-jo?</span>
  <span style="color: #FF8888;">&lt;&lt; name -- bool &gt;&gt;</span>
  name<span style="color: #b0b1a3;">-&gt;</span>address
  <span style="color: #fd971f; font-weight: bold;">*cell-size*</span> <span style="color: #fd971f; font-weight: bold;">4</span> mul add
  get <span style="color: #ffffff; font-weight: bold;">zero?</span> not
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org9239bac" class="outline-4">
<h4 id="org9239bac">name-&gt;string</h4>
<div class="outline-text-4" id="text-org9239bac">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">name-&gt;string</span>
  <span style="color: #FF8888;">&lt;&lt; name -- string[address, length] &gt;&gt;</span>
  name<span style="color: #b0b1a3;">-&gt;</span>address
  <span style="color: #fd971f; font-weight: bold;">2</span> n-get
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb22ab28" class="outline-4">
<h4 id="orgb22ab28">name,get-orbit-length</h4>
<div class="outline-text-4" id="text-orgb22ab28">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">name,get-orbit-length</span>
  <span style="color: #FF8888;">&lt;&lt; name -- orbit-length &gt;&gt;</span>
  name<span style="color: #b0b1a3;">-&gt;</span>address
  <span style="color: #fd971f; font-weight: bold;">*cell-size*</span> <span style="color: #fd971f; font-weight: bold;">2</span> mul add
  get
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orga225771" class="outline-4">
<h4 id="orga225771">name,get-orbiton</h4>
<div class="outline-text-4" id="text-orga225771">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">name,get-orbiton</span>
  <span style="color: #FF8888;">&lt;&lt; name -- orbiton &gt;&gt;</span>
  name<span style="color: #b0b1a3;">-&gt;</span>address
  <span style="color: #fd971f; font-weight: bold;">*cell-size*</span> <span style="color: #fd971f; font-weight: bold;">3</span> mul add
  get
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd330c77" class="outline-4">
<h4 id="orgd330c77">name,get-jo</h4>
<div class="outline-text-4" id="text-orgd330c77">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">name,get-jo</span>
  <span style="color: #FF8888;">&lt;&lt; name -- jo &gt;&gt;</span>
  name<span style="color: #b0b1a3;">-&gt;</span>address
  <span style="color: #fd971f; font-weight: bold;">*cell-size*</span> <span style="color: #fd971f; font-weight: bold;">4</span> mul add
  get
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org62a4045" class="outline-4">
<h4 id="org62a4045">name,set-string</h4>
<div class="outline-text-4" id="text-org62a4045">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">name,set-string</span>
  <span style="color: #FF8888;">&lt;&lt; string[address, length], name -- &gt;&gt;</span>
  <span style="color: #FF4C4C; font-weight: bold;">&gt;:name</span>
  make-string,for-name
  <span style="color: #83EA83; font-weight: bold;">:name</span> name<span style="color: #b0b1a3;">-&gt;</span>address
  <span style="color: #fd971f; font-weight: bold;">2</span> n-set
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orga497c53" class="outline-4">
<h4 id="orga497c53">name,set-orbit-length</h4>
<div class="outline-text-4" id="text-orga497c53">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">name,set-orbit-length</span>
  <span style="color: #FF8888;">&lt;&lt; orbit-length, name -- &gt;&gt;</span>
  name<span style="color: #b0b1a3;">-&gt;</span>address
  <span style="color: #fd971f; font-weight: bold;">*cell-size*</span> <span style="color: #fd971f; font-weight: bold;">2</span> mul add
  set
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orge621bc1" class="outline-4">
<h4 id="orge621bc1">name,set-orbiton</h4>
<div class="outline-text-4" id="text-orge621bc1">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">name,set-orbiton</span>
  <span style="color: #FF8888;">&lt;&lt; orbiton, name -- &gt;&gt;</span>
  name<span style="color: #b0b1a3;">-&gt;</span>address
  <span style="color: #fd971f; font-weight: bold;">*cell-size*</span> <span style="color: #fd971f; font-weight: bold;">3</span> mul add
  set
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd451ed1" class="outline-4">
<h4 id="orgd451ed1">name,set-jo</h4>
<div class="outline-text-4" id="text-orgd451ed1">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">name,set-jo</span>
  <span style="color: #FF8888;">&lt;&lt; jo, name -- &gt;&gt;</span>
  name<span style="color: #b0b1a3;">-&gt;</span>address
  <span style="color: #fd971f; font-weight: bold;">*cell-size*</span> <span style="color: #fd971f; font-weight: bold;">4</span> mul add
  set
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org7dbf3b5" class="outline-4">
<h4 id="org7dbf3b5">name,no-collision?</h4>
<div class="outline-text-4" id="text-org7dbf3b5">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">name,no-collision?</span>
  <span style="color: #FF8888;">&lt;&lt; name -- bool &gt;&gt;</span>
  dup name,get-orbiton
  <span style="color: #ffffff; font-weight: bold;">equal?</span>
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org52e0d4d" class="outline-3">
<h3 id="org52e0d4d">name-hash-table</h3>
<div class="outline-text-3" id="text-org52e0d4d">
</div><div id="outline-container-orgd36cf98" class="outline-4">
<h4 id="orgd36cf98"><span class="todo note">note</span> interface</h4>
<div class="outline-text-4" id="text-orgd36cf98">
<ul class="org-ul">
<li><p>open addressing</p><p>for we do not need to delete</p></li>
<li><p>math</p><p><ul class="org-ul"></p><p><li><p>hash</p></li></ul></p></li>
<li><p>memory</p><p><ul class="org-ul"></p><p><li><p>insert</p></li></p><p><li><p>search</p></li></ul></p></li>
<li><p>function</p><p><ul class="org-ul"></p><p><li><p>string-&gt;name</p></li></p><p><li><p>name-&gt;string</p></li></ul></p></li></ul>
</div>
</div>

<div id="outline-container-org631bdee" class="outline-4">
<h4 id="org631bdee">name-hash-table,hash</h4>
<div class="outline-text-4" id="text-org631bdee">
<ul class="org-ul">
<li><p>prime table size</p></li>
<li><p>linear probing</p></li></ul>
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">name-hash-table,hash</span>
  <span style="color: #FF8888;">&lt;&lt; number, counter -- index &gt;&gt;</span>
  add <span style="color: #fd971f; font-weight: bold;">*name-hash-table,size*</span> mod
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org10e90e2" class="outline-4">
<h4 id="org10e90e2">string-&gt;finite-carry-sum</h4>
<div class="outline-text-4" id="text-org10e90e2">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #fd971f; font-weight: bold;">16</span>
<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #fd971f; font-weight: bold;">*max-carry-position*</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #a1ab3a; font-weight: bold;">define-variable,with-tos</span>

<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">string-&gt;finite-carry-sum,loop</span>
  <span style="color: #FF8888;">&lt;&lt; carry-sum, string[address, length], counter -- carry-sum &gt;&gt;</span>
  over <span style="color: #ffffff; font-weight: bold;">zero?</span> <span style="color: #f92672; font-weight: bold;">if</span>
    drop drop2
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  dup <span style="color: #fd971f; font-weight: bold;">*max-carry-position*</span> <span style="color: #ffffff; font-weight: bold;">greater-than?</span> <span style="color: #f92672; font-weight: bold;">if</span>
    drop <span style="color: #fd971f; font-weight: bold;">0</span> <span style="color: #FF8888;">&lt;&lt; re-start from 0 &gt;&gt;</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  xx<span style="color: #b0b1a3;">|</span>over<span style="color: #b0b1a3;">|</span>x
  <span style="color: #ffffff; font-weight: bold;">string:</span>byte over
  <span style="color: #fd971f; font-weight: bold;">2</span> swap power
  mul
  x<span style="color: #b0b1a3;">|</span>swap<span style="color: #b0b1a3;">|</span>xxxx add xxx<span style="color: #b0b1a3;">|</span>swap<span style="color: #b0b1a3;">|</span>x
  add1 xx<span style="color: #b0b1a3;">|</span>swap<span style="color: #b0b1a3;">|</span>x
  <span style="color: #ffffff; font-weight: bold;">string:</span>byte-tail x<span style="color: #b0b1a3;">|</span>swap<span style="color: #b0b1a3;">|</span>xx
  <span style="color: #00ffff; font-weight: bold;">loop</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>

<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">string-&gt;finite-carry-sum</span>
  <span style="color: #FF8888;">&lt;&lt; string[address, length] -- carry-sum &gt;&gt;</span>
  <span style="color: #fd971f; font-weight: bold;">0</span> xx<span style="color: #b0b1a3;">|</span>swap<span style="color: #b0b1a3;">|</span>x <span style="color: #FF8888;">&lt;&lt; carry-sum &gt;&gt;</span>
  <span style="color: #fd971f; font-weight: bold;">0</span> <span style="color: #FF8888;">&lt;&lt; counter &gt;&gt;</span>
  string<span style="color: #b0b1a3;">-&gt;</span>finite-carry-sum,loop
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org826398" class="outline-4">
<h4 id="org826398">name-hash-table,search</h4>
<div class="outline-text-4" id="text-org826398">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">name-hash-table,search,loop</span>
  <span style="color: #FF8888;">&lt;&lt; string[address, length], number, counter</span>
<span style="color: #FF8888;">     -- name, true</span>
<span style="color: #FF8888;">     -- name, false &gt;&gt;</span>
  <span style="color: #FF4C4C; font-weight: bold;">&gt;:counter</span> <span style="color: #FF4C4C; font-weight: bold;">&gt;:number</span> <span style="color: #dc322f; font-weight: bold;">&gt;::string</span>
  <span style="color: #83EA83; font-weight: bold;">:number</span> <span style="color: #83EA83; font-weight: bold;">:counter</span> name-hash-table,hash
  <span style="color: #FF4C4C; font-weight: bold;">&gt;:name</span>
  <span style="color: #83EA83; font-weight: bold;">:number</span> <span style="color: #fd971f; font-weight: bold;">0</span> name-hash-table,hash
  <span style="color: #FF4C4C; font-weight: bold;">&gt;:orbit</span>
  <span style="color: #83EA83; font-weight: bold;">:name</span> <span style="color: #ffffff; font-weight: bold;">name,used?</span> <span style="color: #ffffff; font-weight: bold;">false?</span> <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #83EA83; font-weight: bold;">:name</span> <span style="color: #fd971f; font-weight: bold;">false</span>
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #83EA83; font-weight: bold;">:name</span> name<span style="color: #b0b1a3;">-&gt;</span>string
  <span style="color: #5CDD5C; font-weight: bold;">::string</span> <span style="color: #ffffff; font-weight: bold;">string:</span>equal? <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #83EA83; font-weight: bold;">:name</span> <span style="color: #fd971f; font-weight: bold;">true</span>
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #83EA83; font-weight: bold;">:name</span> name,get-orbit-length
  <span style="color: #83EA83; font-weight: bold;">:counter</span> <span style="color: #ffffff; font-weight: bold;">equal?</span> <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #83EA83; font-weight: bold;">:name</span> <span style="color: #fd971f; font-weight: bold;">false</span>
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #5CDD5C; font-weight: bold;">::string</span>
  <span style="color: #83EA83; font-weight: bold;">:number</span> <span style="color: #83EA83; font-weight: bold;">:counter</span> add1
  <span style="color: #00ffff; font-weight: bold;">loop</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>

<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">name-hash-table,search</span>
  <span style="color: #FF8888;">&lt;&lt; string[address, length]</span>
<span style="color: #FF8888;">     -- name, true</span>
<span style="color: #FF8888;">     -- name, false &gt;&gt;</span>
  dup2 string<span style="color: #b0b1a3;">-&gt;</span>finite-carry-sum
  <span style="color: #fd971f; font-weight: bold;">0</span> name-hash-table,search,loop
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orga4c3874" class="outline-4">
<h4 id="orga4c3874">name-hash-table,insert</h4>
<div class="outline-text-4" id="text-orga4c3874">
<ul class="org-ul">
<li><p>I found that (insert) can not re-use (search)</p></li></ul>
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">name-hash-table,insert,loop</span>
  <span style="color: #FF8888;">&lt;&lt; string[address, length], number, counter</span>
<span style="color: #FF8888;">     -- name, true</span>
<span style="color: #FF8888;">     -- name, false &gt;&gt;</span>
  <span style="color: #FF4C4C; font-weight: bold;">&gt;:counter</span> <span style="color: #FF4C4C; font-weight: bold;">&gt;:number</span> <span style="color: #dc322f; font-weight: bold;">&gt;::string</span>
  <span style="color: #83EA83; font-weight: bold;">:number</span> <span style="color: #83EA83; font-weight: bold;">:counter</span> name-hash-table,hash
  <span style="color: #FF4C4C; font-weight: bold;">&gt;:name</span>
  <span style="color: #83EA83; font-weight: bold;">:number</span> <span style="color: #fd971f; font-weight: bold;">0</span> name-hash-table,hash
  <span style="color: #FF4C4C; font-weight: bold;">&gt;:orbit</span>
  <span style="color: #83EA83; font-weight: bold;">:name</span> <span style="color: #ffffff; font-weight: bold;">name,used?</span> <span style="color: #ffffff; font-weight: bold;">false?</span> <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #5CDD5C; font-weight: bold;">::string</span> <span style="color: #83EA83; font-weight: bold;">:name</span>
    name,set-string
    <span style="color: #83EA83; font-weight: bold;">:orbit</span> <span style="color: #83EA83; font-weight: bold;">:name</span>
    name,set-orbiton
    <span style="color: #83EA83; font-weight: bold;">:counter</span> <span style="color: #83EA83; font-weight: bold;">:orbit</span>
    name,set-orbit-length
    <span style="color: #fd971f; font-weight: bold;">1</span> <span style="color: #f92672; font-weight: bold;">address</span> <span style="color: #fd971f; font-weight: bold;">*name-hash-table,counter*</span> add-set
    <span style="color: #83EA83; font-weight: bold;">:name</span> <span style="color: #fd971f; font-weight: bold;">true</span>
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #83EA83; font-weight: bold;">:name</span> name<span style="color: #b0b1a3;">-&gt;</span>string
  <span style="color: #5CDD5C; font-weight: bold;">::string</span> <span style="color: #ffffff; font-weight: bold;">string:</span>equal? <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #83EA83; font-weight: bold;">:name</span> <span style="color: #fd971f; font-weight: bold;">true</span>
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #83EA83; font-weight: bold;">:counter</span> <span style="color: #fd971f; font-weight: bold;">*name-hash-table,size*</span> <span style="color: #ffffff; font-weight: bold;">equal?</span> <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #83EA83; font-weight: bold;">:name</span> <span style="color: #fd971f; font-weight: bold;">false</span>
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #5CDD5C; font-weight: bold;">::string</span>
  <span style="color: #83EA83; font-weight: bold;">:number</span>
  <span style="color: #83EA83; font-weight: bold;">:counter</span> add1
  <span style="color: #00ffff; font-weight: bold;">loop</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>

<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">name-hash-table,insert</span>
  <span style="color: #FF8888;">&lt;&lt; string[address, length]</span>
<span style="color: #FF8888;">     -- name, true</span>
<span style="color: #FF8888;">     -- name, false &gt;&gt;</span>
  dup2 string<span style="color: #b0b1a3;">-&gt;</span>finite-carry-sum
  <span style="color: #fd971f; font-weight: bold;">0</span> name-hash-table,insert,loop
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org1959eff" class="outline-4">
<h4 id="org1959eff">string-&gt;name</h4>
<div class="outline-text-4" id="text-org1959eff">
<ul class="org-ul">
<li><p>error handling here</p></li></ul>
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">string-&gt;name</span>
  <span style="color: #FF8888;">&lt;&lt; string[address, length] -- name &gt;&gt;</span>
  name-hash-table,insert
  <span style="color: #ffffff; font-weight: bold;">false?</span> <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #e6db74;">"* (string-&gt;name) *name-hash-table* is full!"</span> .s .l
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org71a2899" class="outline-4">
<h4 id="org71a2899"><span class="todo note">note</span> about report</h4>
<div class="outline-text-4" id="text-org71a2899">
<ul class="org-ul">
<li><p>report point orbit by orbit</p><p>in the following format</p></li>
<li><p>{index} string # orbit-lenght</p><p><ul class="org-ul"></p><p><li><p>{index} string</p></li></p><p><li><p>{index} string</p></li></p><p><li><p>{index} string</p></li></ul></p></li></ul>
</div>
</div>

<div id="outline-container-orga1bc275" class="outline-4">
<h4 id="orga1bc275">name-hash-table,report</h4>
<div class="outline-text-4" id="text-orga1bc275">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">name-hash-table,report,orbit</span>
  <span style="color: #FF8888;">&lt;&lt; name, counter -- &gt;&gt;</span>
  over name,get-orbit-length
  over <span style="color: #ffffff; font-weight: bold;">less-than?</span> <span style="color: #f92672; font-weight: bold;">if</span>
    drop2
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  over name<span style="color: #b0b1a3;">-&gt;</span>string string<span style="color: #b0b1a3;">-&gt;</span>finite-carry-sum
  over name-hash-table,hash
  dup name,get-orbiton
  <span style="color: #FF8888;">&lt;&lt; name, counter, new-name, orbiton &gt;&gt;</span>
  x<span style="color: #b0b1a3;">|</span>over<span style="color: #b0b1a3;">|</span>xxx name<span style="color: #b0b1a3;">-&gt;</span>string string<span style="color: #b0b1a3;">-&gt;</span>finite-carry-sum
  <span style="color: #fd971f; font-weight: bold;">0</span> name-hash-table,hash
  <span style="color: #ffffff; font-weight: bold;">equal?</span> <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #e6db74;">"  {"</span> .s
    dup write-number
    <span style="color: #e6db74;">"} "</span> .s
    name<span style="color: #b0b1a3;">-&gt;</span>string .s
    .l
  <span style="color: #f92672; font-weight: bold;">else</span>
    drop
  <span style="color: #f92672; font-weight: bold;">then</span>
  add1
  <span style="color: #00ffff; font-weight: bold;">loop</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>

<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">name-hash-table,report,loop</span>
  <span style="color: #FF8888;">&lt;&lt; name -- &gt;&gt;</span>
  dup <span style="color: #fd971f; font-weight: bold;">*name-hash-table,size*</span> <span style="color: #ffffff; font-weight: bold;">equal?</span> <span style="color: #f92672; font-weight: bold;">if</span>
    drop
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  dup <span style="color: #ffffff; font-weight: bold;">name,used?</span> <span style="color: #f92672; font-weight: bold;">if</span>
  dup <span style="color: #ffffff; font-weight: bold;">name,no-collision?</span> <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #FF8888;">&lt;&lt; * {index} string # orbit-lenght &gt;&gt;</span>
    <span style="color: #e6db74;">"* {"</span> .s
    dup write-number
    <span style="color: #e6db74;">"} "</span> .s
    dup name<span style="color: #b0b1a3;">-&gt;</span>string .s
    <span style="color: #e6db74;">" # "</span> .s
    dup name,get-orbit-length
    write-number
    .l
    dup <span style="color: #fd971f; font-weight: bold;">1</span> name-hash-table,report,orbit
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  add1
  <span style="color: #00ffff; font-weight: bold;">loop</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>

<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">name-hash-table,report</span>
  <span style="color: #FF8888;">&lt;&lt; -- &gt;&gt;</span>
  <span style="color: #fd971f; font-weight: bold;">0</span> name-hash-table,report,loop
  <span style="color: #e6db74;">"* totally : "</span> .s
  <span style="color: #fd971f; font-weight: bold;">*name-hash-table,counter*</span> write-number
  .l
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org97943d9" class="outline-4">
<h4 id="org97943d9"><span class="done test">test</span> string-&gt;name &amp; name-&gt;string</h4>
<div class="outline-text-4" id="text-org97943d9">
<ul class="org-ul">
<li><p>set <b>name-hash-table,size</b> to a small number [for example 13]</p><p>then use the following function</p><p>and (name-hash-table,report) to do test</p></li></ul>
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #e6db74;">"* (testing) string-&gt;name &amp; name-&gt;string"</span> .s .l
  <span style="color: #e6db74;">"a-000"</span> dup2 string<span style="color: #b0b1a3;">-&gt;</span>name name<span style="color: #b0b1a3;">-&gt;</span>string <span style="color: #ffffff; font-weight: bold;">string:</span>equal?
  <span style="color: #e6db74;">"a-111"</span> dup2 string<span style="color: #b0b1a3;">-&gt;</span>name name<span style="color: #b0b1a3;">-&gt;</span>string <span style="color: #ffffff; font-weight: bold;">string:</span>equal? and
  <span style="color: #e6db74;">"a-222"</span> dup2 string<span style="color: #b0b1a3;">-&gt;</span>name name<span style="color: #b0b1a3;">-&gt;</span>string <span style="color: #ffffff; font-weight: bold;">string:</span>equal? and
  <span style="color: #e6db74;">"a-333"</span> dup2 string<span style="color: #b0b1a3;">-&gt;</span>name name<span style="color: #b0b1a3;">-&gt;</span>string <span style="color: #ffffff; font-weight: bold;">string:</span>equal? and
  <span style="color: #e6db74;">"a-444"</span> dup2 string<span style="color: #b0b1a3;">-&gt;</span>name name<span style="color: #b0b1a3;">-&gt;</span>string <span style="color: #ffffff; font-weight: bold;">string:</span>equal? and
  <span style="color: #e6db74;">"a-555"</span> dup2 string<span style="color: #b0b1a3;">-&gt;</span>name name<span style="color: #b0b1a3;">-&gt;</span>string <span style="color: #ffffff; font-weight: bold;">string:</span>equal? and
  <span style="color: #e6db74;">"a-666"</span> dup2 string<span style="color: #b0b1a3;">-&gt;</span>name name<span style="color: #b0b1a3;">-&gt;</span>string <span style="color: #ffffff; font-weight: bold;">string:</span>equal? and
  <span style="color: #e6db74;">"a-777"</span> dup2 string<span style="color: #b0b1a3;">-&gt;</span>name name<span style="color: #b0b1a3;">-&gt;</span>string <span style="color: #ffffff; font-weight: bold;">string:</span>equal? and
  <span style="color: #e6db74;">"a-888"</span> dup2 string<span style="color: #b0b1a3;">-&gt;</span>name name<span style="color: #b0b1a3;">-&gt;</span>string <span style="color: #ffffff; font-weight: bold;">string:</span>equal? and
  <span style="color: #e6db74;">"a-999"</span> dup2 string<span style="color: #b0b1a3;">-&gt;</span>name name<span style="color: #b0b1a3;">-&gt;</span>string <span style="color: #ffffff; font-weight: bold;">string:</span>equal? and
  <span style="color: #e6db74;">"b-000"</span> dup2 string<span style="color: #b0b1a3;">-&gt;</span>name name<span style="color: #b0b1a3;">-&gt;</span>string <span style="color: #ffffff; font-weight: bold;">string:</span>equal? and
  <span style="color: #e6db74;">"b-111"</span> dup2 string<span style="color: #b0b1a3;">-&gt;</span>name name<span style="color: #b0b1a3;">-&gt;</span>string <span style="color: #ffffff; font-weight: bold;">string:</span>equal? and
  <span style="color: #e6db74;">"b-222"</span> dup2 string<span style="color: #b0b1a3;">-&gt;</span>name name<span style="color: #b0b1a3;">-&gt;</span>string <span style="color: #ffffff; font-weight: bold;">string:</span>equal? and
  <span style="color: #e6db74;">"b-333"</span> dup2 string<span style="color: #b0b1a3;">-&gt;</span>name name<span style="color: #b0b1a3;">-&gt;</span>string <span style="color: #ffffff; font-weight: bold;">string:</span>equal? and
  <span style="color: #e6db74;">"b-444"</span> dup2 string<span style="color: #b0b1a3;">-&gt;</span>name name<span style="color: #b0b1a3;">-&gt;</span>string <span style="color: #ffffff; font-weight: bold;">string:</span>equal? and
  <span style="color: #e6db74;">"b-555"</span> dup2 string<span style="color: #b0b1a3;">-&gt;</span>name name<span style="color: #b0b1a3;">-&gt;</span>string <span style="color: #ffffff; font-weight: bold;">string:</span>equal? and
  <span style="color: #e6db74;">"b-666"</span> dup2 string<span style="color: #b0b1a3;">-&gt;</span>name name<span style="color: #b0b1a3;">-&gt;</span>string <span style="color: #ffffff; font-weight: bold;">string:</span>equal? and
  <span style="color: #e6db74;">"b-777"</span> dup2 string<span style="color: #b0b1a3;">-&gt;</span>name name<span style="color: #b0b1a3;">-&gt;</span>string <span style="color: #ffffff; font-weight: bold;">string:</span>equal? and
  <span style="color: #e6db74;">"b-888"</span> dup2 string<span style="color: #b0b1a3;">-&gt;</span>name name<span style="color: #b0b1a3;">-&gt;</span>string <span style="color: #ffffff; font-weight: bold;">string:</span>equal? and
  <span style="color: #e6db74;">"b-999"</span> dup2 string<span style="color: #b0b1a3;">-&gt;</span>name name<span style="color: #b0b1a3;">-&gt;</span>string <span style="color: #ffffff; font-weight: bold;">string:</span>equal? and <span style="color: #1ef15f; font-weight: bold;">test</span>
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #1ef15f; font-weight: bold;">test-do</span>

<span style="color: #FF8888;">&lt;&lt;</span>
<span style="color: #FF8888;">name-hash-table,report</span>
<span style="color: #FF8888;">&gt;&gt;</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org84e9724" class="outline-4">
<h4 id="org84e9724">name-hash-table,find-jo</h4>
<div class="outline-text-4" id="text-org84e9724">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">name-hash-table,find-jo</span>
  <span style="color: #FF8888;">&lt;&lt; word[address, length]</span>
<span style="color: #FF8888;">     -- jo, true</span>
<span style="color: #FF8888;">     -- false &gt;&gt;</span>
  name-hash-table,search <span style="color: #f92672; font-weight: bold;">if</span>
  <span style="color: #f92672; font-weight: bold;">else</span>
    drop
    <span style="color: #fd971f; font-weight: bold;">false</span>
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  dup <span style="color: #ffffff; font-weight: bold;">name,used-as-jo?</span> <span style="color: #f92672; font-weight: bold;">if</span>
    name,get-jo
    <span style="color: #fd971f; font-weight: bold;">true</span>
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  drop
  <span style="color: #fd971f; font-weight: bold;">false</span>
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org6f4964e" class="outline-4">
<h4 id="org6f4964e"><span class="done test">test</span> name-hash-table,find-jo</h4>
<div class="outline-text-4" id="text-org6f4964e">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #e6db74;">"* (testing) name-hash-table,find-jo"</span> .s .l
  <span style="color: #e6db74;">"add"</span> name-hash-table,find-jo <span style="color: #f92672; font-weight: bold;">if</span>
    name<span style="color: #b0b1a3;">-&gt;</span>string <span style="color: #e6db74;">"add"</span> <span style="color: #ffffff; font-weight: bold;">string:</span>equal? <span style="color: #1ef15f; font-weight: bold;">test</span>
  <span style="color: #f92672; font-weight: bold;">else</span>
    <span style="color: #fd971f; font-weight: bold;">false</span> <span style="color: #1ef15f; font-weight: bold;">test</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #1ef15f; font-weight: bold;">test-do</span>
</pre>
</div>
</div>
</div>
</div>
</div>


<div id="outline-container-org99903e" class="outline-2">
<h2 id="org99903e">global-naming-stack &amp; name-record</h2>
<div class="outline-text-2" id="text-org99903e">
</div><div id="outline-container-org5abfd52" class="outline-3">
<h3 id="org5abfd52"><span class="todo note">note</span> global-naming-stack</h3>
<div class="outline-text-3" id="text-org5abfd52">
<ul class="org-ul">
<li><p>(define-*) push</p><p>(undo) pop</p></li></ul>
</div>
</div>

<div id="outline-container-org1e83fd9" class="outline-3">
<h3 id="org1e83fd9"><span class="todo note">note</span> name-record</h3>
<div class="outline-text-3" id="text-org1e83fd9">
<ul class="org-ul">
<li><p><b>global-naming-stack</b> contain name-record</p></li>
<li><p><p></p><p>structure</p><p></p></p><p><table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides"></p><p></p><p></p><p><colgroup></p><p><col  class="org-left" /></p><p></p><p><col  class="org-left" /></p><p></colgroup></p><p><tbody></p><p><tr></p><p><td class="org-left">name-record</td></p><p><td class="org-left">old-jo</td></p><p></tr></p><p></p><p><tr></p><p><td class="org-left">&#xa0;</td></p><p><td class="org-left">name</td></p><p></tr></p><p></p><p><tr></p><p><td class="org-left">&#xa0;</td></p><p><td class="org-left">new-jo</td></p><p></tr></p><p></tbody></p><p></table></p></li></ul>
</div>
</div>

<div id="outline-container-orgcaa7cf6" class="outline-3">
<h3 id="orgcaa7cf6"><b>global-naming-stack</b></h3>
<div class="outline-text-3" id="text-orgcaa7cf6">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #fd971f; font-weight: bold;">100</span> <span style="color: #fd971f; font-weight: bold;">1024</span> mul
<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #fd971f; font-weight: bold;">global-naming-stack:*size*</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #a1ab3a; font-weight: bold;">define-variable,with-tos</span>

<span style="color: #fd971f; font-weight: bold;">3</span> <span style="color: #fd971f; font-weight: bold;">*cell-size*</span> mul
<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #fd971f; font-weight: bold;">global-naming-stack:*unit*</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #a1ab3a; font-weight: bold;">define-variable,with-tos</span>

<span style="color: #fd971f; font-weight: bold;">global-naming-stack:*size*</span>
<span style="color: #fd971f; font-weight: bold;">global-naming-stack:*unit*</span> mul <span style="color: #AE7C3B; font-weight: bold;">allocate-memory</span>
<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #fd971f; font-weight: bold;">*global-naming-stack*</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #a1ab3a; font-weight: bold;">define-variable,with-tos</span>

<span style="color: #fd971f; font-weight: bold;">*global-naming-stack*</span>
<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #fd971f; font-weight: bold;">global-naming-stack:*pointer*</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #a1ab3a; font-weight: bold;">define-variable,with-tos</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc23f82b" class="outline-3">
<h3 id="orgc23f82b">name-record:[get|set]-old-jo</h3>
<div class="outline-text-3" id="text-orgc23f82b">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">name-record:get-old-jo</span>
  <span style="color: #FF8888;">&lt;&lt; name-record -- old-jo &gt;&gt;</span>
  get
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>

<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">name-record:set-old-jo</span>
  <span style="color: #FF8888;">&lt;&lt; old-jo, name-record -- &gt;&gt;</span>
  set
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org75db36a" class="outline-3">
<h3 id="org75db36a">name-record:[get|set]-name</h3>
<div class="outline-text-3" id="text-org75db36a">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">name-record:get-name</span>
  <span style="color: #FF8888;">&lt;&lt; name-record -- name &gt;&gt;</span>
  <span style="color: #fd971f; font-weight: bold;">*cell-size*</span> add get
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>

<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">name-record:set-name</span>
  <span style="color: #FF8888;">&lt;&lt; name, name-record -- &gt;&gt;</span>
  <span style="color: #fd971f; font-weight: bold;">*cell-size*</span> add set
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org97aec31" class="outline-3">
<h3 id="org97aec31">name-record:[get|set]-new-jo</h3>
<div class="outline-text-3" id="text-org97aec31">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">name-record:get-new-jo</span>
  <span style="color: #FF8888;">&lt;&lt; name-record -- new-jo &gt;&gt;</span>
  <span style="color: #fd971f; font-weight: bold;">*cell-size*</span> <span style="color: #fd971f; font-weight: bold;">2</span> mul add get
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>

<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">name-record:set-new-jo</span>
  <span style="color: #FF8888;">&lt;&lt; new-jo, name-record -- &gt;&gt;</span>
  <span style="color: #fd971f; font-weight: bold;">*cell-size*</span> <span style="color: #fd971f; font-weight: bold;">2</span> mul add set
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgdca0c1d" class="outline-3">
<h3 id="orgdca0c1d">global-naming-stack:record-jo</h3>
<div class="outline-text-3" id="text-orgdca0c1d">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">global-naming-stack:record-jo</span>
  <span style="color: #FF8888;">&lt;&lt; jo, name -- &gt;&gt;</span>
  dup name,get-jo
  <span style="color: #fd971f; font-weight: bold;">global-naming-stack:*pointer*</span> <span style="color: #ffffff; font-weight: bold;">name-record:</span>set-old-jo
  dup2 name,set-jo
  <span style="color: #fd971f; font-weight: bold;">global-naming-stack:*pointer*</span> <span style="color: #ffffff; font-weight: bold;">name-record:</span>set-name
  <span style="color: #fd971f; font-weight: bold;">global-naming-stack:*pointer*</span> <span style="color: #ffffff; font-weight: bold;">name-record:</span>set-new-jo
  <span style="color: #fd971f; font-weight: bold;">global-naming-stack:*unit*</span> <span style="color: #f92672; font-weight: bold;">address</span> <span style="color: #fd971f; font-weight: bold;">global-naming-stack:*pointer*</span> add-set
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org4b8327a" class="outline-3">
<h3 id="org4b8327a">global-naming-stack:delete-last-record</h3>
<div class="outline-text-3" id="text-org4b8327a">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">global-naming-stack:delete-last-record</span>
  <span style="color: #FF8888;">&lt;&lt; -- &gt;&gt;</span>
  <span style="color: #fd971f; font-weight: bold;">global-naming-stack:*unit*</span>
  <span style="color: #f92672; font-weight: bold;">address</span> <span style="color: #fd971f; font-weight: bold;">global-naming-stack:*pointer*</span>
  sub-set
  <span style="color: #fd971f; font-weight: bold;">global-naming-stack:*pointer*</span> <span style="color: #ffffff; font-weight: bold;">name-record:</span>get-old-jo
  <span style="color: #fd971f; font-weight: bold;">global-naming-stack:*pointer*</span> <span style="color: #ffffff; font-weight: bold;">name-record:</span>get-name
  name,set-jo
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org4639ec6" class="outline-3">
<h3 id="org4639ec6">jo,find-name</h3>
<div class="outline-text-3" id="text-org4639ec6">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">jo,find-name,loop</span>
  <span style="color: #FF8888;">&lt;&lt; jo, current-record</span>
<span style="color: #FF8888;">     -- name, true</span>
<span style="color: #FF8888;">     -- false &gt;&gt;</span>
  dup <span style="color: #fd971f; font-weight: bold;">*global-naming-stack*</span> <span style="color: #ffffff; font-weight: bold;">equal?</span> <span style="color: #f92672; font-weight: bold;">if</span>
    drop2
    <span style="color: #fd971f; font-weight: bold;">false</span>
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #fd971f; font-weight: bold;">global-naming-stack:*unit*</span> sub
  dup <span style="color: #FF4C4C; font-weight: bold;">&gt;:name-record</span>
  over
  <span style="color: #83EA83; font-weight: bold;">:name-record</span> <span style="color: #ffffff; font-weight: bold;">name-record:</span>get-new-jo <span style="color: #ffffff; font-weight: bold;">equal?</span> <span style="color: #f92672; font-weight: bold;">if</span>
    drop2
    <span style="color: #83EA83; font-weight: bold;">:name-record</span> <span style="color: #ffffff; font-weight: bold;">name-record:</span>get-name
    <span style="color: #fd971f; font-weight: bold;">true</span>
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #00ffff; font-weight: bold;">loop</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>

<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">jo,find-name</span>
  <span style="color: #FF8888;">&lt;&lt; jo</span>
<span style="color: #FF8888;">     -- name, true</span>
<span style="color: #FF8888;">     -- false &gt;&gt;</span>
  <span style="color: #fd971f; font-weight: bold;">global-naming-stack:*pointer*</span>
  jo,find-name,loop
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org5ceb84b" class="outline-3">
<h3 id="org5ceb84b">name-hash-table,record-jo,by-link</h3>
<div class="outline-text-3" id="text-org5ceb84b">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">name-hash-table,record-jo,by-link</span>
  <span style="color: #FF8888;">&lt;&lt; link -- &gt;&gt;</span>
  <span style="color: #FF4C4C; font-weight: bold;">&gt;:link</span>
  <span style="color: #83EA83; font-weight: bold;">:link</span> link<span style="color: #b0b1a3;">-&gt;</span>jo
  <span style="color: #83EA83; font-weight: bold;">:link</span> link<span style="color: #b0b1a3;">-&gt;</span>name-string string<span style="color: #b0b1a3;">-&gt;</span>name
  <span style="color: #ffffff; font-weight: bold;">global-naming-stack:</span>record-jo
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org61d6957" class="outline-2">
<h2 id="org61d6957">jojo-compiler-syntax:quote</h2>
<div class="outline-text-2" id="text-org61d6957">
</div><div id="outline-container-org6a8066c" class="outline-3">
<h3 id="org6a8066c">quote-word?</h3>
<div class="outline-text-3" id="text-org6a8066c">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">quote-word?</span>
  <span style="color: #FF8888;">&lt;&lt; word[address, length] -- bool &gt;&gt;</span>
  dup <span style="color: #fd971f; font-weight: bold;">1</span> <span style="color: #ffffff; font-weight: bold;">less-or-equal?</span> <span style="color: #f92672; font-weight: bold;">if</span>
    drop2
    <span style="color: #fd971f; font-weight: bold;">false</span>
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #ffffff; font-weight: bold;">string:</span>byte <span style="color: #e6db74;">"'"</span> <span style="color: #ffffff; font-weight: bold;">string:</span>byte <span style="color: #ffffff; font-weight: bold;">equal?</span>
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org5b6c4ea" class="outline-3">
<h3 id="org5b6c4ea">jojo-compiler-syntax:quote</h3>
<div class="outline-text-3" id="text-org5b6c4ea">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">jojo-compiler-syntax:quote</span>
  <span style="color: #FF8888;">&lt;&lt; string[address, length], word[address, length] --</span>
<span style="color: #FF8888;">     string[address, length] &gt;&gt;</span>
  <span style="color: #f92672; font-weight: bold;">jo</span> instruction,literal
    jojo-area,stay
  <span style="color: #ffffff; font-weight: bold;">string:</span>byte-tail string<span style="color: #b0b1a3;">-&gt;</span>name
    jojo-area,stay
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgbbe92e5" class="outline-3">
<h3 id="orgbbe92e5">more,syntax-rule-set:jojo-compiler</h3>
<div class="outline-text-3" id="text-orgbbe92e5">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">more,syntax-rule-set:jojo-compiler</span>
  <span style="color: #FF8888;">&lt;&lt; -- &gt;&gt;</span>
  <span style="color: #fd971f; font-weight: bold;">jojo-compiler:*syntax-rule-set*</span>
  <span style="color: #f92672; font-weight: bold;">jo</span> <span style="color: #ffffff; font-weight: bold;">quote-word?</span> <span style="color: #f92672; font-weight: bold;">jo</span> <span style="color: #ffffff; font-weight: bold;">jojo-compiler-syntax:</span>quote <span style="color: #ffffff; font-weight: bold;">syntax-rule:</span>add
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
<span style="color: #ffffff; font-weight: bold;">more,syntax-rule-set:</span>jojo-compiler
</pre>
</div>
</div>
</div>

<div id="outline-container-org4f3f072" class="outline-3">
<h3 id="org4f3f072"><span class="done test">test</span> jojo-compiler-syntax:quote</h3>
<div class="outline-text-3" id="text-org4f3f072">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #e6db74;">"* (testing) jojo-compiler-syntax:quote"</span> .s .l
  <span style="color: #fd971f; font-weight: bold;">'testing--jojo-compiler-syntax:quote</span> name<span style="color: #b0b1a3;">-&gt;</span>string
  <span style="color: #e6db74;">"testing--jojo-compiler-syntax:quote"</span> <span style="color: #ffffff; font-weight: bold;">string:</span>equal? <span style="color: #1ef15f; font-weight: bold;">test</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #1ef15f; font-weight: bold;">test-do</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgcd46c22" class="outline-2">
<h2 id="orgcd46c22">scope-stack &amp; offset-record</h2>
<div class="outline-text-2" id="text-orgcd46c22">
</div><div id="outline-container-orgdd109eb" class="outline-3">
<h3 id="orgdd109eb"><b>scope-stack</b></h3>
<div class="outline-text-3" id="text-orgdd109eb">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #fd971f; font-weight: bold;">10</span> <span style="color: #fd971f; font-weight: bold;">1024</span> mul
<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #fd971f; font-weight: bold;">scope-stack:*size*</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #a1ab3a; font-weight: bold;">define-variable,with-tos</span>

<span style="color: #fd971f; font-weight: bold;">2</span> <span style="color: #fd971f; font-weight: bold;">*cell-size*</span> mul
<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #fd971f; font-weight: bold;">scope-stack:*unit*</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #a1ab3a; font-weight: bold;">define-variable,with-tos</span>

<span style="color: #fd971f; font-weight: bold;">scope-stack:*size*</span>
<span style="color: #fd971f; font-weight: bold;">scope-stack:*unit*</span> mul <span style="color: #AE7C3B; font-weight: bold;">allocate-memory</span>
<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #fd971f; font-weight: bold;">*scope-stack*</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #a1ab3a; font-weight: bold;">define-variable,with-tos</span>

<span style="color: #fd971f; font-weight: bold;">*scope-stack*</span>
<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #fd971f; font-weight: bold;">scope-stack:*pointer*</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #a1ab3a; font-weight: bold;">define-variable,with-tos</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org79987e9" class="outline-3">
<h3 id="org79987e9"><span class="todo note">note</span> offset-record</h3>
<div class="outline-text-3" id="text-org79987e9">
<ul class="org-ul">
<li><p><p></p><p>structure</p><p></p></p><p><table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides"></p><p></p><p></p><p><colgroup></p><p><col  class="org-left" /></p><p></p><p><col  class="org-left" /></p><p></colgroup></p><p><tbody></p><p><tr></p><p><td class="org-left">offset-record</td></p><p><td class="org-left">name</td></p><p></tr></p><p></p><p><tr></p><p><td class="org-left">&#xa0;</td></p><p><td class="org-left">offset</td></p><p></tr></p><p></tbody></p><p></table></p><p><p></p><p>specially</p><p></p></p><p><table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides"></p><p></p><p></p><p><colgroup></p><p><col  class="org-left" /></p><p></p><p><col  class="org-right" /></p><p></colgroup></p><p><tbody></p><p><tr></p><p><td class="org-left">scope-delimiter</td></p><p><td class="org-right">0</td></p><p></tr></p><p></p><p><tr></p><p><td class="org-left">&#xa0;</td></p><p><td class="org-right">0</td></p><p></tr></p><p></tbody></p><p></table></p></li></ul>
</div>
</div>

<div id="outline-container-org7809636" class="outline-3">
<h3 id="org7809636">offset-record,[get|set]-name</h3>
<div class="outline-text-3" id="text-org7809636">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">offset-record,get-name</span>
  <span style="color: #FF8888;">&lt;&lt; offset-record -- name &gt;&gt;</span>
  get
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>

<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">offset-record,set-name</span>
  <span style="color: #FF8888;">&lt;&lt; name, offset-record -- &gt;&gt;</span>
  set
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org995d593" class="outline-3">
<h3 id="org995d593">offset-record,[get|set]-offset</h3>
<div class="outline-text-3" id="text-org995d593">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">offset-record,get-offset</span>
  <span style="color: #FF8888;">&lt;&lt; offset-record -- offset &gt;&gt;</span>
  <span style="color: #fd971f; font-weight: bold;">*cell-size*</span> add get
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>

<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">offset-record,set-offset</span>
  <span style="color: #FF8888;">&lt;&lt; offset, offset-record -- &gt;&gt;</span>
  <span style="color: #fd971f; font-weight: bold;">*cell-size*</span> add set
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org9532775" class="outline-3">
<h3 id="org9532775">offset-record,scope-delimiter?</h3>
<div class="outline-text-3" id="text-org9532775">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">offset-record,scope-delimiter?</span>
  <span style="color: #FF8888;">&lt;&lt; offset-record -- bool &gt;&gt;</span>
  offset-record,get-name <span style="color: #ffffff; font-weight: bold;">zero?</span>
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org2bf9317" class="outline-3">
<h3 id="org2bf9317">scope-stack:find</h3>
<div class="outline-text-3" id="text-org2bf9317">
<ul class="org-ul">
<li><p>from the pointer to the base</p></li></ul>
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">scope-stack:find,loop</span>
  <span style="color: #FF8888;">&lt;&lt; name, cursor</span>
<span style="color: #FF8888;">     -- offset-record, true</span>
<span style="color: #FF8888;">     -- false &gt;&gt;</span>
  dup <span style="color: #fd971f; font-weight: bold;">*scope-stack*</span> <span style="color: #ffffff; font-weight: bold;">equal?</span> <span style="color: #f92672; font-weight: bold;">if</span>
    drop2
    <span style="color: #fd971f; font-weight: bold;">false</span>
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #fd971f; font-weight: bold;">scope-stack:*unit*</span> sub <span style="color: #FF4C4C; font-weight: bold;">&gt;:cursor</span>
  <span style="color: #FF4C4C; font-weight: bold;">&gt;:name</span>
  <span style="color: #83EA83; font-weight: bold;">:cursor</span> offset-record,get-name
  <span style="color: #83EA83; font-weight: bold;">:name</span> <span style="color: #ffffff; font-weight: bold;">equal?</span> <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #83EA83; font-weight: bold;">:cursor</span>
    <span style="color: #fd971f; font-weight: bold;">true</span>
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #83EA83; font-weight: bold;">:name</span>
  <span style="color: #83EA83; font-weight: bold;">:cursor</span>
  <span style="color: #00ffff; font-weight: bold;">loop</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>

<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">scope-stack:find</span>
  <span style="color: #FF8888;">&lt;&lt; name</span>
<span style="color: #FF8888;">     -- offset-record, true</span>
<span style="color: #FF8888;">     -- false &gt;&gt;</span>
  <span style="color: #fd971f; font-weight: bold;">scope-stack:*pointer*</span>
  <span style="color: #ffffff; font-weight: bold;">scope-stack:</span>find,loop
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org2cea4c3" class="outline-3">
<h3 id="org2cea4c3">scope-stack:get-current-offset</h3>
<div class="outline-text-3" id="text-org2cea4c3">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">scope-stack:get-current-offset</span>
  <span style="color: #FF8888;">&lt;&lt; -- offset &gt;&gt;</span>
  <span style="color: #fd971f; font-weight: bold;">*scope-stack*</span> <span style="color: #fd971f; font-weight: bold;">scope-stack:*pointer*</span> <span style="color: #ffffff; font-weight: bold;">equal?</span> <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #e6db74;">"* (scope-stack:get-current-offset) fail"</span> .s .l
    <span style="color: #e6db74;">"  for the scope-stack is empty"</span> .s .l
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #fd971f; font-weight: bold;">scope-stack:*pointer*</span>
  <span style="color: #fd971f; font-weight: bold;">scope-stack:*unit*</span> sub
  dup <span style="color: #ffffff; font-weight: bold;">offset-record,scope-delimiter?</span> <span style="color: #f92672; font-weight: bold;">if</span>
    drop
    <span style="color: #fd971f; font-weight: bold;">0</span>
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  dup
  offset-record,get-name
  name<span style="color: #b0b1a3;">-&gt;</span>string count-front-colon <span style="color: #fd971f; font-weight: bold;">*cell-size*</span> mul
  swap
  offset-record,get-offset
  add
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org84adbee" class="outline-2">
<h2 id="org84adbee">await &amp; awake</h2>
<div class="outline-text-2" id="text-org84adbee">
</div><div id="outline-container-orge557931" class="outline-3">
<h3 id="orge557931"><span class="todo note">note</span> notation</h3>
<div class="outline-text-3" id="text-orge557931">
<ul class="org-ul">
<li><p><p></p><p>table</p><p></p></p><p><table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides"></p><p></p><p></p><p><colgroup></p><p><col  class="org-left" /></p><p></p><p><col  class="org-left" /></p><p></colgroup></p><p><tbody></p><p><tr></p><p><td class="org-left">期待 [非局部退出點]</td></p><p><td class="org-left">await [make non-local-exit-piont]</td></p><p></tr></p><p></p><p><tr></p><p><td class="org-left">動意 [非局部退出信號]</td></p><p><td class="org-left">awake [non-local-exit-signal]</td></p><p></tr></p><p></tbody></p><p></table></p></li></ul>
</div>
</div>

<div id="outline-container-orgf12ab38" class="outline-3">
<h3 id="orgf12ab38"><b>awaiting-stack</b></h3>
<div class="outline-text-3" id="text-orgf12ab38">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #fd971f; font-weight: bold;">10</span> <span style="color: #fd971f; font-weight: bold;">1024</span> mul
<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #fd971f; font-weight: bold;">awaiting-stack:*size*</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #a1ab3a; font-weight: bold;">define-variable,with-tos</span>

<span style="color: #fd971f; font-weight: bold;">4</span> <span style="color: #fd971f; font-weight: bold;">*cell-size*</span> mul
<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #fd971f; font-weight: bold;">awaiting-stack:*unit*</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #a1ab3a; font-weight: bold;">define-variable,with-tos</span>

<span style="color: #fd971f; font-weight: bold;">awaiting-stack:*size*</span>
<span style="color: #fd971f; font-weight: bold;">awaiting-stack:*unit*</span> mul <span style="color: #AE7C3B; font-weight: bold;">allocate-memory</span>
<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #fd971f; font-weight: bold;">*awaiting-stack*</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #a1ab3a; font-weight: bold;">define-variable,with-tos</span>

<span style="color: #fd971f; font-weight: bold;">*awaiting-stack*</span>
<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #fd971f; font-weight: bold;">awaiting-stack:*pointer*</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #a1ab3a; font-weight: bold;">define-variable,with-tos</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org82a1e2d" class="outline-3">
<h3 id="org82a1e2d"><span class="todo note">note</span> action</h3>
<div class="outline-text-3" id="text-org82a1e2d">
<ul class="org-ul">
<li><p><p></p><p>structure</p><p></p></p><p><table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides"></p><p></p><p></p><p><colgroup></p><p><col  class="org-left" /></p><p></p><p><col  class="org-left" /></p><p></colgroup></p><p><tbody></p><p><tr></p><p><td class="org-left">action</td></p><p><td class="org-left">function</td></p><p></tr></p><p></p><p><tr></p><p><td class="org-left">&#xa0;</td></p><p><td class="org-left">argument-stack</td></p><p></tr></p><p></p><p><tr></p><p><td class="org-left">&#xa0;</td></p><p><td class="org-left">return-stack</td></p><p></tr></p><p></p><p><tr></p><p><td class="org-left">&#xa0;</td></p><p><td class="org-left">name</td></p><p></tr></p><p></tbody></p><p></table></p></li></ul>
</div>
</div>

<div id="outline-container-org3cd99f1" class="outline-3">
<h3 id="org3cd99f1">action,[get|set]-function</h3>
<div class="outline-text-3" id="text-org3cd99f1">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">action,get-function</span>
  <span style="color: #FF8888;">&lt;&lt; action -- function &gt;&gt;</span>
  get
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>

<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">action,set-function</span>
  <span style="color: #FF8888;">&lt;&lt; function, action -- &gt;&gt;</span>
  set
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org6ad0b47" class="outline-3">
<h3 id="org6ad0b47">action,[get|set]-argument-stack-pointer</h3>
<div class="outline-text-3" id="text-org6ad0b47">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">action,get-argument-stack-pointer</span>
  <span style="color: #FF8888;">&lt;&lt; action -- argument-stack-pointer &gt;&gt;</span>
  <span style="color: #fd971f; font-weight: bold;">*cell-size*</span> add get
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>

<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">action,set-argument-stack-pointer</span>
  <span style="color: #FF8888;">&lt;&lt; argument-stack-pointer, action -- &gt;&gt;</span>
  <span style="color: #fd971f; font-weight: bold;">*cell-size*</span> add set
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org2218415" class="outline-3">
<h3 id="org2218415">action,[get|set]-return-stack-pointer</h3>
<div class="outline-text-3" id="text-org2218415">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">action,get-return-stack-pointer</span>
  <span style="color: #FF8888;">&lt;&lt; action -- return-stack-pointer &gt;&gt;</span>
  <span style="color: #fd971f; font-weight: bold;">*cell-size*</span> <span style="color: #fd971f; font-weight: bold;">2</span> mul add get
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>

<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">action,set-return-stack-pointer</span>
  <span style="color: #FF8888;">&lt;&lt; return-stack-pointer, action -- &gt;&gt;</span>
  <span style="color: #fd971f; font-weight: bold;">*cell-size*</span> <span style="color: #fd971f; font-weight: bold;">2</span> mul add set
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd94f638" class="outline-3">
<h3 id="orgd94f638">action,[get|set]-name</h3>
<div class="outline-text-3" id="text-orgd94f638">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">action,get-name</span>
  <span style="color: #FF8888;">&lt;&lt; action -- name &gt;&gt;</span>
  <span style="color: #fd971f; font-weight: bold;">*cell-size*</span> <span style="color: #fd971f; font-weight: bold;">3</span> mul add get
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>

<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">action,set-name</span>
  <span style="color: #FF8888;">&lt;&lt; name, action -- &gt;&gt;</span>
  <span style="color: #fd971f; font-weight: bold;">*cell-size*</span> <span style="color: #fd971f; font-weight: bold;">3</span> mul add set
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf13a4c" class="outline-3">
<h3 id="orgf13a4c">drop-awaiting-stack</h3>
<div class="outline-text-3" id="text-orgf13a4c">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">drop-awaiting-stack</span>
  <span style="color: #FF8888;">&lt;&lt; -- &gt;&gt;</span>
  <span style="color: #fd971f; font-weight: bold;">awaiting-stack:*unit*</span> <span style="color: #f92672; font-weight: bold;">address</span> <span style="color: #fd971f; font-weight: bold;">awaiting-stack:*pointer*</span> sub-set
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org171e938" class="outline-3">
<h3 id="org171e938">awaiting-stack:find</h3>
<div class="outline-text-3" id="text-org171e938">
<ul class="org-ul">
<li><p>from the pointer to the base</p></li></ul>
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">awaiting-stack:find,loop</span>
  <span style="color: #FF8888;">&lt;&lt; name, cursor</span>
<span style="color: #FF8888;">     -- action, true</span>
<span style="color: #FF8888;">     -- false &gt;&gt;</span>
  dup <span style="color: #fd971f; font-weight: bold;">*awaiting-stack*</span> <span style="color: #ffffff; font-weight: bold;">equal?</span> <span style="color: #f92672; font-weight: bold;">if</span>
    drop2
    <span style="color: #fd971f; font-weight: bold;">false</span>
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #fd971f; font-weight: bold;">awaiting-stack:*unit*</span> sub <span style="color: #FF4C4C; font-weight: bold;">&gt;:cursor</span>
  <span style="color: #FF4C4C; font-weight: bold;">&gt;:name</span>
  <span style="color: #83EA83; font-weight: bold;">:cursor</span> action,get-name
  <span style="color: #83EA83; font-weight: bold;">:name</span> <span style="color: #ffffff; font-weight: bold;">equal?</span> <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #83EA83; font-weight: bold;">:cursor</span>
    <span style="color: #fd971f; font-weight: bold;">true</span>
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #83EA83; font-weight: bold;">:name</span>
  <span style="color: #83EA83; font-weight: bold;">:cursor</span>
  <span style="color: #00ffff; font-weight: bold;">loop</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>

<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">awaiting-stack:find</span>
  <span style="color: #FF8888;">&lt;&lt; name</span>
<span style="color: #FF8888;">     -- action, true</span>
<span style="color: #FF8888;">     -- false &gt;&gt;</span>
  <span style="color: #fd971f; font-weight: bold;">awaiting-stack:*pointer*</span>
  <span style="color: #ffffff; font-weight: bold;">awaiting-stack:</span>find,loop
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org2b49adb" class="outline-3">
<h3 id="org2b49adb">await</h3>
<div class="outline-text-3" id="text-org2b49adb">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">await</span>
  <span style="color: #FF8888;">&lt;&lt; function, name -- &gt;&gt;</span>
  <span style="color: #FF4C4C; font-weight: bold;">&gt;:name</span>
  <span style="color: #FF4C4C; font-weight: bold;">&gt;:function</span>

  snapshot-the-stack-pointer
  <span style="color: #fd971f; font-weight: bold;">*the-stack-pointer-snapshot*</span> <span style="color: #FF4C4C; font-weight: bold;">&gt;:argument-stack-pointer</span>

  get-return-stack-pointer
  <span style="color: #fd971f; font-weight: bold;">return-stack:*unit*</span> <span style="color: #fd971f; font-weight: bold;">2</span> mul sub <span style="color: #FF4C4C; font-weight: bold;">&gt;:return-stack-pointer</span>

  <span style="color: #fd971f; font-weight: bold;">awaiting-stack:*pointer*</span> <span style="color: #FF4C4C; font-weight: bold;">&gt;:action</span>
  <span style="color: #fd971f; font-weight: bold;">awaiting-stack:*unit*</span> <span style="color: #f92672; font-weight: bold;">address</span> <span style="color: #fd971f; font-weight: bold;">awaiting-stack:*pointer*</span> add-set

  <span style="color: #83EA83; font-weight: bold;">:function</span>
  <span style="color: #83EA83; font-weight: bold;">:action</span>
  action,set-function

  <span style="color: #83EA83; font-weight: bold;">:argument-stack-pointer</span>
  <span style="color: #83EA83; font-weight: bold;">:action</span>
  action,set-argument-stack-pointer

  <span style="color: #83EA83; font-weight: bold;">:return-stack-pointer</span>
  <span style="color: #83EA83; font-weight: bold;">:action</span>
  action,set-return-stack-pointer

  <span style="color: #83EA83; font-weight: bold;">:name</span>
  <span style="color: #83EA83; font-weight: bold;">:action</span>
  action,set-name

  <span style="color: #f92672; font-weight: bold;">jo</span> drop-awaiting-stack
  <span style="color: #83EA83; font-weight: bold;">:return-stack-pointer</span>
  <span style="color: #ffffff; font-weight: bold;">return-stack:</span>insert-jo
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org1adf103" class="outline-3">
<h3 id="org1adf103">action,apply</h3>
<div class="outline-text-3" id="text-org1adf103">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">action,apply</span>
  <span style="color: #FF8888;">&lt;&lt; action -- &gt;&gt;</span>
  <span style="color: #FF4C4C; font-weight: bold;">&gt;:action</span>
  <span style="color: #83EA83; font-weight: bold;">:action</span> <span style="color: #f92672; font-weight: bold;">address</span> <span style="color: #fd971f; font-weight: bold;">awaiting-stack:*pointer*</span> set
  <span style="color: #83EA83; font-weight: bold;">:action</span> action,get-return-stack-pointer
  <span style="color: #83EA83; font-weight: bold;">:action</span> action,get-function
  <span style="color: #00ffff; font-weight: bold;">apply-with-return-point</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org12d6565" class="outline-3">
<h3 id="org12d6565">action,reset-the-stack</h3>
<div class="outline-text-3" id="text-org12d6565">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">action,reset-the-stack</span>
  <span style="color: #FF8888;">&lt;&lt; -- &gt;&gt;</span>
  <span style="color: #fd971f; font-weight: bold;">awaiting-stack:*pointer*</span> action,get-argument-stack-pointer
  set-argument-stack-pointer
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org4e752b5" class="outline-3">
<h3 id="org4e752b5">awake</h3>
<div class="outline-text-3" id="text-org4e752b5">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">awake</span>
  <span style="color: #FF8888;">&lt;&lt; name -- &gt;&gt;</span>
  <span style="color: #FF4C4C; font-weight: bold;">&gt;:name</span>
  <span style="color: #83EA83; font-weight: bold;">:name</span> <span style="color: #ffffff; font-weight: bold;">awaiting-stack:</span>find <span style="color: #f92672; font-weight: bold;">if</span>
    action,apply
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #e6db74;">"* (awake) can not find action in awaiting-stack by : "</span> .s <span style="color: #83EA83; font-weight: bold;">:name</span> name<span style="color: #b0b1a3;">-&gt;</span>string .s .l
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org6f05061" class="outline-3">
<h3 id="org6f05061"><span class="done test">test</span> await &amp; awake</h3>
<div class="outline-text-3" id="text-org6f05061">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">testing-awake</span>
  <span style="color: #FF8888;">&lt;&lt; -- &gt;&gt;</span>
  <span style="color: #fd971f; font-weight: bold;">'signal</span> <span style="color: #00ffff; font-weight: bold;">awake</span>
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #1ef15f; font-weight: bold;">test-function</span>

<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">testing-await</span>
  <span style="color: #FF8888;">&lt;&lt; -- &gt;&gt;</span>
  <span style="color: #e6db74;">"after reset-the-stack"</span>
  <span style="color: #93a8c6;">[</span> <span style="color: #e6db74;">"before reset-the-stack"</span> <span style="color: #ffffff; font-weight: bold;">string:</span>equal? <span style="color: #1ef15f; font-weight: bold;">test</span>
    action,reset-the-stack
    <span style="color: #e6db74;">"after reset-the-stack"</span> <span style="color: #ffffff; font-weight: bold;">string:</span>equal? <span style="color: #1ef15f; font-weight: bold;">test</span>
    <span style="color: #00ffff; font-weight: bold;">end</span> <span style="color: #93a8c6;">]</span>
  <span style="color: #fd971f; font-weight: bold;">'signal</span> <span style="color: #1ef15f; font-weight: bold;">await</span>
  <span style="color: #e6db74;">"something in the stack"</span>
  <span style="color: #e6db74;">"before reset-the-stack"</span>
  testing-awake
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #1ef15f; font-weight: bold;">test-function</span>

<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #e6db74;">"* (testing) await &amp; awake"</span> .s .l
  testing-await
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #1ef15f; font-weight: bold;">test-do</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org7bdf7e1" class="outline-2">
<h2 id="org7bdf7e1">basic-REPL</h2>
<div class="outline-text-2" id="text-org7bdf7e1">
</div><div id="outline-container-org5062c6c" class="outline-3">
<h3 id="org5062c6c">syntax-rule-set:*word-interpreter*</h3>
<div class="outline-text-3" id="text-org5062c6c">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #fd971f; font-weight: bold;">1024</span> <span style="color: #fd971f; font-weight: bold;">*cell-size*</span> mul
<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #fd971f; font-weight: bold;">*syntax-rule-set:word-interpreter,size*</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #a1ab3a; font-weight: bold;">define-variable,with-tos</span>

<span style="color: #FF8888;">&lt;&lt; for cursor &gt;&gt;</span>
<span style="color: #fd971f; font-weight: bold;">*cell-size*</span> <span style="color: #AE7C3B; font-weight: bold;">allocate-memory</span> drop

<span style="color: #fd971f; font-weight: bold;">*syntax-rule-set:word-interpreter,size*</span>
<span style="color: #AE7C3B; font-weight: bold;">allocate-memory</span>
<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #fd971f; font-weight: bold;">syntax-rule-set:*word-interpreter*</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #a1ab3a; font-weight: bold;">define-variable,with-tos</span>

<span style="color: #fd971f; font-weight: bold;">syntax-rule-set:*word-interpreter*</span>
<span style="color: #fd971f; font-weight: bold;">syntax-rule-set:*word-interpreter*</span> <span style="color: #fd971f; font-weight: bold;">*cell-size*</span> sub
set
</pre>
</div>
</div>
</div>

<div id="outline-container-org477b069" class="outline-3">
<h3 id="org477b069">word-interpreter</h3>
<div class="outline-text-3" id="text-org477b069">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">word-interpreter</span>
  <span style="color: #FF8888;">&lt;&lt; word[address, length] -- unknown &gt;&gt;</span>
  dup2 find-syntax <span style="color: #f92672; font-weight: bold;">if</span>
    apply
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  dup2
  name-hash-table,find-jo <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #FF8888;">&lt;&lt; function &amp; primitive-function &amp; variable &gt;&gt;</span>
    xx<span style="color: #b0b1a3;">|</span>swap<span style="color: #b0b1a3;">|</span>x drop2
    apply
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #e6db74;">"* (word-interpreter) meets undefined word : "</span> .s
  .s .l
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb1a76af" class="outline-3">
<h3 id="orgb1a76af">word-interpreter-syntax:bye</h3>
<div class="outline-text-3" id="text-orgb1a76af">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">word-interpreter-syntax:bye</span>
  <span style="color: #FF8888;">&lt;&lt; literal-word:bye -- &gt;&gt;</span>
  drop2
  <span style="color: #fd971f; font-weight: bold;">'bye,basic-REPL</span> <span style="color: #00ffff; font-weight: bold;">awake</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgcd5dc6b" class="outline-3">
<h3 id="orgcd5dc6b">bye,basic-REPL</h3>
<div class="outline-text-3" id="text-orgcd5dc6b">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">bye,basic-REPL</span>
  <span style="color: #FF8888;">&lt;&lt; -- &gt;&gt;</span>
  action,reset-the-stack
  drop-syntax-stack
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org8952bf4" class="outline-3">
<h3 id="org8952bf4">basic-REPL&#xa0;&#xa0;&#xa0;<span class="tag"><span class="redefine">redefine</span></span></h3>
<div class="outline-text-3" id="text-org8952bf4">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">basic-REPL,loop</span>
  <span style="color: #FF8888;">&lt;&lt; unknown -- unknown &gt;&gt;</span>
  read-word
  word-interpreter
  <span style="color: #00ffff; font-weight: bold;">loop</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>

<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">basic-REPL</span>
  <span style="color: #FF8888;">&lt;&lt; unknown -- unknown &gt;&gt;</span>
  <span style="color: #f92672; font-weight: bold;">jo</span> bye,basic-REPL
  <span style="color: #fd971f; font-weight: bold;">'bye,basic-REPL</span> <span style="color: #1ef15f; font-weight: bold;">await</span>
  <span style="color: #fd971f; font-weight: bold;">syntax-rule-set:*word-interpreter*</span> push-syntax-stack
  basic-REPL,loop
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org87e5cf4" class="outline-3">
<h3 id="org87e5cf4">number with base</h3>
<div class="outline-text-3" id="text-org87e5cf4">
</div><div id="outline-container-org67e9dab" class="outline-4">
<h4 id="org67e9dab"><span class="todo _">記</span> 原理</h4>
<div class="outline-text-4" id="text-org67e9dab">
<ul class="org-ul">
<li><p>現在 的 number 就只是 "integer" 而已</p><p>更多的數的類型將在 cicada 中實現</p></li>
<li><p>在 "integer" 這個函數中 我將只支持 對四種進位制的 字符串的 閱讀</p><p><ul class="org-ul"></p><p><li><p>十進制</p><p>10#1231</p><p>10#-1231</p><p>1231</p><p>-1231</p></li></p><p><li><p>二進制</p><p>2#101001</p><p>2#-101001</p><p>2#-1011_1001</p><p>"-" 和 "_" 的同時存在有點難讀</p><p>此時可以用 2#1011_1001 negate</p><p>也就是說雖然允許用 "-" 來表示負數</p><p>但是不鼓勵這樣做</p><p>之所以允許這樣做</p><p>是因爲在打印負數的時候需要這種表示方式</p><p>不能把 "-123" 打印成 "123 negate"</p></li></p><p><li><p>八進制</p><p>8#712537</p><p>8#-712537</p></li></p><p><li><p>十六進制</p><p>16#f123acb3</p><p>16#-F123ACB3</p><p>大寫小寫字母都可以</p></li></ul></p></li>
<li><p>one can use "_" to separate the number</p><p>to make it more readable</p><p>for example</p><p>2#1111_0101_0001</p></li>
<li><p>actually, the base can be any 10 based number</p><p>even greater then 36</p><p>but when the base is greater then 36</p><p>not all integer can be represented under this base</p><p>for we only have 36 bytes</p></li></ul>
</div>
</div>

<div id="outline-container-orgb686728" class="outline-4">
<h4 id="orgb686728">remove-byte!</h4>
<div class="outline-text-4" id="text-orgb686728">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">remove-byte!,loop</span>
  <span style="color: #FF8888;">&lt;&lt; cursor, length, byte -- cursor &gt;&gt;</span>
  <span style="color: #FF4C4C; font-weight: bold;">&gt;:byte</span>
  <span style="color: #FF4C4C; font-weight: bold;">&gt;:length</span>
  <span style="color: #FF4C4C; font-weight: bold;">&gt;:cursor</span>
  <span style="color: #83EA83; font-weight: bold;">:length</span> <span style="color: #ffffff; font-weight: bold;">zero?</span> <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #83EA83; font-weight: bold;">:cursor</span>
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #83EA83; font-weight: bold;">:cursor</span> get-byte <span style="color: #83EA83; font-weight: bold;">:byte</span> <span style="color: #ffffff; font-weight: bold;">equal?</span> <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #83EA83; font-weight: bold;">:cursor</span> add1 <span style="color: #83EA83; font-weight: bold;">:length</span> sub1
    <span style="color: #83EA83; font-weight: bold;">:cursor</span>
    string<span style="color: #b0b1a3;">-&gt;</span>buffer!
    <span style="color: #83EA83; font-weight: bold;">:cursor</span>
    <span style="color: #83EA83; font-weight: bold;">:length</span> sub1
    <span style="color: #83EA83; font-weight: bold;">:byte</span>
  <span style="color: #f92672; font-weight: bold;">else</span>
    <span style="color: #83EA83; font-weight: bold;">:cursor</span> add1
    <span style="color: #83EA83; font-weight: bold;">:length</span> sub1
    <span style="color: #83EA83; font-weight: bold;">:byte</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #00ffff; font-weight: bold;">loop</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>

<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">remove-byte!</span>
  <span style="color: #FF8888;">&lt;&lt; string[address, length], byte -- string[address, length] &gt;&gt;</span>
  x<span style="color: #b0b1a3;">|</span>over<span style="color: #b0b1a3;">|</span>xx <span style="color: #FF4C4C; font-weight: bold;">&gt;:address</span>
  remove-byte!,loop <span style="color: #FF4C4C; font-weight: bold;">&gt;:cursor</span>
  <span style="color: #83EA83; font-weight: bold;">:address</span>
  <span style="color: #83EA83; font-weight: bold;">:cursor</span> <span style="color: #83EA83; font-weight: bold;">:address</span> sub
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf710ab9" class="outline-4">
<h4 id="orgf710ab9"><span class="done test">test</span> remove-byte!</h4>
<div class="outline-text-4" id="text-orgf710ab9">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #e6db74;">"* (testing) remove-byte!"</span> .s .l
  <span style="color: #e6db74;">"2#1001_1001"</span>
  <span style="color: #e6db74;">"_"</span> <span style="color: #ffffff; font-weight: bold;">string:</span>byte remove-byte!
  <span style="color: #e6db74;">"2#10011001"</span> <span style="color: #ffffff; font-weight: bold;">string:</span>equal?
  <span style="color: #e6db74;">"___2#1001___1001___"</span>
  <span style="color: #e6db74;">"_"</span> <span style="color: #ffffff; font-weight: bold;">string:</span>byte remove-byte!
  <span style="color: #e6db74;">"2#10011001"</span> <span style="color: #ffffff; font-weight: bold;">string:</span>equal? and <span style="color: #1ef15f; font-weight: bold;">test</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #1ef15f; font-weight: bold;">test-do</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org72db2c7" class="outline-4">
<h4 id="org72db2c7">latin-byte?</h4>
<div class="outline-text-4" id="text-org72db2c7">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">latin-byte?</span>
  <span style="color: #FF8888;">&lt;&lt; byte -- bool &gt;&gt;</span>
  dup <span style="color: #e6db74;">"A"</span> <span style="color: #ffffff; font-weight: bold;">string:</span>byte <span style="color: #ffffff; font-weight: bold;">less-than?</span> <span style="color: #f92672; font-weight: bold;">if</span>
    drop <span style="color: #fd971f; font-weight: bold;">false</span>
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  dup <span style="color: #e6db74;">"Z"</span> <span style="color: #ffffff; font-weight: bold;">string:</span>byte <span style="color: #ffffff; font-weight: bold;">less-or-equal?</span> <span style="color: #f92672; font-weight: bold;">if</span>
    drop <span style="color: #fd971f; font-weight: bold;">true</span>
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  dup <span style="color: #e6db74;">"a"</span> <span style="color: #ffffff; font-weight: bold;">string:</span>byte <span style="color: #ffffff; font-weight: bold;">less-than?</span> <span style="color: #f92672; font-weight: bold;">if</span>
    drop <span style="color: #fd971f; font-weight: bold;">false</span>
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  dup <span style="color: #e6db74;">"z"</span> <span style="color: #ffffff; font-weight: bold;">string:</span>byte <span style="color: #ffffff; font-weight: bold;">less-or-equal?</span> <span style="color: #f92672; font-weight: bold;">if</span>
    drop <span style="color: #fd971f; font-weight: bold;">true</span>
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  drop <span style="color: #fd971f; font-weight: bold;">false</span>
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org64ed7da" class="outline-4">
<h4 id="org64ed7da">latin-byte-&gt;number</h4>
<div class="outline-text-4" id="text-org64ed7da">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">latin-byte-&gt;number</span>
  <span style="color: #FF8888;">&lt;&lt; latin-byte -- number &gt;&gt;</span>
  dup <span style="color: #e6db74;">"A"</span> <span style="color: #ffffff; font-weight: bold;">string:</span>byte <span style="color: #ffffff; font-weight: bold;">less-than?</span> <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #e6db74;">"* (latin-byte-&gt;number) the argument must be a latin-byte"</span> .s .l
    <span style="color: #e6db74;">"  but the following byte is less-than 'A' : "</span> .s
    .i .l
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  dup <span style="color: #e6db74;">"Z"</span> <span style="color: #ffffff; font-weight: bold;">string:</span>byte <span style="color: #ffffff; font-weight: bold;">less-or-equal?</span> <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #e6db74;">"A"</span> <span style="color: #ffffff; font-weight: bold;">string:</span>byte
    sub
    <span style="color: #fd971f; font-weight: bold;">10</span> add
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  dup <span style="color: #e6db74;">"a"</span> <span style="color: #ffffff; font-weight: bold;">string:</span>byte <span style="color: #ffffff; font-weight: bold;">less-than?</span> <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #e6db74;">"* (latin-byte-&gt;number) the argument must be a latin-byte"</span> .s .l
    <span style="color: #e6db74;">"  but the following byte is less-than 'a' but greater-then 'Z' : "</span> .s
    .i .l
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  dup <span style="color: #e6db74;">"z"</span> <span style="color: #ffffff; font-weight: bold;">string:</span>byte <span style="color: #ffffff; font-weight: bold;">less-or-equal?</span> <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #e6db74;">"a"</span> <span style="color: #ffffff; font-weight: bold;">string:</span>byte
    sub
    <span style="color: #fd971f; font-weight: bold;">10</span> add
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #e6db74;">"* (latin-byte-&gt;number) the argument must be a latin-byte"</span> .s .l
  <span style="color: #e6db74;">"  but the following byte is greater-then 'z' : "</span> .s
  .i .l
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org315c312" class="outline-4">
<h4 id="org315c312">number-&gt;latin-byte</h4>
<div class="outline-text-4" id="text-org315c312">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">number-&gt;latin-byte</span>
  <span style="color: #FF8888;">&lt;&lt; number -- latin-byte &gt;&gt;</span>
  <span style="color: #fd971f; font-weight: bold;">10</span> sub
  <span style="color: #e6db74;">"a"</span> <span style="color: #ffffff; font-weight: bold;">string:</span>byte
  add
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org626d2fc" class="outline-4">
<h4 id="org626d2fc">wild-digit-string?</h4>
<div class="outline-text-4" id="text-org626d2fc">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">wild-digit-string?</span>
  <span style="color: #FF8888;">&lt;&lt; string[address, length] -- bool &gt;&gt;</span>
  dup <span style="color: #ffffff; font-weight: bold;">zero?</span> <span style="color: #f92672; font-weight: bold;">if</span>
    drop2 <span style="color: #fd971f; font-weight: bold;">true</span>
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  over get-byte
  dup <span style="color: #ffffff; font-weight: bold;">digit-byte?</span>
  swap <span style="color: #ffffff; font-weight: bold;">latin-byte?</span>
  or <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #ffffff; font-weight: bold;">string:</span>byte-tail
    <span style="color: #00ffff; font-weight: bold;">loop</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  drop2
  <span style="color: #fd971f; font-weight: bold;">false</span>
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc47f2b6" class="outline-4">
<h4 id="orgc47f2b6">wild-integer-string?</h4>
<div class="outline-text-4" id="text-orgc47f2b6">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">wild-integer-string?</span>
  <span style="color: #FF8888;">&lt;&lt; string[address, length] -- bool &gt;&gt;</span>
  dup <span style="color: #ffffff; font-weight: bold;">zero?</span> <span style="color: #f92672; font-weight: bold;">if</span>
    drop2 <span style="color: #fd971f; font-weight: bold;">false</span>
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  dup2 <span style="color: #ffffff; font-weight: bold;">string:</span>byte
  <span style="color: #e6db74;">"-"</span> <span style="color: #ffffff; font-weight: bold;">string:</span>byte
  <span style="color: #ffffff; font-weight: bold;">equal?</span> <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #ffffff; font-weight: bold;">string:</span>byte-tail
    <span style="color: #ffffff; font-weight: bold;">wild-digit-string?</span>
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #ffffff; font-weight: bold;">wild-digit-string?</span>
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgaae8b4a" class="outline-4">
<h4 id="orgaae8b4a"><span class="done test">test</span> wild-integer-string?</h4>
<div class="outline-text-4" id="text-orgaae8b4a">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #e6db74;">"* (testing) wild-integer-string?"</span> .s .l
  ""        <span style="color: #ffffff; font-weight: bold;">wild-integer-string?</span> <span style="color: #ffffff; font-weight: bold;">false?</span>
  <span style="color: #e6db74;">" "</span>       <span style="color: #ffffff; font-weight: bold;">wild-integer-string?</span> <span style="color: #ffffff; font-weight: bold;">false?</span> and
  <span style="color: #e6db74;">"_asd"</span>    <span style="color: #ffffff; font-weight: bold;">wild-integer-string?</span> <span style="color: #ffffff; font-weight: bold;">false?</span> and
  <span style="color: #e6db74;">" asd"</span>    <span style="color: #ffffff; font-weight: bold;">wild-integer-string?</span> <span style="color: #ffffff; font-weight: bold;">false?</span> and
  <span style="color: #e6db74;">"asd"</span>     <span style="color: #ffffff; font-weight: bold;">wild-integer-string?</span> <span style="color: #ffffff; font-weight: bold;">true?</span>  and
  <span style="color: #e6db74;">"123"</span>     <span style="color: #ffffff; font-weight: bold;">wild-integer-string?</span> <span style="color: #ffffff; font-weight: bold;">true?</span>  and
  <span style="color: #e6db74;">"123asd"</span>  <span style="color: #ffffff; font-weight: bold;">wild-integer-string?</span> <span style="color: #ffffff; font-weight: bold;">true?</span>  and <span style="color: #1ef15f; font-weight: bold;">test</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #1ef15f; font-weight: bold;">test-do</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgba5b956" class="outline-4">
<h4 id="orgba5b956">base#wild-integer-string?</h4>
<div class="outline-text-4" id="text-orgba5b956">
<ul class="org-ul">
<li><p>a string for the following format</p><p>is viewed as a base#digit-string</p><p>&lt;digit-string&gt;#[-]&lt;wild-integer-string-string&gt;</p><p>any "_" in the anywhere of the above string</p><p>will be ignored</p></li></ul>
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">base#wild-integer-string?</span>
  <span style="color: #FF8888;">&lt;&lt; string[address, length] -- bool &gt;&gt;</span>
  <span style="color: #fd971f; font-weight: bold;">128</span> <span style="color: #AE7C3B; font-weight: bold;">allocate-local-memory</span>
  <span style="color: #FF4C4C; font-weight: bold;">&gt;:string-address</span>
  tuck
  <span style="color: #83EA83; font-weight: bold;">:string-address</span>
  string<span style="color: #b0b1a3;">-&gt;</span>buffer!
  <span style="color: #83EA83; font-weight: bold;">:string-address</span> swap
  <span style="color: #e6db74;">"_"</span> <span style="color: #ffffff; font-weight: bold;">string:</span>byte
  remove-byte!
  <span style="color: #FF4C4C; font-weight: bold;">&gt;:new-string-length</span>
  <span style="color: #FF4C4C; font-weight: bold;">&gt;:new-string-address</span>
  <span style="color: #FF8888;">&lt;&lt; dup2 .s .l 0 end &gt;&gt;</span>
  <span style="color: #83EA83; font-weight: bold;">:new-string-address</span>
  <span style="color: #83EA83; font-weight: bold;">:new-string-length</span>
  <span style="color: #e6db74;">"#"</span> <span style="color: #ffffff; font-weight: bold;">string:</span>byte
  <span style="color: #ffffff; font-weight: bold;">string:</span>find-byte <span style="color: #f92672; font-weight: bold;">if</span>
  <span style="color: #f92672; font-weight: bold;">else</span>
    <span style="color: #fd971f; font-weight: bold;">false</span>
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #FF4C4C; font-weight: bold;">&gt;:address-of-#</span>
  <span style="color: #83EA83; font-weight: bold;">:new-string-address</span>
  <span style="color: #83EA83; font-weight: bold;">:address-of-#</span> <span style="color: #83EA83; font-weight: bold;">:new-string-address</span> sub
  <span style="color: #dc322f; font-weight: bold;">&gt;::base-string</span>
  <span style="color: #83EA83; font-weight: bold;">:address-of-#</span> add1
  <span style="color: #83EA83; font-weight: bold;">:address-of-#</span> <span style="color: #83EA83; font-weight: bold;">:new-string-address</span> sub add1
  <span style="color: #83EA83; font-weight: bold;">:new-string-length</span> swap sub
  <span style="color: #dc322f; font-weight: bold;">&gt;::wild-integer-string</span>
  <span style="color: #5CDD5C; font-weight: bold;">::base-string</span> <span style="color: #ffffff; font-weight: bold;">digit-string?</span>
  <span style="color: #5CDD5C; font-weight: bold;">::base-string</span> <span style="color: #ffffff; font-weight: bold;">string:</span>empty? not
  and <span style="color: #f92672; font-weight: bold;">if</span>
  <span style="color: #f92672; font-weight: bold;">else</span>
    <span style="color: #fd971f; font-weight: bold;">false</span>
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #5CDD5C; font-weight: bold;">::wild-integer-string</span> <span style="color: #ffffff; font-weight: bold;">wild-integer-string?</span>
  <span style="color: #5CDD5C; font-weight: bold;">::wild-integer-string</span> <span style="color: #ffffff; font-weight: bold;">string:</span>empty? not
  and <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #fd971f; font-weight: bold;">true</span>
  <span style="color: #f92672; font-weight: bold;">else</span>
    <span style="color: #fd971f; font-weight: bold;">false</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgcdd2555" class="outline-4">
<h4 id="orgcdd2555"><span class="done test">test</span> base#wild-integer-string?</h4>
<div class="outline-text-4" id="text-orgcdd2555">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #e6db74;">"* (testing) base#wild-integer-string?"</span> .s .l
  <span style="color: #e6db74;">"#"</span>     <span style="color: #ffffff; font-weight: bold;">base#wild-integer-string?</span> <span style="color: #ffffff; font-weight: bold;">false?</span>
  <span style="color: #e6db74;">"##"</span>    <span style="color: #ffffff; font-weight: bold;">base#wild-integer-string?</span> <span style="color: #ffffff; font-weight: bold;">false?</span> and
  <span style="color: #e6db74;">"#___#"</span> <span style="color: #ffffff; font-weight: bold;">base#wild-integer-string?</span> <span style="color: #ffffff; font-weight: bold;">false?</span> and
  <span style="color: #e6db74;">"   "</span>   <span style="color: #ffffff; font-weight: bold;">base#wild-integer-string?</span> <span style="color: #ffffff; font-weight: bold;">false?</span> and
  <span style="color: #e6db74;">"______#__1___"</span> <span style="color: #ffffff; font-weight: bold;">base#wild-integer-string?</span> <span style="color: #ffffff; font-weight: bold;">false?</span> and
  <span style="color: #e6db74;">"___2___#__1___c29bf210019___&#28450;&#23383;"</span> <span style="color: #ffffff; font-weight: bold;">base#wild-integer-string?</span> <span style="color: #ffffff; font-weight: bold;">false?</span> and

  <span style="color: #e6db74;">"1#1"</span> <span style="color: #ffffff; font-weight: bold;">base#wild-integer-string?</span> <span style="color: #ffffff; font-weight: bold;">true?</span> and
  <span style="color: #e6db74;">"123#1c29bf219g42"</span> <span style="color: #ffffff; font-weight: bold;">base#wild-integer-string?</span> <span style="color: #ffffff; font-weight: bold;">true?</span> and
  <span style="color: #e6db74;">"___2___#__1___c29bf210019___g42"</span> <span style="color: #ffffff; font-weight: bold;">base#wild-integer-string?</span> <span style="color: #ffffff; font-weight: bold;">true?</span> and <span style="color: #1ef15f; font-weight: bold;">test</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #1ef15f; font-weight: bold;">test-do</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orga5f042" class="outline-4">
<h4 id="orga5f042">base#wild-integer-string-&gt;base-string</h4>
<div class="outline-text-4" id="text-orga5f042">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">base#wild-integer-string-&gt;base-string</span>
  <span style="color: #FF8888;">&lt;&lt; string[address, length] -- string[address, length] &gt;&gt;</span>
  <span style="color: #FF4C4C; font-weight: bold;">&gt;:length</span>
  <span style="color: #FF4C4C; font-weight: bold;">&gt;:address</span>
  <span style="color: #83EA83; font-weight: bold;">:address</span>
  <span style="color: #83EA83; font-weight: bold;">:length</span>
  <span style="color: #e6db74;">"#"</span> <span style="color: #ffffff; font-weight: bold;">string:</span>byte
  <span style="color: #ffffff; font-weight: bold;">string:</span>find-byte <span style="color: #f92672; font-weight: bold;">if</span>
  <span style="color: #f92672; font-weight: bold;">else</span>
    <span style="color: #e6db74;">"* (base#wild-integer-string-&gt;base-string)"</span> .s .l
    <span style="color: #e6db74;">"  the argument must be a base#wild-integer-string"</span> .s .l
    <span style="color: #e6db74;">"  but the following string does not even have a '#' in it :"</span> .s .l
    <span style="color: #e6db74;">"  "</span> .s
    <span style="color: #83EA83; font-weight: bold;">:address</span> <span style="color: #83EA83; font-weight: bold;">:length</span> .s .l
    <span style="color: #FF8888;">&lt;&lt; to balance the argument-stack or not ??? &gt;&gt;</span>
    <span style="color: #FF8888;">&lt;&lt; :address :length &gt;&gt;</span>
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #FF4C4C; font-weight: bold;">&gt;:address-of-#</span>
  <span style="color: #83EA83; font-weight: bold;">:address</span>
  <span style="color: #83EA83; font-weight: bold;">:address-of-#</span> <span style="color: #83EA83; font-weight: bold;">:address</span> sub
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org75647c" class="outline-4">
<h4 id="org75647c">base#wild-integer-string-&gt;wild-integer-string</h4>
<div class="outline-text-4" id="text-org75647c">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">base#wild-integer-string-&gt;wild-integer-string</span>
  <span style="color: #FF8888;">&lt;&lt; string[address, length] -- string[address, length] &gt;&gt;</span>
  <span style="color: #FF4C4C; font-weight: bold;">&gt;:length</span>
  <span style="color: #FF4C4C; font-weight: bold;">&gt;:address</span>
  <span style="color: #83EA83; font-weight: bold;">:address</span>
  <span style="color: #83EA83; font-weight: bold;">:length</span>
  <span style="color: #e6db74;">"#"</span> <span style="color: #ffffff; font-weight: bold;">string:</span>byte
  <span style="color: #ffffff; font-weight: bold;">string:</span>find-byte <span style="color: #f92672; font-weight: bold;">if</span>
  <span style="color: #f92672; font-weight: bold;">else</span>
    <span style="color: #e6db74;">"* (base#wild-integer-string-&gt;wild-integer-string)"</span> .s .l
    <span style="color: #e6db74;">"  the argument must be a base#wild-integer-string"</span> .s .l
    <span style="color: #e6db74;">"  but the following string does not even have a '#' in it :"</span> .s .l
    <span style="color: #e6db74;">"  "</span> .s
    <span style="color: #83EA83; font-weight: bold;">:address</span> <span style="color: #83EA83; font-weight: bold;">:length</span> .s .l
    <span style="color: #FF8888;">&lt;&lt; to balance the argument-stack or not ??? &gt;&gt;</span>
    <span style="color: #FF8888;">&lt;&lt; :address :length &gt;&gt;</span>
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #FF4C4C; font-weight: bold;">&gt;:address-of-#</span>
  <span style="color: #83EA83; font-weight: bold;">:address-of-#</span> add1
  <span style="color: #83EA83; font-weight: bold;">:address-of-#</span> <span style="color: #83EA83; font-weight: bold;">:address</span> sub add1
  <span style="color: #83EA83; font-weight: bold;">:length</span> swap sub
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgda4faff" class="outline-4">
<h4 id="orgda4faff"><span class="done test">test</span> base#wild-integer-string-&gt;base-string</h4>
<div class="outline-text-4" id="text-orgda4faff">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #e6db74;">"* (testing) base#wild-integer-string-&gt;base-string"</span> .s .l
  <span style="color: #FF8888;">&lt;&lt; error</span>
<span style="color: #FF8888;">  "___2___ __1___c29bf210019___&#28450;&#23383;" base#wild-integer-string-&gt;base-string</span>
<span style="color: #FF8888;">  &gt;&gt;</span>

  <span style="color: #e6db74;">"1#1"</span> base#wild-integer-string<span style="color: #b0b1a3;">-&gt;</span>base-string
  <span style="color: #e6db74;">"1"</span> <span style="color: #ffffff; font-weight: bold;">string:</span>equal?

  <span style="color: #e6db74;">"123#1c29bf219g42"</span> base#wild-integer-string<span style="color: #b0b1a3;">-&gt;</span>base-string
  <span style="color: #e6db74;">"123"</span> <span style="color: #ffffff; font-weight: bold;">string:</span>equal? and

  <span style="color: #e6db74;">"___2___#__1___c29bf210019___g42"</span> base#wild-integer-string<span style="color: #b0b1a3;">-&gt;</span>base-string
  <span style="color: #e6db74;">"___2___"</span> <span style="color: #ffffff; font-weight: bold;">string:</span>equal? and <span style="color: #1ef15f; font-weight: bold;">test</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #1ef15f; font-weight: bold;">test-do</span>

<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #e6db74;">"* (testing) base#wild-integer-string-&gt;wild-integer-string"</span> .s .l
  <span style="color: #FF8888;">&lt;&lt; error</span>
<span style="color: #FF8888;">  "___2___ __1___c29bf210019___&#28450;&#23383;" base#wild-integer-string-&gt;wild-integer-string</span>
<span style="color: #FF8888;">  &gt;&gt;</span>

  <span style="color: #e6db74;">"1#1"</span> base#wild-integer-string<span style="color: #b0b1a3;">-&gt;</span>wild-integer-string
  <span style="color: #e6db74;">"1"</span> <span style="color: #ffffff; font-weight: bold;">string:</span>equal?

  <span style="color: #e6db74;">"123#1c29bf219g42"</span> base#wild-integer-string<span style="color: #b0b1a3;">-&gt;</span>wild-integer-string
  <span style="color: #e6db74;">"1c29bf219g42"</span> <span style="color: #ffffff; font-weight: bold;">string:</span>equal? and

  <span style="color: #e6db74;">"___2___#__1___c29bf210019___g42"</span> base#wild-integer-string<span style="color: #b0b1a3;">-&gt;</span>wild-integer-string
  <span style="color: #e6db74;">"__1___c29bf210019___g42"</span> <span style="color: #ffffff; font-weight: bold;">string:</span>equal? and <span style="color: #1ef15f; font-weight: bold;">test</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #1ef15f; font-weight: bold;">test-do</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orga5c946d" class="outline-4">
<h4 id="orga5c946d">wild-integer-string-&gt;integer,with-base</h4>
<div class="outline-text-4" id="text-orga5c946d">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">wild-integer-string-&gt;integer,with-base,loop</span>
  <span style="color: #FF8888;">&lt;&lt; string[address, length], base, sum, counter -- integer &gt;&gt;</span>
  <span style="color: #FF4C4C; font-weight: bold;">&gt;:counter</span>
  <span style="color: #FF4C4C; font-weight: bold;">&gt;:sum</span>
  <span style="color: #FF4C4C; font-weight: bold;">&gt;:base</span>
  <span style="color: #FF4C4C; font-weight: bold;">&gt;:length</span>
  <span style="color: #FF4C4C; font-weight: bold;">&gt;:address</span>
  <span style="color: #83EA83; font-weight: bold;">:length</span> <span style="color: #ffffff; font-weight: bold;">zero?</span> <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #83EA83; font-weight: bold;">:sum</span>
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #83EA83; font-weight: bold;">:address</span> get-byte <span style="color: #FF4C4C; font-weight: bold;">&gt;:byte</span>
  <span style="color: #83EA83; font-weight: bold;">:byte</span> <span style="color: #ffffff; font-weight: bold;">digit-byte?</span> <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #83EA83; font-weight: bold;">:byte</span> digit-byte<span style="color: #b0b1a3;">-&gt;</span>number
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #83EA83; font-weight: bold;">:byte</span> <span style="color: #ffffff; font-weight: bold;">latin-byte?</span> <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #83EA83; font-weight: bold;">:byte</span> latin-byte<span style="color: #b0b1a3;">-&gt;</span>number
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #83EA83; font-weight: bold;">:base</span> <span style="color: #83EA83; font-weight: bold;">:counter</span> power
  mul
  <span style="color: #83EA83; font-weight: bold;">:sum</span> add
  <span style="color: #FF4C4C; font-weight: bold;">&gt;:sum</span>
  <span style="color: #83EA83; font-weight: bold;">:address</span> add1
  <span style="color: #83EA83; font-weight: bold;">:length</span> sub1
  <span style="color: #83EA83; font-weight: bold;">:base</span>
  <span style="color: #83EA83; font-weight: bold;">:sum</span>
  <span style="color: #83EA83; font-weight: bold;">:counter</span> add1
  <span style="color: #00ffff; font-weight: bold;">loop</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>

<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">wild-integer-string-&gt;integer,with-base</span>
  <span style="color: #FF8888;">&lt;&lt; string[address, length], base -- integer &gt;&gt;</span>
  <span style="color: #FF4C4C; font-weight: bold;">&gt;:base</span>
  dup <span style="color: #ffffff; font-weight: bold;">zero?</span> <span style="color: #f92672; font-weight: bold;">if</span>
    drop2
    <span style="color: #fd971f; font-weight: bold;">0</span>
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  dup2 <span style="color: #ffffff; font-weight: bold;">string:</span>byte
  <span style="color: #e6db74;">"-"</span> <span style="color: #ffffff; font-weight: bold;">string:</span>byte
  <span style="color: #ffffff; font-weight: bold;">equal?</span> <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #ffffff; font-weight: bold;">string:</span>byte-tail
    <span style="color: #fd971f; font-weight: bold;">-1</span> <span style="color: #FF4C4C; font-weight: bold;">&gt;:sign</span>
  <span style="color: #f92672; font-weight: bold;">else</span>
    <span style="color: #fd971f; font-weight: bold;">1</span> <span style="color: #FF4C4C; font-weight: bold;">&gt;:sign</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #dc322f; font-weight: bold;">&gt;::string</span>
  <span style="color: #5CDD5C; font-weight: bold;">::string</span> string-reverse!
  <span style="color: #83EA83; font-weight: bold;">:base</span>
  <span style="color: #fd971f; font-weight: bold;">0</span> <span style="color: #fd971f; font-weight: bold;">0</span> wild-integer-string<span style="color: #b0b1a3;">-&gt;</span>integer,with-base,loop
  <span style="color: #83EA83; font-weight: bold;">:sign</span> mul
  <span style="color: #5CDD5C; font-weight: bold;">::string</span> string-reverse!
  drop2
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf836ecc" class="outline-4">
<h4 id="orgf836ecc">base#wild-integer-string-&gt;integer</h4>
<div class="outline-text-4" id="text-orgf836ecc">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">base#wild-integer-string-&gt;integer</span>
  <span style="color: #FF8888;">&lt;&lt; string[address, length] -- integer &gt;&gt;</span>
  <span style="color: #fd971f; font-weight: bold;">128</span> <span style="color: #AE7C3B; font-weight: bold;">allocate-local-memory</span>
    <span style="color: #FF4C4C; font-weight: bold;">&gt;:address</span>
  tuck <span style="color: #83EA83; font-weight: bold;">:address</span> string<span style="color: #b0b1a3;">-&gt;</span>buffer!
    <span style="color: #FF4C4C; font-weight: bold;">&gt;:length</span>
  <span style="color: #83EA83; font-weight: bold;">:address</span> <span style="color: #83EA83; font-weight: bold;">:length</span>
  <span style="color: #e6db74;">"_"</span> <span style="color: #ffffff; font-weight: bold;">string:</span>byte remove-byte!
    <span style="color: #dc322f; font-weight: bold;">&gt;::string</span>
  <span style="color: #5CDD5C; font-weight: bold;">::string</span>
  base#wild-integer-string<span style="color: #b0b1a3;">-&gt;</span>base-string
    <span style="color: #dc322f; font-weight: bold;">&gt;::base-string</span>
  <span style="color: #5CDD5C; font-weight: bold;">::string</span>
  base#wild-integer-string<span style="color: #b0b1a3;">-&gt;</span>wild-integer-string
    <span style="color: #dc322f; font-weight: bold;">&gt;::wild-integer-string</span>
  <span style="color: #5CDD5C; font-weight: bold;">::base-string</span>
  digit-string<span style="color: #b0b1a3;">-&gt;</span>number
    <span style="color: #FF4C4C; font-weight: bold;">&gt;:base</span>
  <span style="color: #5CDD5C; font-weight: bold;">::wild-integer-string</span>
  <span style="color: #83EA83; font-weight: bold;">:base</span>
  wild-integer-string<span style="color: #b0b1a3;">-&gt;</span>integer,with-base
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org6ad80f8" class="outline-4">
<h4 id="org6ad80f8"><span class="done test">test</span> base#wild-integer-string-&gt;integer</h4>
<div class="outline-text-4" id="text-org6ad80f8">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #e6db74;">"* (testing) base#wild-integer-string-&gt;integer"</span> .s .l
  <span style="color: #e6db74;">"0#111"</span> base#wild-integer-string<span style="color: #b0b1a3;">-&gt;</span>integer
  <span style="color: #fd971f; font-weight: bold;">0</span> <span style="color: #fd971f; font-weight: bold;">0</span> power <span style="color: #fd971f; font-weight: bold;">1</span> mul
  <span style="color: #fd971f; font-weight: bold;">0</span> <span style="color: #fd971f; font-weight: bold;">1</span> power <span style="color: #fd971f; font-weight: bold;">1</span> mul add
  <span style="color: #fd971f; font-weight: bold;">0</span> <span style="color: #fd971f; font-weight: bold;">2</span> power <span style="color: #fd971f; font-weight: bold;">1</span> mul add
  <span style="color: #ffffff; font-weight: bold;">equal?</span>

  <span style="color: #e6db74;">"1#111"</span> base#wild-integer-string<span style="color: #b0b1a3;">-&gt;</span>integer
  <span style="color: #fd971f; font-weight: bold;">1</span> <span style="color: #fd971f; font-weight: bold;">0</span> power <span style="color: #fd971f; font-weight: bold;">1</span> mul
  <span style="color: #fd971f; font-weight: bold;">1</span> <span style="color: #fd971f; font-weight: bold;">1</span> power <span style="color: #fd971f; font-weight: bold;">1</span> mul add
  <span style="color: #fd971f; font-weight: bold;">1</span> <span style="color: #fd971f; font-weight: bold;">2</span> power <span style="color: #fd971f; font-weight: bold;">1</span> mul add
  <span style="color: #ffffff; font-weight: bold;">equal?</span>
  and

  <span style="color: #e6db74;">"10#123"</span> base#wild-integer-string<span style="color: #b0b1a3;">-&gt;</span>integer
  <span style="color: #e6db74;">"_1_0__#_1__2_3_"</span> base#wild-integer-string<span style="color: #b0b1a3;">-&gt;</span>integer
  <span style="color: #fd971f; font-weight: bold;">10</span> <span style="color: #fd971f; font-weight: bold;">0</span> power <span style="color: #fd971f; font-weight: bold;">3</span> mul
  <span style="color: #fd971f; font-weight: bold;">10</span> <span style="color: #fd971f; font-weight: bold;">1</span> power <span style="color: #fd971f; font-weight: bold;">2</span> mul add
  <span style="color: #fd971f; font-weight: bold;">10</span> <span style="color: #fd971f; font-weight: bold;">2</span> power <span style="color: #fd971f; font-weight: bold;">1</span> mul add
  tuck <span style="color: #ffffff; font-weight: bold;">equal?</span>
  xx<span style="color: #b0b1a3;">|</span>swap<span style="color: #b0b1a3;">|</span>x <span style="color: #ffffff; font-weight: bold;">equal?</span> and
  and

  <span style="color: #e6db74;">"2#1000"</span> base#wild-integer-string<span style="color: #b0b1a3;">-&gt;</span>integer
  <span style="color: #e6db74;">"2#_1000_"</span> base#wild-integer-string<span style="color: #b0b1a3;">-&gt;</span>integer
  <span style="color: #fd971f; font-weight: bold;">2</span> <span style="color: #fd971f; font-weight: bold;">0</span> power <span style="color: #fd971f; font-weight: bold;">0</span> mul
  <span style="color: #fd971f; font-weight: bold;">2</span> <span style="color: #fd971f; font-weight: bold;">1</span> power <span style="color: #fd971f; font-weight: bold;">0</span> mul add
  <span style="color: #fd971f; font-weight: bold;">2</span> <span style="color: #fd971f; font-weight: bold;">2</span> power <span style="color: #fd971f; font-weight: bold;">0</span> mul add
  <span style="color: #fd971f; font-weight: bold;">2</span> <span style="color: #fd971f; font-weight: bold;">3</span> power <span style="color: #fd971f; font-weight: bold;">1</span> mul add
  tuck <span style="color: #ffffff; font-weight: bold;">equal?</span>
  xx<span style="color: #b0b1a3;">|</span>swap<span style="color: #b0b1a3;">|</span>x <span style="color: #ffffff; font-weight: bold;">equal?</span> and
  and

  <span style="color: #e6db74;">"2#1111_1111"</span> base#wild-integer-string<span style="color: #b0b1a3;">-&gt;</span>integer
  <span style="color: #fd971f; font-weight: bold;">2</span> <span style="color: #fd971f; font-weight: bold;">0</span> power <span style="color: #fd971f; font-weight: bold;">1</span> mul
  <span style="color: #fd971f; font-weight: bold;">2</span> <span style="color: #fd971f; font-weight: bold;">1</span> power <span style="color: #fd971f; font-weight: bold;">1</span> mul add
  <span style="color: #fd971f; font-weight: bold;">2</span> <span style="color: #fd971f; font-weight: bold;">2</span> power <span style="color: #fd971f; font-weight: bold;">1</span> mul add
  <span style="color: #fd971f; font-weight: bold;">2</span> <span style="color: #fd971f; font-weight: bold;">3</span> power <span style="color: #fd971f; font-weight: bold;">1</span> mul add
  <span style="color: #fd971f; font-weight: bold;">2</span> <span style="color: #fd971f; font-weight: bold;">4</span> power <span style="color: #fd971f; font-weight: bold;">1</span> mul add
  <span style="color: #fd971f; font-weight: bold;">2</span> <span style="color: #fd971f; font-weight: bold;">5</span> power <span style="color: #fd971f; font-weight: bold;">1</span> mul add
  <span style="color: #fd971f; font-weight: bold;">2</span> <span style="color: #fd971f; font-weight: bold;">6</span> power <span style="color: #fd971f; font-weight: bold;">1</span> mul add
  <span style="color: #fd971f; font-weight: bold;">2</span> <span style="color: #fd971f; font-weight: bold;">7</span> power <span style="color: #fd971f; font-weight: bold;">1</span> mul add
  <span style="color: #ffffff; font-weight: bold;">equal?</span>
  and

  <span style="color: #e6db74;">"16#f_f"</span> base#wild-integer-string<span style="color: #b0b1a3;">-&gt;</span>integer
  <span style="color: #fd971f; font-weight: bold;">16</span> <span style="color: #fd971f; font-weight: bold;">0</span> power <span style="color: #fd971f; font-weight: bold;">15</span> mul
  <span style="color: #fd971f; font-weight: bold;">16</span> <span style="color: #fd971f; font-weight: bold;">1</span> power <span style="color: #fd971f; font-weight: bold;">15</span> mul add
  <span style="color: #ffffff; font-weight: bold;">equal?</span>
  and

  <span style="color: #e6db74;">"100#111"</span> base#wild-integer-string<span style="color: #b0b1a3;">-&gt;</span>integer
  <span style="color: #fd971f; font-weight: bold;">100</span> <span style="color: #fd971f; font-weight: bold;">0</span> power <span style="color: #fd971f; font-weight: bold;">1</span> mul
  <span style="color: #fd971f; font-weight: bold;">100</span> <span style="color: #fd971f; font-weight: bold;">1</span> power <span style="color: #fd971f; font-weight: bold;">1</span> mul add
  <span style="color: #fd971f; font-weight: bold;">100</span> <span style="color: #fd971f; font-weight: bold;">2</span> power <span style="color: #fd971f; font-weight: bold;">1</span> mul add
  <span style="color: #ffffff; font-weight: bold;">equal?</span>
  and

  <span style="color: #e6db74;">"64#zzz"</span> base#wild-integer-string<span style="color: #b0b1a3;">-&gt;</span>integer
  <span style="color: #fd971f; font-weight: bold;">64</span> <span style="color: #fd971f; font-weight: bold;">0</span> power <span style="color: #fd971f; font-weight: bold;">35</span> mul
  <span style="color: #fd971f; font-weight: bold;">64</span> <span style="color: #fd971f; font-weight: bold;">1</span> power <span style="color: #fd971f; font-weight: bold;">35</span> mul add
  <span style="color: #fd971f; font-weight: bold;">64</span> <span style="color: #fd971f; font-weight: bold;">2</span> power <span style="color: #fd971f; font-weight: bold;">35</span> mul add
  <span style="color: #ffffff; font-weight: bold;">equal?</span>
  and

  <span style="color: #e6db74;">"36#zzzz"</span> base#wild-integer-string<span style="color: #b0b1a3;">-&gt;</span>integer
  <span style="color: #fd971f; font-weight: bold;">36</span> <span style="color: #fd971f; font-weight: bold;">0</span> power <span style="color: #fd971f; font-weight: bold;">35</span> mul
  <span style="color: #fd971f; font-weight: bold;">36</span> <span style="color: #fd971f; font-weight: bold;">1</span> power <span style="color: #fd971f; font-weight: bold;">35</span> mul add
  <span style="color: #fd971f; font-weight: bold;">36</span> <span style="color: #fd971f; font-weight: bold;">2</span> power <span style="color: #fd971f; font-weight: bold;">35</span> mul add
  <span style="color: #fd971f; font-weight: bold;">36</span> <span style="color: #fd971f; font-weight: bold;">3</span> power <span style="color: #fd971f; font-weight: bold;">35</span> mul add
  <span style="color: #ffffff; font-weight: bold;">equal?</span>
  and <span style="color: #1ef15f; font-weight: bold;">test</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #1ef15f; font-weight: bold;">test-do</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org18a195a" class="outline-4">
<h4 id="org18a195a"><span class="todo note">note</span> writers</h4>
<div class="outline-text-4" id="text-org18a195a">
<ul class="org-ul">
<li><p>a general function</p><p>and three special ones</p></li>
<li><p>they all writer integer</p></li>
<li><p>I will implemented them by syntax when needed</p></li></ul>
</div>
</div>

<div id="outline-container-org6ac3e43" class="outline-4">
<h4 id="org6ac3e43">.#</h4>
<div class="outline-text-4" id="text-org6ac3e43">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">.#,loop</span>
  <span style="color: #FF8888;">&lt;&lt; number, base, cursor -- cursor &gt;&gt;</span>
  <span style="color: #FF4C4C; font-weight: bold;">&gt;:cursor</span>
  <span style="color: #FF4C4C; font-weight: bold;">&gt;:base</span>
  <span style="color: #FF4C4C; font-weight: bold;">&gt;:number</span>
  <span style="color: #83EA83; font-weight: bold;">:number</span> <span style="color: #ffffff; font-weight: bold;">zero?</span> <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #83EA83; font-weight: bold;">:cursor</span>
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #83EA83; font-weight: bold;">:number</span>
  <span style="color: #83EA83; font-weight: bold;">:base</span>
  divmod <span style="color: #FF4C4C; font-weight: bold;">&gt;:mod</span> <span style="color: #FF4C4C; font-weight: bold;">&gt;:div</span>
  <span style="color: #83EA83; font-weight: bold;">:mod</span> <span style="color: #fd971f; font-weight: bold;">10</span> <span style="color: #ffffff; font-weight: bold;">less-than?</span> <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #83EA83; font-weight: bold;">:mod</span> number<span style="color: #b0b1a3;">-&gt;</span>digit-byte
  <span style="color: #f92672; font-weight: bold;">else</span>
    <span style="color: #83EA83; font-weight: bold;">:mod</span> number<span style="color: #b0b1a3;">-&gt;</span>latin-byte
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #83EA83; font-weight: bold;">:cursor</span>
  set-byte
  <span style="color: #83EA83; font-weight: bold;">:div</span>
  <span style="color: #83EA83; font-weight: bold;">:base</span>
  <span style="color: #83EA83; font-weight: bold;">:cursor</span> add1
  <span style="color: #00ffff; font-weight: bold;">loop</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>

<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">.#</span>
  <span style="color: #FF8888;">&lt;&lt; integer, base -- &gt;&gt;</span>
  over <span style="color: #ffffff; font-weight: bold;">zero?</span> <span style="color: #f92672; font-weight: bold;">if</span>
    drop .i
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  dup <span style="color: #fd971f; font-weight: bold;">36</span> <span style="color: #ffffff; font-weight: bold;">greater-than?</span>
  over <span style="color: #fd971f; font-weight: bold;">2</span> <span style="color: #ffffff; font-weight: bold;">less-than?</span>
  or <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #e6db74;">"* (.#) the base "</span> .s .i <span style="color: #e6db74;">" is not valid to write a number"</span> .s .l
    <span style="color: #e6db74;">"  a base should in between 2 and 36 includingly"</span> .s .l
    <span style="color: #e6db74;">"  the integer to be written is "</span> .s .i .l
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  dup .i
  <span style="color: #e6db74;">"#"</span> .s
  over <span style="color: #ffffff; font-weight: bold;">negative?</span> <span style="color: #f92672; font-weight: bold;">if</span>
    swap negate swap
    <span style="color: #e6db74;">"-"</span> .s
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #fd971f; font-weight: bold;">128</span> <span style="color: #AE7C3B; font-weight: bold;">allocate-local-memory</span> <span style="color: #FF4C4C; font-weight: bold;">&gt;:buffer</span>
  <span style="color: #83EA83; font-weight: bold;">:buffer</span>
  .#,loop <span style="color: #FF4C4C; font-weight: bold;">&gt;:cursor</span>
  <span style="color: #83EA83; font-weight: bold;">:buffer</span>
  <span style="color: #83EA83; font-weight: bold;">:cursor</span> <span style="color: #83EA83; font-weight: bold;">:buffer</span> sub
  string-reverse! .s
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org8c9a7b3" class="outline-4">
<h4 id="org8c9a7b3">.#2 .#8 .#16</h4>
<div class="outline-text-4" id="text-org8c9a7b3">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">.#2</span>  <span style="color: #fd971f; font-weight: bold;">2</span>  .# <span style="color: #e6db74;">" "</span> .s <span style="color: #00ffff; font-weight: bold;">end</span> <span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">.#8</span>  <span style="color: #fd971f; font-weight: bold;">8</span>  .# <span style="color: #e6db74;">" "</span> .s <span style="color: #00ffff; font-weight: bold;">end</span> <span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">.#16</span> <span style="color: #fd971f; font-weight: bold;">16</span> .# <span style="color: #e6db74;">" "</span> .s <span style="color: #00ffff; font-weight: bold;">end</span> <span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org4ef800e" class="outline-4">
<h4 id="org4ef800e"><span class="done test">test</span> .#</h4>
<div class="outline-text-4" id="text-org4ef800e">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #e6db74;">"* (testing) .#"</span> .s .l
  .s .l
  <span style="color: #fd971f; font-weight: bold;">0</span><span style="color: #ffff00;">#</span><span style="color: #fd971f; font-weight: bold;">111</span>        <span style="color: #fd971f; font-weight: bold;">0</span>  .# .l
  <span style="color: #FF8888;">&lt;&lt; error</span>
<span style="color: #FF8888;">  1#111        1  .# .l</span>
<span style="color: #FF8888;">  &gt;&gt;</span>
  <span style="color: #fd971f; font-weight: bold;">10</span><span style="color: #ffff00;">#</span><span style="color: #fd971f; font-weight: bold;">123</span>       <span style="color: #fd971f; font-weight: bold;">10</span> .# .l
  <span style="color: #fd971f; font-weight: bold;">10</span><span style="color: #ffff00;">#</span><span style="color: #fd971f; font-weight: bold;">0</span>         <span style="color: #fd971f; font-weight: bold;">10</span> .# .l
  <span style="color: #fd971f; font-weight: bold;">2</span><span style="color: #ffff00;">#</span><span style="color: #fd971f; font-weight: bold;">1000</span>       <span style="color: #fd971f; font-weight: bold;">2</span>  .# .l
  <span style="color: #fd971f; font-weight: bold;">2</span><span style="color: #ffff00;">#</span><span style="color: #fd971f; font-weight: bold;">1111_1111</span>  <span style="color: #fd971f; font-weight: bold;">2</span>  .# .l
  <span style="color: #fd971f; font-weight: bold;">16</span><span style="color: #ffff00;">#</span><span style="color: #fd971f; font-weight: bold;">f_f</span>       <span style="color: #fd971f; font-weight: bold;">16</span> .# .l
  <span style="color: #fd971f; font-weight: bold;">36</span><span style="color: #ffff00;">#</span><span style="color: #fd971f; font-weight: bold;">zzzz</span>      <span style="color: #fd971f; font-weight: bold;">36</span> .# .l

  <span style="color: #fd971f; font-weight: bold;">2</span><span style="color: #ffff00;">#</span><span style="color: #fd971f; font-weight: bold;">1111_1111</span>  .#2  .l
  <span style="color: #fd971f; font-weight: bold;">8</span><span style="color: #ffff00;">#</span><span style="color: #fd971f; font-weight: bold;">123</span>        .#8  .l
  <span style="color: #fd971f; font-weight: bold;">16</span><span style="color: #ffff00;">#</span><span style="color: #fd971f; font-weight: bold;">fff</span>       .#16 .l
<span style="color: #ffff00; font-weight: bold;">;</span> dup2 <span style="color: #1ef15f; font-weight: bold;">test-do</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org6734155" class="outline-3">
<h3 id="org6734155">init,syntax-rule-set:basic-REPL</h3>
<div class="outline-text-3" id="text-org6734155">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">init,syntax-rule-set:basic-REPL</span>
  <span style="color: #FF8888;">&lt;&lt; -- &gt;&gt;</span>
  <span style="color: #fd971f; font-weight: bold;">syntax-rule-set:*word-interpreter*</span>
  dup <span style="color: #f92672; font-weight: bold;">jo</span> <span style="color: #ffffff; font-weight: bold;">integer-string?</span> <span style="color: #f92672; font-weight: bold;">jo</span> string<span style="color: #b0b1a3;">-&gt;</span>integer <span style="color: #ffffff; font-weight: bold;">syntax-rule:</span>add
      <span style="color: #f92672; font-weight: bold;">jo</span> <span style="color: #ffffff; font-weight: bold;">base#wild-integer-string?</span> <span style="color: #f92672; font-weight: bold;">jo</span> base#wild-integer-string<span style="color: #b0b1a3;">-&gt;</span>integer <span style="color: #ffffff; font-weight: bold;">syntax-rule:</span>add
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
<span style="color: #ffffff; font-weight: bold;">init,syntax-rule-set:</span>basic-REPL
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd0614a9" class="outline-3">
<h3 id="orgd0614a9"><span class="done test">test</span> REPL</h3>
<div class="outline-text-3" id="text-orgd0614a9">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #e6db74;">"* (testing) REPL"</span> .s .l
  <span style="color: #fd971f; font-weight: bold;">0</span><span style="color: #ffff00;">#</span><span style="color: #fd971f; font-weight: bold;">111</span>
  <span style="color: #fd971f; font-weight: bold;">0</span> <span style="color: #fd971f; font-weight: bold;">0</span> power <span style="color: #fd971f; font-weight: bold;">1</span> mul
  <span style="color: #fd971f; font-weight: bold;">0</span> <span style="color: #fd971f; font-weight: bold;">1</span> power <span style="color: #fd971f; font-weight: bold;">1</span> mul add
  <span style="color: #fd971f; font-weight: bold;">0</span> <span style="color: #fd971f; font-weight: bold;">2</span> power <span style="color: #fd971f; font-weight: bold;">1</span> mul add
  <span style="color: #ffffff; font-weight: bold;">equal?</span>

  <span style="color: #fd971f; font-weight: bold;">1</span><span style="color: #ffff00;">#</span><span style="color: #fd971f; font-weight: bold;">111</span>
  <span style="color: #fd971f; font-weight: bold;">1</span> <span style="color: #fd971f; font-weight: bold;">0</span> power <span style="color: #fd971f; font-weight: bold;">1</span> mul
  <span style="color: #fd971f; font-weight: bold;">1</span> <span style="color: #fd971f; font-weight: bold;">1</span> power <span style="color: #fd971f; font-weight: bold;">1</span> mul add
  <span style="color: #fd971f; font-weight: bold;">1</span> <span style="color: #fd971f; font-weight: bold;">2</span> power <span style="color: #fd971f; font-weight: bold;">1</span> mul add
  <span style="color: #ffffff; font-weight: bold;">equal?</span> and

  <span style="color: #fd971f; font-weight: bold;">10</span><span style="color: #ffff00;">#</span><span style="color: #fd971f; font-weight: bold;">123</span>
  _1_0__#_1__2_3_
  <span style="color: #ffffff; font-weight: bold;">equal?</span> and

  _1_0__#_1__2_3_
  <span style="color: #fd971f; font-weight: bold;">10</span> <span style="color: #fd971f; font-weight: bold;">0</span> power <span style="color: #fd971f; font-weight: bold;">3</span> mul
  <span style="color: #fd971f; font-weight: bold;">10</span> <span style="color: #fd971f; font-weight: bold;">1</span> power <span style="color: #fd971f; font-weight: bold;">2</span> mul add
  <span style="color: #fd971f; font-weight: bold;">10</span> <span style="color: #fd971f; font-weight: bold;">2</span> power <span style="color: #fd971f; font-weight: bold;">1</span> mul add
  <span style="color: #ffffff; font-weight: bold;">equal?</span> and

  <span style="color: #fd971f; font-weight: bold;">2</span><span style="color: #ffff00;">#</span><span style="color: #fd971f; font-weight: bold;">1000</span>
  <span style="color: #fd971f; font-weight: bold;">2</span><span style="color: #ffff00;">#</span><span style="color: #fd971f; font-weight: bold;">_1000_</span>
  <span style="color: #ffffff; font-weight: bold;">equal?</span> and

  <span style="color: #fd971f; font-weight: bold;">2</span><span style="color: #ffff00;">#</span><span style="color: #fd971f; font-weight: bold;">_1000_</span>
  <span style="color: #fd971f; font-weight: bold;">2</span> <span style="color: #fd971f; font-weight: bold;">0</span> power <span style="color: #fd971f; font-weight: bold;">0</span> mul
  <span style="color: #fd971f; font-weight: bold;">2</span> <span style="color: #fd971f; font-weight: bold;">1</span> power <span style="color: #fd971f; font-weight: bold;">0</span> mul add
  <span style="color: #fd971f; font-weight: bold;">2</span> <span style="color: #fd971f; font-weight: bold;">2</span> power <span style="color: #fd971f; font-weight: bold;">0</span> mul add
  <span style="color: #fd971f; font-weight: bold;">2</span> <span style="color: #fd971f; font-weight: bold;">3</span> power <span style="color: #fd971f; font-weight: bold;">1</span> mul add
  <span style="color: #ffffff; font-weight: bold;">equal?</span> and

  <span style="color: #fd971f; font-weight: bold;">2</span><span style="color: #ffff00;">#</span><span style="color: #fd971f; font-weight: bold;">1111_1111</span>
  <span style="color: #fd971f; font-weight: bold;">2</span> <span style="color: #fd971f; font-weight: bold;">0</span> power <span style="color: #fd971f; font-weight: bold;">1</span> mul
  <span style="color: #fd971f; font-weight: bold;">2</span> <span style="color: #fd971f; font-weight: bold;">1</span> power <span style="color: #fd971f; font-weight: bold;">1</span> mul add
  <span style="color: #fd971f; font-weight: bold;">2</span> <span style="color: #fd971f; font-weight: bold;">2</span> power <span style="color: #fd971f; font-weight: bold;">1</span> mul add
  <span style="color: #fd971f; font-weight: bold;">2</span> <span style="color: #fd971f; font-weight: bold;">3</span> power <span style="color: #fd971f; font-weight: bold;">1</span> mul add
  <span style="color: #fd971f; font-weight: bold;">2</span> <span style="color: #fd971f; font-weight: bold;">4</span> power <span style="color: #fd971f; font-weight: bold;">1</span> mul add
  <span style="color: #fd971f; font-weight: bold;">2</span> <span style="color: #fd971f; font-weight: bold;">5</span> power <span style="color: #fd971f; font-weight: bold;">1</span> mul add
  <span style="color: #fd971f; font-weight: bold;">2</span> <span style="color: #fd971f; font-weight: bold;">6</span> power <span style="color: #fd971f; font-weight: bold;">1</span> mul add
  <span style="color: #fd971f; font-weight: bold;">2</span> <span style="color: #fd971f; font-weight: bold;">7</span> power <span style="color: #fd971f; font-weight: bold;">1</span> mul add
  <span style="color: #ffffff; font-weight: bold;">equal?</span> and

  <span style="color: #fd971f; font-weight: bold;">16</span><span style="color: #ffff00;">#</span><span style="color: #fd971f; font-weight: bold;">f_f</span>
  <span style="color: #fd971f; font-weight: bold;">16</span> <span style="color: #fd971f; font-weight: bold;">0</span> power <span style="color: #fd971f; font-weight: bold;">15</span> mul
  <span style="color: #fd971f; font-weight: bold;">16</span> <span style="color: #fd971f; font-weight: bold;">1</span> power <span style="color: #fd971f; font-weight: bold;">15</span> mul add
  <span style="color: #ffffff; font-weight: bold;">equal?</span> and

  <span style="color: #fd971f; font-weight: bold;">100</span><span style="color: #ffff00;">#</span><span style="color: #fd971f; font-weight: bold;">111</span>
  <span style="color: #fd971f; font-weight: bold;">100</span> <span style="color: #fd971f; font-weight: bold;">0</span> power <span style="color: #fd971f; font-weight: bold;">1</span> mul
  <span style="color: #fd971f; font-weight: bold;">100</span> <span style="color: #fd971f; font-weight: bold;">1</span> power <span style="color: #fd971f; font-weight: bold;">1</span> mul add
  <span style="color: #fd971f; font-weight: bold;">100</span> <span style="color: #fd971f; font-weight: bold;">2</span> power <span style="color: #fd971f; font-weight: bold;">1</span> mul add
  <span style="color: #ffffff; font-weight: bold;">equal?</span> and

  <span style="color: #fd971f; font-weight: bold;">64</span><span style="color: #ffff00;">#</span><span style="color: #fd971f; font-weight: bold;">zzz</span>
  <span style="color: #fd971f; font-weight: bold;">64</span> <span style="color: #fd971f; font-weight: bold;">0</span> power <span style="color: #fd971f; font-weight: bold;">35</span> mul
  <span style="color: #fd971f; font-weight: bold;">64</span> <span style="color: #fd971f; font-weight: bold;">1</span> power <span style="color: #fd971f; font-weight: bold;">35</span> mul add
  <span style="color: #fd971f; font-weight: bold;">64</span> <span style="color: #fd971f; font-weight: bold;">2</span> power <span style="color: #fd971f; font-weight: bold;">35</span> mul add
  <span style="color: #ffffff; font-weight: bold;">equal?</span> and

  <span style="color: #fd971f; font-weight: bold;">36</span><span style="color: #ffff00;">#</span><span style="color: #fd971f; font-weight: bold;">zzzz</span>
  <span style="color: #fd971f; font-weight: bold;">36</span> <span style="color: #fd971f; font-weight: bold;">0</span> power <span style="color: #fd971f; font-weight: bold;">35</span> mul
  <span style="color: #fd971f; font-weight: bold;">36</span> <span style="color: #fd971f; font-weight: bold;">1</span> power <span style="color: #fd971f; font-weight: bold;">35</span> mul add
  <span style="color: #fd971f; font-weight: bold;">36</span> <span style="color: #fd971f; font-weight: bold;">2</span> power <span style="color: #fd971f; font-weight: bold;">35</span> mul add
  <span style="color: #fd971f; font-weight: bold;">36</span> <span style="color: #fd971f; font-weight: bold;">3</span> power <span style="color: #fd971f; font-weight: bold;">35</span> mul add
  <span style="color: #ffffff; font-weight: bold;">equal?</span> and <span style="color: #1ef15f; font-weight: bold;">test</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #1ef15f; font-weight: bold;">test-do</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgfc36f80" class="outline-2">
<h2 id="orgfc36f80">jojo-compiler</h2>
<div class="outline-text-2" id="text-orgfc36f80">
</div><div id="outline-container-org592f3ac" class="outline-3">
<h3 id="org592f3ac">jojo-compiler,dispatch-word&#xa0;&#xa0;&#xa0;<span class="tag"><span class="redefine">redefine</span></span></h3>
<div class="outline-text-3" id="text-org592f3ac">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">jojo-compiler,dispatch-word</span>
  <span style="color: #FF8888;">&lt;&lt; jo, string[address, length], word[address, length] --</span>
<span style="color: #FF8888;">     jo, string[address, length] &gt;&gt;</span>
  dup2 find-syntax <span style="color: #f92672; font-weight: bold;">if</span>
    apply
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  dup2 name-hash-table,find-jo <span style="color: #f92672; font-weight: bold;">if</span>
    xx<span style="color: #b0b1a3;">|</span>swap<span style="color: #b0b1a3;">|</span>x drop2
    jojo-area,stay
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #e6db74;">"* (jojo-compiler) meets undefined word : "</span> .s .s .l
  <span style="color: #ffffff; font-weight: bold;">global-naming-stack:</span>delete-last-record
  <span style="color: #fd971f; font-weight: bold;">'jojo-compiler,dispatch-word,fail</span> <span style="color: #00ffff; font-weight: bold;">awake</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org4c1deb1" class="outline-3">
<h3 id="org4c1deb1">jojo-compiler,dispatch-word,fail</h3>
<div class="outline-text-3" id="text-org4c1deb1">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">jojo-compiler,dispatch-word,fail</span>
  <span style="color: #e6db74;">"* (jojo-compiler,dispatch-word,fail)"</span> .s .l
  drop-syntax-stack
  action,reset-the-stack
  <span style="color: #FF8888;">&lt;&lt; scope-stack-pointer -- &gt;&gt;</span>
  <span style="color: #f92672; font-weight: bold;">address</span> <span style="color: #fd971f; font-weight: bold;">scope-stack:*pointer*</span> set
  <span style="color: #fd971f; font-weight: bold;">'undo-jojo-compiler</span> <span style="color: #00ffff; font-weight: bold;">awake</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org8e4a9ef" class="outline-3">
<h3 id="org8e4a9ef">jojo-compiler&#xa0;&#xa0;&#xa0;<span class="tag"><span class="redefine">redefine</span></span></h3>
<div class="outline-text-3" id="text-org8e4a9ef">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">jojo-compiler,loop</span>
  <span style="color: #FF8888;">&lt;&lt; jo, string[address, length] -- &gt;&gt;</span>
  dup2 <span style="color: #ffffff; font-weight: bold;">string:</span>space? <span style="color: #f92672; font-weight: bold;">if</span>
    drop2
    drop
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  dup2
  <span style="color: #ffffff; font-weight: bold;">string:</span>word-tail
  xx<span style="color: #b0b1a3;">|</span>swap<span style="color: #b0b1a3;">|</span>xx
  <span style="color: #ffffff; font-weight: bold;">string:</span>word
  jojo-compiler,dispatch-word
  <span style="color: #00ffff; font-weight: bold;">loop</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>

<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">jojo-compiler</span>
  <span style="color: #FF8888;">&lt;&lt; jo, string[address, length] -- &gt;&gt;</span>
  <span style="color: #dc322f; font-weight: bold;">&gt;::string</span>
  <span style="color: #FF4C4C; font-weight: bold;">&gt;:jo</span>

  <span style="color: #FF8888;">&lt;&lt; this is an ad hoc</span>
<span style="color: #FF8888;">  &gt;&gt;</span> local-variable-table,clear

  <span style="color: #fd971f; font-weight: bold;">scope-stack:*pointer*</span> <span style="color: #FF4C4C; font-weight: bold;">&gt;:scope-stack-pointer</span>
  <span style="color: #fd971f; font-weight: bold;">0</span> <span style="color: #83EA83; font-weight: bold;">:scope-stack-pointer</span> offset-record,set-name
  <span style="color: #fd971f; font-weight: bold;">0</span> <span style="color: #83EA83; font-weight: bold;">:scope-stack-pointer</span> offset-record,set-offset
  <span style="color: #fd971f; font-weight: bold;">scope-stack:*unit*</span> <span style="color: #f92672; font-weight: bold;">address</span> <span style="color: #fd971f; font-weight: bold;">scope-stack:*pointer*</span> add-set

  <span style="color: #83EA83; font-weight: bold;">:scope-stack-pointer</span>

  <span style="color: #f92672; font-weight: bold;">jo</span> jojo-compiler,dispatch-word,fail
  <span style="color: #fd971f; font-weight: bold;">'jojo-compiler,dispatch-word,fail</span> <span style="color: #1ef15f; font-weight: bold;">await</span>

  <span style="color: #fd971f; font-weight: bold;">jojo-compiler:*syntax-rule-set*</span> push-syntax-stack
  <span style="color: #83EA83; font-weight: bold;">:jo</span> <span style="color: #5CDD5C; font-weight: bold;">::string</span> jojo-compiler,loop
  drop-syntax-stack

  <span style="color: #f92672; font-weight: bold;">address</span> <span style="color: #fd971f; font-weight: bold;">scope-stack:*pointer*</span> set
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgdaec151" class="outline-2">
<h2 id="orgdaec151">define-function</h2>
<div class="outline-text-2" id="text-orgdaec151">
</div><div id="outline-container-org8d6f8c2" class="outline-3">
<h3 id="org8d6f8c2">init,name-hash-table,by-link</h3>
<div class="outline-text-3" id="text-org8d6f8c2">
<ul class="org-ul">
<li><p>the function should be evaled right after</p><p>(define-function) is redefined</p></li>
<li><p>be ware of</p><p>the interface of (name-hash-table,search)</p></li>
<li><p>I simply implement it as a recursive function</p></li></ul>
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">init,name-hash-table,by-link</span>
  <span style="color: #FF8888;">&lt;&lt; link -- &gt;&gt;</span>
  <span style="color: #FF4C4C; font-weight: bold;">&gt;:link</span>
  <span style="color: #83EA83; font-weight: bold;">:link</span> <span style="color: #ffffff; font-weight: bold;">zero?</span> <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #83EA83; font-weight: bold;">:link</span> link<span style="color: #b0b1a3;">-&gt;</span>next-link <span style="color: #f92672; font-weight: bold;">recur</span>
  <span style="color: #83EA83; font-weight: bold;">:link</span> name-hash-table,record-jo,by-link
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org9a377fd" class="outline-3">
<h3 id="org9a377fd">n-string-&gt;buffer!</h3>
<div class="outline-text-3" id="text-org9a377fd">
<ul class="org-ul">
<li><p>this function return length</p></li></ul>
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">n-string-&gt;buffer!,loop</span>
  <span style="color: #FF8888;">&lt;&lt; string-1[address, length],</span>
<span style="color: #FF8888;">     ...</span>
<span style="color: #FF8888;">     string-2[address, length],</span>
<span style="color: #FF8888;">     buffer, n, cursor</span>
<span style="color: #FF8888;">     -- length &gt;&gt;</span>
  <span style="color: #FF4C4C; font-weight: bold;">&gt;:cursor</span>
  <span style="color: #FF4C4C; font-weight: bold;">&gt;:n</span>
  <span style="color: #FF4C4C; font-weight: bold;">&gt;:buffer</span>
  <span style="color: #83EA83; font-weight: bold;">:n</span> <span style="color: #ffffff; font-weight: bold;">zero?</span> <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #83EA83; font-weight: bold;">:buffer</span>
    <span style="color: #83EA83; font-weight: bold;">:cursor</span> <span style="color: #83EA83; font-weight: bold;">:buffer</span> sub
    string-reverse!
    swap drop
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  dup <span style="color: #ffffff; font-weight: bold;">zero?</span> <span style="color: #f92672; font-weight: bold;">if</span>
    drop2
    <span style="color: #83EA83; font-weight: bold;">:buffer</span>
    <span style="color: #83EA83; font-weight: bold;">:n</span> sub1
    <span style="color: #83EA83; font-weight: bold;">:cursor</span>
    <span style="color: #00ffff; font-weight: bold;">loop</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  dup2 add sub1 get-byte <span style="color: #83EA83; font-weight: bold;">:cursor</span> set-byte
  sub1
  <span style="color: #83EA83; font-weight: bold;">:buffer</span>
  <span style="color: #83EA83; font-weight: bold;">:n</span>
  <span style="color: #83EA83; font-weight: bold;">:cursor</span> add1
  <span style="color: #00ffff; font-weight: bold;">loop</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>

<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">n-string-&gt;buffer!</span>
  <span style="color: #FF8888;">&lt;&lt; string-1[address, length],</span>
<span style="color: #FF8888;">     ...</span>
<span style="color: #FF8888;">     string-2[address, length],</span>
<span style="color: #FF8888;">     buffer, n</span>
<span style="color: #FF8888;">     -- length &gt;&gt;</span>
  over n-string<span style="color: #b0b1a3;">-&gt;</span>buffer!,loop
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd2ea030" class="outline-3">
<h3 id="orgd2ea030"><span class="done test">test</span> n-string-&gt;buffer!</h3>
<div class="outline-text-3" id="text-orgd2ea030">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #fd971f; font-weight: bold;">*test,buffer*</span>
  <span style="color: #fd971f; font-weight: bold;">512</span> <span style="color: #AE7C3B; font-weight: bold;">allocate-memory</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #1ef15f; font-weight: bold;">test-variable</span>

<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #e6db74;">"* (testing) n-string-&gt;buffer!"</span> .s .l
  <span style="color: #e6db74;">"/home"</span>
  <span style="color: #e6db74;">"/xyh"</span>
  <span style="color: #e6db74;">"/cicada"</span>
  <span style="color: #fd971f; font-weight: bold;">*test,buffer*</span> <span style="color: #fd971f; font-weight: bold;">3</span> n-string<span style="color: #b0b1a3;">-&gt;</span>buffer!
  <span style="color: #fd971f; font-weight: bold;">*test,buffer*</span> swap
  <span style="color: #e6db74;">"/home/xyh/cicada"</span>
  <span style="color: #ffffff; font-weight: bold;">string:</span>equal? <span style="color: #1ef15f; font-weight: bold;">test</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #1ef15f; font-weight: bold;">test-do</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org4606da5" class="outline-3">
<h3 id="org4606da5">undo-jojo-compiler</h3>
<div class="outline-text-3" id="text-org4606da5">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">undo-jojo-compiler</span>
  action,reset-the-stack
  <span style="color: #FF8888;">&lt;&lt; *string-area,current-free-address*</span>
<span style="color: #FF8888;">     *jojo-area,current-free-address*</span>
<span style="color: #FF8888;">     string[address, length] &gt;&gt;</span>
  <span style="color: #e6db74;">"  the following jojo is not made :"</span> .s .l
  <span style="color: #e6db74;">":"</span> .s
  .s .l
  <span style="color: #e6db74;">";"</span> .s .l
  <span style="color: #f92672; font-weight: bold;">address</span> <span style="color: #fd971f; font-weight: bold;">*jojo-area,current-free-address*</span> set
  <span style="color: #f92672; font-weight: bold;">address</span> <span style="color: #fd971f; font-weight: bold;">*string-area,current-free-address*</span> set
  drop-syntax-stack
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org26f133e" class="outline-3">
<h3 id="org26f133e">define-function&#xa0;&#xa0;&#xa0;<span class="tag"><span class="redefine">redefine</span></span></h3>
<div class="outline-text-3" id="text-org26f133e">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">define-function</span>
  <span style="color: #FF8888;">&lt;&lt; string[address, length] -- &gt;&gt;</span>
  <span style="color: #fd971f; font-weight: bold;">*string-area,current-free-address*</span> xx<span style="color: #b0b1a3;">|</span>swap<span style="color: #b0b1a3;">|</span>x
  <span style="color: #fd971f; font-weight: bold;">*jojo-area,current-free-address*</span> xx<span style="color: #b0b1a3;">|</span>swap<span style="color: #b0b1a3;">|</span>x
  <span style="color: #FF8888;">&lt;&lt; *string-area,current-free-address*</span>
<span style="color: #FF8888;">     *jojo-area,current-free-address*</span>
<span style="color: #FF8888;">     string[address, length] &gt;&gt;</span>
  <span style="color: #f92672; font-weight: bold;">jo</span> undo-jojo-compiler
  <span style="color: #fd971f; font-weight: bold;">'undo-jojo-compiler</span> <span style="color: #1ef15f; font-weight: bold;">await</span>

  dup2 <span style="color: #dc322f; font-weight: bold;">&gt;::string</span>

  <span style="color: #5CDD5C; font-weight: bold;">::string</span> <span style="color: #ffffff; font-weight: bold;">string:</span>word <span style="color: #dc322f; font-weight: bold;">&gt;::name</span>
  <span style="color: #5CDD5C; font-weight: bold;">::string</span> <span style="color: #ffffff; font-weight: bold;">string:</span>word-tail <span style="color: #dc322f; font-weight: bold;">&gt;::body</span>

  <span style="color: #fd971f; font-weight: bold;">*explainer,function*</span> <span style="color: #fd971f; font-weight: bold;">0</span>
  make-jo-head <span style="color: #FF4C4C; font-weight: bold;">&gt;:jo</span>

  <span style="color: #83EA83; font-weight: bold;">:jo</span>
  <span style="color: #5CDD5C; font-weight: bold;">::name</span> string<span style="color: #b0b1a3;">-&gt;</span>name
  <span style="color: #ffffff; font-weight: bold;">global-naming-stack:</span>record-jo

  <span style="color: #fd971f; font-weight: bold;">*jojo-area,current-free-address*</span> <span style="color: #FF4C4C; font-weight: bold;">&gt;:old-address</span>

  <span style="color: #83EA83; font-weight: bold;">:jo</span> <span style="color: #5CDD5C; font-weight: bold;">::body</span> jojo-compiler

  <span style="color: #fd971f; font-weight: bold;">*jojo-area,current-free-address*</span>
  <span style="color: #83EA83; font-weight: bold;">:old-address</span> sub <span style="color: #fd971f; font-weight: bold;">*cell-size*</span> div
  <span style="color: #83EA83; font-weight: bold;">:jo</span> jo,set-length

  drop2
  drop
  drop
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org7f5208f" class="outline-3">
<h3 id="org7f5208f"><span class="done test">test</span> function</h3>
<div class="outline-text-3" id="text-org7f5208f">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">k</span> <span style="color: #fd971f; font-weight: bold;">1</span> <span style="color: #fd971f; font-weight: bold;">2</span> <span style="color: #fd971f; font-weight: bold;">3</span> add add . <span style="color: #00ffff; font-weight: bold;">end</span> <span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
k

<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">k</span> <span style="color: #fd971f; font-weight: bold;">1</span> <span style="color: #fd971f; font-weight: bold;">2</span> <span style="color: #fd971f; font-weight: bold;">3</span> <span style="color: #00ffff; font-weight: bold;">end</span> <span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
k add add .

<span style="color: #FF8888;">&lt;&lt; error &gt;&gt;</span>
<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">k</span> no <span style="color: #00ffff; font-weight: bold;">end</span> <span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgdc59d5" class="outline-2">
<h2 id="orgdc59d5"><b>to use the new naming mechanism</b></h2>
<div class="outline-text-2" id="text-orgdc59d5">
</div><div id="outline-container-orge707ea" class="outline-3">
<h3 id="orge707ea"><span class="todo note">note</span> </h3>
<div class="outline-text-3" id="text-orge707ea">
<ul class="org-ul">
<li><p>這裏的函數需要處理 鏈 中的重複定義的 珠</p><p>重複定義者 只有很少的幾個</p><p>一是 jojo-compiler 以及相關的</p><p>一是 define-function</p></li></ul>
</div>
</div>

<div id="outline-container-orgfdb30c" class="outline-3">
<h3 id="orgfdb30c">switch</h3>
<div class="outline-text-3" id="text-orgfdb30c">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #fd971f; font-weight: bold;">*link*</span> init,name-hash-table,by-link
basic-REPL
</pre>
</div>
</div>
</div>
</div>


<div id="outline-container-orga9ca966" class="outline-2">
<h2 id="orga9ca966">fix syntax about local-variable</h2>
<div class="outline-text-2" id="text-orga9ca966">
</div><div id="outline-container-org22f01f5" class="outline-3">
<h3 id="org22f01f5">jojo-compiler-syntax:local-variable-get&#xa0;&#xa0;&#xa0;<span class="tag"><span class="redefine">redefine</span></span></h3>
<div class="outline-text-3" id="text-org22f01f5">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">jojo-compiler-syntax:local-variable-get</span>
  <span style="color: #FF8888;">&lt;&lt; string[address, length], word[address, length] --</span>
<span style="color: #FF8888;">     string[address, length] &gt;&gt;</span>
  dup2 string<span style="color: #b0b1a3;">-&gt;</span>name <span style="color: #ffffff; font-weight: bold;">scope-stack:</span>find <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #f92672; font-weight: bold;">jo</span> instruction,local-variable,n-get
      jojo-area,stay
    <span style="color: #FF8888;">&lt;&lt; offset &gt;&gt;</span>
    offset-record,get-offset
      jojo-area,stay
    <span style="color: #FF8888;">&lt;&lt; number &gt;&gt;</span>
    count-front-colon
      jojo-area,stay
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #e6db74;">"* (jojo-compiler-syntax:local-variable-get)"</span> .s .l
  <span style="color: #e6db74;">"  local-variable not bound : "</span> .s
     .s .l
  <span style="color: #fd971f; font-weight: bold;">'undo-jojo-compiler</span> <span style="color: #1ef15f; font-weight: bold;">await</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org5f4d59d" class="outline-3">
<h3 id="org5f4d59d">jojo-compiler-syntax:local-variable-set&#xa0;&#xa0;&#xa0;<span class="tag"><span class="redefine">redefine</span></span></h3>
<div class="outline-text-3" id="text-org5f4d59d">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">jojo-compiler-syntax:local-variable-set</span>
  <span style="color: #FF8888;">&lt;&lt; string[address, length], word[address, length] --</span>
<span style="color: #FF8888;">     string[address, length] &gt;&gt;</span>
  <span style="color: #ffffff; font-weight: bold;">string:</span>byte-tail
  <span style="color: #dc322f; font-weight: bold;">&gt;::local-variable-name</span>
  <span style="color: #5CDD5C; font-weight: bold;">::local-variable-name</span> count-front-colon <span style="color: #FF4C4C; font-weight: bold;">&gt;:number</span>
  <span style="color: #5CDD5C; font-weight: bold;">::local-variable-name</span> string<span style="color: #b0b1a3;">-&gt;</span>name <span style="color: #FF4C4C; font-weight: bold;">&gt;:name</span>

  <span style="color: #83EA83; font-weight: bold;">:name</span> <span style="color: #ffffff; font-weight: bold;">scope-stack:</span>find <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #f92672; font-weight: bold;">jo</span> instruction,local-variable,n-set
      jojo-area,stay
    <span style="color: #FF8888;">&lt;&lt; offset &gt;&gt;</span>
    offset-record,get-offset
      jojo-area,stay
    <span style="color: #83EA83; font-weight: bold;">:number</span>
      jojo-area,stay
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>

  <span style="color: #ffffff; font-weight: bold;">scope-stack:</span>get-current-offset <span style="color: #FF4C4C; font-weight: bold;">&gt;:current-offset</span>
  <span style="color: #83EA83; font-weight: bold;">:current-offset</span>
  <span style="color: #fd971f; font-weight: bold;">scope-stack:*pointer*</span>
  offset-record,set-offset
  <span style="color: #83EA83; font-weight: bold;">:name</span>
  <span style="color: #fd971f; font-weight: bold;">scope-stack:*pointer*</span>
  offset-record,set-name
  <span style="color: #fd971f; font-weight: bold;">scope-stack:*unit*</span> <span style="color: #f92672; font-weight: bold;">address</span> <span style="color: #fd971f; font-weight: bold;">scope-stack:*pointer*</span> add-set

  <span style="color: #f92672; font-weight: bold;">jo</span> instruction,literal
    jojo-area,stay
  <span style="color: #83EA83; font-weight: bold;">:number</span>
    jojo-area,stay
  <span style="color: #f92672; font-weight: bold;">jo</span> allocate-local-variable
    jojo-area,stay

  <span style="color: #f92672; font-weight: bold;">jo</span> instruction,local-variable,n-set
    jojo-area,stay
  <span style="color: #83EA83; font-weight: bold;">:current-offset</span>
    jojo-area,stay
  <span style="color: #83EA83; font-weight: bold;">:number</span>
    jojo-area,stay
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org4bd0743" class="outline-3">
<h3 id="org4bd0743">jojo-compiler-syntax:if&#xa0;&#xa0;&#xa0;<span class="tag"><span class="redefine">redefine</span></span></h3>
<div class="outline-text-3" id="text-org4bd0743">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">jojo-compiler-syntax:if</span>
  <span style="color: #FF8888;">&lt;&lt; jo, string[address, length], literal-word:if --</span>
<span style="color: #FF8888;">     scope-stack-pointer,</span>
<span style="color: #FF8888;">     address,</span>
<span style="color: #FF8888;">     jo, string[address, length] &gt;&gt;</span>
  drop2
  <span style="color: #dc322f; font-weight: bold;">&gt;::string</span>
  <span style="color: #FF4C4C; font-weight: bold;">&gt;:jo</span>

  <span style="color: #f92672; font-weight: bold;">jo</span> <span style="color: #ffffff; font-weight: bold;">instruction,false?</span>branch
    jojo-area,stay

  <span style="color: #fd971f; font-weight: bold;">scope-stack:*pointer*</span>
  <span style="color: #fd971f; font-weight: bold;">*jojo-area,current-free-address*</span>
  <span style="color: #83EA83; font-weight: bold;">:jo</span>
  <span style="color: #5CDD5C; font-weight: bold;">::string</span>

  <span style="color: #fd971f; font-weight: bold;">0</span> jojo-area,stay
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgad2dcc5" class="outline-3">
<h3 id="orgad2dcc5">jojo-compiler-syntax:else&#xa0;&#xa0;&#xa0;<span class="tag"><span class="redefine">redefine</span></span></h3>
<div class="outline-text-3" id="text-orgad2dcc5">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">jojo-compiler-syntax:else</span>
  <span style="color: #FF8888;">&lt;&lt; scope-stack-pointer,</span>
<span style="color: #FF8888;">     address,</span>
<span style="color: #FF8888;">     jo, string[address, length], literal-word:else --</span>
<span style="color: #FF8888;">     scope-stack-pointer,</span>
<span style="color: #FF8888;">     address,</span>
<span style="color: #FF8888;">     jo, string[address, length] &gt;&gt;</span>
  drop2
  <span style="color: #dc322f; font-weight: bold;">&gt;::string</span>
  <span style="color: #FF4C4C; font-weight: bold;">&gt;:jo</span>
  <span style="color: #FF4C4C; font-weight: bold;">&gt;:address</span>
  <span style="color: #FF4C4C; font-weight: bold;">&gt;:scope-stack-pointer</span>

  <span style="color: #83EA83; font-weight: bold;">:scope-stack-pointer</span> <span style="color: #f92672; font-weight: bold;">address</span> <span style="color: #fd971f; font-weight: bold;">scope-stack:*pointer*</span> set

  <span style="color: #f92672; font-weight: bold;">jo</span> instruction,branch
    jojo-area,stay

  <span style="color: #fd971f; font-weight: bold;">scope-stack:*pointer*</span>
  <span style="color: #fd971f; font-weight: bold;">*jojo-area,current-free-address*</span>
  <span style="color: #83EA83; font-weight: bold;">:jo</span>
  <span style="color: #5CDD5C; font-weight: bold;">::string</span>

  <span style="color: #fd971f; font-weight: bold;">0</span> jojo-area,stay

  <span style="color: #FF8888;">&lt;&lt;</span>
<span style="color: #FF8888;">  set offset of (instruction,false?branch)</span>
<span style="color: #FF8888;">  over (instruction,branch) and its offset</span>
<span style="color: #FF8888;">  &gt;&gt;</span>
  <span style="color: #fd971f; font-weight: bold;">*jojo-area,current-free-address*</span> <span style="color: #83EA83; font-weight: bold;">:address</span> sub
  <span style="color: #fd971f; font-weight: bold;">*cell-size*</span> div
  <span style="color: #83EA83; font-weight: bold;">:address</span> set
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf034c83" class="outline-3">
<h3 id="orgf034c83">jojo-compiler-syntax:then&#xa0;&#xa0;&#xa0;<span class="tag"><span class="redefine">redefine</span></span></h3>
<div class="outline-text-3" id="text-orgf034c83">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">jojo-compiler-syntax:then</span>
  <span style="color: #FF8888;">&lt;&lt; scope-stack-pointer,</span>
<span style="color: #FF8888;">     address,</span>
<span style="color: #FF8888;">     jo, string[address, length], literal-word:then --</span>
<span style="color: #FF8888;">     jo, string[address, length] &gt;&gt;</span>
  drop2
  <span style="color: #dc322f; font-weight: bold;">&gt;::string</span>
  <span style="color: #FF4C4C; font-weight: bold;">&gt;:jo</span>
  <span style="color: #FF4C4C; font-weight: bold;">&gt;:address</span>
  <span style="color: #FF4C4C; font-weight: bold;">&gt;:scope-stack-pointer</span>

  <span style="color: #fd971f; font-weight: bold;">*jojo-area,current-free-address*</span> <span style="color: #83EA83; font-weight: bold;">:address</span> sub
  <span style="color: #fd971f; font-weight: bold;">*cell-size*</span> div
  <span style="color: #83EA83; font-weight: bold;">:address</span> set

  <span style="color: #83EA83; font-weight: bold;">:jo</span>
  <span style="color: #5CDD5C; font-weight: bold;">::string</span>
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org29fff49" class="outline-3">
<h3 id="org29fff49">more,syntax-rule-set:jojo-compiler</h3>
<div class="outline-text-3" id="text-org29fff49">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">more,syntax-rule-set:jojo-compiler</span>
  <span style="color: #FF8888;">&lt;&lt; -- &gt;&gt;</span>
  <span style="color: #fd971f; font-weight: bold;">jojo-compiler:*syntax-rule-set*</span>
  <span style="color: #f92672; font-weight: bold;">jo</span> <span style="color: #ffffff; font-weight: bold;">local-variable-get-word?</span>
  <span style="color: #f92672; font-weight: bold;">jo</span> <span style="color: #ffffff; font-weight: bold;">jojo-compiler-syntax:</span>local-variable-get
  <span style="color: #ffffff; font-weight: bold;">syntax-rule:</span>add
  <span style="color: #fd971f; font-weight: bold;">jojo-compiler:*syntax-rule-set*</span>
  <span style="color: #f92672; font-weight: bold;">jo</span> <span style="color: #ffffff; font-weight: bold;">local-variable-set-word?</span>
  <span style="color: #f92672; font-weight: bold;">jo</span> <span style="color: #ffffff; font-weight: bold;">jojo-compiler-syntax:</span>local-variable-set
  <span style="color: #ffffff; font-weight: bold;">syntax-rule:</span>add
  <span style="color: #fd971f; font-weight: bold;">jojo-compiler:*syntax-rule-set*</span>
  dup <span style="color: #f92672; font-weight: bold;">jo</span> <span style="color: #ffffff; font-weight: bold;">literal-word:</span>if?    <span style="color: #f92672; font-weight: bold;">jo</span> <span style="color: #ffffff; font-weight: bold;">jojo-compiler-syntax:</span>if    <span style="color: #ffffff; font-weight: bold;">syntax-rule:</span>add
  dup <span style="color: #f92672; font-weight: bold;">jo</span> <span style="color: #ffffff; font-weight: bold;">literal-word:</span>else?  <span style="color: #f92672; font-weight: bold;">jo</span> <span style="color: #ffffff; font-weight: bold;">jojo-compiler-syntax:</span>else  <span style="color: #ffffff; font-weight: bold;">syntax-rule:</span>add
      <span style="color: #f92672; font-weight: bold;">jo</span> <span style="color: #ffffff; font-weight: bold;">literal-word:</span>then?  <span style="color: #f92672; font-weight: bold;">jo</span> <span style="color: #ffffff; font-weight: bold;">jojo-compiler-syntax:</span>then  <span style="color: #ffffff; font-weight: bold;">syntax-rule:</span>add
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
<span style="color: #ffffff; font-weight: bold;">more,syntax-rule-set:</span>jojo-compiler
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org462763b" class="outline-2">
<h2 id="org462763b">argument-stack:print</h2>
<div class="outline-text-2" id="text-org462763b">
</div><div id="outline-container-orgd2decc4" class="outline-3">
<h3 id="orgd2decc4">argument-stack:print</h3>
<div class="outline-text-3" id="text-orgd2decc4">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">argument-stack:print,loop</span>
  <span style="color: #FF8888;">&lt;&lt; address, counter -- &gt;&gt;</span>
  dup <span style="color: #ffffff; font-weight: bold;">zero?</span> <span style="color: #f92672; font-weight: bold;">if</span>
    drop2
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  sub1 swap
    dup get .
  <span style="color: #fd971f; font-weight: bold;">*cell-size*</span> add
  swap
  <span style="color: #00ffff; font-weight: bold;">loop</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>

<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">argument-stack:print</span>
  <span style="color: #FF8888;">&lt;&lt; -- &gt;&gt;</span>
  snapshot-the-stack-pointer
  <span style="color: #fd971f; font-weight: bold;">*the-stack-pointer-snapshot*</span>
  <span style="color: #fd971f; font-weight: bold;">*the-stack*</span> <span style="color: #ffffff; font-weight: bold;">greater-or-equal?</span> <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #fd971f; font-weight: bold;">*the-stack*</span>   <span style="color: #FF8888;">&lt;&lt; address as return value &gt;&gt;</span>
    <span style="color: #fd971f; font-weight: bold;">*the-stack-pointer-snapshot*</span> <span style="color: #fd971f; font-weight: bold;">*the-stack*</span> sub
    <span style="color: #fd971f; font-weight: bold;">*cell-size*</span> div <span style="color: #FF8888;">&lt;&lt; counter as return value &gt;&gt;</span>
    <span style="color: #ffffff; font-weight: bold;">argument-stack:</span>print,loop
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #e6db74;">"below the stack "</span> .s
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgaf74e49" class="outline-3">
<h3 id="orgaf74e49">argument-stack:pretty-print</h3>
<div class="outline-text-3" id="text-orgaf74e49">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">argument-stack:pretty-print</span>
  <span style="color: #FF8888;">&lt;&lt; -- &gt;&gt;</span>
  snapshot-the-stack-pointer
  .l
  <span style="color: #e6db74;">"  * "</span> .s
     <span style="color: #fd971f; font-weight: bold;">*the-stack-pointer-snapshot*</span>
     <span style="color: #fd971f; font-weight: bold;">*the-stack*</span> sub
     <span style="color: #FF8888;">&lt;&lt; ad hoc for the BUG of div &gt;&gt;</span>
     dup <span style="color: #ffffff; font-weight: bold;">negative?</span> <span style="color: #f92672; font-weight: bold;">if</span>
       negate
       <span style="color: #fd971f; font-weight: bold;">*cell-size*</span> div
       negate
     <span style="color: #f92672; font-weight: bold;">else</span>
       <span style="color: #fd971f; font-weight: bold;">*cell-size*</span> div
     <span style="color: #f92672; font-weight: bold;">then</span>
     .i
  <span style="color: #e6db74;">" * "</span> .s
  <span style="color: #e6db74;">" -- "</span> .s
    <span style="color: #ffffff; font-weight: bold;">argument-stack:</span>print
  <span style="color: #e6db74;">"--"</span> .s
  .l
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orga68b50b" class="outline-2">
<h2 id="orga68b50b">define-variable,with-tos</h2>
<div class="outline-text-2" id="text-orga68b50b">
</div><div id="outline-container-org19ecfd" class="outline-3">
<h3 id="org19ecfd">define-variable,with-tos&#xa0;&#xa0;&#xa0;<span class="tag"><span class="redefine">redefine</span></span></h3>
<div class="outline-text-3" id="text-org19ecfd">
<ul class="org-ul">
<li><p>not undo is needed for define-variable,with-tos</p></li></ul>
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">define-variable,with-tos</span>
  <span style="color: #FF8888;">&lt;&lt; value, string[address, length] -- &gt;&gt;</span>
  <span style="color: #dc322f; font-weight: bold;">&gt;::string</span>
  <span style="color: #FF4C4C; font-weight: bold;">&gt;:value</span>

  <span style="color: #5CDD5C; font-weight: bold;">::string</span> <span style="color: #ffffff; font-weight: bold;">string:</span>word <span style="color: #dc322f; font-weight: bold;">&gt;::name</span>

  <span style="color: #fd971f; font-weight: bold;">*explainer,variable*</span> <span style="color: #fd971f; font-weight: bold;">0</span>
  make-jo-head <span style="color: #FF4C4C; font-weight: bold;">&gt;:jo</span>

  <span style="color: #83EA83; font-weight: bold;">:jo</span>
  <span style="color: #5CDD5C; font-weight: bold;">::name</span> string<span style="color: #b0b1a3;">-&gt;</span>name
  <span style="color: #ffffff; font-weight: bold;">global-naming-stack:</span>record-jo

  <span style="color: #fd971f; font-weight: bold;">1</span> <span style="color: #83EA83; font-weight: bold;">:jo</span> jo,set-length

  <span style="color: #83EA83; font-weight: bold;">:value</span> jojo-area,stay
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org5341827" class="outline-3">
<h3 id="org5341827"><span class="done test">test</span> define-variable,with-tos</h3>
<div class="outline-text-3" id="text-org5341827">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #fd971f; font-weight: bold;">233</span>
<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #fd971f; font-weight: bold;">*three*</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #1ef15f; font-weight: bold;">test-variable,with-tos</span>

<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">add-three</span>
  <span style="color: #fd971f; font-weight: bold;">*three*</span> add
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #1ef15f; font-weight: bold;">test-function</span>

<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">fix-*three*</span>
  <span style="color: #fd971f; font-weight: bold;">3</span>
  <span style="color: #f92672; font-weight: bold;">address</span> <span style="color: #fd971f; font-weight: bold;">*three*</span>
  set
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #1ef15f; font-weight: bold;">test-function</span>

<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #e6db74;">"* (testing) define-variable,with-tos"</span> .s .l
  <span style="color: #fd971f; font-weight: bold;">1</span> add-three
  <span style="color: #fd971f; font-weight: bold;">234</span> <span style="color: #ffffff; font-weight: bold;">equal?</span>

  fix-<span style="color: #b0b1a3;">*</span>three<span style="color: #b0b1a3;">*</span> <span style="color: #fd971f; font-weight: bold;">1</span> add-three
  <span style="color: #fd971f; font-weight: bold;">4</span> <span style="color: #ffffff; font-weight: bold;">equal?</span> and <span style="color: #1ef15f; font-weight: bold;">test</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #1ef15f; font-weight: bold;">test-do</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org73f5cf9" class="outline-2">
<h2 id="org73f5cf9">alias</h2>
<div class="outline-text-2" id="text-org73f5cf9">
</div><div id="outline-container-org13a1a0f" class="outline-3">
<h3 id="org13a1a0f"><span class="todo note">note</span> </h3>
<div class="outline-text-3" id="text-org13a1a0f">
<ul class="org-ul">
<li><p>there shall be no way to know a naming is an alias or not</p></li></ul>
</div>
</div>

<div id="outline-container-orgfd943fd" class="outline-3">
<h3 id="orgfd943fd">alias</h3>
<div class="outline-text-3" id="text-orgfd943fd">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">alias</span>
  <span style="color: #FF8888;">&lt;&lt; alias[address, length], name[address, length] -- &gt;&gt;</span>
  <span style="color: #dc322f; font-weight: bold;">&gt;::name</span> <span style="color: #dc322f; font-weight: bold;">&gt;::alias</span>
  <span style="color: #5CDD5C; font-weight: bold;">::name</span> name-hash-table,find-jo <span style="color: #f92672; font-weight: bold;">if</span>
  <span style="color: #f92672; font-weight: bold;">else</span>
    <span style="color: #e6db74;">"* (alias) fail"</span> .s .l
    <span style="color: #e6db74;">"  because can not find name in name-hash-table"</span> .s .l
    <span style="color: #e6db74;">"  alias : "</span> .s <span style="color: #5CDD5C; font-weight: bold;">::alias</span> .s .l
    <span style="color: #e6db74;">"  name : "</span> .s <span style="color: #5CDD5C; font-weight: bold;">::name</span> .s .l
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #FF4C4C; font-weight: bold;">&gt;:jo</span>
  <span style="color: #83EA83; font-weight: bold;">:jo</span>
  <span style="color: #5CDD5C; font-weight: bold;">::alias</span> string<span style="color: #b0b1a3;">-&gt;</span>name
  <span style="color: #ffffff; font-weight: bold;">global-naming-stack:</span>record-jo
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb2c5a7" class="outline-3">
<h3 id="orgb2c5a7"><span class="done test">test</span> alias</h3>
<div class="outline-text-3" id="text-orgb2c5a7">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #e6db74;">"* (testing) alias"</span> .s .l
  <span style="color: #e6db74;">"adba"</span> <span style="color: #e6db74;">"add"</span> alias
  <span style="color: #fd971f; font-weight: bold;">1</span> <span style="color: #fd971f; font-weight: bold;">2</span> adba
  <span style="color: #fd971f; font-weight: bold;">3</span> <span style="color: #ffffff; font-weight: bold;">equal?</span> <span style="color: #1ef15f; font-weight: bold;">test</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #1ef15f; font-weight: bold;">test-do</span>

<span style="color: #FF8888;">&lt;&lt; error</span>
<span style="color: #FF8888;">"ab" "ad" alias</span>
<span style="color: #FF8888;">&gt;&gt;</span>
</pre>
</div>
</div>
</div>
</div>


<div id="outline-container-org2306044" class="outline-2">
<h2 id="org2306044">jojo-compiler-syntax:square-bar</h2>
<div class="outline-text-2" id="text-org2306044">
</div><div id="outline-container-org14525b" class="outline-3">
<h3 id="org14525b">string:find-word</h3>
<div class="outline-text-3" id="text-org14525b">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">string:find-word</span>
  <span style="color: #FF8888;">&lt;&lt; string[address, length], word[address, length]</span>
<span style="color: #FF8888;">     -- sub-string[address, length], true</span>
<span style="color: #FF8888;">     -- false &gt;&gt;</span>
  xx<span style="color: #b0b1a3;">|</span>over<span style="color: #b0b1a3;">|</span>xx <span style="color: #ffffff; font-weight: bold;">string:</span>space? <span style="color: #f92672; font-weight: bold;">if</span>
    drop2 drop2
    <span style="color: #fd971f; font-weight: bold;">false</span>
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  xx<span style="color: #b0b1a3;">|</span>over<span style="color: #b0b1a3;">|</span>xx <span style="color: #ffffff; font-weight: bold;">string:</span>word
  xx<span style="color: #b0b1a3;">|</span>over<span style="color: #b0b1a3;">|</span>xx <span style="color: #ffffff; font-weight: bold;">string:</span>equal? <span style="color: #f92672; font-weight: bold;">if</span>
    drop2
    <span style="color: #fd971f; font-weight: bold;">true</span>
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  xx<span style="color: #b0b1a3;">|</span>swap<span style="color: #b0b1a3;">|</span>xx <span style="color: #ffffff; font-weight: bold;">string:</span>word-tail
  xx<span style="color: #b0b1a3;">|</span>swap<span style="color: #b0b1a3;">|</span>xx
  <span style="color: #00ffff; font-weight: bold;">loop</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org99ae5e1" class="outline-3">
<h3 id="org99ae5e1"><span class="done test">test</span> string:find-word</h3>
<div class="outline-text-3" id="text-org99ae5e1">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #e6db74;">"* (testing) string:find-word"</span> .s .l
  <span style="color: #e6db74;">"111 222 333"</span> <span style="color: #e6db74;">"222"</span> <span style="color: #ffffff; font-weight: bold;">string:</span>find-word <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #e6db74;">" 222 333"</span> <span style="color: #ffffff; font-weight: bold;">string:</span>equal? <span style="color: #1ef15f; font-weight: bold;">test</span>
  <span style="color: #f92672; font-weight: bold;">else</span>
    <span style="color: #fd971f; font-weight: bold;">false</span> <span style="color: #1ef15f; font-weight: bold;">test</span>
  <span style="color: #f92672; font-weight: bold;">then</span>

  <span style="color: #e6db74;">"111 222 333"</span> <span style="color: #e6db74;">"444"</span> <span style="color: #ffffff; font-weight: bold;">string:</span>find-word <span style="color: #f92672; font-weight: bold;">if</span>
    .l .s .l
    <span style="color: #fd971f; font-weight: bold;">false</span> <span style="color: #1ef15f; font-weight: bold;">test</span>
  <span style="color: #f92672; font-weight: bold;">else</span>
    <span style="color: #fd971f; font-weight: bold;">true</span> <span style="color: #1ef15f; font-weight: bold;">test</span>
  <span style="color: #f92672; font-weight: bold;">then</span>

  <span style="color: #e6db74;">"111 222 [] 333"</span> <span style="color: #e6db74;">"["</span> <span style="color: #ffffff; font-weight: bold;">string:</span>find-word <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #e6db74;">" [] 333"</span> <span style="color: #ffffff; font-weight: bold;">string:</span>equal? <span style="color: #1ef15f; font-weight: bold;">test</span>
  <span style="color: #f92672; font-weight: bold;">else</span>
    <span style="color: #fd971f; font-weight: bold;">false</span> <span style="color: #1ef15f; font-weight: bold;">test</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #1ef15f; font-weight: bold;">test-do</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd3c9e1e" class="outline-3">
<h3 id="orgd3c9e1e"><span class="todo note">note</span> side-effect</h3>
<div class="outline-text-3" id="text-orgd3c9e1e">
<ul class="org-ul">
<li><p>side-effect on function [unnamed or named] is actually not so needed</p><p>for function is mainly used to encode algorithm</p></li>
<li><p>but side-effect on function is always possible when needed</p></li></ul>
</div>
</div>

<div id="outline-container-org636d250" class="outline-3">
<h3 id="org636d250"><span class="todo note">note</span> scope of named-local-variable</h3>
<div class="outline-text-3" id="text-org636d250">
<ul class="org-ul">
<li><p>in named function or unnamed function</p><p>the scope of named-local-variable is linear</p></li></ul>
</div>
</div>

<div id="outline-container-org2fae1eb" class="outline-3">
<h3 id="org2fae1eb">literal-word:square-bar?</h3>
<div class="outline-text-3" id="text-org2fae1eb">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">literal-word:square-bar?</span>
  <span style="color: #FF8888;">&lt;&lt; word[address, length] -- bool &gt;&gt;</span>
  <span style="color: #e6db74;">"["</span> <span style="color: #ffffff; font-weight: bold;">string:</span>equal?
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org8c8eaf4" class="outline-3">
<h3 id="org8c8eaf4">literal-word:square-ket?</h3>
<div class="outline-text-3" id="text-org8c8eaf4">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">literal-word:square-ket?</span>
  <span style="color: #FF8888;">&lt;&lt; word[address, length] -- bool &gt;&gt;</span>
  <span style="color: #e6db74;">"]"</span> <span style="color: #ffffff; font-weight: bold;">string:</span>equal?
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orge272ccc" class="outline-3">
<h3 id="orge272ccc"><span class="todo note">note</span> memory usage</h3>
<div class="outline-text-3" id="text-orge272ccc">
<ul class="org-ul">
<li><p>for the array can be nested</p><p>we must allocate the memory in place</p><p>a branch is there helping us to achieve this</p></li>
<li><p><p></p><p>[dup drop end]</p><p></p></p><p><table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides"></p><p></p><p></p><p><colgroup></p><p><col  class="org-left" /></p><p></colgroup></p><p><thead></p><p><tr></p><p><th scope="col" class="org-left">branch</th></p><p></tr></p><p></p><p><tr></p><p><th scope="col" class="org-left">offset to jo</th></p><p></tr></p><p></thead></p><p><tbody></p><p><tr></p><p><td class="org-left">&lt;jo-head&gt;</td></p><p></tr></p><p></tbody></p><p><tbody></p><p><tr></p><p><td class="org-left">dup</td></p><p></tr></p><p></p><p><tr></p><p><td class="org-left">drop</td></p><p></tr></p><p></p><p><tr></p><p><td class="org-left">end</td></p><p></tr></p><p></tbody></p><p><tbody></p><p><tr></p><p><td class="org-left">literal</td></p><p></tr></p><p></p><p><tr></p><p><td class="org-left">address of the jo</td></p><p></tr></p><p></tbody></p><p></table></p></li></ul>
</div>
</div>

<div id="outline-container-org4a78dde" class="outline-3">
<h3 id="org4a78dde">jojo-compiler-syntax:square-bar</h3>
<div class="outline-text-3" id="text-org4a78dde">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">jojo-compiler-syntax:square-bar</span>
  <span style="color: #FF8888;">&lt;&lt; jo, string[address, length], literal-word:square-bar --</span>
<span style="color: #FF8888;">     scope-stack-pointer,</span>
<span style="color: #FF8888;">     offset-address,</span>
<span style="color: #FF8888;">     new-jo,</span>
<span style="color: #FF8888;">     jo, string[address, length] &gt;&gt;</span>
  drop2
  <span style="color: #dc322f; font-weight: bold;">&gt;::string</span>
  <span style="color: #FF4C4C; font-weight: bold;">&gt;:jo</span>

  <span style="color: #f92672; font-weight: bold;">jo</span> instruction,branch
    jojo-area,stay
  <span style="color: #fd971f; font-weight: bold;">*jojo-area,current-free-address*</span> <span style="color: #FF4C4C; font-weight: bold;">&gt;:offset-address</span>
  <span style="color: #fd971f; font-weight: bold;">0</span> jojo-area,stay

  <span style="color: #fd971f; font-weight: bold;">*explainer,function*</span> <span style="color: #fd971f; font-weight: bold;">0</span>
  make-jo-head <span style="color: #FF4C4C; font-weight: bold;">&gt;:new-jo</span>

  <span style="color: #fd971f; font-weight: bold;">scope-stack:*pointer*</span> <span style="color: #FF4C4C; font-weight: bold;">&gt;:scope-stack-pointer</span>
  <span style="color: #fd971f; font-weight: bold;">0</span>
  <span style="color: #83EA83; font-weight: bold;">:scope-stack-pointer</span>
  offset-record,set-name
  <span style="color: #fd971f; font-weight: bold;">0</span>
  <span style="color: #83EA83; font-weight: bold;">:scope-stack-pointer</span>
  offset-record,set-offset
  <span style="color: #fd971f; font-weight: bold;">scope-stack:*unit*</span> <span style="color: #f92672; font-weight: bold;">address</span> <span style="color: #fd971f; font-weight: bold;">scope-stack:*pointer*</span> add-set

  <span style="color: #83EA83; font-weight: bold;">:scope-stack-pointer</span>
  <span style="color: #83EA83; font-weight: bold;">:offset-address</span>
  <span style="color: #83EA83; font-weight: bold;">:new-jo</span>
  <span style="color: #83EA83; font-weight: bold;">:jo</span>
  <span style="color: #5CDD5C; font-weight: bold;">::string</span>
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org94b9d23" class="outline-3">
<h3 id="org94b9d23">jojo-compiler-syntax:square-ket</h3>
<div class="outline-text-3" id="text-org94b9d23">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">jojo-compiler-syntax:square-ket</span>
  <span style="color: #FF8888;">&lt;&lt; scope-stack-pointer,</span>
<span style="color: #FF8888;">     offset-address,</span>
<span style="color: #FF8888;">     new-jo,</span>
<span style="color: #FF8888;">     jo, string[address, length], literal-word:square-ket --</span>
<span style="color: #FF8888;">     jo, string[address, length] &gt;&gt;</span>
  drop2
  <span style="color: #dc322f; font-weight: bold;">&gt;::string</span>
  <span style="color: #FF4C4C; font-weight: bold;">&gt;:jo</span>
  <span style="color: #FF4C4C; font-weight: bold;">&gt;:new-jo</span>
  <span style="color: #FF4C4C; font-weight: bold;">&gt;:offset-address</span>
  <span style="color: #FF4C4C; font-weight: bold;">&gt;:scope-stack-pointer</span>

  <span style="color: #83EA83; font-weight: bold;">:scope-stack-pointer</span> <span style="color: #f92672; font-weight: bold;">address</span> <span style="color: #fd971f; font-weight: bold;">scope-stack:*pointer*</span> set

  <span style="color: #fd971f; font-weight: bold;">*jojo-area,current-free-address*</span>
  <span style="color: #83EA83; font-weight: bold;">:offset-address</span> sub
  <span style="color: #fd971f; font-weight: bold;">*cell-size*</span> div
  <span style="color: #83EA83; font-weight: bold;">:offset-address</span> set

  <span style="color: #f92672; font-weight: bold;">jo</span> instruction,literal
    jojo-area,stay
  <span style="color: #83EA83; font-weight: bold;">:new-jo</span>
    jojo-area,stay

  <span style="color: #83EA83; font-weight: bold;">:jo</span>
  <span style="color: #5CDD5C; font-weight: bold;">::string</span>
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org6b7f8b6" class="outline-3">
<h3 id="org6b7f8b6">more,syntax-rule-set:jojo-compiler</h3>
<div class="outline-text-3" id="text-org6b7f8b6">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">more,syntax-rule-set:jojo-compiler</span>
  <span style="color: #FF8888;">&lt;&lt; -- &gt;&gt;</span>
  <span style="color: #fd971f; font-weight: bold;">jojo-compiler:*syntax-rule-set*</span>
  dup <span style="color: #f92672; font-weight: bold;">jo</span> <span style="color: #ffffff; font-weight: bold;">literal-word:</span>square-bar? <span style="color: #f92672; font-weight: bold;">jo</span> <span style="color: #ffffff; font-weight: bold;">jojo-compiler-syntax:</span>square-bar <span style="color: #ffffff; font-weight: bold;">syntax-rule:</span>add
      <span style="color: #f92672; font-weight: bold;">jo</span> <span style="color: #ffffff; font-weight: bold;">literal-word:</span>square-ket? <span style="color: #f92672; font-weight: bold;">jo</span> <span style="color: #ffffff; font-weight: bold;">jojo-compiler-syntax:</span>square-ket <span style="color: #ffffff; font-weight: bold;">syntax-rule:</span>add
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>

<span style="color: #ffffff; font-weight: bold;">more,syntax-rule-set:</span>jojo-compiler
</pre>
</div>
</div>
</div>

<div id="outline-container-org381548" class="outline-3">
<h3 id="org381548"><span class="done test">test</span> square-bar &amp; square-ket by factorial</h3>
<div class="outline-text-3" id="text-org381548">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">testing-square-bar</span>
  <span style="color: #93a8c6;">[</span><span style="color: #e6db74;">"testing square-bar &amp; square-ket"</span> <span style="color: #00ffff; font-weight: bold;">end</span><span style="color: #93a8c6;">]</span>
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #1ef15f; font-weight: bold;">test-function</span>

<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #e6db74;">"* (testing) square-bar &amp; square-ket"</span> .s .l
  testing-square-bar apply
  <span style="color: #e6db74;">"testing square-bar &amp; square-ket"</span>
  <span style="color: #ffffff; font-weight: bold;">string:</span>equal? <span style="color: #1ef15f; font-weight: bold;">test</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #1ef15f; font-weight: bold;">test-do</span>

<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">apply-factorial</span>
  <span style="color: #FF8888;">&lt;&lt; number -- number &gt;&gt;</span>
  <span style="color: #93a8c6;">[</span>dup
   <span style="color: #ffffff; font-weight: bold;">one?</span> <span style="color: #f92672; font-weight: bold;">if</span>
     <span style="color: #00ffff; font-weight: bold;">end</span>
   <span style="color: #f92672; font-weight: bold;">then</span>
   dup sub1 <span style="color: #f92672; font-weight: bold;">recur</span>
   mul
   <span style="color: #00ffff; font-weight: bold;">end</span><span style="color: #93a8c6;">]</span> apply
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #1ef15f; font-weight: bold;">test-function</span>

<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #e6db74;">"* (testing) square-bar &amp; square-ket by factorial"</span> .s .l
  <span style="color: #fd971f; font-weight: bold;">1</span> apply-factorial <span style="color: #fd971f; font-weight: bold;">1</span>   <span style="color: #ffffff; font-weight: bold;">equal?</span>
  <span style="color: #fd971f; font-weight: bold;">2</span> apply-factorial <span style="color: #fd971f; font-weight: bold;">2</span>   <span style="color: #ffffff; font-weight: bold;">equal?</span> and
  <span style="color: #fd971f; font-weight: bold;">3</span> apply-factorial <span style="color: #fd971f; font-weight: bold;">6</span>   <span style="color: #ffffff; font-weight: bold;">equal?</span> and
  <span style="color: #fd971f; font-weight: bold;">4</span> apply-factorial <span style="color: #fd971f; font-weight: bold;">24</span>  <span style="color: #ffffff; font-weight: bold;">equal?</span> and
  <span style="color: #fd971f; font-weight: bold;">5</span> apply-factorial <span style="color: #fd971f; font-weight: bold;">120</span> <span style="color: #ffffff; font-weight: bold;">equal?</span> and
  <span style="color: #fd971f; font-weight: bold;">6</span> apply-factorial <span style="color: #fd971f; font-weight: bold;">720</span> <span style="color: #ffffff; font-weight: bold;">equal?</span> and <span style="color: #1ef15f; font-weight: bold;">test</span>
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #1ef15f; font-weight: bold;">test-do</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org1652470" class="outline-2">
<h2 id="org1652470">jojo-compiler-syntax:name</h2>
<div class="outline-text-2" id="text-org1652470">
</div><div id="outline-container-org7162372" class="outline-3">
<h3 id="org7162372">jojo-compiler-syntax:name</h3>
<div class="outline-text-3" id="text-org7162372">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">jojo-compiler-syntax:name</span>
  <span style="color: #FF8888;">&lt;&lt; string[address, length], word[address, length] --</span>
<span style="color: #FF8888;">     string[address, length] &gt;&gt;</span>
  drop2
  <span style="color: #f92672; font-weight: bold;">jo</span> instruction,literal
    jojo-area,stay
  dup2
  <span style="color: #ffffff; font-weight: bold;">string:</span>word
  string<span style="color: #b0b1a3;">-&gt;</span>name
    jojo-area,stay
  <span style="color: #ffffff; font-weight: bold;">string:</span>word-tail
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org2907900" class="outline-3">
<h3 id="org2907900">more,syntax-rule-set:jojo-compiler</h3>
<div class="outline-text-3" id="text-org2907900">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">more,syntax-rule-set:jojo-compiler</span>
  <span style="color: #FF8888;">&lt;&lt; -- &gt;&gt;</span>
  <span style="color: #fd971f; font-weight: bold;">jojo-compiler:*syntax-rule-set*</span>
  <span style="color: #93a8c6;">[</span><span style="color: #e6db74;">"name"</span> <span style="color: #ffffff; font-weight: bold;">string:</span>equal? <span style="color: #00ffff; font-weight: bold;">end</span><span style="color: #93a8c6;">]</span> <span style="color: #f92672; font-weight: bold;">jo</span> <span style="color: #ffffff; font-weight: bold;">jojo-compiler-syntax:</span>name
  <span style="color: #ffffff; font-weight: bold;">syntax-rule:</span>add
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
<span style="color: #ffffff; font-weight: bold;">more,syntax-rule-set:</span>jojo-compiler
</pre>
</div>
</div>
</div>

<div id="outline-container-org90d264b" class="outline-3">
<h3 id="org90d264b"><span class="done test">test</span> jojo-compiler-syntax:name</h3>
<div class="outline-text-3" id="text-org90d264b">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">jojo-compiler-syntax:name,test</span>
  <span style="color: #FF8888;">&lt;&lt; -- string[address, length] &gt;&gt;</span>
  <span style="color: #f92672; font-weight: bold;">name</span> test-name name<span style="color: #b0b1a3;">-&gt;</span>string
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #1ef15f; font-weight: bold;">test-function</span>

<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #e6db74;">"* (testing) jojo-compiler-syntax:name"</span> .s .l
  <span style="color: #ffffff; font-weight: bold;">jojo-compiler-syntax:</span>name,test
  <span style="color: #e6db74;">"test-name"</span> <span style="color: #ffffff; font-weight: bold;">string:</span>equal? <span style="color: #1ef15f; font-weight: bold;">test</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #1ef15f; font-weight: bold;">test-do</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgb333db2" class="outline-2">
<h2 id="orgb333db2">jojo-compiler-syntax:base#wild-integer-string</h2>
<div class="outline-text-2" id="text-orgb333db2">
</div><div id="outline-container-org53905f" class="outline-3">
<h3 id="org53905f">jojo-compiler-syntax:base#wild-integer-string</h3>
<div class="outline-text-3" id="text-org53905f">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">jojo-compiler-syntax:base#wild-integer-string</span>
  <span style="color: #FF8888;">&lt;&lt; string[address, length], word[address, length] --</span>
<span style="color: #FF8888;">     string[address, length] &gt;&gt;</span>
  <span style="color: #f92672; font-weight: bold;">jo</span> instruction,literal
    jojo-area,stay
  base#wild-integer-string<span style="color: #b0b1a3;">-&gt;</span>integer
    jojo-area,stay
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org2520fdc" class="outline-3">
<h3 id="org2520fdc">more,syntax-rule-set:jojo-compiler</h3>
<div class="outline-text-3" id="text-org2520fdc">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">more,syntax-rule-set:jojo-compiler</span>
  <span style="color: #FF8888;">&lt;&lt; -- &gt;&gt;</span>
  <span style="color: #fd971f; font-weight: bold;">jojo-compiler:*syntax-rule-set*</span>
  <span style="color: #f92672; font-weight: bold;">jo</span> <span style="color: #ffffff; font-weight: bold;">base#wild-integer-string?</span>
  <span style="color: #f92672; font-weight: bold;">jo</span> <span style="color: #ffffff; font-weight: bold;">jojo-compiler-syntax:</span>base#wild-integer-string
  <span style="color: #ffffff; font-weight: bold;">syntax-rule:</span>add
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
<span style="color: #ffffff; font-weight: bold;">more,syntax-rule-set:</span>jojo-compiler
</pre>
</div>
</div>
</div>
</div>


<div id="outline-container-orga3526f0" class="outline-2">
<h2 id="orga3526f0">word-interpreter-syntax</h2>
<div class="outline-text-2" id="text-orga3526f0">
</div><div id="outline-container-orgf86cc27" class="outline-3">
<h3 id="orgf86cc27">jo&#xa0;&#xa0;&#xa0;<span class="tag"><span class="syntax">syntax</span></span></h3>
<div class="outline-text-3" id="text-orgf86cc27">
</div><div id="outline-container-org8b05ea8" class="outline-4">
<h4 id="org8b05ea8">word-interpreter-syntax:jo</h4>
<div class="outline-text-4" id="text-org8b05ea8">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">word-interpreter-syntax:jo</span>
  <span style="color: #FF8888;">&lt;&lt; literal-word:jo -- jo &gt;&gt;</span>
  drop2
  read-word
  <span style="color: #dc322f; font-weight: bold;">&gt;::word</span>
  <span style="color: #5CDD5C; font-weight: bold;">::word</span> name-hash-table,find-jo <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #e6db74;">"* (word-interpreter-syntax:jo) meet undefined word after jo : "</span> .s <span style="color: #5CDD5C; font-weight: bold;">::word</span> .s .l
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org9b44af6" class="outline-4">
<h4 id="org9b44af6">more,syntax-rule-set:basic-REPL</h4>
<div class="outline-text-4" id="text-org9b44af6">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">more,syntax-rule-set:basic-REPL</span>
  <span style="color: #FF8888;">&lt;&lt; -- &gt;&gt;</span>
  <span style="color: #fd971f; font-weight: bold;">syntax-rule-set:*word-interpreter*</span>
  <span style="color: #93a8c6;">[</span><span style="color: #e6db74;">"bye"</span> <span style="color: #ffffff; font-weight: bold;">string:</span>equal? <span style="color: #00ffff; font-weight: bold;">end</span><span style="color: #93a8c6;">]</span> <span style="color: #f92672; font-weight: bold;">jo</span> <span style="color: #ffffff; font-weight: bold;">word-interpreter-syntax:</span>bye
  <span style="color: #ffffff; font-weight: bold;">syntax-rule:</span>add

  <span style="color: #fd971f; font-weight: bold;">syntax-rule-set:*word-interpreter*</span>
  <span style="color: #93a8c6;">[</span><span style="color: #e6db74;">"jo"</span> <span style="color: #ffffff; font-weight: bold;">string:</span>equal? <span style="color: #00ffff; font-weight: bold;">end</span><span style="color: #93a8c6;">]</span> <span style="color: #f92672; font-weight: bold;">jo</span> <span style="color: #ffffff; font-weight: bold;">word-interpreter-syntax:</span>jo
  <span style="color: #ffffff; font-weight: bold;">syntax-rule:</span>add
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
<span style="color: #ffffff; font-weight: bold;">more,syntax-rule-set:</span>basic-REPL
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org580ddac" class="outline-3">
<h3 id="org580ddac">if &amp; else &amp; then&#xa0;&#xa0;&#xa0;<span class="tag"><span class="syntax">syntax</span></span></h3>
<div class="outline-text-3" id="text-org580ddac">
</div><div id="outline-container-org1725db" class="outline-4">
<h4 id="org1725db"><span class="todo note">note</span> ending jo</h4>
<div class="outline-text-4" id="text-org1725db">
<ul class="org-ul">
<li><p>you do not need to use ending jo</p><p>in code blocks formed by if else then</p><p>because in a REPL</p><p>things are different from function body</p><p>and there is no such thing as</p><p>the end of a function body in the REPL</p></li></ul>
</div>
</div>

<div id="outline-container-orgb386043" class="outline-4">
<h4 id="orgb386043"><span class="todo note">note</span> (end) in REPL</h4>
<div class="outline-text-4" id="text-orgb386043">
<ul class="org-ul">
<li><p>when use (end) in REPL</p><p>nothing will happen</p><p>this is because (word-interpreter) calls (end)</p><p>and the jojo (word-interpreter) is pop out of return-stack</p><p>just like meet (end) in the function-body of (word-interpreter)</p></li></ul>
</div>
</div>

<div id="outline-container-org3c691db" class="outline-4">
<h4 id="org3c691db">word-interpreter-syntax:if,meet-true</h4>
<div class="outline-text-4" id="text-org3c691db">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">word-interpreter-syntax:if,meet-true,else</span>
  <span style="color: #FF8888;">&lt;&lt; -- &gt;&gt;</span>
  read-word
  <span style="color: #e6db74;">"then"</span> <span style="color: #ffffff; font-weight: bold;">string:</span>equal? <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #00ffff; font-weight: bold;">loop</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>

<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">word-interpreter-syntax:if,meet-true</span>
  <span style="color: #FF8888;">&lt;&lt; -- &gt;&gt;</span>
  read-word
  dup2 <span style="color: #e6db74;">"then"</span> <span style="color: #ffffff; font-weight: bold;">string:</span>equal? <span style="color: #f92672; font-weight: bold;">if</span>
    drop2
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  dup2 <span style="color: #e6db74;">"else"</span> <span style="color: #ffffff; font-weight: bold;">string:</span>equal? <span style="color: #f92672; font-weight: bold;">if</span>
    drop2
    <span style="color: #ffffff; font-weight: bold;">word-interpreter-syntax:</span>if,meet-true,else
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  word-interpreter
  <span style="color: #00ffff; font-weight: bold;">loop</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org2b4116d" class="outline-4">
<h4 id="org2b4116d">word-interpreter-syntax:if,meet-false</h4>
<div class="outline-text-4" id="text-org2b4116d">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">word-interpreter-syntax:if,meet-false,else</span>
  <span style="color: #FF8888;">&lt;&lt; -- &gt;&gt;</span>
  read-word
  dup2 <span style="color: #e6db74;">"then"</span> <span style="color: #ffffff; font-weight: bold;">string:</span>equal? <span style="color: #f92672; font-weight: bold;">if</span>
    drop2
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  word-interpreter
  <span style="color: #00ffff; font-weight: bold;">loop</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>

<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">word-interpreter-syntax:if,meet-false</span>
  <span style="color: #FF8888;">&lt;&lt; -- &gt;&gt;</span>
  read-word
  dup2 <span style="color: #e6db74;">"then"</span> <span style="color: #ffffff; font-weight: bold;">string:</span>equal? <span style="color: #f92672; font-weight: bold;">if</span>
    drop2
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  dup2 <span style="color: #e6db74;">"else"</span> <span style="color: #ffffff; font-weight: bold;">string:</span>equal? <span style="color: #f92672; font-weight: bold;">if</span>
    drop2
    <span style="color: #ffffff; font-weight: bold;">word-interpreter-syntax:</span>if,meet-false,else
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  drop2
  <span style="color: #00ffff; font-weight: bold;">loop</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orga3fcfad" class="outline-4">
<h4 id="orga3fcfad">word-interpreter-syntax:if</h4>
<div class="outline-text-4" id="text-orga3fcfad">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">word-interpreter-syntax:if</span>
  <span style="color: #FF8888;">&lt;&lt; bool, literal-word:if -- &gt;&gt;</span>
  drop2 <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #ffffff; font-weight: bold;">word-interpreter-syntax:</span>if,meet-true
  <span style="color: #f92672; font-weight: bold;">else</span>
    <span style="color: #ffffff; font-weight: bold;">word-interpreter-syntax:</span>if,meet-false
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org2259445" class="outline-4">
<h4 id="org2259445">syntax-rule:add to syntax-rule-set:*word-interpreter*</h4>
<div class="outline-text-4" id="text-org2259445">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #fd971f; font-weight: bold;">syntax-rule-set:*word-interpreter*</span>
<span style="color: #f92672; font-weight: bold;">jo</span> <span style="color: #ffffff; font-weight: bold;">literal-word:</span>if? <span style="color: #f92672; font-weight: bold;">jo</span> <span style="color: #ffffff; font-weight: bold;">word-interpreter-syntax:</span>if
<span style="color: #ffffff; font-weight: bold;">syntax-rule:</span>add
</pre>
</div>
</div>
</div>

<div id="outline-container-org4ae9359" class="outline-4">
<h4 id="org4ae9359"><span class="done test">test</span> word-interpreter-syntax:if &amp; else &amp; then</h4>
<div class="outline-text-4" id="text-org4ae9359">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #e6db74;">"* (testing) word-interpreter-syntax:if &amp; else &amp; then"</span> .s .l
  <span style="color: #fd971f; font-weight: bold;">1</span>
  <span style="color: #ffffff; font-weight: bold;">one?</span> <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #fd971f; font-weight: bold;">111</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #fd971f; font-weight: bold;">111</span> <span style="color: #ffffff; font-weight: bold;">equal?</span> <span style="color: #1ef15f; font-weight: bold;">test</span>

  <span style="color: #fd971f; font-weight: bold;">0</span>
  <span style="color: #ffffff; font-weight: bold;">one?</span> <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #fd971f; font-weight: bold;">111</span>
  <span style="color: #f92672; font-weight: bold;">else</span>
    <span style="color: #fd971f; font-weight: bold;">666</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #fd971f; font-weight: bold;">666</span> <span style="color: #ffffff; font-weight: bold;">equal?</span> <span style="color: #1ef15f; font-weight: bold;">test</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #1ef15f; font-weight: bold;">test-do</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org6c420ac" class="outline-3">
<h3 id="org6c420ac"><b>circular-string-area</b></h3>
<div class="outline-text-3" id="text-org6c420ac">
</div><div id="outline-container-orge1a320b" class="outline-4">
<h4 id="orge1a320b"><span class="todo note">note</span> </h4>
<div class="outline-text-4" id="text-orge1a320b">
<ul class="org-ul">
<li><p>no length in the area anymore</p><p>[not like the string-area]</p></li>
<li><p>and ending each string here with a 0</p></li></ul>
</div>
</div>

<div id="outline-container-orgac1b098" class="outline-4">
<h4 id="orgac1b098">allocate-memory</h4>
<div class="outline-text-4" id="text-orgac1b098">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #fd971f; font-weight: bold;">1024</span> <span style="color: #fd971f; font-weight: bold;">1024</span> mul
<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #fd971f; font-weight: bold;">*circular-string-area,size*</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #a1ab3a; font-weight: bold;">define-variable,with-tos</span>


<span style="color: #fd971f; font-weight: bold;">*circular-string-area,size*</span> <span style="color: #AE7C3B; font-weight: bold;">allocate-memory</span>
<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #fd971f; font-weight: bold;">*circular-string-area*</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #a1ab3a; font-weight: bold;">define-variable,with-tos</span>

<span style="color: #fd971f; font-weight: bold;">*circular-string-area*</span>
<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #fd971f; font-weight: bold;">*circular-string-area,current-free-address*</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #a1ab3a; font-weight: bold;">define-variable,with-tos</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org33afd6e" class="outline-3">
<h3 id="org33afd6e">double-quote&#xa0;&#xa0;&#xa0;<span class="tag"><span class="syntax">syntax</span></span></h3>
<div class="outline-text-3" id="text-org33afd6e">
</div><div id="outline-container-org2ecdcaa" class="outline-4">
<h4 id="org2ecdcaa">circular-string-area,stay</h4>
<div class="outline-text-4" id="text-org2ecdcaa">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">circular-string-area,stay</span>
  <span style="color: #FF8888;">&lt;&lt; string[address, length] -- &gt;&gt;</span>
  dup <span style="color: #fd971f; font-weight: bold;">*circular-string-area,current-free-address*</span> add
  <span style="color: #fd971f; font-weight: bold;">*circular-string-area,size*</span> <span style="color: #fd971f; font-weight: bold;">*circular-string-area*</span> add
  <span style="color: #ffffff; font-weight: bold;">greater-or-equal?</span> <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #fd971f; font-weight: bold;">*circular-string-area*</span>
    <span style="color: #f92672; font-weight: bold;">address</span> <span style="color: #fd971f; font-weight: bold;">*circular-string-area,current-free-address*</span> set
  <span style="color: #f92672; font-weight: bold;">then</span>
  tuck
  <span style="color: #fd971f; font-weight: bold;">*circular-string-area,current-free-address*</span>
  string<span style="color: #b0b1a3;">-&gt;</span>buffer!
  <span style="color: #f92672; font-weight: bold;">address</span> <span style="color: #fd971f; font-weight: bold;">*circular-string-area,current-free-address*</span>
  add-set
  <span style="color: #fd971f; font-weight: bold;">0</span> <span style="color: #fd971f; font-weight: bold;">*circular-string-area,current-free-address*</span>
  set-byte
  <span style="color: #fd971f; font-weight: bold;">1</span> <span style="color: #f92672; font-weight: bold;">address</span> <span style="color: #fd971f; font-weight: bold;">*circular-string-area,current-free-address*</span>
  add-set
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org1923d43" class="outline-4">
<h4 id="org1923d43">word-interpreter-syntax:double-quote</h4>
<div class="outline-text-4" id="text-org1923d43">
<ul class="org-ul">
<li><p>in ASCII encode double-quote is 34</p></li></ul>
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">word-interpreter-syntax:double-quote,loop</span>
  <span style="color: #FF8888;">&lt;&lt; cursor -- cursor &gt;&gt;</span>
  read-byte
  dup <span style="color: #fd971f; font-weight: bold;">34</span> <span style="color: #ffffff; font-weight: bold;">equal?</span> <span style="color: #f92672; font-weight: bold;">if</span>
    drop
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  over set-byte
  add1
  <span style="color: #00ffff; font-weight: bold;">loop</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>

<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">word-interpreter-syntax:double-quote</span>
  <span style="color: #FF8888;">&lt;&lt; literal-word:double-quote -- string[address, length] &gt;&gt;</span>
  drop2
  <span style="color: #fd971f; font-weight: bold;">1024</span> <span style="color: #fd971f; font-weight: bold;">2</span> mul <span style="color: #AE7C3B; font-weight: bold;">allocate-local-memory</span> <span style="color: #FF4C4C; font-weight: bold;">&gt;:buffer</span>
  <span style="color: #83EA83; font-weight: bold;">:buffer</span>
  <span style="color: #ffffff; font-weight: bold;">word-interpreter-syntax:</span>double-quote,loop
  <span style="color: #FF4C4C; font-weight: bold;">&gt;:cursor</span>
  <span style="color: #fd971f; font-weight: bold;">*circular-string-area,current-free-address*</span> <span style="color: #FF4C4C; font-weight: bold;">&gt;:address</span>
  <span style="color: #83EA83; font-weight: bold;">:buffer</span>
  <span style="color: #83EA83; font-weight: bold;">:cursor</span> <span style="color: #83EA83; font-weight: bold;">:buffer</span> sub dup <span style="color: #FF4C4C; font-weight: bold;">&gt;:length</span>
  circular-string-area,stay
  <span style="color: #83EA83; font-weight: bold;">:address</span>
  <span style="color: #83EA83; font-weight: bold;">:length</span>
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb34d453" class="outline-4">
<h4 id="orgb34d453">syntax-rule:add to syntax-rule-set:*word-interpreter*</h4>
<div class="outline-text-4" id="text-orgb34d453">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #fd971f; font-weight: bold;">syntax-rule-set:*word-interpreter*</span>
<span style="color: #f92672; font-weight: bold;">jo</span> <span style="color: #ffffff; font-weight: bold;">literal-word:</span>double-quote? <span style="color: #f92672; font-weight: bold;">jo</span> <span style="color: #ffffff; font-weight: bold;">word-interpreter-syntax:</span>double-quote
<span style="color: #ffffff; font-weight: bold;">syntax-rule:</span>add
</pre>
</div>
</div>
</div>

<div id="outline-container-org8448b04" class="outline-4">
<h4 id="org8448b04"><span class="done test">test</span> word-interpreter-syntax:double-quote</h4>
<div class="outline-text-4" id="text-org8448b04">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #e6db74;">"* (testing) word-interpreter-syntax:double-quote"</span> .s .l
  <span style="color: #fd971f; font-weight: bold;">1</span>
  <span style="color: #ffffff; font-weight: bold;">one?</span> <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #e6db74;">"111"</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #e6db74;">"111"</span> <span style="color: #ffffff; font-weight: bold;">string:</span>equal? <span style="color: #1ef15f; font-weight: bold;">test</span>

  <span style="color: #fd971f; font-weight: bold;">0</span>
  <span style="color: #ffffff; font-weight: bold;">one?</span> <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #e6db74;">"111"</span>
  <span style="color: #f92672; font-weight: bold;">else</span>
    <span style="color: #e6db74;">"___"</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #e6db74;">"___"</span> <span style="color: #ffffff; font-weight: bold;">string:</span>equal? <span style="color: #1ef15f; font-weight: bold;">test</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #1ef15f; font-weight: bold;">test-do</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgbbd4bd0" class="outline-3">
<h3 id="orgbbd4bd0">address&#xa0;&#xa0;&#xa0;<span class="tag"><span class="syntax">syntax</span></span></h3>
<div class="outline-text-3" id="text-orgbbd4bd0">
</div><div id="outline-container-org432b9cc" class="outline-4">
<h4 id="org432b9cc">word-interpreter-syntax:address</h4>
<div class="outline-text-4" id="text-org432b9cc">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">word-interpreter-syntax:address</span>
  <span style="color: #FF8888;">&lt;&lt; literal-word:address -- address &gt;&gt;</span>
  drop2
  read-word
  <span style="color: #dc322f; font-weight: bold;">&gt;::word</span>

  <span style="color: #5CDD5C; font-weight: bold;">::word</span> name-hash-table,find-jo <span style="color: #f92672; font-weight: bold;">if</span>
  <span style="color: #f92672; font-weight: bold;">else</span>
    <span style="color: #e6db74;">"* (word-interpreter-syntax:address) meet undefined word : "</span> .s <span style="color: #5CDD5C; font-weight: bold;">::word</span> .s .l
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>

  <span style="color: #FF4C4C; font-weight: bold;">&gt;:jo</span>
  <span style="color: #83EA83; font-weight: bold;">:jo</span> <span style="color: #ffffff; font-weight: bold;">variable-jo?</span> <span style="color: #f92672; font-weight: bold;">if</span>
  <span style="color: #f92672; font-weight: bold;">else</span>
    <span style="color: #e6db74;">"* (word-interpreter-syntax:address) meet a not variable-jo : "</span> .s <span style="color: #5CDD5C; font-weight: bold;">::word</span> .s .l
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #83EA83; font-weight: bold;">:jo</span> <span style="color: #fd971f; font-weight: bold;">*cell-size*</span> add
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org923ab7" class="outline-4">
<h4 id="org923ab7">syntax-rule:add to syntax-rule-set:*word-interpreter*</h4>
<div class="outline-text-4" id="text-org923ab7">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #fd971f; font-weight: bold;">syntax-rule-set:*word-interpreter*</span>
<span style="color: #f92672; font-weight: bold;">jo</span> <span style="color: #ffffff; font-weight: bold;">literal-word:</span>address?
<span style="color: #f92672; font-weight: bold;">jo</span> <span style="color: #ffffff; font-weight: bold;">word-interpreter-syntax:</span>address
<span style="color: #ffffff; font-weight: bold;">syntax-rule:</span>add
</pre>
</div>
</div>
</div>

<div id="outline-container-org669bfd2" class="outline-4">
<h4 id="org669bfd2"><span class="done test">test</span> word-interpreter-syntax:address</h4>
<div class="outline-text-4" id="text-org669bfd2">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #fd971f; font-weight: bold;">0</span>
<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #fd971f; font-weight: bold;">word-interpreter-syntax:*testing-variable*</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #1ef15f; font-weight: bold;">test-variable,with-tos</span>

<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #e6db74;">"* (testing) word-interpreter-syntax:address"</span> .s .l
  <span style="color: #fd971f; font-weight: bold;">666</span>
  <span style="color: #f92672; font-weight: bold;">address</span> <span style="color: #fd971f; font-weight: bold;">word-interpreter-syntax:*testing-variable*</span> set
  <span style="color: #fd971f; font-weight: bold;">word-interpreter-syntax:*testing-variable*</span>
  <span style="color: #fd971f; font-weight: bold;">666</span> <span style="color: #ffffff; font-weight: bold;">equal?</span> <span style="color: #1ef15f; font-weight: bold;">test</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #1ef15f; font-weight: bold;">test-do</span>

<span style="color: #FF8888;">&lt;&lt; error</span>
<span style="color: #FF8888;">address kkk</span>
<span style="color: #FF8888;">&gt;&gt;</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org37ff73d" class="outline-3">
<h3 id="org37ff73d">literal-word:name?</h3>
<div class="outline-text-3" id="text-org37ff73d">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">literal-word:name?</span>
  <span style="color: #FF8888;">&lt;&lt; word[address, length] -- bool &gt;&gt;</span>
  <span style="color: #e6db74;">"name"</span> <span style="color: #ffffff; font-weight: bold;">string:</span>equal?
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org8fa9a10" class="outline-3">
<h3 id="org8fa9a10">name&#xa0;&#xa0;&#xa0;<span class="tag"><span class="syntax">syntax</span></span></h3>
<div class="outline-text-3" id="text-org8fa9a10">
</div><div id="outline-container-org3d4f3f9" class="outline-4">
<h4 id="org3d4f3f9">word-interpreter-syntax:name</h4>
<div class="outline-text-4" id="text-org3d4f3f9">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">word-interpreter-syntax:name</span>
  <span style="color: #FF8888;">&lt;&lt; literal-word:name -- name &gt;&gt;</span>
  drop2
  read-word
  <span style="color: #dc322f; font-weight: bold;">&gt;::word</span>

  <span style="color: #5CDD5C; font-weight: bold;">::word</span> string<span style="color: #b0b1a3;">-&gt;</span>name
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb54de49" class="outline-4">
<h4 id="orgb54de49">syntax-rule:add to syntax-rule-set:*word-interpreter*</h4>
<div class="outline-text-4" id="text-orgb54de49">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #fd971f; font-weight: bold;">syntax-rule-set:*word-interpreter*</span>
<span style="color: #f92672; font-weight: bold;">jo</span> <span style="color: #ffffff; font-weight: bold;">literal-word:</span>name?
<span style="color: #f92672; font-weight: bold;">jo</span> <span style="color: #ffffff; font-weight: bold;">word-interpreter-syntax:</span>name
<span style="color: #ffffff; font-weight: bold;">syntax-rule:</span>add
</pre>
</div>
</div>
</div>

<div id="outline-container-org5f45a6e" class="outline-4">
<h4 id="org5f45a6e"><span class="done test">test</span> word-interpreter-syntax:name</h4>
<div class="outline-text-4" id="text-org5f45a6e">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #e6db74;">"* (testing) word-interpreter-syntax:name"</span> .s .l
  <span style="color: #f92672; font-weight: bold;">name</span> add
  name<span style="color: #b0b1a3;">-&gt;</span>string <span style="color: #e6db74;">"add"</span> <span style="color: #ffffff; font-weight: bold;">string:</span>equal? <span style="color: #1ef15f; font-weight: bold;">test</span>
  <span style="color: #f92672; font-weight: bold;">name</span> <span style="color: #fd971f; font-weight: bold;">word-interpreter-syntax:*testing-variable*</span>
  name<span style="color: #b0b1a3;">-&gt;</span>string <span style="color: #e6db74;">"word-interpreter-syntax:*testing-variable*"</span> <span style="color: #ffffff; font-weight: bold;">string:</span>equal? <span style="color: #1ef15f; font-weight: bold;">test</span>
  <span style="color: #f92672; font-weight: bold;">name</span> kkk
  name<span style="color: #b0b1a3;">-&gt;</span>string <span style="color: #e6db74;">"kkk"</span> <span style="color: #ffffff; font-weight: bold;">string:</span>equal? <span style="color: #1ef15f; font-weight: bold;">test</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #1ef15f; font-weight: bold;">test-do</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org4c03143" class="outline-3">
<h3 id="org4c03143">quote</h3>
<div class="outline-text-3" id="text-org4c03143">
</div><div id="outline-container-org7b8ebe9" class="outline-4">
<h4 id="org7b8ebe9">word-interpreter-syntax:quote</h4>
<div class="outline-text-4" id="text-org7b8ebe9">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">word-interpreter-syntax:quote</span>
  <span style="color: #FF8888;">&lt;&lt; quote-word -- name &gt;&gt;</span>
  <span style="color: #ffffff; font-weight: bold;">string:</span>byte-tail string<span style="color: #b0b1a3;">-&gt;</span>name
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org7853e9c" class="outline-4">
<h4 id="org7853e9c">syntax-rule:add to syntax-rule-set:*word-interpreter*</h4>
<div class="outline-text-4" id="text-org7853e9c">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #fd971f; font-weight: bold;">syntax-rule-set:*word-interpreter*</span>
<span style="color: #f92672; font-weight: bold;">jo</span> <span style="color: #ffffff; font-weight: bold;">quote-word?</span>
<span style="color: #f92672; font-weight: bold;">jo</span> <span style="color: #ffffff; font-weight: bold;">word-interpreter-syntax:</span>quote
<span style="color: #ffffff; font-weight: bold;">syntax-rule:</span>add
</pre>
</div>
</div>
</div>

<div id="outline-container-org367ecee" class="outline-4">
<h4 id="org367ecee"><span class="done test">test</span> word-interpreter-syntax:quote</h4>
<div class="outline-text-4" id="text-org367ecee">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #e6db74;">"* (testing) word-interpreter-syntax:name"</span> .s .l
  <span style="color: #fd971f; font-weight: bold;">'add</span>
  name<span style="color: #b0b1a3;">-&gt;</span>string <span style="color: #e6db74;">"add"</span> <span style="color: #ffffff; font-weight: bold;">string:</span>equal? <span style="color: #1ef15f; font-weight: bold;">test</span>
  <span style="color: #fd971f; font-weight: bold;">'kkk</span>
  name<span style="color: #b0b1a3;">-&gt;</span>string <span style="color: #e6db74;">"kkk"</span> <span style="color: #ffffff; font-weight: bold;">string:</span>equal? <span style="color: #1ef15f; font-weight: bold;">test</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #1ef15f; font-weight: bold;">test-do</span>
</pre>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-org7f7cc6d" class="outline-2">
<h2 id="org7f7cc6d"><b>a little test</b></h2>
<div class="outline-text-2" id="text-org7f7cc6d">
</div><div id="outline-container-org5dcc892" class="outline-3">
<h3 id="org5dcc892">nested comment</h3>
<div class="outline-text-3" id="text-org5dcc892">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #e6db74;">"* (testing) nested comment in REPL"</span> .s .l
  <span style="color: #fd971f; font-weight: bold;">1</span> <span style="color: #FF8888;">&lt;&lt; 2    3    4 &gt;&gt;</span> <span style="color: #fd971f; font-weight: bold;">5</span>
  <span style="color: #fd971f; font-weight: bold;">1</span> <span style="color: #FF8888;">&lt;&lt; 2 &lt;&lt; 3 &gt;&gt;</span> <span style="color: #fd971f; font-weight: bold;">4</span> &gt;&gt; <span style="color: #fd971f; font-weight: bold;">5</span>
  <span style="color: #fd971f; font-weight: bold;">5</span> <span style="color: #ffffff; font-weight: bold;">equal?</span>
  <span style="color: #fd971f; font-weight: bold;">1</span> <span style="color: #ffffff; font-weight: bold;">equal?</span> add
  <span style="color: #fd971f; font-weight: bold;">5</span> <span style="color: #ffffff; font-weight: bold;">equal?</span> add
  <span style="color: #fd971f; font-weight: bold;">1</span> <span style="color: #ffffff; font-weight: bold;">equal?</span> add <span style="color: #1ef15f; font-weight: bold;">test</span>
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #1ef15f; font-weight: bold;">test-do</span>

<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">nested-comment-function-body</span>
  <span style="color: #fd971f; font-weight: bold;">1</span> <span style="color: #FF8888;">&lt;&lt; 2    3    4 &gt;&gt;</span> <span style="color: #fd971f; font-weight: bold;">5</span>
  <span style="color: #fd971f; font-weight: bold;">1</span> <span style="color: #FF8888;">&lt;&lt; 2 &lt;&lt; 3 &gt;&gt;</span> <span style="color: #fd971f; font-weight: bold;">4</span> &gt;&gt; <span style="color: #fd971f; font-weight: bold;">5</span>
  <span style="color: #fd971f; font-weight: bold;">5</span> <span style="color: #ffffff; font-weight: bold;">equal?</span>
  <span style="color: #fd971f; font-weight: bold;">1</span> <span style="color: #ffffff; font-weight: bold;">equal?</span> add
  <span style="color: #fd971f; font-weight: bold;">5</span> <span style="color: #ffffff; font-weight: bold;">equal?</span> add
  <span style="color: #fd971f; font-weight: bold;">1</span> <span style="color: #ffffff; font-weight: bold;">equal?</span> add <span style="color: #1ef15f; font-weight: bold;">test</span>
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #1ef15f; font-weight: bold;">test-function</span>

<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #e6db74;">"* (testing) nested comment in function body"</span> .s .l
  nested-comment-function-body
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #1ef15f; font-weight: bold;">test-do</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd5ee686" class="outline-3">
<h3 id="orgd5ee686">return structured value</h3>
<div class="outline-text-3" id="text-orgd5ee686">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">callee</span>
  <span style="color: #FF8888;">&lt;&lt; -- string[address, length] &gt;&gt;</span>
  <span style="color: #fd971f; font-weight: bold;">512</span> <span style="color: #AE7C3B; font-weight: bold;">allocate-conjugate-local-memory</span> <span style="color: #FF4C4C; font-weight: bold;">&gt;:buffer</span>
  <span style="color: #e6db74;">"(callee ^-^) "</span> <span style="color: #FF4C4C; font-weight: bold;">&gt;:length</span> <span style="color: #FF4C4C; font-weight: bold;">&gt;:address</span>
  <span style="color: #83EA83; font-weight: bold;">:address</span> <span style="color: #83EA83; font-weight: bold;">:length</span>
  <span style="color: #83EA83; font-weight: bold;">:buffer</span>
  string<span style="color: #b0b1a3;">-&gt;</span>buffer!
  <span style="color: #83EA83; font-weight: bold;">:buffer</span> <span style="color: #83EA83; font-weight: bold;">:length</span>
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #1ef15f; font-weight: bold;">test-function</span>

<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">caller</span>
  <span style="color: #FF8888;">&lt;&lt; -- string[address, length] &gt;&gt;</span>
  <span style="color: #fd971f; font-weight: bold;">512</span> <span style="color: #AE7C3B; font-weight: bold;">allocate-local-memory</span> <span style="color: #FF4C4C; font-weight: bold;">&gt;:buffer</span>
  <span style="color: #e6db74;">"(caller O.o) "</span> <span style="color: #FF4C4C; font-weight: bold;">&gt;:length</span> <span style="color: #FF4C4C; font-weight: bold;">&gt;:address</span>
  <span style="color: #83EA83; font-weight: bold;">:address</span> <span style="color: #83EA83; font-weight: bold;">:length</span>
  <span style="color: #83EA83; font-weight: bold;">:buffer</span>
  string<span style="color: #b0b1a3;">-&gt;</span>buffer!
  <span style="color: #83EA83; font-weight: bold;">:buffer</span> <span style="color: #83EA83; font-weight: bold;">:length</span> <span style="color: #dc322f; font-weight: bold;">&gt;::caller-string-1</span>

  callee <span style="color: #dc322f; font-weight: bold;">&gt;::callee-string</span>

  <span style="color: #fd971f; font-weight: bold;">512</span> <span style="color: #AE7C3B; font-weight: bold;">allocate-local-memory</span> <span style="color: #FF4C4C; font-weight: bold;">&gt;:buffer</span>
  <span style="color: #e6db74;">"(caller o.O) "</span> <span style="color: #FF4C4C; font-weight: bold;">&gt;:length</span> <span style="color: #FF4C4C; font-weight: bold;">&gt;:address</span>
  <span style="color: #83EA83; font-weight: bold;">:address</span> <span style="color: #83EA83; font-weight: bold;">:length</span>
  <span style="color: #83EA83; font-weight: bold;">:buffer</span>
  string<span style="color: #b0b1a3;">-&gt;</span>buffer!
  <span style="color: #83EA83; font-weight: bold;">:buffer</span> <span style="color: #83EA83; font-weight: bold;">:length</span> <span style="color: #dc322f; font-weight: bold;">&gt;::caller-string-2</span>

  <span style="color: #fd971f; font-weight: bold;">512</span> <span style="color: #AE7C3B; font-weight: bold;">allocate-local-memory</span> <span style="color: #FF4C4C; font-weight: bold;">&gt;:buffer</span>
  <span style="color: #5CDD5C; font-weight: bold;">::caller-string-1</span>
  <span style="color: #5CDD5C; font-weight: bold;">::callee-string</span>
  <span style="color: #5CDD5C; font-weight: bold;">::caller-string-2</span>
  <span style="color: #83EA83; font-weight: bold;">:buffer</span>
  <span style="color: #fd971f; font-weight: bold;">3</span> n-string<span style="color: #b0b1a3;">-&gt;</span>buffer! <span style="color: #FF4C4C; font-weight: bold;">&gt;:length</span>

  <span style="color: #83EA83; font-weight: bold;">:buffer</span>
  <span style="color: #83EA83; font-weight: bold;">:length</span>
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #1ef15f; font-weight: bold;">test-function</span>

<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #e6db74;">"* (testing) return structured value"</span> .s .l
  caller
  <span style="color: #e6db74;">"(caller O.o) (callee ^-^) (caller o.O) "</span>
  <span style="color: #ffffff; font-weight: bold;">string:</span>equal? <span style="color: #1ef15f; font-weight: bold;">test</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #1ef15f; font-weight: bold;">test-do</span>
</pre>
</div>
</div>
</div>
</div>


<div id="outline-container-org9b9f929" class="outline-2">
<h2 id="org9b9f929">syntax-rule-set &amp; syntax-rule</h2>
<div class="outline-text-2" id="text-org9b9f929">
</div><div id="outline-container-orgd2ceaec" class="outline-3">
<h3 id="orgd2ceaec"><span class="done test">test</span> endianness of n-get &amp; n-set</h3>
<div class="outline-text-3" id="text-orgd2ceaec">
<ul class="org-ul">
<li><p><p></p><p>big-endian is used</p><p>in memory</p><p></p></p><p><table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides"></p><p></p><p></p><p><colgroup></p><p><col  class="org-left" /></p><p></colgroup></p><p><tbody></p><p><tr></p><p><td class="org-left">value-1</td></p><p></tr></p><p></p><p><tr></p><p><td class="org-left">value-2</td></p><p></tr></p><p></p><p><tr></p><p><td class="org-left">value-3</td></p><p></tr></p><p></tbody></p><p></table></p><p><p></p><p>on stack</p><p>&lt;&lt; value-1, value-2, value-3 &gt;&gt;</p><p></p></p></li></ul>
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #fd971f; font-weight: bold;">3</span> <span style="color: #fd971f; font-weight: bold;">*cell-size*</span> mul <span style="color: #AE7C3B; font-weight: bold;">allocate-memory</span>
<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #fd971f; font-weight: bold;">*t*</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #1ef15f; font-weight: bold;">test-variable,with-tos</span>

<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #e6db74;">"* (testing) endianness of n-get &amp; n-set"</span> .s .l
  <span style="color: #fd971f; font-weight: bold;">1</span> <span style="color: #fd971f; font-weight: bold;">2</span> <span style="color: #fd971f; font-weight: bold;">3</span> <span style="color: #fd971f; font-weight: bold;">*t*</span> <span style="color: #fd971f; font-weight: bold;">3</span> n-set
  <span style="color: #FF8888;">&lt;&lt; re-occur when geting through &gt;&gt;</span>
  <span style="color: #fd971f; font-weight: bold;">*t*</span> get
  <span style="color: #fd971f; font-weight: bold;">1</span> <span style="color: #ffffff; font-weight: bold;">equal?</span>

  <span style="color: #fd971f; font-weight: bold;">*t*</span> <span style="color: #fd971f; font-weight: bold;">*cell-size*</span> add get
  <span style="color: #fd971f; font-weight: bold;">2</span> <span style="color: #ffffff; font-weight: bold;">equal?</span> and

  <span style="color: #fd971f; font-weight: bold;">*t*</span> <span style="color: #fd971f; font-weight: bold;">*cell-size*</span> <span style="color: #fd971f; font-weight: bold;">2</span> mul add get
  <span style="color: #fd971f; font-weight: bold;">3</span> <span style="color: #ffffff; font-weight: bold;">equal?</span> and <span style="color: #1ef15f; font-weight: bold;">test</span>

  <span style="color: #fd971f; font-weight: bold;">*t*</span> <span style="color: #fd971f; font-weight: bold;">3</span> n-get
  <span style="color: #fd971f; font-weight: bold;">3</span> <span style="color: #ffffff; font-weight: bold;">equal?</span> <span style="color: #1ef15f; font-weight: bold;">test</span>
  <span style="color: #fd971f; font-weight: bold;">2</span> <span style="color: #ffffff; font-weight: bold;">equal?</span> <span style="color: #1ef15f; font-weight: bold;">test</span>
  <span style="color: #fd971f; font-weight: bold;">1</span> <span style="color: #ffffff; font-weight: bold;">equal?</span> <span style="color: #1ef15f; font-weight: bold;">test</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #1ef15f; font-weight: bold;">test-do</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orge9bfa9c" class="outline-3">
<h3 id="orge9bfa9c">syntax-rule-set:list</h3>
<div class="outline-text-3" id="text-orge9bfa9c">
<ul class="org-ul">
<li><p>最後寫到規則集合裏的 被最先打印出來</p></li>
<li><p>下面的打印方式 看似有些不簡潔</p><p>是因爲 我還沒有 integer-&gt;string 這樣的函數</p><p>[因爲 沒有對字符串的動態內存管理]</p></li></ul>
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">syntax-rule-set:list,loop</span>
  <span style="color: #FF8888;">&lt;&lt; syntax-rule-set: cursor, counter -- &gt;&gt;</span>
  xx<span style="color: #b0b1a3;">|</span>over<span style="color: #b0b1a3;">|</span>x <span style="color: #ffffff; font-weight: bold;">equal?</span> <span style="color: #f92672; font-weight: bold;">if</span>
    drop drop2
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #e6db74;">"  * "</span> .s
  <span style="color: #e6db74;">"("</span> .s
  add1 dup .i
  <span style="color: #e6db74;">")"</span> .s .l
  swap
    dup <span style="color: #fd971f; font-weight: bold;">syntax-rule:*unit*</span> sub <span style="color: #ffffff; font-weight: bold;">syntax-rule:</span>get-predicate
    <span style="color: #e6db74;">"    "</span> .s jo,find-name <span style="color: #f92672; font-weight: bold;">if</span> name<span style="color: #b0b1a3;">-&gt;</span>string <span style="color: #f92672; font-weight: bold;">else</span> <span style="color: #e6db74;">"  unnamed jo"</span> <span style="color: #f92672; font-weight: bold;">then</span> .s .l
    dup <span style="color: #fd971f; font-weight: bold;">syntax-rule:*unit*</span> sub <span style="color: #ffffff; font-weight: bold;">syntax-rule:</span>get-function
    <span style="color: #e6db74;">"    "</span> .s jo,find-name <span style="color: #f92672; font-weight: bold;">if</span> name<span style="color: #b0b1a3;">-&gt;</span>string <span style="color: #f92672; font-weight: bold;">else</span> <span style="color: #e6db74;">"  unnamed jo"</span> <span style="color: #f92672; font-weight: bold;">then</span> .s .l
    <span style="color: #fd971f; font-weight: bold;">*cell-size*</span> sub <span style="color: #fd971f; font-weight: bold;">*cell-size*</span> sub
  swap
  <span style="color: #00ffff; font-weight: bold;">loop</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>

<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">syntax-rule-set:list</span>
  <span style="color: #FF8888;">&lt;&lt; syntax-rule-set -- &gt;&gt;</span>
  dup <span style="color: #ffffff; font-weight: bold;">syntax-rule-set:</span>get-border
  <span style="color: #fd971f; font-weight: bold;">0</span> <span style="color: #ffffff; font-weight: bold;">syntax-rule-set:</span>list,loop
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf943896" class="outline-3">
<h3 id="orgf943896">syntax-rule:sub</h3>
<div class="outline-text-3" id="text-orgf943896">
<ul class="org-ul">
<li><p>firstly</p><p>in (syntax-rule:sub,loop)</p><p>cursor move from border down to address of syntax-rule-set</p><p>secondly</p><p>in (syntax-rule:sub,move)</p><p>cursor move from founded place up to border</p></li></ul>
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">syntax-rule:sub,move-one</span>
  <span style="color: #FF8888;">&lt;&lt; cursor -- &gt;&gt;</span>
  <span style="color: #FF4C4C; font-weight: bold;">&gt;:cursor</span>
  <span style="color: #83EA83; font-weight: bold;">:cursor</span> <span style="color: #fd971f; font-weight: bold;">2</span> n-get
  <span style="color: #83EA83; font-weight: bold;">:cursor</span> <span style="color: #fd971f; font-weight: bold;">*cell-size*</span> <span style="color: #fd971f; font-weight: bold;">2</span> mul sub
  <span style="color: #fd971f; font-weight: bold;">2</span> n-set
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>

<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">syntax-rule:sub,move</span>
  <span style="color: #FF8888;">&lt;&lt; syntax-rule-set: cursor -- &gt;&gt;</span>
  <span style="color: #FF4C4C; font-weight: bold;">&gt;:cursor</span>
  <span style="color: #FF4C4C; font-weight: bold;">&gt;:syntax-rule-set</span>
  <span style="color: #83EA83; font-weight: bold;">:syntax-rule-set</span> <span style="color: #ffffff; font-weight: bold;">syntax-rule-set:</span>get-border <span style="color: #FF4C4C; font-weight: bold;">&gt;:border</span>
  <span style="color: #83EA83; font-weight: bold;">:cursor</span> <span style="color: #83EA83; font-weight: bold;">:border</span> <span style="color: #ffffff; font-weight: bold;">equal?</span> <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #83EA83; font-weight: bold;">:border</span> <span style="color: #fd971f; font-weight: bold;">*cell-size*</span> <span style="color: #fd971f; font-weight: bold;">2</span> mul sub
    <span style="color: #83EA83; font-weight: bold;">:syntax-rule-set</span>
    <span style="color: #ffffff; font-weight: bold;">syntax-rule-set:</span>set-border
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #83EA83; font-weight: bold;">:cursor</span> <span style="color: #ffffff; font-weight: bold;">syntax-rule:</span>sub,move-one
  <span style="color: #83EA83; font-weight: bold;">:syntax-rule-set</span>
  <span style="color: #83EA83; font-weight: bold;">:cursor</span> <span style="color: #fd971f; font-weight: bold;">*cell-size*</span> <span style="color: #fd971f; font-weight: bold;">2</span> mul add
  <span style="color: #00ffff; font-weight: bold;">loop</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>

<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">syntax-rule:sub,loop</span>
  <span style="color: #FF8888;">&lt;&lt; syntax-rule-set: syntax-rule[predicate, function], cursor -- &gt;&gt;</span>
  <span style="color: #FF4C4C; font-weight: bold;">&gt;:cursor</span>
  <span style="color: #dc322f; font-weight: bold;">&gt;::syntax-rule</span>
  <span style="color: #FF4C4C; font-weight: bold;">&gt;:syntax-rule-set</span>
  <span style="color: #83EA83; font-weight: bold;">:cursor</span> <span style="color: #83EA83; font-weight: bold;">:syntax-rule-set</span> <span style="color: #ffffff; font-weight: bold;">equal?</span> <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #5CDD5C; font-weight: bold;">::syntax-rule</span>
  <span style="color: #83EA83; font-weight: bold;">:cursor</span> <span style="color: #fd971f; font-weight: bold;">syntax-rule:*unit*</span> sub <span style="color: #ffffff; font-weight: bold;">syntax-rule:</span>get
  <span style="color: #ffffff; font-weight: bold;">equal2?</span> <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #83EA83; font-weight: bold;">:syntax-rule-set</span> <span style="color: #83EA83; font-weight: bold;">:cursor</span>
    <span style="color: #ffffff; font-weight: bold;">syntax-rule:</span>sub,move
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #83EA83; font-weight: bold;">:syntax-rule-set</span>
  <span style="color: #5CDD5C; font-weight: bold;">::syntax-rule</span>
  <span style="color: #83EA83; font-weight: bold;">:cursor</span> <span style="color: #fd971f; font-weight: bold;">*cell-size*</span> <span style="color: #fd971f; font-weight: bold;">2</span> mul sub
  <span style="color: #00ffff; font-weight: bold;">loop</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>

<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">syntax-rule:sub</span>
  <span style="color: #FF8888;">&lt;&lt; syntax-rule-set: syntax-rule[predicate, function] -- &gt;&gt;</span>
  x<span style="color: #b0b1a3;">|</span>over<span style="color: #b0b1a3;">|</span>xx <span style="color: #ffffff; font-weight: bold;">syntax-rule-set:</span>get-border
  <span style="color: #ffffff; font-weight: bold;">syntax-rule:</span>sub,loop
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org819e880" class="outline-3">
<h3 id="org819e880"><span class="done test">test</span> </h3>
<div class="outline-text-3" id="text-org819e880">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #fd971f; font-weight: bold;">syntax-rule-set:*word-interpreter*</span> <span style="color: #ffffff; font-weight: bold;">syntax-rule-set:</span>list

<span style="color: #fd971f; font-weight: bold;">syntax-rule-set:*word-interpreter*</span>
<span style="color: #f92672; font-weight: bold;">jo</span> <span style="color: #ffffff; font-weight: bold;">literal-word:</span>address?
<span style="color: #f92672; font-weight: bold;">jo</span> <span style="color: #ffffff; font-weight: bold;">word-interpreter-syntax:</span>address
<span style="color: #ffffff; font-weight: bold;">syntax-rule:</span>add

<span style="color: #fd971f; font-weight: bold;">syntax-rule-set:*word-interpreter*</span>
<span style="color: #f92672; font-weight: bold;">jo</span> <span style="color: #ffffff; font-weight: bold;">literal-word:</span>double-quote?
<span style="color: #f92672; font-weight: bold;">jo</span> <span style="color: #ffffff; font-weight: bold;">word-interpreter-syntax:</span>double-quote
<span style="color: #ffffff; font-weight: bold;">syntax-rule:</span>add

<span style="color: #fd971f; font-weight: bold;">syntax-rule-set:*word-interpreter*</span> <span style="color: #ffffff; font-weight: bold;">syntax-rule-set:</span>list

<span style="color: #fd971f; font-weight: bold;">syntax-rule-set:*word-interpreter*</span>
<span style="color: #f92672; font-weight: bold;">jo</span> <span style="color: #ffffff; font-weight: bold;">literal-word:</span>address?
<span style="color: #f92672; font-weight: bold;">jo</span> <span style="color: #ffffff; font-weight: bold;">word-interpreter-syntax:</span>address
<span style="color: #ffffff; font-weight: bold;">syntax-rule:</span>sub

<span style="color: #fd971f; font-weight: bold;">syntax-rule-set:*word-interpreter*</span> <span style="color: #ffffff; font-weight: bold;">syntax-rule-set:</span>list

<span style="color: #fd971f; font-weight: bold;">syntax-rule-set:*word-interpreter*</span>
<span style="color: #f92672; font-weight: bold;">jo</span> <span style="color: #ffffff; font-weight: bold;">literal-word:</span>double-quote?
<span style="color: #f92672; font-weight: bold;">jo</span> <span style="color: #ffffff; font-weight: bold;">word-interpreter-syntax:</span>double-quote
<span style="color: #ffffff; font-weight: bold;">syntax-rule:</span>sub

<span style="color: #fd971f; font-weight: bold;">syntax-rule-set:*word-interpreter*</span> <span style="color: #ffffff; font-weight: bold;">syntax-rule-set:</span>list
</pre>
</div>
</div>
</div>

<div id="outline-container-orgcecd6bd" class="outline-3">
<h3 id="orgcecd6bd">syntax-rule-set:mixin</h3>
<div class="outline-text-3" id="text-orgcecd6bd">
<ul class="org-ul">
<li><p>the order matters</p></li></ul>
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">syntax-rule-set:mixin,loop</span>
  <span style="color: #FF8888;">&lt;&lt; base-syntax-rule-set: border, cursor -- &gt;&gt;</span>
  dup2 <span style="color: #ffffff; font-weight: bold;">equal?</span> <span style="color: #f92672; font-weight: bold;">if</span>
    drop2
    drop
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  dup <span style="color: #ffffff; font-weight: bold;">syntax-rule:</span>get <span style="color: #dc322f; font-weight: bold;">&gt;::syntax-rule</span>
  x<span style="color: #b0b1a3;">|</span>over<span style="color: #b0b1a3;">|</span>xx <span style="color: #5CDD5C; font-weight: bold;">::syntax-rule</span> <span style="color: #ffffff; font-weight: bold;">syntax-rule:</span>add
  <span style="color: #fd971f; font-weight: bold;">syntax-rule:*unit*</span> add
  <span style="color: #00ffff; font-weight: bold;">loop</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>

<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">syntax-rule-set:mixin</span>
  <span style="color: #FF8888;">&lt;&lt; base-syntax-rule-set: syntax-rule-set -- &gt;&gt;</span>
  dup <span style="color: #ffffff; font-weight: bold;">syntax-rule-set:</span>get-border swap
  <span style="color: #ffffff; font-weight: bold;">syntax-rule-set:</span>mixin,loop
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org294dce1" class="outline-3">
<h3 id="org294dce1">syntax-rule-set:mixout</h3>
<div class="outline-text-3" id="text-org294dce1">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">syntax-rule-set:mixout,loop</span>
  <span style="color: #FF8888;">&lt;&lt; base-syntax-rule-set: border, cursor -- &gt;&gt;</span>
  dup2 <span style="color: #ffffff; font-weight: bold;">equal?</span> <span style="color: #f92672; font-weight: bold;">if</span>
    drop2
    drop
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  dup <span style="color: #ffffff; font-weight: bold;">syntax-rule:</span>get <span style="color: #dc322f; font-weight: bold;">&gt;::syntax-rule</span>
  x<span style="color: #b0b1a3;">|</span>over<span style="color: #b0b1a3;">|</span>xx <span style="color: #5CDD5C; font-weight: bold;">::syntax-rule</span> <span style="color: #ffffff; font-weight: bold;">syntax-rule:</span>sub
  <span style="color: #fd971f; font-weight: bold;">syntax-rule:*unit*</span> add
  <span style="color: #00ffff; font-weight: bold;">loop</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>

<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">syntax-rule-set:mixout</span>
  <span style="color: #FF8888;">&lt;&lt; base-syntax-rule-set: syntax-rule-set -- &gt;&gt;</span>
  dup <span style="color: #ffffff; font-weight: bold;">syntax-rule-set:</span>get-border swap
  <span style="color: #ffffff; font-weight: bold;">syntax-rule-set:</span>mixout,loop
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org534f00e" class="outline-2">
<h2 id="org534f00e">stack-REPL</h2>
<div class="outline-text-2" id="text-org534f00e">
</div><div id="outline-container-org81f91b0" class="outline-3">
<h3 id="org81f91b0"><span class="todo note">note</span> </h3>
<div class="outline-text-3" id="text-org81f91b0">
<ul class="org-ul">
<li><p>print argument-stack in every loop</p></li></ul>
</div>
</div>

<div id="outline-container-org1ee987d" class="outline-3">
<h3 id="org1ee987d">stack-REPL</h3>
<div class="outline-text-3" id="text-org1ee987d">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">stack-REPL,loop</span>
  <span style="color: #FF8888;">&lt;&lt; unknown -- unknown &gt;&gt;</span>
  read-word
  word-interpreter
  <span style="color: #ffffff; font-weight: bold;">argument-stack:</span>pretty-print
  <span style="color: #00ffff; font-weight: bold;">loop</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>

<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">stack-REPL</span>
  <span style="color: #FF8888;">&lt;&lt; unknown -- unknown &gt;&gt;</span>
  <span style="color: #f92672; font-weight: bold;">jo</span> bye,basic-REPL
  <span style="color: #fd971f; font-weight: bold;">'bye,basic-REPL</span> <span style="color: #1ef15f; font-weight: bold;">await</span>
  <span style="color: #fd971f; font-weight: bold;">syntax-rule-set:*word-interpreter*</span> push-syntax-stack
  stack-REPL,loop
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org46715f6" class="outline-2">
<h2 id="org46715f6">eval-string</h2>
<div class="outline-text-2" id="text-org46715f6">
</div><div id="outline-container-orgd97d669" class="outline-3">
<h3 id="orgd97d669"><span class="todo note">note</span> </h3>
<div class="outline-text-3" id="text-orgd97d669">
<ul class="org-ul">
<li><p>(eval-string) is implemented by doing side-effect on reading-stack</p><p>this is because syntax extension system is implemented by reader-macro</p></li>
<li><p>by implementing (eval-string) this way</p><p>i can easily change the syntax be used to eval a string</p></li></ul>
</div>
</div>

<div id="outline-container-orgfd595fa" class="outline-3">
<h3 id="orgfd595fa">eval-string</h3>
<div class="outline-text-3" id="text-orgfd595fa">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">eval-string,loop</span>
  <span style="color: #FF8888;">&lt;&lt; unknown -- unknown &gt;&gt;</span>
  tos-reading-stack <span style="color: #ffffff; font-weight: bold;">string:</span>space? <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  read-word
  word-interpreter
  <span style="color: #00ffff; font-weight: bold;">loop</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>

<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">eval-string</span>
  <span style="color: #FF8888;">&lt;&lt; string[address, length] -- unknown &gt;&gt;</span>
  push-reading-stack
  eval-string,loop
  drop-reading-stack
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc2bfb8b" class="outline-3">
<h3 id="orgc2bfb8b"><span class="done test">test</span> eval-string</h3>
<div class="outline-text-3" id="text-orgc2bfb8b">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #e6db74;">"* (testing) eval-string"</span> .s .l
  <span style="color: #e6db74;">"1 2 3 add add"</span> eval-string <span style="color: #fd971f; font-weight: bold;">6</span> <span style="color: #ffffff; font-weight: bold;">equal?</span> <span style="color: #1ef15f; font-weight: bold;">test</span>
  <span style="color: #e6db74;">"  1 2 3 add add  "</span> eval-string  <span style="color: #fd971f; font-weight: bold;">6</span> <span style="color: #ffffff; font-weight: bold;">equal?</span> <span style="color: #1ef15f; font-weight: bold;">test</span>
  <span style="color: #e6db74;">" k</span>
<span style="color: #e6db74;">    1 2 3 add add</span>
<span style="color: #e6db74;">    end</span>
<span style="color: #e6db74;">  "</span>
  <span style="color: #e6db74;">"define-function k"</span> eval-string <span style="color: #fd971f; font-weight: bold;">6</span> <span style="color: #ffffff; font-weight: bold;">equal?</span> <span style="color: #1ef15f; font-weight: bold;">test</span>
  k <span style="color: #fd971f; font-weight: bold;">6</span> <span style="color: #ffffff; font-weight: bold;">equal?</span> <span style="color: #1ef15f; font-weight: bold;">test</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #1ef15f; font-weight: bold;">test-do</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgacf852e" class="outline-2">
<h2 id="orgacf852e">define-variable</h2>
<div class="outline-text-2" id="text-orgacf852e">
</div><div id="outline-container-orgf9d6e9e" class="outline-3">
<h3 id="orgf9d6e9e"><span class="todo note">note</span> string allocation</h3>
<div class="outline-text-3" id="text-orgf9d6e9e">
<ul class="org-ul">
<li><p>string should be allocated to a static area</p><p>instead of dynamic area like <b>circular-string-area</b></p><p>thus we have</p><p>(syntax,double-quote,define-variable)</p></li></ul>
</div>
</div>

<div id="outline-container-org307c336" class="outline-3">
<h3 id="org307c336">syntax,double-quote,define-variable</h3>
<div class="outline-text-3" id="text-org307c336">
<ul class="org-ul">
<li><p>in ASCII encode double-quote is 34</p></li></ul>
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">syntax,double-quote,define-variable,loop</span>
  <span style="color: #FF8888;">&lt;&lt; cursor -- cursor &gt;&gt;</span>
  read-byte
  dup <span style="color: #fd971f; font-weight: bold;">34</span> <span style="color: #ffffff; font-weight: bold;">equal?</span> <span style="color: #f92672; font-weight: bold;">if</span>
    drop
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  over set-byte
  add1
  <span style="color: #00ffff; font-weight: bold;">loop</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>

<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">syntax,double-quote,define-variable</span>
  <span style="color: #FF8888;">&lt;&lt; literal-word:double-quote -- string[address, length] &gt;&gt;</span>
  drop2
  <span style="color: #fd971f; font-weight: bold;">1024</span> <span style="color: #fd971f; font-weight: bold;">2</span> mul <span style="color: #AE7C3B; font-weight: bold;">allocate-local-memory</span> <span style="color: #FF4C4C; font-weight: bold;">&gt;:buffer</span>
  <span style="color: #83EA83; font-weight: bold;">:buffer</span>
  syntax,double-quote,define-variable,loop
  <span style="color: #FF4C4C; font-weight: bold;">&gt;:cursor</span>
  <span style="color: #83EA83; font-weight: bold;">:buffer</span>
  <span style="color: #83EA83; font-weight: bold;">:cursor</span> <span style="color: #83EA83; font-weight: bold;">:buffer</span> sub
  make-string
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org9e078ac" class="outline-3">
<h3 id="org9e078ac">define-variable</h3>
<div class="outline-text-3" id="text-org9e078ac">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">define-variable</span>
  <span style="color: #FF8888;">&lt;&lt; string[address, length] -- &gt;&gt;</span>
  <span style="color: #dc322f; font-weight: bold;">&gt;::string</span>

  <span style="color: #5CDD5C; font-weight: bold;">::string</span> <span style="color: #ffffff; font-weight: bold;">string:</span>word <span style="color: #dc322f; font-weight: bold;">&gt;::name</span>
  <span style="color: #5CDD5C; font-weight: bold;">::string</span> <span style="color: #ffffff; font-weight: bold;">string:</span>word-tail <span style="color: #dc322f; font-weight: bold;">&gt;::body</span>

  snapshot-the-stack-pointer
  <span style="color: #fd971f; font-weight: bold;">*the-stack-pointer-snapshot*</span> <span style="color: #FF4C4C; font-weight: bold;">&gt;:old-snapshot</span>

  <span style="color: #fd971f; font-weight: bold;">syntax-rule-set:*word-interpreter*</span>
  <span style="color: #f92672; font-weight: bold;">jo</span> <span style="color: #ffffff; font-weight: bold;">literal-word:</span>double-quote?
  <span style="color: #f92672; font-weight: bold;">jo</span> syntax,double-quote,define-variable
  <span style="color: #ffffff; font-weight: bold;">syntax-rule:</span>add

  <span style="color: #5CDD5C; font-weight: bold;">::body</span> eval-string

  <span style="color: #fd971f; font-weight: bold;">syntax-rule-set:*word-interpreter*</span>
  <span style="color: #f92672; font-weight: bold;">jo</span> <span style="color: #ffffff; font-weight: bold;">literal-word:</span>double-quote?
  <span style="color: #f92672; font-weight: bold;">jo</span> syntax,double-quote,define-variable
  <span style="color: #ffffff; font-weight: bold;">syntax-rule:</span>sub

  snapshot-the-stack-pointer
  <span style="color: #fd971f; font-weight: bold;">*the-stack-pointer-snapshot*</span> <span style="color: #FF4C4C; font-weight: bold;">&gt;:new-snapshot</span>

  <span style="color: #83EA83; font-weight: bold;">:new-snapshot</span> <span style="color: #83EA83; font-weight: bold;">:old-snapshot</span> sub

  dup <span style="color: #ffffff; font-weight: bold;">negative?</span> <span style="color: #f92672; font-weight: bold;">if</span>
    negate <span style="color: #fd971f; font-weight: bold;">*cell-size*</span> div
    <span style="color: #e6db74;">"* (define-variable) fail to define variable : "</span> .s <span style="color: #5CDD5C; font-weight: bold;">::name</span> .s .l
    <span style="color: #e6db74;">"  because after eval the following body"</span> .s .l
    <span style="color: #e6db74;">"  the stack is "</span> .s .i <span style="color: #e6db74;">" below what it use to be"</span> .s .l
    <span style="color: #5CDD5C; font-weight: bold;">::body</span> .s .l
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  dup <span style="color: #ffffff; font-weight: bold;">zero?</span> <span style="color: #f92672; font-weight: bold;">if</span>
    drop
    <span style="color: #e6db74;">"* (define-variable) fail to define variable : "</span> .s <span style="color: #5CDD5C; font-weight: bold;">::name</span> .s .l
    <span style="color: #e6db74;">"  because after eval the following body"</span> .s .l
    <span style="color: #e6db74;">"  the stack is still where it use to be"</span> .s .l
    <span style="color: #5CDD5C; font-weight: bold;">::body</span> .s .l
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>

  <span style="color: #fd971f; font-weight: bold;">*cell-size*</span> div <span style="color: #FF4C4C; font-weight: bold;">&gt;:length</span>

  <span style="color: #5CDD5C; font-weight: bold;">::name</span> make-string <span style="color: #dc322f; font-weight: bold;">&gt;::name</span>

  <span style="color: #5CDD5C; font-weight: bold;">::name</span> <span style="color: #fd971f; font-weight: bold;">*link*</span> <span style="color: #fd971f; font-weight: bold;">0</span>
  make-link <span style="color: #FF4C4C; font-weight: bold;">&gt;:link</span>

  <span style="color: #83EA83; font-weight: bold;">:link</span> <span style="color: #f92672; font-weight: bold;">address</span> <span style="color: #fd971f; font-weight: bold;">*link*</span> set

  <span style="color: #fd971f; font-weight: bold;">*explainer,variable*</span> <span style="color: #fd971f; font-weight: bold;">0</span>
  make-jo-head <span style="color: #FF4C4C; font-weight: bold;">&gt;:jo</span>

  <span style="color: #83EA83; font-weight: bold;">:jo</span> <span style="color: #83EA83; font-weight: bold;">:link</span> link,set-jo

  <span style="color: #83EA83; font-weight: bold;">:link</span> name-hash-table,record-jo,by-link

  <span style="color: #83EA83; font-weight: bold;">:length</span>
  <span style="color: #83EA83; font-weight: bold;">:jo</span> jo,set-length

  <span style="color: #fd971f; font-weight: bold;">*jojo-area,current-free-address*</span>
  <span style="color: #83EA83; font-weight: bold;">:length</span>
  n-set

  <span style="color: #83EA83; font-weight: bold;">:length</span> <span style="color: #fd971f; font-weight: bold;">*cell-size*</span> mul
  <span style="color: #f92672; font-weight: bold;">address</span> <span style="color: #fd971f; font-weight: bold;">*jojo-area,current-free-address*</span>
  add-set
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org9c2d21e" class="outline-3">
<h3 id="org9c2d21e"><span class="done test">test</span> </h3>
<div class="outline-text-3" id="text-org9c2d21e">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #fd971f; font-weight: bold;">define-variable:*testing-numbers*</span>
  <span style="color: #fd971f; font-weight: bold;">1</span> <span style="color: #fd971f; font-weight: bold;">2</span> <span style="color: #fd971f; font-weight: bold;">3</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #a1ab3a; font-weight: bold;">define-variable</span>
<span style="color: #fd971f; font-weight: bold;">define-variable:*testing-numbers*</span> . . . <span style="color: #FF8888;">&lt;&lt; 3 2 1 &gt;&gt;</span>
<span style="color: #f92672; font-weight: bold;">address</span> <span style="color: #fd971f; font-weight: bold;">define-variable:*testing-numbers*</span> get . <span style="color: #FF8888;">&lt;&lt; 1 &gt;&gt;</span>

<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #fd971f; font-weight: bold;">define-variable:*testing-string*</span>
  <span style="color: #e6db74;">"define-variable"</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #a1ab3a; font-weight: bold;">define-variable</span>
<span style="color: #fd971f; font-weight: bold;">define-variable:*testing-string*</span> .s <span style="color: #FF8888;">&lt;&lt; define-variable &gt;&gt;</span>

<span style="color: #FF8888;">&lt;&lt; error &gt;&gt;</span>
<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">kkk</span>
  <span style="color: #fd971f; font-weight: bold;">1</span> . <span style="color: #fd971f; font-weight: bold;">2</span> . <span style="color: #fd971f; font-weight: bold;">3</span> .
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #a1ab3a; font-weight: bold;">define-variable</span>

<span style="color: #FF8888;">&lt;&lt; error &gt;&gt;</span>
<span style="color: #fd971f; font-weight: bold;">1</span> <span style="color: #fd971f; font-weight: bold;">2</span> <span style="color: #fd971f; font-weight: bold;">3</span>
<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">kkk</span>
  . . .
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #a1ab3a; font-weight: bold;">define-variable</span>
</pre>
</div>
</div>
</div>
</div>


<div id="outline-container-orga23c480" class="outline-2">
<h2 id="orga23c480">system misc</h2>
<div class="outline-text-2" id="text-orga23c480">
</div><div id="outline-container-org6f4ff79" class="outline-3">
<h3 id="org6f4ff79"><span class="todo note">note</span> linux</h3>
</div>

<div id="outline-container-org5e04b51" class="outline-3">
<h3 id="org5e04b51">init-syscall-number&#xa0;&#xa0;&#xa0;<span class="tag"><span class="32bit">32bit</span></span></h3>
<div class="outline-text-3" id="text-org5e04b51">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #fd971f; font-weight: bold;">*cell-size*</span> <span style="color: #fd971f; font-weight: bold;">4</span> <span style="color: #ffffff; font-weight: bold;">equal?</span> <span style="color: #f92672; font-weight: bold;">if</span>
  <span style="color: #fd971f; font-weight: bold;">5</span>   <span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #fd971f; font-weight: bold;">syscall-number:*open*</span>       <span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #a1ab3a; font-weight: bold;">define-variable,with-tos</span>
  <span style="color: #fd971f; font-weight: bold;">6</span>   <span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #fd971f; font-weight: bold;">syscall-number:*close*</span>      <span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #a1ab3a; font-weight: bold;">define-variable,with-tos</span>
  <span style="color: #fd971f; font-weight: bold;">3</span>   <span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #fd971f; font-weight: bold;">syscall-number:*read*</span>       <span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #a1ab3a; font-weight: bold;">define-variable,with-tos</span>
  <span style="color: #fd971f; font-weight: bold;">4</span>   <span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #fd971f; font-weight: bold;">syscall-number:*write*</span>      <span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #a1ab3a; font-weight: bold;">define-variable,with-tos</span>
  <span style="color: #fd971f; font-weight: bold;">9</span>   <span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #fd971f; font-weight: bold;">syscall-number:*link*</span>       <span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #a1ab3a; font-weight: bold;">define-variable,with-tos</span>
  <span style="color: #fd971f; font-weight: bold;">10</span>  <span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #fd971f; font-weight: bold;">syscall-number:*unlink*</span>     <span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #a1ab3a; font-weight: bold;">define-variable,with-tos</span>
  <span style="color: #fd971f; font-weight: bold;">39</span>  <span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #fd971f; font-weight: bold;">syscall-number:*mkdir*</span>      <span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #a1ab3a; font-weight: bold;">define-variable,with-tos</span>
  <span style="color: #fd971f; font-weight: bold;">40</span>  <span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #fd971f; font-weight: bold;">syscall-number:*rmdir*</span>      <span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #a1ab3a; font-weight: bold;">define-variable,with-tos</span>
  <span style="color: #fd971f; font-weight: bold;">141</span> <span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #fd971f; font-weight: bold;">syscall-number:*getdents*</span>   <span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #a1ab3a; font-weight: bold;">define-variable,with-tos</span>
  <span style="color: #fd971f; font-weight: bold;">220</span> <span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #fd971f; font-weight: bold;">syscall-number:*getdents64*</span> <span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #a1ab3a; font-weight: bold;">define-variable,with-tos</span>
  <span style="color: #fd971f; font-weight: bold;">106</span> <span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #fd971f; font-weight: bold;">syscall-number:*stat*</span>       <span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #a1ab3a; font-weight: bold;">define-variable,with-tos</span>
  <span style="color: #fd971f; font-weight: bold;">1</span>   <span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #fd971f; font-weight: bold;">syscall-number:*exit*</span>       <span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #a1ab3a; font-weight: bold;">define-variable,with-tos</span>
  <span style="color: #fd971f; font-weight: bold;">43</span>  <span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #fd971f; font-weight: bold;">syscall-number:*times*</span>      <span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #a1ab3a; font-weight: bold;">define-variable,with-tos</span>
  <span style="color: #fd971f; font-weight: bold;">20</span>  <span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #fd971f; font-weight: bold;">syscall-number:*getpid*</span>     <span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #a1ab3a; font-weight: bold;">define-variable,with-tos</span>
  <span style="color: #fd971f; font-weight: bold;">183</span> <span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #fd971f; font-weight: bold;">syscall-number:*getcwd*</span>     <span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #a1ab3a; font-weight: bold;">define-variable,with-tos</span>
  <span style="color: #fd971f; font-weight: bold;">12</span>  <span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #fd971f; font-weight: bold;">syscall-number:*chdir*</span>      <span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #a1ab3a; font-weight: bold;">define-variable,with-tos</span>
<span style="color: #f92672; font-weight: bold;">then</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgcbc28e3" class="outline-3">
<h3 id="orgcbc28e3">init-syscall-number&#xa0;&#xa0;&#xa0;<span class="tag"><span class="64bit">64bit</span></span></h3>
<div class="outline-text-3" id="text-orgcbc28e3">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #fd971f; font-weight: bold;">*cell-size*</span> <span style="color: #fd971f; font-weight: bold;">8</span> <span style="color: #ffffff; font-weight: bold;">equal?</span> <span style="color: #f92672; font-weight: bold;">if</span>
  <span style="color: #fd971f; font-weight: bold;">2</span>   <span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #fd971f; font-weight: bold;">syscall-number:*open*</span>       <span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #a1ab3a; font-weight: bold;">define-variable,with-tos</span>
  <span style="color: #fd971f; font-weight: bold;">3</span>   <span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #fd971f; font-weight: bold;">syscall-number:*close*</span>      <span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #a1ab3a; font-weight: bold;">define-variable,with-tos</span>
  <span style="color: #fd971f; font-weight: bold;">0</span>   <span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #fd971f; font-weight: bold;">syscall-number:*read*</span>       <span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #a1ab3a; font-weight: bold;">define-variable,with-tos</span>
  <span style="color: #fd971f; font-weight: bold;">1</span>   <span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #fd971f; font-weight: bold;">syscall-number:*write*</span>      <span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #a1ab3a; font-weight: bold;">define-variable,with-tos</span>
  <span style="color: #fd971f; font-weight: bold;">86</span>  <span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #fd971f; font-weight: bold;">syscall-number:*link*</span>       <span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #a1ab3a; font-weight: bold;">define-variable,with-tos</span>
  <span style="color: #fd971f; font-weight: bold;">87</span>  <span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #fd971f; font-weight: bold;">syscall-number:*unlink*</span>     <span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #a1ab3a; font-weight: bold;">define-variable,with-tos</span>
  <span style="color: #fd971f; font-weight: bold;">83</span>  <span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #fd971f; font-weight: bold;">syscall-number:*mkdir*</span>      <span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #a1ab3a; font-weight: bold;">define-variable,with-tos</span>
  <span style="color: #fd971f; font-weight: bold;">84</span>  <span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #fd971f; font-weight: bold;">syscall-number:*rmdir*</span>      <span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #a1ab3a; font-weight: bold;">define-variable,with-tos</span>
  <span style="color: #fd971f; font-weight: bold;">78</span>  <span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #fd971f; font-weight: bold;">syscall-number:*getdents*</span>   <span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #a1ab3a; font-weight: bold;">define-variable,with-tos</span>
  <span style="color: #fd971f; font-weight: bold;">217</span> <span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #fd971f; font-weight: bold;">syscall-number:*getdents64*</span> <span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #a1ab3a; font-weight: bold;">define-variable,with-tos</span>
  <span style="color: #fd971f; font-weight: bold;">4</span>   <span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #fd971f; font-weight: bold;">syscall-number:*stat*</span>       <span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #a1ab3a; font-weight: bold;">define-variable,with-tos</span>
  <span style="color: #fd971f; font-weight: bold;">60</span>  <span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #fd971f; font-weight: bold;">syscall-number:*exit*</span>       <span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #a1ab3a; font-weight: bold;">define-variable,with-tos</span>
  <span style="color: #fd971f; font-weight: bold;">100</span> <span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #fd971f; font-weight: bold;">syscall-number:*times*</span>      <span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #a1ab3a; font-weight: bold;">define-variable,with-tos</span>
  <span style="color: #fd971f; font-weight: bold;">39</span>  <span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #fd971f; font-weight: bold;">syscall-number:*getpid*</span>     <span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #a1ab3a; font-weight: bold;">define-variable,with-tos</span>
  <span style="color: #fd971f; font-weight: bold;">79</span>  <span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #fd971f; font-weight: bold;">syscall-number:*getcwd*</span>     <span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #a1ab3a; font-weight: bold;">define-variable,with-tos</span>
  <span style="color: #fd971f; font-weight: bold;">80</span>  <span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #fd971f; font-weight: bold;">syscall-number:*chdir*</span>      <span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #a1ab3a; font-weight: bold;">define-variable,with-tos</span>
<span style="color: #f92672; font-weight: bold;">then</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org3dddc89" class="outline-3">
<h3 id="org3dddc89">error-code-&gt;string</h3>
<div class="outline-text-3" id="text-org3dddc89">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">error-code-&gt;string</span>
  <span style="color: #FF8888;">&lt;&lt; error-code -- string[address, length] &gt;&gt;</span>
  dup <span style="color: #fd971f; font-weight: bold;">-1</span>  <span style="color: #ffffff; font-weight: bold;">equal?</span> <span style="color: #f92672; font-weight: bold;">if</span> drop  <span style="color: #FF8888;">&lt;&lt; EPERM   &gt;&gt;</span>   <span style="color: #e6db74;">"Operation not permitted "</span> <span style="color: #00ffff; font-weight: bold;">end</span> <span style="color: #f92672; font-weight: bold;">then</span>
  dup <span style="color: #fd971f; font-weight: bold;">-2</span>  <span style="color: #ffffff; font-weight: bold;">equal?</span> <span style="color: #f92672; font-weight: bold;">if</span> drop  <span style="color: #FF8888;">&lt;&lt; ENOENT  &gt;&gt;</span>   <span style="color: #e6db74;">"No such file or directory "</span> <span style="color: #00ffff; font-weight: bold;">end</span> <span style="color: #f92672; font-weight: bold;">then</span>
  dup <span style="color: #fd971f; font-weight: bold;">-3</span>  <span style="color: #ffffff; font-weight: bold;">equal?</span> <span style="color: #f92672; font-weight: bold;">if</span> drop  <span style="color: #FF8888;">&lt;&lt; ESRCH   &gt;&gt;</span>   <span style="color: #e6db74;">"No such process "</span> <span style="color: #00ffff; font-weight: bold;">end</span> <span style="color: #f92672; font-weight: bold;">then</span>
  dup <span style="color: #fd971f; font-weight: bold;">-4</span>  <span style="color: #ffffff; font-weight: bold;">equal?</span> <span style="color: #f92672; font-weight: bold;">if</span> drop  <span style="color: #FF8888;">&lt;&lt; EINTR   &gt;&gt;</span>   <span style="color: #e6db74;">"Interrupted system call "</span> <span style="color: #00ffff; font-weight: bold;">end</span> <span style="color: #f92672; font-weight: bold;">then</span>
  dup <span style="color: #fd971f; font-weight: bold;">-5</span>  <span style="color: #ffffff; font-weight: bold;">equal?</span> <span style="color: #f92672; font-weight: bold;">if</span> drop  <span style="color: #FF8888;">&lt;&lt; EIO     &gt;&gt;</span>   <span style="color: #e6db74;">"I/O error "</span> <span style="color: #00ffff; font-weight: bold;">end</span> <span style="color: #f92672; font-weight: bold;">then</span>
  dup <span style="color: #fd971f; font-weight: bold;">-6</span>  <span style="color: #ffffff; font-weight: bold;">equal?</span> <span style="color: #f92672; font-weight: bold;">if</span> drop  <span style="color: #FF8888;">&lt;&lt; ENXIO   &gt;&gt;</span>   <span style="color: #e6db74;">"No such device or address "</span> <span style="color: #00ffff; font-weight: bold;">end</span> <span style="color: #f92672; font-weight: bold;">then</span>
  dup <span style="color: #fd971f; font-weight: bold;">-7</span>  <span style="color: #ffffff; font-weight: bold;">equal?</span> <span style="color: #f92672; font-weight: bold;">if</span> drop  <span style="color: #FF8888;">&lt;&lt; E2BIG   &gt;&gt;</span>   <span style="color: #e6db74;">"Argument list too long "</span> <span style="color: #00ffff; font-weight: bold;">end</span> <span style="color: #f92672; font-weight: bold;">then</span>
  dup <span style="color: #fd971f; font-weight: bold;">-8</span>  <span style="color: #ffffff; font-weight: bold;">equal?</span> <span style="color: #f92672; font-weight: bold;">if</span> drop  <span style="color: #FF8888;">&lt;&lt; ENOEXEC &gt;&gt;</span>   <span style="color: #e6db74;">"Exec format error "</span> <span style="color: #00ffff; font-weight: bold;">end</span> <span style="color: #f92672; font-weight: bold;">then</span>
  dup <span style="color: #fd971f; font-weight: bold;">-9</span>  <span style="color: #ffffff; font-weight: bold;">equal?</span> <span style="color: #f92672; font-weight: bold;">if</span> drop  <span style="color: #FF8888;">&lt;&lt; EBADF   &gt;&gt;</span>   <span style="color: #e6db74;">"Bad file number "</span> <span style="color: #00ffff; font-weight: bold;">end</span> <span style="color: #f92672; font-weight: bold;">then</span>
  dup <span style="color: #fd971f; font-weight: bold;">-10</span> <span style="color: #ffffff; font-weight: bold;">equal?</span> <span style="color: #f92672; font-weight: bold;">if</span> drop  <span style="color: #FF8888;">&lt;&lt; ECHILD  &gt;&gt;</span>   <span style="color: #e6db74;">"No child processes "</span> <span style="color: #00ffff; font-weight: bold;">end</span> <span style="color: #f92672; font-weight: bold;">then</span>
  dup <span style="color: #fd971f; font-weight: bold;">-11</span> <span style="color: #ffffff; font-weight: bold;">equal?</span> <span style="color: #f92672; font-weight: bold;">if</span> drop  <span style="color: #FF8888;">&lt;&lt; EAGAIN  &gt;&gt;</span>   <span style="color: #e6db74;">"Try again "</span> <span style="color: #00ffff; font-weight: bold;">end</span> <span style="color: #f92672; font-weight: bold;">then</span>
  dup <span style="color: #fd971f; font-weight: bold;">-12</span> <span style="color: #ffffff; font-weight: bold;">equal?</span> <span style="color: #f92672; font-weight: bold;">if</span> drop  <span style="color: #FF8888;">&lt;&lt; ENOMEM  &gt;&gt;</span>   <span style="color: #e6db74;">"Out of memory "</span> <span style="color: #00ffff; font-weight: bold;">end</span> <span style="color: #f92672; font-weight: bold;">then</span>
  dup <span style="color: #fd971f; font-weight: bold;">-13</span> <span style="color: #ffffff; font-weight: bold;">equal?</span> <span style="color: #f92672; font-weight: bold;">if</span> drop  <span style="color: #FF8888;">&lt;&lt; EACCES  &gt;&gt;</span>   <span style="color: #e6db74;">"Permission denied "</span> <span style="color: #00ffff; font-weight: bold;">end</span> <span style="color: #f92672; font-weight: bold;">then</span>
  dup <span style="color: #fd971f; font-weight: bold;">-14</span> <span style="color: #ffffff; font-weight: bold;">equal?</span> <span style="color: #f92672; font-weight: bold;">if</span> drop  <span style="color: #FF8888;">&lt;&lt; EFAULT  &gt;&gt;</span>   <span style="color: #e6db74;">"Bad address "</span> <span style="color: #00ffff; font-weight: bold;">end</span> <span style="color: #f92672; font-weight: bold;">then</span>
  dup <span style="color: #fd971f; font-weight: bold;">-15</span> <span style="color: #ffffff; font-weight: bold;">equal?</span> <span style="color: #f92672; font-weight: bold;">if</span> drop  <span style="color: #FF8888;">&lt;&lt; ENOTBLK &gt;&gt;</span>   <span style="color: #e6db74;">"Block device required "</span> <span style="color: #00ffff; font-weight: bold;">end</span> <span style="color: #f92672; font-weight: bold;">then</span>
  dup <span style="color: #fd971f; font-weight: bold;">-16</span> <span style="color: #ffffff; font-weight: bold;">equal?</span> <span style="color: #f92672; font-weight: bold;">if</span> drop  <span style="color: #FF8888;">&lt;&lt; EBUSY   &gt;&gt;</span>   <span style="color: #e6db74;">"Device or resource busy "</span> <span style="color: #00ffff; font-weight: bold;">end</span> <span style="color: #f92672; font-weight: bold;">then</span>
  dup <span style="color: #fd971f; font-weight: bold;">-17</span> <span style="color: #ffffff; font-weight: bold;">equal?</span> <span style="color: #f92672; font-weight: bold;">if</span> drop  <span style="color: #FF8888;">&lt;&lt; EEXIST  &gt;&gt;</span>   <span style="color: #e6db74;">"File exists "</span> <span style="color: #00ffff; font-weight: bold;">end</span> <span style="color: #f92672; font-weight: bold;">then</span>
  dup <span style="color: #fd971f; font-weight: bold;">-18</span> <span style="color: #ffffff; font-weight: bold;">equal?</span> <span style="color: #f92672; font-weight: bold;">if</span> drop  <span style="color: #FF8888;">&lt;&lt; EXDEV   &gt;&gt;</span>   <span style="color: #e6db74;">"Cross-device link "</span> <span style="color: #00ffff; font-weight: bold;">end</span> <span style="color: #f92672; font-weight: bold;">then</span>
  dup <span style="color: #fd971f; font-weight: bold;">-19</span> <span style="color: #ffffff; font-weight: bold;">equal?</span> <span style="color: #f92672; font-weight: bold;">if</span> drop  <span style="color: #FF8888;">&lt;&lt; ENODEV  &gt;&gt;</span>   <span style="color: #e6db74;">"No such device "</span> <span style="color: #00ffff; font-weight: bold;">end</span> <span style="color: #f92672; font-weight: bold;">then</span>
  dup <span style="color: #fd971f; font-weight: bold;">-20</span> <span style="color: #ffffff; font-weight: bold;">equal?</span> <span style="color: #f92672; font-weight: bold;">if</span> drop  <span style="color: #FF8888;">&lt;&lt; ENOTDIR &gt;&gt;</span>   <span style="color: #e6db74;">"Not a directory "</span> <span style="color: #00ffff; font-weight: bold;">end</span> <span style="color: #f92672; font-weight: bold;">then</span>
  dup <span style="color: #fd971f; font-weight: bold;">-21</span> <span style="color: #ffffff; font-weight: bold;">equal?</span> <span style="color: #f92672; font-weight: bold;">if</span> drop  <span style="color: #FF8888;">&lt;&lt; EISDIR  &gt;&gt;</span>   <span style="color: #e6db74;">"Is a directory "</span> <span style="color: #00ffff; font-weight: bold;">end</span> <span style="color: #f92672; font-weight: bold;">then</span>
  dup <span style="color: #fd971f; font-weight: bold;">-22</span> <span style="color: #ffffff; font-weight: bold;">equal?</span> <span style="color: #f92672; font-weight: bold;">if</span> drop  <span style="color: #FF8888;">&lt;&lt; EINVAL  &gt;&gt;</span>   <span style="color: #e6db74;">"Invalid argument "</span> <span style="color: #00ffff; font-weight: bold;">end</span> <span style="color: #f92672; font-weight: bold;">then</span>
  dup <span style="color: #fd971f; font-weight: bold;">-23</span> <span style="color: #ffffff; font-weight: bold;">equal?</span> <span style="color: #f92672; font-weight: bold;">if</span> drop  <span style="color: #FF8888;">&lt;&lt; ENFILE  &gt;&gt;</span>   <span style="color: #e6db74;">"File table overflow "</span> <span style="color: #00ffff; font-weight: bold;">end</span> <span style="color: #f92672; font-weight: bold;">then</span>
  dup <span style="color: #fd971f; font-weight: bold;">-24</span> <span style="color: #ffffff; font-weight: bold;">equal?</span> <span style="color: #f92672; font-weight: bold;">if</span> drop  <span style="color: #FF8888;">&lt;&lt; EMFILE  &gt;&gt;</span>   <span style="color: #e6db74;">"Too many open files "</span> <span style="color: #00ffff; font-weight: bold;">end</span> <span style="color: #f92672; font-weight: bold;">then</span>
  dup <span style="color: #fd971f; font-weight: bold;">-25</span> <span style="color: #ffffff; font-weight: bold;">equal?</span> <span style="color: #f92672; font-weight: bold;">if</span> drop  <span style="color: #FF8888;">&lt;&lt; ENOTTY  &gt;&gt;</span>   <span style="color: #e6db74;">"Not a typewriter "</span> <span style="color: #00ffff; font-weight: bold;">end</span> <span style="color: #f92672; font-weight: bold;">then</span>
  dup <span style="color: #fd971f; font-weight: bold;">-26</span> <span style="color: #ffffff; font-weight: bold;">equal?</span> <span style="color: #f92672; font-weight: bold;">if</span> drop  <span style="color: #FF8888;">&lt;&lt; ETXTBSY &gt;&gt;</span>   <span style="color: #e6db74;">"Text file busy "</span> <span style="color: #00ffff; font-weight: bold;">end</span> <span style="color: #f92672; font-weight: bold;">then</span>
  dup <span style="color: #fd971f; font-weight: bold;">-27</span> <span style="color: #ffffff; font-weight: bold;">equal?</span> <span style="color: #f92672; font-weight: bold;">if</span> drop  <span style="color: #FF8888;">&lt;&lt; EFBIG   &gt;&gt;</span>   <span style="color: #e6db74;">"File too large "</span> <span style="color: #00ffff; font-weight: bold;">end</span> <span style="color: #f92672; font-weight: bold;">then</span>
  dup <span style="color: #fd971f; font-weight: bold;">-28</span> <span style="color: #ffffff; font-weight: bold;">equal?</span> <span style="color: #f92672; font-weight: bold;">if</span> drop  <span style="color: #FF8888;">&lt;&lt; ENOSPC  &gt;&gt;</span>   <span style="color: #e6db74;">"No space left on device "</span> <span style="color: #00ffff; font-weight: bold;">end</span> <span style="color: #f92672; font-weight: bold;">then</span>
  dup <span style="color: #fd971f; font-weight: bold;">-29</span> <span style="color: #ffffff; font-weight: bold;">equal?</span> <span style="color: #f92672; font-weight: bold;">if</span> drop  <span style="color: #FF8888;">&lt;&lt; ESPIPE  &gt;&gt;</span>   <span style="color: #e6db74;">"Illegal seek "</span> <span style="color: #00ffff; font-weight: bold;">end</span> <span style="color: #f92672; font-weight: bold;">then</span>
  dup <span style="color: #fd971f; font-weight: bold;">-30</span> <span style="color: #ffffff; font-weight: bold;">equal?</span> <span style="color: #f92672; font-weight: bold;">if</span> drop  <span style="color: #FF8888;">&lt;&lt; EROFS   &gt;&gt;</span>   <span style="color: #e6db74;">"Read-only file system "</span> <span style="color: #00ffff; font-weight: bold;">end</span> <span style="color: #f92672; font-weight: bold;">then</span>
  dup <span style="color: #fd971f; font-weight: bold;">-31</span> <span style="color: #ffffff; font-weight: bold;">equal?</span> <span style="color: #f92672; font-weight: bold;">if</span> drop  <span style="color: #FF8888;">&lt;&lt; EMLINK  &gt;&gt;</span>   <span style="color: #e6db74;">"Too many links "</span> <span style="color: #00ffff; font-weight: bold;">end</span> <span style="color: #f92672; font-weight: bold;">then</span>
  dup <span style="color: #fd971f; font-weight: bold;">-32</span> <span style="color: #ffffff; font-weight: bold;">equal?</span> <span style="color: #f92672; font-weight: bold;">if</span> drop  <span style="color: #FF8888;">&lt;&lt; EPIPE   &gt;&gt;</span>   <span style="color: #e6db74;">"Broken pipe "</span> <span style="color: #00ffff; font-weight: bold;">end</span> <span style="color: #f92672; font-weight: bold;">then</span>
  dup <span style="color: #fd971f; font-weight: bold;">-33</span> <span style="color: #ffffff; font-weight: bold;">equal?</span> <span style="color: #f92672; font-weight: bold;">if</span> drop  <span style="color: #FF8888;">&lt;&lt; EDOM    &gt;&gt;</span>   <span style="color: #e6db74;">"Math argument out of domain of func "</span> <span style="color: #00ffff; font-weight: bold;">end</span> <span style="color: #f92672; font-weight: bold;">then</span>
  dup <span style="color: #fd971f; font-weight: bold;">-34</span> <span style="color: #ffffff; font-weight: bold;">equal?</span> <span style="color: #f92672; font-weight: bold;">if</span> drop  <span style="color: #FF8888;">&lt;&lt; ERANGE  &gt;&gt;</span>   <span style="color: #e6db74;">"Math result not representable "</span> <span style="color: #00ffff; font-weight: bold;">end</span> <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #e6db74;">"unknow error-code : "</span> .s .i .l
  <span style="color: #e6db74;">"* (error-code-&gt;string) fail"</span> <span style="color: #FF8888;">&lt;&lt; to balance the argument-stack &gt;&gt;</span>
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org1da1365" class="outline-3">
<h3 id="org1da1365">file-type-code-&gt;string</h3>
<div class="outline-text-3" id="text-org1da1365">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">file-type-code-&gt;string</span>
  <span style="color: #FF8888;">&lt;&lt; file-type-code -- string[address, length] &gt;&gt;</span>
  dup <span style="color: #fd971f; font-weight: bold;">1</span>  <span style="color: #ffffff; font-weight: bold;">equal?</span>  <span style="color: #FF8888;">&lt;&lt; DT_FIFO  &gt;&gt;</span>  <span style="color: #f92672; font-weight: bold;">if</span> drop <span style="color: #e6db74;">"named pipe i.e. FIFO"</span>  <span style="color: #00ffff; font-weight: bold;">end</span> <span style="color: #f92672; font-weight: bold;">then</span>
  dup <span style="color: #fd971f; font-weight: bold;">2</span>  <span style="color: #ffffff; font-weight: bold;">equal?</span>  <span style="color: #FF8888;">&lt;&lt; DT_CHR   &gt;&gt;</span>  <span style="color: #f92672; font-weight: bold;">if</span> drop <span style="color: #e6db74;">"Character device"</span>      <span style="color: #00ffff; font-weight: bold;">end</span> <span style="color: #f92672; font-weight: bold;">then</span>
  dup <span style="color: #fd971f; font-weight: bold;">4</span>  <span style="color: #ffffff; font-weight: bold;">equal?</span>  <span style="color: #FF8888;">&lt;&lt; DT_DIR   &gt;&gt;</span>  <span style="color: #f92672; font-weight: bold;">if</span> drop <span style="color: #e6db74;">"directory"</span>             <span style="color: #00ffff; font-weight: bold;">end</span> <span style="color: #f92672; font-weight: bold;">then</span>
  dup <span style="color: #fd971f; font-weight: bold;">6</span>  <span style="color: #ffffff; font-weight: bold;">equal?</span>  <span style="color: #FF8888;">&lt;&lt; DT_BLK   &gt;&gt;</span>  <span style="color: #f92672; font-weight: bold;">if</span> drop <span style="color: #e6db74;">"block device"</span>          <span style="color: #00ffff; font-weight: bold;">end</span> <span style="color: #f92672; font-weight: bold;">then</span>
  dup <span style="color: #fd971f; font-weight: bold;">8</span>  <span style="color: #ffffff; font-weight: bold;">equal?</span>  <span style="color: #FF8888;">&lt;&lt; DT_REG   &gt;&gt;</span>  <span style="color: #f92672; font-weight: bold;">if</span> drop <span style="color: #e6db74;">"regular file"</span>          <span style="color: #00ffff; font-weight: bold;">end</span> <span style="color: #f92672; font-weight: bold;">then</span>
  dup <span style="color: #fd971f; font-weight: bold;">10</span> <span style="color: #ffffff; font-weight: bold;">equal?</span>  <span style="color: #FF8888;">&lt;&lt; DT_LNK   &gt;&gt;</span>  <span style="color: #f92672; font-weight: bold;">if</span> drop <span style="color: #e6db74;">"symbolic link"</span>         <span style="color: #00ffff; font-weight: bold;">end</span> <span style="color: #f92672; font-weight: bold;">then</span>
  dup <span style="color: #fd971f; font-weight: bold;">12</span> <span style="color: #ffffff; font-weight: bold;">equal?</span>  <span style="color: #FF8888;">&lt;&lt; DT_SOCK  &gt;&gt;</span>  <span style="color: #f92672; font-weight: bold;">if</span> drop <span style="color: #e6db74;">"UNIX domain socket"</span>    <span style="color: #00ffff; font-weight: bold;">end</span> <span style="color: #f92672; font-weight: bold;">then</span>
  drop
  <span style="color: #e6db74;">"unknow file type"</span>
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org2069433" class="outline-2">
<h2 id="org2069433">port</h2>
<div class="outline-text-2" id="text-org2069433">
</div><div id="outline-container-org3784383" class="outline-3">
<h3 id="org3784383"><span class="todo _">記</span> 關於輸入輸出</h3>
<div class="outline-text-3" id="text-org3784383">
<ul class="org-ul">
<li><p>接口設計分兩個層次</p><p><ol class="org-ol"></p><p><li>底層的以 port 爲基礎的接口</p><p>這裏應該如何設計還不確定</p><p>可能會模仿操作系統所提供的接口</li></p><p><li>高層的以 path 爲基礎的接口</p><p>這裏將抽象掉 port 這個概念</p><p>也就是每次簡單的讀寫都伴隨兩個對 port 的操作</p><p>這樣接口就很簡單 但是速度可能會非常慢</li></ol></p></li>
<li><p>目前</p><p>二者的接口差異是通過前綴 port:體現出來的</p></li></ul>
</div>
</div>

<div id="outline-container-org7738662" class="outline-3">
<h3 id="org7738662"><span class="todo note">note</span> linux header</h3>
<div class="outline-text-3" id="text-org7738662">
<ul class="org-ul">
<li><p>8 base number :</p><p>O_ACCMODE          0003</p><p>O_RDONLY             00</p><p>O_WRONLY             01</p><p>O_RDWR               02</p><p>O_CREAT            0100  Not fcntl</p><p>O_EXCL             0200  Not fcntl</p><p>O_NOCTTY           0400  Not fcntl</p><p>O_TRUNC           01000  Not fcntl</p><p>O_APPEND          02000</p><p>O_NONBLOCK        04000</p><p>O_NDELAY     O_NONBLOCK</p><p>O_SYNC         04010000</p><p>O_FSYNC          O_SYNC</p><p>O_ASYNC          020000</p><p>O_LARGEFILE     0100000</p><p>O_DIRECTORY     0200000</p><p>O_NOFOLLOW      0400000</p><p>O_CLOEXEC      02000000</p><p>O_DIRECT         040000</p><p>O_NOATIME      01000000</p><p>O_PATH        010000000</p><p>O_DSYNC          010000</p><p>O_TMPFILE     020200000</p></li></ul>
</div>
</div>

<div id="outline-container-org919be60" class="outline-3">
<h3 id="org919be60"><span class="todo note">note</span> interface</h3>
<div class="outline-text-3" id="text-org919be60">
<ul class="org-ul">
<li><p>open to read</p></li>
<li><p><p></p><p>create and update to write</p><p></p></p><p><table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides"></p><p></p><p></p><p><colgroup></p><p><col  class="org-left" /></p><p></p><p><col  class="org-left" /></p><p></colgroup></p><p><tbody></p><p><tr></p><p><td class="org-left">create</td></p><p><td class="org-left">fail if already exist</td></p><p></tr></p><p></p><p><tr></p><p><td class="org-left">update</td></p><p><td class="org-left">fail if nor exist</td></p><p></tr></p><p></tbody></p><p></table></p></li>
<li><p>one should always know if a file exist or not</p><p>when open it as output-port</p><p>predicates are provided to help you to do so</p></li></ul>
</div>
</div>

<div id="outline-container-org9ac93c7" class="outline-3">
<h3 id="org9ac93c7"><span class="todo note">note</span> syscall with string arguments</h3>
<div class="outline-text-3" id="text-org9ac93c7">
<ul class="org-ul">
<li><p>for syscall the arguments in stack look like</p><p>&lt;&lt; &#x2026;, arg3, arg2, arg1 &gt;&gt;</p><p>so</p><p>for read(port, buffer, size)</p><p>we need</p><p>&lt;&lt; size, buffer, port &gt;&gt;</p><p>but the interface (port:read) in cicada-nymph is</p><p>&lt;&lt; buffer, size, port &gt;&gt;</p><p>thus we need a swap here</p><p>and</p><p>we should be careful</p><p>for other interface functions in cicada-nymph</p></li></ul>
</div>
</div>

<div id="outline-container-org882c8da" class="outline-3">
<h3 id="org882c8da">port:open</h3>
<div class="outline-text-3" id="text-org882c8da">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">port:open</span>
  <span style="color: #FF8888;">&lt;&lt; path[address, length]</span>
<span style="color: #FF8888;">     -- port, true</span>
<span style="color: #FF8888;">     -- error-code, false &gt;&gt;</span>
  string<span style="color: #b0b1a3;">-&gt;</span>syscall-string
  <span style="color: #FF4C4C; font-weight: bold;">&gt;:syscall-path</span>
  <span style="color: #fd971f; font-weight: bold;">0</span> <span style="color: #FF8888;">&lt;&lt;</span>
<span style="color: #FF8888;">  O_RDONLY</span>
<span style="color: #FF8888;">  &gt;&gt;</span>
  <span style="color: #83EA83; font-weight: bold;">:syscall-path</span>
  <span style="color: #fd971f; font-weight: bold;">syscall-number:*open*</span>
  <span style="color: #fd971f; font-weight: bold;">2</span> syscall
  dup
  <span style="color: #ffffff; font-weight: bold;">negative?</span> <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #fd971f; font-weight: bold;">false</span>
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #fd971f; font-weight: bold;">true</span>
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org774bdfd" class="outline-3">
<h3 id="org774bdfd">port:create</h3>
<div class="outline-text-3" id="text-org774bdfd">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">port:create</span>
  <span style="color: #FF8888;">&lt;&lt; path[address, length]</span>
<span style="color: #FF8888;">     -- port, true</span>
<span style="color: #FF8888;">     -- error-code, false &gt;&gt;</span>
  string<span style="color: #b0b1a3;">-&gt;</span>syscall-string
  <span style="color: #FF4C4C; font-weight: bold;">&gt;:syscall-path</span>
  <span style="color: #fd971f; font-weight: bold;">8</span><span style="color: #ffff00;">#</span><span style="color: #fd971f; font-weight: bold;">644</span> <span style="color: #FF8888;">&lt;&lt;</span>
<span style="color: #FF8888;">  2#110100100</span>
<span style="color: #FF8888;">  &gt;&gt;</span>
  <span style="color: #fd971f; font-weight: bold;">8</span><span style="color: #ffff00;">#</span><span style="color: #fd971f; font-weight: bold;">1102</span> <span style="color: #FF8888;">&lt;&lt;</span>
<span style="color: #FF8888;">  O_RDWR   0002</span>
<span style="color: #FF8888;">  O_CREAT  0100</span>
<span style="color: #FF8888;">  O_TRUNC  1000</span>
<span style="color: #FF8888;">  &gt;&gt;</span>
  <span style="color: #83EA83; font-weight: bold;">:syscall-path</span>
  <span style="color: #fd971f; font-weight: bold;">syscall-number:*open*</span>
  <span style="color: #fd971f; font-weight: bold;">3</span> syscall
  dup
  <span style="color: #ffffff; font-weight: bold;">negative?</span> <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #fd971f; font-weight: bold;">false</span>
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #fd971f; font-weight: bold;">true</span>
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd222dc0" class="outline-3">
<h3 id="orgd222dc0">port:update</h3>
<div class="outline-text-3" id="text-orgd222dc0">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">port:update</span>
  <span style="color: #FF8888;">&lt;&lt; path[address, length]</span>
<span style="color: #FF8888;">     -- port, true</span>
<span style="color: #FF8888;">     -- error-code, false &gt;&gt;</span>
  string<span style="color: #b0b1a3;">-&gt;</span>syscall-string
  <span style="color: #FF4C4C; font-weight: bold;">&gt;:syscall-path</span>
  <span style="color: #fd971f; font-weight: bold;">8</span><span style="color: #ffff00;">#</span><span style="color: #fd971f; font-weight: bold;">644</span> <span style="color: #FF8888;">&lt;&lt;</span>
<span style="color: #FF8888;">  110100100b</span>
<span style="color: #FF8888;">  &gt;&gt;</span>
  <span style="color: #fd971f; font-weight: bold;">8</span><span style="color: #ffff00;">#</span><span style="color: #fd971f; font-weight: bold;">1002</span> <span style="color: #FF8888;">&lt;&lt;</span>
<span style="color: #FF8888;">  O_RDWR   0002</span>
<span style="color: #FF8888;">  O_TRUNC  1000</span>
<span style="color: #FF8888;">  &gt;&gt;</span>
  <span style="color: #83EA83; font-weight: bold;">:syscall-path</span>
  <span style="color: #fd971f; font-weight: bold;">syscall-number:*open*</span>
  <span style="color: #fd971f; font-weight: bold;">3</span> syscall
  dup
  <span style="color: #ffffff; font-weight: bold;">negative?</span> <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #fd971f; font-weight: bold;">false</span>
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #fd971f; font-weight: bold;">true</span>
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org92121cd" class="outline-3">
<h3 id="org92121cd">port:close</h3>
<div class="outline-text-3" id="text-org92121cd">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">port:close</span>
  <span style="color: #FF8888;">&lt;&lt; port</span>
<span style="color: #FF8888;">     -- true</span>
<span style="color: #FF8888;">     -- error-code, false &gt;&gt;</span>
  <span style="color: #fd971f; font-weight: bold;">syscall-number:*close*</span>
  <span style="color: #fd971f; font-weight: bold;">1</span> syscall
  dup
  <span style="color: #ffffff; font-weight: bold;">negative?</span> <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #fd971f; font-weight: bold;">false</span>
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  drop <span style="color: #fd971f; font-weight: bold;">true</span>
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org8f80526" class="outline-3">
<h3 id="org8f80526">port:read</h3>
<div class="outline-text-3" id="text-org8f80526">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">port:read</span>
  <span style="color: #FF8888;">&lt;&lt; buffer, max-size, port</span>
<span style="color: #FF8888;">     -- counter, true</span>
<span style="color: #FF8888;">     -- error-code, false &gt;&gt;</span>
  <span style="color: #FF4C4C; font-weight: bold;">&gt;:port</span>
  swap
  <span style="color: #83EA83; font-weight: bold;">:port</span>
  <span style="color: #fd971f; font-weight: bold;">syscall-number:*read*</span>
  <span style="color: #fd971f; font-weight: bold;">3</span> syscall
  dup
  <span style="color: #ffffff; font-weight: bold;">negative?</span> <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #fd971f; font-weight: bold;">false</span>
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #fd971f; font-weight: bold;">true</span>
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org572bad4" class="outline-3">
<h3 id="org572bad4">port:write</h3>
<div class="outline-text-3" id="text-org572bad4">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">port:write</span>
  <span style="color: #FF8888;">&lt;&lt; buffer, max-size, port</span>
<span style="color: #FF8888;">     -- counter, true</span>
<span style="color: #FF8888;">     -- error-code, false &gt;&gt;</span>
  <span style="color: #FF4C4C; font-weight: bold;">&gt;:port</span>
  swap
  <span style="color: #83EA83; font-weight: bold;">:port</span>
  <span style="color: #fd971f; font-weight: bold;">syscall-number:*write*</span>
  <span style="color: #fd971f; font-weight: bold;">3</span> syscall
  dup
  <span style="color: #ffffff; font-weight: bold;">negative?</span> <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #fd971f; font-weight: bold;">false</span>
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #fd971f; font-weight: bold;">true</span>
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org6215533" class="outline-3">
<h3 id="org6215533"><span class="done test">test</span> </h3>
<div class="outline-text-3" id="text-org6215533">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">k</span>
  <span style="color: #FF8888;">&lt;&lt; -- &gt;&gt;</span>
  <span style="color: #e6db74;">"kkk~"</span> <span style="color: #ffffff; font-weight: bold;">port:</span>create <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #ffffff; font-weight: bold;">port:</span>close <span style="color: #f92672; font-weight: bold;">if</span>
      <span style="color: #00ffff; font-weight: bold;">end</span>
    <span style="color: #f92672; font-weight: bold;">then</span> error-code<span style="color: #b0b1a3;">-&gt;</span>string .s .l <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span> error-code<span style="color: #b0b1a3;">-&gt;</span>string .s .l <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
k

<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">k</span>
  <span style="color: #FF8888;">&lt;&lt; -- &gt;&gt;</span>
  <span style="color: #e6db74;">"kkk~"</span> <span style="color: #ffffff; font-weight: bold;">port:</span>update <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #ffffff; font-weight: bold;">port:</span>close <span style="color: #f92672; font-weight: bold;">if</span>
      <span style="color: #00ffff; font-weight: bold;">end</span>
    <span style="color: #f92672; font-weight: bold;">then</span> error-code<span style="color: #b0b1a3;">-&gt;</span>string .s .l <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span> error-code<span style="color: #b0b1a3;">-&gt;</span>string .s .l <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
k

<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">k</span>
  <span style="color: #FF8888;">&lt;&lt; -- &gt;&gt;</span>
  <span style="color: #fd971f; font-weight: bold;">64</span> <span style="color: #AE7C3B; font-weight: bold;">allocate-local-memory</span>
  dup
  <span style="color: #e6db74;">"kkk~"</span> <span style="color: #ffffff; font-weight: bold;">port:</span>open <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #fd971f; font-weight: bold;">64</span> swap <span style="color: #ffffff; font-weight: bold;">port:</span>read <span style="color: #f92672; font-weight: bold;">if</span>
      .s .l
      <span style="color: #00ffff; font-weight: bold;">end</span>
    <span style="color: #f92672; font-weight: bold;">then</span> error-code<span style="color: #b0b1a3;">-&gt;</span>string .s .l <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span> error-code<span style="color: #b0b1a3;">-&gt;</span>string .s .l <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
k
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgb173f6e" class="outline-2">
<h2 id="orgb173f6e">file</h2>
<div class="outline-text-2" id="text-orgb173f6e">
</div><div id="outline-container-org387d701" class="outline-3">
<h3 id="org387d701"><span class="todo note">note</span> interface</h3>
<div class="outline-text-3" id="text-org387d701">
<ul class="org-ul">
<li><p>note that</p><p>the concept of port is</p><p>completely removed from the interface</p></li>
<li><p><p></p><p>file-tree</p><p>two types of nodes</p><p></p></p><p><ol class="org-ol"></p><p><li>file</li></p><p><li>directory</li></ol></p><p><p></p><p>a leaf must be a file</p><p></p></p></li>
<li><p>the interface</p><p><ol class="org-ol"></p><p><li>use path as an argument</li></p><p><li>print error message on error</p><p>instead of</p><p>return error info</p><p>or do non-local-exit</li></ol></p></li></ul>
</div>
</div>

<div id="outline-container-orgb6b95b9" class="outline-3">
<h3 id="orgb6b95b9"><span class="todo _">記</span> 元數據</h3>
<div class="outline-text-3" id="text-orgb6b95b9">
<ul class="org-ul">
<li><p>訪問管理</p><p><ol class="org-ol"></p><p><li>誰有權訪問這個文件</li></p><p><li>他的權利是什麼</li></ol></p></li>
<li><p>文件類型</p><p>[linux 沒有]</p></li>
<li><p>文件大小</p></li>
<li><p>文件使用註釋</p><p>[linux 沒有]</p></li></ul>
</div>
</div>

<div id="outline-container-orgfc64b28" class="outline-3">
<h3 id="orgfc64b28"><a href="create">create</a></h3>
<div class="outline-text-3" id="text-orgfc64b28">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">file:create</span>
  <span style="color: #FF8888;">&lt;&lt; path[address, length] -- &gt;&gt;</span>
  <span style="color: #dc322f; font-weight: bold;">&gt;::path</span>
  <span style="color: #5CDD5C; font-weight: bold;">::path</span>
  string<span style="color: #b0b1a3;">-&gt;</span>syscall-string
  <span style="color: #FF4C4C; font-weight: bold;">&gt;:syscall-path</span>
  <span style="color: #fd971f; font-weight: bold;">8</span><span style="color: #ffff00;">#</span><span style="color: #fd971f; font-weight: bold;">644</span> <span style="color: #FF8888;">&lt;&lt;</span>
<span style="color: #FF8888;">  2#110100100</span>
<span style="color: #FF8888;">  &gt;&gt;</span>
  <span style="color: #fd971f; font-weight: bold;">8</span><span style="color: #ffff00;">#</span><span style="color: #fd971f; font-weight: bold;">0200</span>
  <span style="color: #fd971f; font-weight: bold;">8</span><span style="color: #ffff00;">#</span><span style="color: #fd971f; font-weight: bold;">0100</span> bit-or <span style="color: #FF8888;">&lt;&lt;</span>
<span style="color: #FF8888;">  O_EXCL   0200</span>
<span style="color: #FF8888;">  O_CREAT  0100</span>
<span style="color: #FF8888;">  &gt;&gt;</span>
  <span style="color: #83EA83; font-weight: bold;">:syscall-path</span>
  <span style="color: #fd971f; font-weight: bold;">syscall-number:*open*</span>
  <span style="color: #fd971f; font-weight: bold;">3</span> syscall
  dup
  <span style="color: #ffffff; font-weight: bold;">negative?</span> <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #e6db74;">"* (file:create) fail to open port for the following path :"</span> .s .l
    <span style="color: #e6db74;">"  "</span> .s <span style="color: #5CDD5C; font-weight: bold;">::path</span> .s .l
    <span style="color: #e6db74;">"  "</span> .s error-code<span style="color: #b0b1a3;">-&gt;</span>string .s .l
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #ffffff; font-weight: bold;">port:</span>close <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #e6db74;">"* (file:create) fail to close port for the following path :"</span> .s .l
  <span style="color: #e6db74;">"  "</span> .s <span style="color: #5CDD5C; font-weight: bold;">::path</span> .s .l
  <span style="color: #e6db74;">"  "</span> .s error-code<span style="color: #b0b1a3;">-&gt;</span>string .s .l
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc65f64d" class="outline-3">
<h3 id="orgc65f64d"><a href="write">write</a></h3>
<div class="outline-text-3" id="text-orgc65f64d">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">file:write</span>
  <span style="color: #FF8888;">&lt;&lt; string[address, length], path[address, length] -- &gt;&gt;</span>
  <span style="color: #dc322f; font-weight: bold;">&gt;::path</span>
  <span style="color: #dc322f; font-weight: bold;">&gt;::string</span>
  <span style="color: #5CDD5C; font-weight: bold;">::path</span>
  string<span style="color: #b0b1a3;">-&gt;</span>syscall-string
  <span style="color: #FF4C4C; font-weight: bold;">&gt;:syscall-path</span>
  <span style="color: #fd971f; font-weight: bold;">8</span><span style="color: #ffff00;">#</span><span style="color: #fd971f; font-weight: bold;">644</span> <span style="color: #FF8888;">&lt;&lt;</span>
<span style="color: #FF8888;">  2#110100100</span>
<span style="color: #FF8888;">  &gt;&gt;</span>
  <span style="color: #fd971f; font-weight: bold;">8</span><span style="color: #ffff00;">#</span><span style="color: #fd971f; font-weight: bold;">1002</span> <span style="color: #FF8888;">&lt;&lt;</span>
<span style="color: #FF8888;">  O_RDWR   0002</span>
<span style="color: #FF8888;">  O_TRUNC  1000</span>
<span style="color: #FF8888;">  &gt;&gt;</span>
  <span style="color: #83EA83; font-weight: bold;">:syscall-path</span>
  <span style="color: #fd971f; font-weight: bold;">syscall-number:*open*</span>
  <span style="color: #fd971f; font-weight: bold;">3</span> syscall
  dup
  <span style="color: #ffffff; font-weight: bold;">negative?</span> <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #e6db74;">"* (file:write) fail to open port for the following path :"</span> .s .l
    <span style="color: #e6db74;">"  "</span> .s <span style="color: #5CDD5C; font-weight: bold;">::path</span> .s .l
    <span style="color: #e6db74;">"  "</span> .s error-code<span style="color: #b0b1a3;">-&gt;</span>string .s .l
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #FF4C4C; font-weight: bold;">&gt;:port</span>
  <span style="color: #5CDD5C; font-weight: bold;">::string</span> swap
  <span style="color: #83EA83; font-weight: bold;">:port</span>
  <span style="color: #fd971f; font-weight: bold;">syscall-number:*write*</span>
  <span style="color: #fd971f; font-weight: bold;">3</span> syscall
  dup
  <span style="color: #ffffff; font-weight: bold;">negative?</span> <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #e6db74;">"* (file:write) fail to write port for the following path :"</span> .s .l
    <span style="color: #e6db74;">"  "</span> .s <span style="color: #5CDD5C; font-weight: bold;">::path</span> .s .l
    <span style="color: #e6db74;">"  "</span> .s error-code<span style="color: #b0b1a3;">-&gt;</span>string .s .l
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #FF4C4C; font-weight: bold;">&gt;:counter</span> <span style="color: #FF8888;">&lt;&lt; bytes been written &gt;&gt;</span>
  <span style="color: #83EA83; font-weight: bold;">:port</span>
  <span style="color: #ffffff; font-weight: bold;">port:</span>close <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #e6db74;">"* (file:write) fail to close port for the following path : "</span> .s .l
  <span style="color: #e6db74;">"  "</span> .s <span style="color: #5CDD5C; font-weight: bold;">::path</span> .s .l
  <span style="color: #e6db74;">"  "</span> .s error-code<span style="color: #b0b1a3;">-&gt;</span>string .s .l
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org2e34d57" class="outline-3">
<h3 id="org2e34d57"><a href="read">read</a></h3>
<div class="outline-text-3" id="text-org2e34d57">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">file:read</span>
  <span style="color: #FF8888;">&lt;&lt; string[address, max-length], path[address, length] -- counter &gt;&gt;</span>
  <span style="color: #dc322f; font-weight: bold;">&gt;::path</span>
  <span style="color: #dc322f; font-weight: bold;">&gt;::string</span>
  <span style="color: #5CDD5C; font-weight: bold;">::path</span>
  string<span style="color: #b0b1a3;">-&gt;</span>syscall-string
  <span style="color: #FF4C4C; font-weight: bold;">&gt;:syscall-path</span>
  <span style="color: #fd971f; font-weight: bold;">0</span> <span style="color: #FF8888;">&lt;&lt;</span>
<span style="color: #FF8888;">  O_RDONLY</span>
<span style="color: #FF8888;">  &gt;&gt;</span>
  <span style="color: #83EA83; font-weight: bold;">:syscall-path</span>
  <span style="color: #fd971f; font-weight: bold;">syscall-number:*open*</span>
  <span style="color: #fd971f; font-weight: bold;">2</span> syscall
  dup
  <span style="color: #ffffff; font-weight: bold;">negative?</span> <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #e6db74;">"* (file:read) fail to open port for the following path :"</span> .s .l
    <span style="color: #e6db74;">"  "</span> .s <span style="color: #5CDD5C; font-weight: bold;">::path</span> .s .l
    <span style="color: #e6db74;">"  "</span> .s error-code<span style="color: #b0b1a3;">-&gt;</span>string .s .l
    <span style="color: #fd971f; font-weight: bold;">0</span>
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #FF4C4C; font-weight: bold;">&gt;:port</span>
  <span style="color: #5CDD5C; font-weight: bold;">::string</span> swap
  <span style="color: #83EA83; font-weight: bold;">:port</span>
  <span style="color: #fd971f; font-weight: bold;">syscall-number:*read*</span>
  <span style="color: #fd971f; font-weight: bold;">3</span> syscall
  dup
  <span style="color: #ffffff; font-weight: bold;">negative?</span> <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #e6db74;">"* (file:read) fail to read port for the following path :"</span> .s .l
    <span style="color: #e6db74;">"  "</span> .s <span style="color: #5CDD5C; font-weight: bold;">::path</span> .s .l
    <span style="color: #e6db74;">"  "</span> .s error-code<span style="color: #b0b1a3;">-&gt;</span>string .s .l
    <span style="color: #fd971f; font-weight: bold;">0</span>
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #FF4C4C; font-weight: bold;">&gt;:counter</span> <span style="color: #FF8888;">&lt;&lt; bytes been readed &gt;&gt;</span>
  <span style="color: #83EA83; font-weight: bold;">:port</span>
  <span style="color: #ffffff; font-weight: bold;">port:</span>close <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #83EA83; font-weight: bold;">:counter</span>
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #e6db74;">"* (file:read) fail to close port for the following path : "</span> .s .l
  <span style="color: #e6db74;">"  "</span> .s <span style="color: #5CDD5C; font-weight: bold;">::path</span> .s .l
  <span style="color: #e6db74;">"  "</span> .s error-code<span style="color: #b0b1a3;">-&gt;</span>string .s .l
  <span style="color: #fd971f; font-weight: bold;">0</span>
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org8a95fcc" class="outline-3">
<h3 id="org8a95fcc"><a href="remove">remove</a></h3>
<div class="outline-text-3" id="text-org8a95fcc">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">file:remove</span>
  <span style="color: #FF8888;">&lt;&lt; path[address, length] -- &gt;&gt;</span>
  <span style="color: #dc322f; font-weight: bold;">&gt;::path</span>
  <span style="color: #5CDD5C; font-weight: bold;">::path</span>
  string<span style="color: #b0b1a3;">-&gt;</span>syscall-string
  <span style="color: #FF4C4C; font-weight: bold;">&gt;:syscall-path</span>
  <span style="color: #83EA83; font-weight: bold;">:syscall-path</span>
  <span style="color: #fd971f; font-weight: bold;">syscall-number:*unlink*</span>
  <span style="color: #fd971f; font-weight: bold;">1</span> syscall
  dup
  <span style="color: #ffffff; font-weight: bold;">negative?</span> <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #e6db74;">"* (file:remove) fail for the following path :"</span> .s .l
    <span style="color: #e6db74;">"  "</span> .s <span style="color: #5CDD5C; font-weight: bold;">::path</span> .s .l
    <span style="color: #e6db74;">"  "</span> .s error-code<span style="color: #b0b1a3;">-&gt;</span>string .s .l
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  drop
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org221a49c" class="outline-3">
<h3 id="org221a49c"><span class="done test">test</span> file</h3>
<div class="outline-text-3" id="text-org221a49c">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">file,test</span>
  <span style="color: #FF8888;">&lt;&lt; -- &gt;&gt;</span>
  <span style="color: #e6db74;">"kkk~"</span> <span style="color: #ffffff; font-weight: bold;">file:</span>create

  <span style="color: #e6db74;">"kkk took my baby away"</span> dup <span style="color: #FF4C4C; font-weight: bold;">&gt;:length</span>
  <span style="color: #e6db74;">"kkk~"</span> <span style="color: #ffffff; font-weight: bold;">file:</span>write

  <span style="color: #e6db74;">"............................"</span> <span style="color: #dc322f; font-weight: bold;">&gt;::string</span>
  <span style="color: #5CDD5C; font-weight: bold;">::string</span> <span style="color: #e6db74;">"kkk~"</span> <span style="color: #ffffff; font-weight: bold;">file:</span>read <span style="color: #FF4C4C; font-weight: bold;">&gt;:counter</span>

  <span style="color: #83EA83; font-weight: bold;">:counter</span>
  <span style="color: #83EA83; font-weight: bold;">:length</span>
  <span style="color: #ffffff; font-weight: bold;">equal?</span> <span style="color: #1ef15f; font-weight: bold;">test</span>

  <span style="color: #e6db74;">"kkk took my baby away......."</span>
  <span style="color: #5CDD5C; font-weight: bold;">::string</span>
  <span style="color: #ffffff; font-weight: bold;">string:</span>equal? <span style="color: #1ef15f; font-weight: bold;">test</span>

  <span style="color: #e6db74;">"kkk~"</span> <span style="color: #ffffff; font-weight: bold;">file:</span>remove
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #1ef15f; font-weight: bold;">test-function</span>

<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #e6db74;">"* (testing) file"</span> .s .l
  file,test
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #1ef15f; font-weight: bold;">test-do</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org26c7f79" class="outline-2">
<h2 id="org26c7f79">directory</h2>
<div class="outline-text-2" id="text-org26c7f79">
</div><div id="outline-container-org1ad45a4" class="outline-3">
<h3 id="org1ad45a4">directory:create</h3>
<div class="outline-text-3" id="text-org1ad45a4">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">directory:create</span>
  <span style="color: #FF8888;">&lt;&lt; path[address, length] -- &gt;&gt;</span>
  <span style="color: #dc322f; font-weight: bold;">&gt;::path</span>
  <span style="color: #5CDD5C; font-weight: bold;">::path</span>
  string<span style="color: #b0b1a3;">-&gt;</span>syscall-string
  <span style="color: #FF4C4C; font-weight: bold;">&gt;:syscall-path</span>
  <span style="color: #fd971f; font-weight: bold;">8</span><span style="color: #ffff00;">#</span><span style="color: #fd971f; font-weight: bold;">755</span> <span style="color: #FF8888;">&lt;&lt;</span>
<span style="color: #FF8888;">  2#111101101</span>
<span style="color: #FF8888;">  &gt;&gt;</span>
  <span style="color: #83EA83; font-weight: bold;">:syscall-path</span>
  <span style="color: #fd971f; font-weight: bold;">syscall-number:*mkdir*</span>
  <span style="color: #fd971f; font-weight: bold;">2</span> syscall
  dup
  <span style="color: #ffffff; font-weight: bold;">negative?</span> <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #e6db74;">"* (directory:create) fail for the following path :"</span> .s .l
    <span style="color: #e6db74;">"  "</span> .s <span style="color: #5CDD5C; font-weight: bold;">::path</span> .s .l
    <span style="color: #e6db74;">"  "</span> .s error-code<span style="color: #b0b1a3;">-&gt;</span>string .s .l
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  drop
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgeeb151d" class="outline-3">
<h3 id="orgeeb151d">directory:remove</h3>
<div class="outline-text-3" id="text-orgeeb151d">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">directory:remove</span>
  <span style="color: #FF8888;">&lt;&lt; path[address, length] -- &gt;&gt;</span>
  <span style="color: #dc322f; font-weight: bold;">&gt;::path</span>
  <span style="color: #5CDD5C; font-weight: bold;">::path</span>
  string<span style="color: #b0b1a3;">-&gt;</span>syscall-string
  <span style="color: #FF4C4C; font-weight: bold;">&gt;:syscall-path</span>
  <span style="color: #83EA83; font-weight: bold;">:syscall-path</span>
  <span style="color: #fd971f; font-weight: bold;">syscall-number:*rmdir*</span>
  <span style="color: #fd971f; font-weight: bold;">1</span> syscall
  dup
  <span style="color: #ffffff; font-weight: bold;">negative?</span> <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #e6db74;">"* (directory:remove) fail for the following path :"</span> .s .l
    <span style="color: #e6db74;">"  "</span> .s <span style="color: #5CDD5C; font-weight: bold;">::path</span> .s .l
    <span style="color: #e6db74;">"  "</span> .s error-code<span style="color: #b0b1a3;">-&gt;</span>string .s .l
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  drop
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org94eb13f" class="outline-3">
<h3 id="org94eb13f"><span class="done test">test</span> </h3>
<div class="outline-text-3" id="text-org94eb13f">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #e6db74;">"kkk"</span> <span style="color: #ffffff; font-weight: bold;">directory:</span>create
<span style="color: #e6db74;">"kkk"</span> <span style="color: #ffffff; font-weight: bold;">directory:</span>remove
</pre>
</div>
</div>
</div>

<div id="outline-container-org39bceef" class="outline-3">
<h3 id="org39bceef">system-getdents64</h3>
<div class="outline-text-3" id="text-org39bceef">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #fd971f; font-weight: bold;">0</span> <span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">+getdents64,ino+</span>        <span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #a1ab3a; font-weight: bold;">define-variable,with-tos</span>
<span style="color: #fd971f; font-weight: bold;">0</span> <span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">+getdents64,off+</span>        <span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #a1ab3a; font-weight: bold;">define-variable,with-tos</span>
<span style="color: #fd971f; font-weight: bold;">0</span> <span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">+getdents64,reclen+</span>     <span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #a1ab3a; font-weight: bold;">define-variable,with-tos</span>
<span style="color: #fd971f; font-weight: bold;">0</span> <span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">+getdents64,type+</span>       <span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #a1ab3a; font-weight: bold;">define-variable,with-tos</span>
<span style="color: #fd971f; font-weight: bold;">0</span> <span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">+getdents64,name+</span>       <span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #a1ab3a; font-weight: bold;">define-variable,with-tos</span>
<span style="color: #fd971f; font-weight: bold;">0</span> <span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">+getdents64,end+</span>          <span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #a1ab3a; font-weight: bold;">define-variable,with-tos</span>

<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">init,getdents64</span>
  <span style="color: #FF8888;">&lt;&lt; offset -- &gt;&gt;</span>
  <span style="color: #fd971f; font-weight: bold;">*cell-size*</span> <span style="color: #fd971f; font-weight: bold;">4</span> <span style="color: #ffffff; font-weight: bold;">equal?</span> <span style="color: #f92672; font-weight: bold;">if</span>
    dup <span style="color: #f92672; font-weight: bold;">address</span> <span style="color: #fd971f; font-weight: bold;">+getdents64,ino+</span>    set    <span style="color: #fd971f; font-weight: bold;">8</span> add
    dup <span style="color: #f92672; font-weight: bold;">address</span> <span style="color: #fd971f; font-weight: bold;">+getdents64,off+</span>    set    <span style="color: #fd971f; font-weight: bold;">8</span> add
    dup <span style="color: #f92672; font-weight: bold;">address</span> <span style="color: #fd971f; font-weight: bold;">+getdents64,reclen+</span> set    <span style="color: #fd971f; font-weight: bold;">2</span> add
    dup <span style="color: #f92672; font-weight: bold;">address</span> <span style="color: #fd971f; font-weight: bold;">+getdents64,type+</span>   set    <span style="color: #fd971f; font-weight: bold;">1</span> add
    dup <span style="color: #f92672; font-weight: bold;">address</span> <span style="color: #fd971f; font-weight: bold;">+getdents64,name+</span>   set    <span style="color: #fd971f; font-weight: bold;">256</span> add
        <span style="color: #f92672; font-weight: bold;">address</span> <span style="color: #fd971f; font-weight: bold;">+getdents64,end+</span>      set
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #fd971f; font-weight: bold;">*cell-size*</span> <span style="color: #fd971f; font-weight: bold;">8</span> <span style="color: #ffffff; font-weight: bold;">equal?</span> <span style="color: #f92672; font-weight: bold;">if</span>
    dup <span style="color: #f92672; font-weight: bold;">address</span> <span style="color: #fd971f; font-weight: bold;">+getdents64,ino+</span>    set    <span style="color: #fd971f; font-weight: bold;">8</span> add
    dup <span style="color: #f92672; font-weight: bold;">address</span> <span style="color: #fd971f; font-weight: bold;">+getdents64,off+</span>    set    <span style="color: #fd971f; font-weight: bold;">8</span> add
    dup <span style="color: #f92672; font-weight: bold;">address</span> <span style="color: #fd971f; font-weight: bold;">+getdents64,reclen+</span> set    <span style="color: #fd971f; font-weight: bold;">2</span> add
    dup <span style="color: #f92672; font-weight: bold;">address</span> <span style="color: #fd971f; font-weight: bold;">+getdents64,type+</span>   set    <span style="color: #fd971f; font-weight: bold;">1</span> add
    dup <span style="color: #f92672; font-weight: bold;">address</span> <span style="color: #fd971f; font-weight: bold;">+getdents64,name+</span>   set    <span style="color: #fd971f; font-weight: bold;">256</span> add
        <span style="color: #f92672; font-weight: bold;">address</span> <span style="color: #fd971f; font-weight: bold;">+getdents64,end+</span>      set
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>

<span style="color: #fd971f; font-weight: bold;">0</span> init,getdents64
<span style="color: #fd971f; font-weight: bold;">+getdents64,end+</span> <span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">+getdents64,length+</span> <span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #a1ab3a; font-weight: bold;">define-variable,with-tos</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org7d6fba8" class="outline-3">
<h3 id="org7d6fba8"><span class="done test">test</span> </h3>
<div class="outline-text-3" id="text-org7d6fba8">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">test,getdents64,print</span>
  <span style="color: #FF8888;">&lt;&lt; -- &gt;&gt;</span>
  <span style="color: #e6db74;">"+getdents64,ino+ : "</span>    .s <span style="color: #fd971f; font-weight: bold;">+getdents64,ino+</span>     get . .l
  <span style="color: #e6db74;">"+getdents64,off+ : "</span>    .s <span style="color: #fd971f; font-weight: bold;">+getdents64,off+</span>     get . .l
  <span style="color: #e6db74;">"+getdents64,reclen+ : "</span> .s <span style="color: #fd971f; font-weight: bold;">+getdents64,reclen+</span>  get-two-bytes . .l
  <span style="color: #e6db74;">"+getdents64,type+ : "</span>   .s
  <span style="color: #fd971f; font-weight: bold;">+getdents64,type+</span>
  get-byte file-type-code<span style="color: #b0b1a3;">-&gt;</span>string .s .l
  <span style="color: #e6db74;">"+getdents64,name+ : "</span>   .s
  <span style="color: #fd971f; font-weight: bold;">+getdents64,name+</span>
  dup <span style="color: #fd971f; font-weight: bold;">256</span>
  <span style="color: #fd971f; font-weight: bold;">0</span> <span style="color: #ffffff; font-weight: bold;">string:</span>find-byte
  drop  <span style="color: #FF8888;">&lt;&lt; drop 0 &gt;&gt;</span>
  over sub .s .l
  .l
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>

<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">test,getdents64,loop,structure</span>
  <span style="color: #FF8888;">&lt;&lt; end, cursor -- &gt;&gt;</span>
  dup2 <span style="color: #ffffff; font-weight: bold;">less-or-equal?</span> <span style="color: #f92672; font-weight: bold;">if</span>
    drop2
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #FF4C4C; font-weight: bold;">&gt;:cursor</span>
  <span style="color: #83EA83; font-weight: bold;">:cursor</span> init,getdents64
  test,getdents64,print
  <span style="color: #83EA83; font-weight: bold;">:cursor</span> <span style="color: #fd971f; font-weight: bold;">+getdents64,reclen+</span> get-two-bytes add
  <span style="color: #00ffff; font-weight: bold;">loop</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>

<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">test,getdents64,loop</span>
  <span style="color: #FF8888;">&lt;&lt; port -- &gt;&gt;</span>
  <span style="color: #FF4C4C; font-weight: bold;">&gt;:port</span>
  <span style="color: #fd971f; font-weight: bold;">1024</span> <span style="color: #AE7C3B; font-weight: bold;">allocate-local-memory</span> <span style="color: #FF4C4C; font-weight: bold;">&gt;:getdents64-structure-list</span>
  <span style="color: #fd971f; font-weight: bold;">1024</span>
  <span style="color: #83EA83; font-weight: bold;">:getdents64-structure-list</span>
  <span style="color: #83EA83; font-weight: bold;">:port</span>
  <span style="color: #fd971f; font-weight: bold;">syscall-number:*getdents64*</span>
  <span style="color: #fd971f; font-weight: bold;">3</span> syscall
  <span style="color: #e6db74;">"* syscall returns : "</span> .s dup .i .l
  dup <span style="color: #ffffff; font-weight: bold;">negative?</span> <span style="color: #f92672; font-weight: bold;">if</span>
    error-code<span style="color: #b0b1a3;">-&gt;</span>string .s .l
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  dup <span style="color: #ffffff; font-weight: bold;">zero?</span> <span style="color: #f92672; font-weight: bold;">if</span>
    drop
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #83EA83; font-weight: bold;">:getdents64-structure-list</span> add
  <span style="color: #83EA83; font-weight: bold;">:getdents64-structure-list</span>
  test,getdents64,loop,structure
  <span style="color: #83EA83; font-weight: bold;">:port</span>
  <span style="color: #00ffff; font-weight: bold;">loop</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>

<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">test,getdents64</span>
  <span style="color: #FF8888;">&lt;&lt; path[address, length] -- &gt;&gt;</span>
  <span style="color: #dc322f; font-weight: bold;">&gt;::path</span>
  <span style="color: #5CDD5C; font-weight: bold;">::path</span> <span style="color: #ffffff; font-weight: bold;">port:</span>open <span style="color: #f92672; font-weight: bold;">if</span>
  <span style="color: #f92672; font-weight: bold;">else</span>
    <span style="color: #e6db74;">"* (test,getdents64) fail to open : "</span> .s <span style="color: #5CDD5C; font-weight: bold;">::path</span> .s .l
    <span style="color: #e6db74;">"  "</span> .s error-code<span style="color: #b0b1a3;">-&gt;</span>string .s .l
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #FF4C4C; font-weight: bold;">&gt;:port</span>
  <span style="color: #83EA83; font-weight: bold;">:port</span> test,getdents64,loop
  <span style="color: #83EA83; font-weight: bold;">:port</span> <span style="color: #ffffff; font-weight: bold;">port:</span>close <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #e6db74;">"* (test,getdents64) fail to close : "</span> .s <span style="color: #5CDD5C; font-weight: bold;">::path</span> .s .l
  <span style="color: #e6db74;">"  "</span> .s error-code<span style="color: #b0b1a3;">-&gt;</span>string .s .l
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>

<span style="color: #e6db74;">"play"</span> test,getdents64
<span style="color: #e6db74;">"play/kkk"</span> test,getdents64
<span style="color: #e6db74;">"."</span> test,getdents64
<span style="color: #e6db74;">"/"</span> test,getdents64
</pre>
</div>
</div>
</div>

<div id="outline-container-orge630e37" class="outline-3">
<h3 id="orge630e37">directory:empty?</h3>
<div class="outline-text-3" id="text-orge630e37">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">directory:empty?</span>
  <span style="color: #FF8888;">&lt;&lt; path[address, length] -- bool &gt;&gt;</span>
  <span style="color: #dc322f; font-weight: bold;">&gt;::path</span>
  <span style="color: #5CDD5C; font-weight: bold;">::path</span> <span style="color: #ffffff; font-weight: bold;">port:</span>open <span style="color: #f92672; font-weight: bold;">if</span>
  <span style="color: #f92672; font-weight: bold;">else</span>
    <span style="color: #e6db74;">"* (directory:empty?) fail to open : "</span> .s <span style="color: #5CDD5C; font-weight: bold;">::path</span> .s .l
    <span style="color: #e6db74;">"  "</span> .s error-code<span style="color: #b0b1a3;">-&gt;</span>string .s .l
    <span style="color: #fd971f; font-weight: bold;">false</span>
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #FF4C4C; font-weight: bold;">&gt;:port</span>
  <span style="color: #fd971f; font-weight: bold;">128</span> <span style="color: #AE7C3B; font-weight: bold;">allocate-local-memory</span> <span style="color: #FF4C4C; font-weight: bold;">&gt;:getdents64-structure-list</span>
  <span style="color: #fd971f; font-weight: bold;">128</span>
  <span style="color: #83EA83; font-weight: bold;">:getdents64-structure-list</span>
  <span style="color: #83EA83; font-weight: bold;">:port</span>
  <span style="color: #fd971f; font-weight: bold;">syscall-number:*getdents64*</span>
  <span style="color: #fd971f; font-weight: bold;">3</span> syscall
  <span style="color: #fd971f; font-weight: bold;">48</span> <span style="color: #ffffff; font-weight: bold;">equal?</span> <span style="color: #FF8888;">&lt;&lt; this call to equal? returns the needed bool &gt;&gt;</span>
  <span style="color: #83EA83; font-weight: bold;">:port</span> <span style="color: #ffffff; font-weight: bold;">port:</span>close <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #e6db74;">"* (directory:empty?) fail to close : "</span> .s <span style="color: #5CDD5C; font-weight: bold;">::path</span> .s .l
  <span style="color: #e6db74;">"  "</span> .s error-code<span style="color: #b0b1a3;">-&gt;</span>string .s .l
  <span style="color: #fd971f; font-weight: bold;">false</span>
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org97f1790" class="outline-3">
<h3 id="org97f1790"><span class="done test">test</span> </h3>
<div class="outline-text-3" id="text-org97f1790">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #e6db74;">"play"</span> <span style="color: #ffffff; font-weight: bold;">directory:</span>empty? . .l
<span style="color: #e6db74;">"play/kkk"</span> <span style="color: #ffffff; font-weight: bold;">directory:</span>empty? . .l
<span style="color: #e6db74;">"play/aaa"</span> <span style="color: #ffffff; font-weight: bold;">directory:</span>empty? . .l
<span style="color: #e6db74;">"."</span> <span style="color: #ffffff; font-weight: bold;">directory:</span>empty? . .l
<span style="color: #e6db74;">"/"</span> <span style="color: #ffffff; font-weight: bold;">directory:</span>empty? . .l
</pre>
</div>
</div>
</div>

<div id="outline-container-org67c84a1" class="outline-3">
<h3 id="org67c84a1">directory:map</h3>
<div class="outline-text-3" id="text-org67c84a1">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">directory:map,loop,apply</span>
  <span style="color: #FF8888;">&lt;&lt; end, cursor, function -- &gt;&gt;</span>
  <span style="color: #FF4C4C; font-weight: bold;">&gt;:function</span>
  dup2 <span style="color: #ffffff; font-weight: bold;">less-or-equal?</span> <span style="color: #f92672; font-weight: bold;">if</span>
    drop2
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #FF4C4C; font-weight: bold;">&gt;:cursor</span>
  <span style="color: #FF4C4C; font-weight: bold;">&gt;:end</span>
  <span style="color: #83EA83; font-weight: bold;">:cursor</span> init,getdents64
  <span style="color: #83EA83; font-weight: bold;">:function</span> apply
  <span style="color: #83EA83; font-weight: bold;">:end</span>
  <span style="color: #83EA83; font-weight: bold;">:cursor</span> <span style="color: #fd971f; font-weight: bold;">+getdents64,reclen+</span> get-two-bytes add
  <span style="color: #83EA83; font-weight: bold;">:function</span>
  <span style="color: #00ffff; font-weight: bold;">loop</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>

<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">directory:map,loop</span>
  <span style="color: #FF8888;">&lt;&lt; port, function -- &gt;&gt;</span>
  <span style="color: #FF4C4C; font-weight: bold;">&gt;:function</span>
  <span style="color: #FF4C4C; font-weight: bold;">&gt;:port</span>
  <span style="color: #fd971f; font-weight: bold;">1024</span> <span style="color: #AE7C3B; font-weight: bold;">allocate-local-memory</span> <span style="color: #FF4C4C; font-weight: bold;">&gt;:getdents64-structure-list</span>
  <span style="color: #fd971f; font-weight: bold;">1024</span>
  <span style="color: #83EA83; font-weight: bold;">:getdents64-structure-list</span>
  <span style="color: #83EA83; font-weight: bold;">:port</span>
  <span style="color: #fd971f; font-weight: bold;">syscall-number:*getdents64*</span>
  <span style="color: #fd971f; font-weight: bold;">3</span> syscall
  dup <span style="color: #ffffff; font-weight: bold;">negative?</span> <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #e6db74;">"* (directory:map,loop) syscall fail"</span> .s .l
    <span style="color: #e6db74;">"  "</span> .s error-code<span style="color: #b0b1a3;">-&gt;</span>string .s .l
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  dup <span style="color: #ffffff; font-weight: bold;">zero?</span> <span style="color: #f92672; font-weight: bold;">if</span>
    drop
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #83EA83; font-weight: bold;">:getdents64-structure-list</span> add
  <span style="color: #83EA83; font-weight: bold;">:getdents64-structure-list</span>
  <span style="color: #83EA83; font-weight: bold;">:function</span>
  <span style="color: #ffffff; font-weight: bold;">directory:</span>map,loop,apply
  <span style="color: #83EA83; font-weight: bold;">:port</span>
  <span style="color: #83EA83; font-weight: bold;">:function</span>
  <span style="color: #00ffff; font-weight: bold;">loop</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>

<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">directory:map</span>
  <span style="color: #FF8888;">&lt;&lt; directory-path[address, length],</span>
<span style="color: #FF8888;">     function</span>
<span style="color: #FF8888;">     -- true</span>
<span style="color: #FF8888;">     -- false &gt;&gt;</span>
  <span style="color: #FF4C4C; font-weight: bold;">&gt;:function</span>
  <span style="color: #dc322f; font-weight: bold;">&gt;::directory-path</span>
  <span style="color: #5CDD5C; font-weight: bold;">::directory-path</span> <span style="color: #ffffff; font-weight: bold;">port:</span>open <span style="color: #f92672; font-weight: bold;">if</span>
  <span style="color: #f92672; font-weight: bold;">else</span>
    <span style="color: #e6db74;">"* (directory:map) fail to open : "</span> .s <span style="color: #5CDD5C; font-weight: bold;">::directory-path</span> .s .l
    <span style="color: #e6db74;">"  "</span> .s error-code<span style="color: #b0b1a3;">-&gt;</span>string .s .l
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #FF4C4C; font-weight: bold;">&gt;:port</span>
  <span style="color: #83EA83; font-weight: bold;">:port</span> <span style="color: #83EA83; font-weight: bold;">:function</span> <span style="color: #ffffff; font-weight: bold;">directory:</span>map,loop
  <span style="color: #83EA83; font-weight: bold;">:port</span> <span style="color: #ffffff; font-weight: bold;">port:</span>close <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #e6db74;">"* (directory:map) fail to close : "</span> .s <span style="color: #5CDD5C; font-weight: bold;">::directory-path</span> .s .l
  <span style="color: #e6db74;">"  "</span> .s error-code<span style="color: #b0b1a3;">-&gt;</span>string .s .l
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc9bfb40" class="outline-3">
<h3 id="orgc9bfb40"><span class="done test">test</span> </h3>
<div class="outline-text-3" id="text-orgc9bfb40">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">test,function</span>
  <span style="color: #FF8888;">&lt;&lt; -- &gt;&gt;</span>
  <span style="color: #fd971f; font-weight: bold;">+getdents64,type+</span> get-byte
  <span style="color: #fd971f; font-weight: bold;">8</span> <span style="color: #ffffff; font-weight: bold;">equal?</span> <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #e6db74;">"  "</span> .s
    <span style="color: #fd971f; font-weight: bold;">+getdents64,name+</span>
    dup <span style="color: #fd971f; font-weight: bold;">256</span>
    <span style="color: #fd971f; font-weight: bold;">0</span> <span style="color: #ffffff; font-weight: bold;">string:</span>find-byte
    drop  <span style="color: #FF8888;">&lt;&lt; drop 0 &gt;&gt;</span>
    over sub .s .l
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>

<span style="color: #e6db74;">"play"</span> <span style="color: #f92672; font-weight: bold;">jo</span> test,function <span style="color: #ffffff; font-weight: bold;">directory:</span>map
</pre>
</div>
</div>
</div>

<div id="outline-container-org64ad2ff" class="outline-3">
<h3 id="org64ad2ff">directory:list-file</h3>
<div class="outline-text-3" id="text-org64ad2ff">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">directory:list-file</span>
  <span style="color: #FF8888;">&lt;&lt; directory-path[address, length] -- &gt;&gt;</span>
  <span style="color: #93a8c6;">[</span> <span style="color: #FF8888;">&lt;&lt; -- &gt;&gt;</span>
    <span style="color: #fd971f; font-weight: bold;">+getdents64,type+</span> get-byte
    <span style="color: #fd971f; font-weight: bold;">8</span> <span style="color: #ffffff; font-weight: bold;">equal?</span> <span style="color: #f92672; font-weight: bold;">if</span>
      <span style="color: #e6db74;">"  "</span> .s
      <span style="color: #fd971f; font-weight: bold;">+getdents64,name+</span>
      dup <span style="color: #fd971f; font-weight: bold;">256</span>
      <span style="color: #fd971f; font-weight: bold;">0</span> <span style="color: #ffffff; font-weight: bold;">string:</span>find-byte
      drop  <span style="color: #FF8888;">&lt;&lt; drop 0 &gt;&gt;</span>
      over sub .s .l
    <span style="color: #f92672; font-weight: bold;">then</span>
    <span style="color: #00ffff; font-weight: bold;">end</span> <span style="color: #93a8c6;">]</span>
  <span style="color: #ffffff; font-weight: bold;">directory:</span>map
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgbc93e15" class="outline-3">
<h3 id="orgbc93e15">directory:list-directory</h3>
<div class="outline-text-3" id="text-orgbc93e15">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">directory:list-directory</span>
  <span style="color: #FF8888;">&lt;&lt; directory-path[address, length] -- &gt;&gt;</span>
  <span style="color: #93a8c6;">[</span> <span style="color: #FF8888;">&lt;&lt; -- &gt;&gt;</span>
    <span style="color: #fd971f; font-weight: bold;">+getdents64,type+</span> get-byte
    <span style="color: #fd971f; font-weight: bold;">4</span> <span style="color: #ffffff; font-weight: bold;">equal?</span> <span style="color: #f92672; font-weight: bold;">if</span>
      <span style="color: #fd971f; font-weight: bold;">+getdents64,name+</span>
      dup <span style="color: #fd971f; font-weight: bold;">256</span>
      <span style="color: #fd971f; font-weight: bold;">0</span> <span style="color: #ffffff; font-weight: bold;">string:</span>find-byte
      drop  <span style="color: #FF8888;">&lt;&lt; drop 0 &gt;&gt;</span>
      over sub <span style="color: #dc322f; font-weight: bold;">&gt;::name</span>
      <span style="color: #e6db74;">".."</span> <span style="color: #5CDD5C; font-weight: bold;">::name</span> <span style="color: #ffffff; font-weight: bold;">string:</span>equal? <span style="color: #f92672; font-weight: bold;">if</span>
        <span style="color: #00ffff; font-weight: bold;">end</span>
      <span style="color: #f92672; font-weight: bold;">then</span>
      <span style="color: #e6db74;">"."</span> <span style="color: #5CDD5C; font-weight: bold;">::name</span> <span style="color: #ffffff; font-weight: bold;">string:</span>equal? <span style="color: #f92672; font-weight: bold;">if</span>
        <span style="color: #00ffff; font-weight: bold;">end</span>
      <span style="color: #f92672; font-weight: bold;">then</span>
      <span style="color: #e6db74;">"  "</span> .s <span style="color: #5CDD5C; font-weight: bold;">::name</span> .s .l
      <span style="color: #00ffff; font-weight: bold;">end</span>
    <span style="color: #f92672; font-weight: bold;">then</span>
    <span style="color: #00ffff; font-weight: bold;">end</span> <span style="color: #93a8c6;">]</span>
  <span style="color: #ffffff; font-weight: bold;">directory:</span>map
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc76a295" class="outline-3">
<h3 id="orgc76a295"><span class="done test">test</span> </h3>
<div class="outline-text-3" id="text-orgc76a295">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #e6db74;">"play"</span> dup2
<span style="color: #ffffff; font-weight: bold;">directory:</span>list-file
<span style="color: #ffffff; font-weight: bold;">directory:</span>list-directory

<span style="color: #e6db74;">"play/kkk"</span> dup2
<span style="color: #ffffff; font-weight: bold;">directory:</span>list-file
<span style="color: #ffffff; font-weight: bold;">directory:</span>list-directory

<span style="color: #e6db74;">"."</span> dup2
<span style="color: #ffffff; font-weight: bold;">directory:</span>list-file
<span style="color: #ffffff; font-weight: bold;">directory:</span>list-directory

<span style="color: #e6db74;">"/"</span> dup2
<span style="color: #ffffff; font-weight: bold;">directory:</span>list-file
<span style="color: #ffffff; font-weight: bold;">directory:</span>list-directory
</pre>
</div>
</div>
</div>

<div id="outline-container-org634eda6" class="outline-3">
<h3 id="org634eda6">directory:find-file</h3>
<div class="outline-text-3" id="text-org634eda6">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">directory:find-file</span>
  <span style="color: #FF8888;">&lt;&lt; directory-path[address, length], file-name[address, length] -- bool &gt;&gt;</span>
  xx<span style="color: #b0b1a3;">|</span>swap<span style="color: #b0b1a3;">|</span>xx
  <span style="color: #fd971f; font-weight: bold;">false</span>
  xx<span style="color: #b0b1a3;">|</span>swap<span style="color: #b0b1a3;">|</span>x
  <span style="color: #93a8c6;">[</span> <span style="color: #FF8888;">&lt;&lt; file-name[address, length], bool --</span>
<span style="color: #FF8888;">       file-name[address, length], bool &gt;&gt;</span>
    <span style="color: #fd971f; font-weight: bold;">+getdents64,type+</span> get-byte <span style="color: #fd971f; font-weight: bold;">8</span> <span style="color: #ffffff; font-weight: bold;">equal?</span> not <span style="color: #f92672; font-weight: bold;">if</span>
      <span style="color: #00ffff; font-weight: bold;">end</span>
    <span style="color: #f92672; font-weight: bold;">then</span>
    <span style="color: #FF4C4C; font-weight: bold;">&gt;:bool</span>
    <span style="color: #FF4C4C; font-weight: bold;">&gt;:file-name,lenght</span>
    <span style="color: #FF4C4C; font-weight: bold;">&gt;:file-name,address</span>
    <span style="color: #83EA83; font-weight: bold;">:file-name,lenght</span> <span style="color: #fd971f; font-weight: bold;">+getdents64,name+</span> add
    get-byte <span style="color: #ffffff; font-weight: bold;">zero?</span> not <span style="color: #f92672; font-weight: bold;">if</span>
      <span style="color: #83EA83; font-weight: bold;">:file-name,address</span>
      <span style="color: #83EA83; font-weight: bold;">:file-name,lenght</span>
      <span style="color: #83EA83; font-weight: bold;">:bool</span>
      <span style="color: #00ffff; font-weight: bold;">end</span>
    <span style="color: #f92672; font-weight: bold;">then</span>
    <span style="color: #83EA83; font-weight: bold;">:file-name,address</span> <span style="color: #83EA83; font-weight: bold;">:file-name,lenght</span>
    <span style="color: #fd971f; font-weight: bold;">+getdents64,name+</span> <span style="color: #83EA83; font-weight: bold;">:file-name,lenght</span>
    <span style="color: #ffffff; font-weight: bold;">string:</span>equal? <span style="color: #f92672; font-weight: bold;">if</span>
      <span style="color: #83EA83; font-weight: bold;">:file-name,address</span>
      <span style="color: #83EA83; font-weight: bold;">:file-name,lenght</span>
      <span style="color: #fd971f; font-weight: bold;">true</span>
      <span style="color: #00ffff; font-weight: bold;">end</span>
    <span style="color: #f92672; font-weight: bold;">then</span>
    <span style="color: #83EA83; font-weight: bold;">:file-name,address</span>
    <span style="color: #83EA83; font-weight: bold;">:file-name,lenght</span>
    <span style="color: #83EA83; font-weight: bold;">:bool</span>
    <span style="color: #00ffff; font-weight: bold;">end</span> <span style="color: #93a8c6;">]</span>
  <span style="color: #ffffff; font-weight: bold;">directory:</span>map
  xx<span style="color: #b0b1a3;">|</span>swap<span style="color: #b0b1a3;">|</span>x drop2
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orge030639" class="outline-3">
<h3 id="orge030639">directory:find-directory</h3>
<div class="outline-text-3" id="text-orge030639">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">directory:find-directory</span>
  <span style="color: #FF8888;">&lt;&lt; directory-path[address, length], file-name[address, length] -- bool &gt;&gt;</span>
  xx<span style="color: #b0b1a3;">|</span>swap<span style="color: #b0b1a3;">|</span>xx
  <span style="color: #fd971f; font-weight: bold;">false</span>
  xx<span style="color: #b0b1a3;">|</span>swap<span style="color: #b0b1a3;">|</span>x
  <span style="color: #93a8c6;">[</span> <span style="color: #FF8888;">&lt;&lt; file-name[address, length], bool --</span>
<span style="color: #FF8888;">       file-name[address, length], bool &gt;&gt;</span>
    <span style="color: #fd971f; font-weight: bold;">+getdents64,type+</span> get-byte <span style="color: #fd971f; font-weight: bold;">4</span> <span style="color: #ffffff; font-weight: bold;">equal?</span> not <span style="color: #f92672; font-weight: bold;">if</span>
      <span style="color: #00ffff; font-weight: bold;">end</span>
    <span style="color: #f92672; font-weight: bold;">then</span>
    <span style="color: #FF4C4C; font-weight: bold;">&gt;:bool</span>
    <span style="color: #FF4C4C; font-weight: bold;">&gt;:file-name,lenght</span>
    <span style="color: #FF4C4C; font-weight: bold;">&gt;:file-name,address</span>
    <span style="color: #83EA83; font-weight: bold;">:file-name,lenght</span> <span style="color: #fd971f; font-weight: bold;">+getdents64,name+</span> add
    get-byte <span style="color: #ffffff; font-weight: bold;">zero?</span> not <span style="color: #f92672; font-weight: bold;">if</span>
      <span style="color: #83EA83; font-weight: bold;">:file-name,address</span>
      <span style="color: #83EA83; font-weight: bold;">:file-name,lenght</span>
      <span style="color: #83EA83; font-weight: bold;">:bool</span>
      <span style="color: #00ffff; font-weight: bold;">end</span>
    <span style="color: #f92672; font-weight: bold;">then</span>
    <span style="color: #83EA83; font-weight: bold;">:file-name,address</span> <span style="color: #83EA83; font-weight: bold;">:file-name,lenght</span>
    <span style="color: #fd971f; font-weight: bold;">+getdents64,name+</span> <span style="color: #83EA83; font-weight: bold;">:file-name,lenght</span>
    <span style="color: #ffffff; font-weight: bold;">string:</span>equal? <span style="color: #f92672; font-weight: bold;">if</span>
      <span style="color: #83EA83; font-weight: bold;">:file-name,address</span>
      <span style="color: #83EA83; font-weight: bold;">:file-name,lenght</span>
      <span style="color: #fd971f; font-weight: bold;">true</span>
      <span style="color: #00ffff; font-weight: bold;">end</span>
    <span style="color: #f92672; font-weight: bold;">then</span>
    <span style="color: #83EA83; font-weight: bold;">:file-name,address</span>
    <span style="color: #83EA83; font-weight: bold;">:file-name,lenght</span>
    <span style="color: #83EA83; font-weight: bold;">:bool</span>
    <span style="color: #00ffff; font-weight: bold;">end</span> <span style="color: #93a8c6;">]</span>
  <span style="color: #ffffff; font-weight: bold;">directory:</span>map
  xx<span style="color: #b0b1a3;">|</span>swap<span style="color: #b0b1a3;">|</span>x drop2
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orge234c64" class="outline-3">
<h3 id="orge234c64"><span class="done test">test</span> </h3>
<div class="outline-text-3" id="text-orge234c64">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">find-file,test</span>
  <span style="color: #FF8888;">&lt;&lt; -- &gt;&gt;</span>
  <span style="color: #e6db74;">"play"</span> <span style="color: #e6db74;">"cn"</span> <span style="color: #ffffff; font-weight: bold;">directory:</span>find-file .
  <span style="color: #e6db74;">"play"</span> <span style="color: #e6db74;">"kkk"</span> <span style="color: #ffffff; font-weight: bold;">directory:</span>find-file .
  <span style="color: #e6db74;">"play"</span> <span style="color: #e6db74;">"no"</span> <span style="color: #ffffff; font-weight: bold;">directory:</span>find-file .
  .l
  <span style="color: #e6db74;">"playlay"</span> <span style="color: #e6db74;">"no"</span> <span style="color: #ffffff; font-weight: bold;">directory:</span>find-file .
  .l
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
find-file,test

<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">find-directory,test</span>
  <span style="color: #FF8888;">&lt;&lt; -- &gt;&gt;</span>
  <span style="color: #e6db74;">"play"</span> <span style="color: #e6db74;">"cn"</span> <span style="color: #ffffff; font-weight: bold;">directory:</span>find-directory .
  <span style="color: #e6db74;">"play"</span> <span style="color: #e6db74;">"kkk"</span> <span style="color: #ffffff; font-weight: bold;">directory:</span>find-directory .
  <span style="color: #e6db74;">"play"</span> <span style="color: #e6db74;">"no"</span> <span style="color: #ffffff; font-weight: bold;">directory:</span>find-directory .
  .l
  <span style="color: #e6db74;">"playlay"</span> <span style="color: #e6db74;">"no"</span> <span style="color: #ffffff; font-weight: bold;">directory:</span>find-directory .
  .l
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
find-directory,test
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgd7136a5" class="outline-2">
<h2 id="orgd7136a5">system environment</h2>
<div class="outline-text-2" id="text-orgd7136a5">
</div><div id="outline-container-orgf7e8bcb" class="outline-3">
<h3 id="orgf7e8bcb"><span class="todo note">note</span> linux</h3>
<div class="outline-text-3" id="text-orgf7e8bcb">
</div><div id="outline-container-org9034786" class="outline-4">
<h4 id="org9034786">one directory</h4>
<div class="outline-text-4" id="text-org9034786">
<ul class="org-ul">
<li><p>all files about cicada</p><p>are stored in</p><p>"<i>home/&lt;user&gt;</i>.cicada"</p></li></ul>
</div>
</div>

<div id="outline-container-org85bd4e4" class="outline-4">
<h4 id="org85bd4e4">pid</h4>
<div class="outline-text-4" id="text-org85bd4e4">
<ul class="org-ul">
<li><p>pid is the key to all the linux system environment</p></li>
<li><p>command-line</p><p>/proc/&lt;pid&gt;/cmdline</p></li>
<li><p>environment-variable-list</p><p>/proc/&lt;pid&gt;/environ</p></li></ul>
</div>
</div>
</div>

<div id="outline-container-org6c1e4df" class="outline-3">
<h3 id="org6c1e4df">[init|get]-pid</h3>
<div class="outline-text-3" id="text-org6c1e4df">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #fd971f; font-weight: bold;">0</span> <span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #fd971f; font-weight: bold;">*pid*</span> <span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #a1ab3a; font-weight: bold;">define-variable,with-tos</span>

<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">init-pid</span>
  <span style="color: #FF8888;">&lt;&lt; -- &gt;&gt;</span>
  <span style="color: #fd971f; font-weight: bold;">syscall-number:*getpid*</span>
  <span style="color: #fd971f; font-weight: bold;">0</span> syscall
  <span style="color: #f92672; font-weight: bold;">address</span> <span style="color: #fd971f; font-weight: bold;">*pid*</span> set
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>

<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">get-pid</span>
  <span style="color: #FF8888;">&lt;&lt; -- pid &gt;&gt;</span>
  <span style="color: #fd971f; font-weight: bold;">*pid*</span>
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orga1dc1ce" class="outline-3">
<h3 id="orga1dc1ce">[init|get]-command-line</h3>
<div class="outline-text-3" id="text-orga1dc1ce">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #fd971f; font-weight: bold;">512</span> <span style="color: #AE7C3B; font-weight: bold;">allocate-memory</span>
<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #fd971f; font-weight: bold;">*address,command-line*</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #a1ab3a; font-weight: bold;">define-variable,with-tos</span>

<span style="color: #fd971f; font-weight: bold;">512</span>
<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #fd971f; font-weight: bold;">*length,command-line*</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #a1ab3a; font-weight: bold;">define-variable,with-tos</span>

<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">init-command-line</span>
  <span style="color: #FF8888;">&lt;&lt; -- &gt;&gt;</span>
  <span style="color: #fd971f; font-weight: bold;">64</span> <span style="color: #AE7C3B; font-weight: bold;">allocate-local-memory</span> <span style="color: #FF4C4C; font-weight: bold;">&gt;:path-buffer</span>
  <span style="color: #83EA83; font-weight: bold;">:path-buffer</span> <span style="color: #FF4C4C; font-weight: bold;">&gt;:cursor</span>

  get-pid write-number,fill-buffer <span style="color: #dc322f; font-weight: bold;">&gt;::pid-string</span>

  <span style="color: #e6db74;">"/proc/"</span> dup <span style="color: #FF4C4C; font-weight: bold;">&gt;:add-to-cursor</span>
  <span style="color: #83EA83; font-weight: bold;">:cursor</span> string<span style="color: #b0b1a3;">-&gt;</span>buffer!
  <span style="color: #83EA83; font-weight: bold;">:add-to-cursor</span> <span style="color: #83EA83; font-weight: bold;">:cursor</span> add <span style="color: #FF4C4C; font-weight: bold;">&gt;:cursor</span>

  <span style="color: #5CDD5C; font-weight: bold;">::pid-string</span> dup <span style="color: #FF4C4C; font-weight: bold;">&gt;:add-to-cursor</span>
  <span style="color: #83EA83; font-weight: bold;">:cursor</span> string<span style="color: #b0b1a3;">-&gt;</span>buffer!
  <span style="color: #83EA83; font-weight: bold;">:add-to-cursor</span> <span style="color: #83EA83; font-weight: bold;">:cursor</span> add <span style="color: #FF4C4C; font-weight: bold;">&gt;:cursor</span>

  <span style="color: #e6db74;">"/cmdline"</span> dup <span style="color: #FF4C4C; font-weight: bold;">&gt;:add-to-cursor</span>
  <span style="color: #83EA83; font-weight: bold;">:cursor</span> string<span style="color: #b0b1a3;">-&gt;</span>buffer!
  <span style="color: #83EA83; font-weight: bold;">:add-to-cursor</span> <span style="color: #83EA83; font-weight: bold;">:cursor</span> add <span style="color: #FF4C4C; font-weight: bold;">&gt;:cursor</span>

  <span style="color: #83EA83; font-weight: bold;">:path-buffer</span>
  <span style="color: #83EA83; font-weight: bold;">:cursor</span> <span style="color: #83EA83; font-weight: bold;">:path-buffer</span> sub dup2 <span style="color: #dc322f; font-weight: bold;">&gt;::path</span>
  <span style="color: #ffffff; font-weight: bold;">port:</span>open <span style="color: #f92672; font-weight: bold;">if</span>
  <span style="color: #f92672; font-weight: bold;">else</span>
    <span style="color: #e6db74;">"* (init-command-line) fail to open : "</span> .s <span style="color: #5CDD5C; font-weight: bold;">::path</span> .s .l
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #FF4C4C; font-weight: bold;">&gt;:port</span>

  <span style="color: #fd971f; font-weight: bold;">*address,command-line*</span>
  <span style="color: #fd971f; font-weight: bold;">*length,command-line*</span>
  <span style="color: #83EA83; font-weight: bold;">:port</span>
  <span style="color: #ffffff; font-weight: bold;">port:</span>read <span style="color: #f92672; font-weight: bold;">if</span>
  <span style="color: #f92672; font-weight: bold;">else</span>
    <span style="color: #e6db74;">"* (init-command-line) fail to read : "</span> .s <span style="color: #5CDD5C; font-weight: bold;">::path</span> .s .l
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #f92672; font-weight: bold;">address</span> <span style="color: #fd971f; font-weight: bold;">*length,command-line*</span> set
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>

<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">get-command-line</span>
  <span style="color: #FF8888;">&lt;&lt; -- string[address, length] &gt;&gt;</span>
  <span style="color: #fd971f; font-weight: bold;">*address,command-line*</span> <span style="color: #fd971f; font-weight: bold;">*length,command-line*</span>
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orga622f46" class="outline-3">
<h3 id="orga622f46">[init|get]-environment-variable-list</h3>
<div class="outline-text-3" id="text-orga622f46">
<ul class="org-ul">
<li><p>the size of /proc/&lt;pid&gt;/environ is limited to 4k</p></li></ul>
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #fd971f; font-weight: bold;">1024</span> <span style="color: #fd971f; font-weight: bold;">4</span> mul <span style="color: #AE7C3B; font-weight: bold;">allocate-memory</span>
<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #fd971f; font-weight: bold;">*address,environment-variable-list*</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #a1ab3a; font-weight: bold;">define-variable,with-tos</span>

<span style="color: #fd971f; font-weight: bold;">1024</span> <span style="color: #fd971f; font-weight: bold;">4</span> mul
<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #fd971f; font-weight: bold;">*length,environment-variable-list*</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #a1ab3a; font-weight: bold;">define-variable,with-tos</span>

<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">init-environment-variable-list</span>
  <span style="color: #FF8888;">&lt;&lt; -- &gt;&gt;</span>
  <span style="color: #fd971f; font-weight: bold;">64</span> <span style="color: #AE7C3B; font-weight: bold;">allocate-local-memory</span> <span style="color: #FF4C4C; font-weight: bold;">&gt;:path-buffer</span>
  <span style="color: #83EA83; font-weight: bold;">:path-buffer</span> <span style="color: #FF4C4C; font-weight: bold;">&gt;:cursor</span>

  get-pid write-number,fill-buffer <span style="color: #dc322f; font-weight: bold;">&gt;::pid-string</span>

  <span style="color: #e6db74;">"/proc/"</span> dup <span style="color: #FF4C4C; font-weight: bold;">&gt;:add-to-cursor</span>
  <span style="color: #83EA83; font-weight: bold;">:cursor</span> string<span style="color: #b0b1a3;">-&gt;</span>buffer!
  <span style="color: #83EA83; font-weight: bold;">:add-to-cursor</span> <span style="color: #83EA83; font-weight: bold;">:cursor</span> add <span style="color: #FF4C4C; font-weight: bold;">&gt;:cursor</span>

  <span style="color: #5CDD5C; font-weight: bold;">::pid-string</span> dup <span style="color: #FF4C4C; font-weight: bold;">&gt;:add-to-cursor</span>
  <span style="color: #83EA83; font-weight: bold;">:cursor</span> string<span style="color: #b0b1a3;">-&gt;</span>buffer!
  <span style="color: #83EA83; font-weight: bold;">:add-to-cursor</span> <span style="color: #83EA83; font-weight: bold;">:cursor</span> add <span style="color: #FF4C4C; font-weight: bold;">&gt;:cursor</span>

  <span style="color: #e6db74;">"/environ"</span> dup <span style="color: #FF4C4C; font-weight: bold;">&gt;:add-to-cursor</span>
  <span style="color: #83EA83; font-weight: bold;">:cursor</span> string<span style="color: #b0b1a3;">-&gt;</span>buffer!
  <span style="color: #83EA83; font-weight: bold;">:add-to-cursor</span> <span style="color: #83EA83; font-weight: bold;">:cursor</span> add <span style="color: #FF4C4C; font-weight: bold;">&gt;:cursor</span>

  <span style="color: #83EA83; font-weight: bold;">:path-buffer</span>
  <span style="color: #83EA83; font-weight: bold;">:cursor</span> <span style="color: #83EA83; font-weight: bold;">:path-buffer</span> sub dup2 <span style="color: #dc322f; font-weight: bold;">&gt;::path</span>
  <span style="color: #ffffff; font-weight: bold;">port:</span>open <span style="color: #f92672; font-weight: bold;">if</span>
  <span style="color: #f92672; font-weight: bold;">else</span>
    <span style="color: #e6db74;">"* (init-environment-variable-list) fail to open : "</span> .s <span style="color: #5CDD5C; font-weight: bold;">::path</span> .s .l
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #FF4C4C; font-weight: bold;">&gt;:port</span>

  <span style="color: #fd971f; font-weight: bold;">*address,environment-variable-list*</span>
  <span style="color: #fd971f; font-weight: bold;">*length,environment-variable-list*</span>
  <span style="color: #83EA83; font-weight: bold;">:port</span>
  <span style="color: #ffffff; font-weight: bold;">port:</span>read <span style="color: #f92672; font-weight: bold;">if</span>
  <span style="color: #f92672; font-weight: bold;">else</span>
    <span style="color: #e6db74;">"* (init-environment-variable-list) fail to read : "</span> .s <span style="color: #5CDD5C; font-weight: bold;">::path</span> .s .l
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #f92672; font-weight: bold;">address</span> <span style="color: #fd971f; font-weight: bold;">*length,environment-variable-list*</span> set
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>

<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">get-environment-variable-list</span>
  <span style="color: #FF8888;">&lt;&lt; -- string[address, length] &gt;&gt;</span>
  <span style="color: #fd971f; font-weight: bold;">*address,environment-variable-list*</span>
  <span style="color: #fd971f; font-weight: bold;">*length,environment-variable-list*</span>
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org1857772" class="outline-3">
<h3 id="org1857772">find-environment-variable</h3>
<div class="outline-text-3" id="text-org1857772">
<ul class="org-ul">
<li><p>the string used to find an environment-variable</p><p>can not contain "="</p><p>no error handling on this</p></li></ul>
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">find-environment-variable,loop</span>
  <span style="color: #FF8888;">&lt;&lt; string[address, length], cursor</span>
<span style="color: #FF8888;">     -- string[address, length], true</span>
<span style="color: #FF8888;">     -- false &gt;&gt;</span>
  dup
  get-environment-variable-list add
  <span style="color: #ffffff; font-weight: bold;">greater-than?</span> <span style="color: #f92672; font-weight: bold;">if</span>
    drop drop2
    <span style="color: #fd971f; font-weight: bold;">false</span>
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #FF4C4C; font-weight: bold;">&gt;:cursor</span>
  <span style="color: #FF4C4C; font-weight: bold;">&gt;:length</span>
  <span style="color: #FF4C4C; font-weight: bold;">&gt;:address</span>
  <span style="color: #83EA83; font-weight: bold;">:address</span> <span style="color: #83EA83; font-weight: bold;">:cursor</span> <span style="color: #83EA83; font-weight: bold;">:length</span>
  compare-buffer not <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #83EA83; font-weight: bold;">:address</span> <span style="color: #83EA83; font-weight: bold;">:length</span>
    <span style="color: #83EA83; font-weight: bold;">:cursor</span> <span style="color: #fd971f; font-weight: bold;">0</span> cursor<span style="color: #b0b1a3;">-&gt;</span>next-matching-byte add1
    <span style="color: #00ffff; font-weight: bold;">loop</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #83EA83; font-weight: bold;">:cursor</span> <span style="color: #83EA83; font-weight: bold;">:length</span> add get-byte
  <span style="color: #e6db74;">"="</span> <span style="color: #ffffff; font-weight: bold;">string:</span>byte
  <span style="color: #ffffff; font-weight: bold;">equal?</span> not <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #83EA83; font-weight: bold;">:address</span> <span style="color: #83EA83; font-weight: bold;">:length</span>
    <span style="color: #83EA83; font-weight: bold;">:cursor</span> <span style="color: #fd971f; font-weight: bold;">0</span> cursor<span style="color: #b0b1a3;">-&gt;</span>next-matching-byte add1
    <span style="color: #00ffff; font-weight: bold;">loop</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #83EA83; font-weight: bold;">:cursor</span> <span style="color: #83EA83; font-weight: bold;">:length</span> add add1 <span style="color: #FF8888;">&lt;&lt; over "=" &gt;&gt;</span>
  <span style="color: #FF4C4C; font-weight: bold;">&gt;:find-address</span>
  <span style="color: #83EA83; font-weight: bold;">:find-address</span> <span style="color: #fd971f; font-weight: bold;">0</span> cursor<span style="color: #b0b1a3;">-&gt;</span>next-matching-byte
  <span style="color: #83EA83; font-weight: bold;">:find-address</span> sub <span style="color: #FF4C4C; font-weight: bold;">&gt;:find-length</span>
  <span style="color: #83EA83; font-weight: bold;">:find-address</span>
  <span style="color: #83EA83; font-weight: bold;">:find-length</span>
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>

<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">find-environment-variable</span>
  <span style="color: #FF8888;">&lt;&lt; string[address, length]</span>
<span style="color: #FF8888;">     -- string[address, length], true</span>
<span style="color: #FF8888;">     -- false &gt;&gt;</span>
  get-environment-variable-list drop
  find-environment-variable,loop
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org447d921" class="outline-3">
<h3 id="org447d921">initialize system environment</h3>
<div class="outline-text-3" id="text-org447d921">
<div class="org-src-container">

<pre class="src src-cicada-nymph">init-pid
init-command-line
init-environment-variable-list
</pre>
</div>
</div>
</div>

<div id="outline-container-org702929a" class="outline-3">
<h3 id="org702929a"><b>home-directory</b></h3>
<div class="outline-text-3" id="text-org702929a">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #fd971f; font-weight: bold;">*home-directory*</span>
  <span style="color: #e6db74;">"HOME"</span> find-environment-variable
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #a1ab3a; font-weight: bold;">define-variable</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org9899db" class="outline-3">
<h3 id="org9899db">report:environment-variable</h3>
<div class="outline-text-3" id="text-org9899db">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">report:environment-variable,loop</span>
  <span style="color: #FF8888;">&lt;&lt; environment-variable-list[address, length]-- &gt;&gt;</span>
  dup2 <span style="color: #ffffff; font-weight: bold;">string:</span>space? <span style="color: #f92672; font-weight: bold;">if</span>
    drop2
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>

  <span style="color: #FF4C4C; font-weight: bold;">&gt;:length</span>
  <span style="color: #FF4C4C; font-weight: bold;">&gt;:address</span>

  <span style="color: #83EA83; font-weight: bold;">:address</span> <span style="color: #83EA83; font-weight: bold;">:length</span> <span style="color: #fd971f; font-weight: bold;">0</span> <span style="color: #ffffff; font-weight: bold;">string:</span>find-byte drop add1 <span style="color: #FF4C4C; font-weight: bold;">&gt;:cursor</span>
  <span style="color: #83EA83; font-weight: bold;">:cursor</span> <span style="color: #83EA83; font-weight: bold;">:address</span> sub <span style="color: #FF4C4C; font-weight: bold;">&gt;:length-of-one-variable</span>

  <span style="color: #83EA83; font-weight: bold;">:address</span>
  <span style="color: #83EA83; font-weight: bold;">:length-of-one-variable</span> sub1 .s .l

  <span style="color: #83EA83; font-weight: bold;">:cursor</span>
  <span style="color: #83EA83; font-weight: bold;">:length</span> <span style="color: #83EA83; font-weight: bold;">:length-of-one-variable</span> sub
  <span style="color: #00ffff; font-weight: bold;">loop</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>

<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">report:environment-variable</span>
  <span style="color: #FF8888;">&lt;&lt; -- &gt;&gt;</span>
  get-environment-variable-list
  <span style="color: #ffffff; font-weight: bold;">report:</span>environment-variable,loop
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgdeba68c" class="outline-3">
<h3 id="orgdeba68c">report:command-line</h3>
<div class="outline-text-3" id="text-orgdeba68c">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">report:command-line,loop</span>
  <span style="color: #FF8888;">&lt;&lt; command-line[address, length] -- &gt;&gt;</span>
  dup2 <span style="color: #ffffff; font-weight: bold;">string:</span>space? <span style="color: #f92672; font-weight: bold;">if</span>
    drop2
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  dup2 <span style="color: #ffffff; font-weight: bold;">string:</span>word .s <span style="color: #fd971f; font-weight: bold;">32</span> .b
  <span style="color: #ffffff; font-weight: bold;">string:</span>word-tail
  <span style="color: #00ffff; font-weight: bold;">loop</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>

<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">report:command-line</span>
  <span style="color: #FF8888;">&lt;&lt; -- &gt;&gt;</span>
  get-command-line
  <span style="color: #ffffff; font-weight: bold;">report:</span>command-line,loop
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org3aa1bc7" class="outline-2">
<h2 id="org3aa1bc7">work-directory</h2>
<div class="outline-text-2" id="text-org3aa1bc7">
</div><div id="outline-container-org3bc9c4b" class="outline-3">
<h3 id="org3bc9c4b">work-directory:get</h3>
<div class="outline-text-3" id="text-org3bc9c4b">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #fd971f; font-weight: bold;">512</span> <span style="color: #AE7C3B; font-weight: bold;">allocate-memory</span>
<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #fd971f; font-weight: bold;">*buffer,work-directory*</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #a1ab3a; font-weight: bold;">define-variable,with-tos</span>

<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">work-directory:get</span>
  <span style="color: #FF8888;">&lt;&lt; -- directory[address, length] &gt;&gt;</span>
  <span style="color: #fd971f; font-weight: bold;">512</span>
  <span style="color: #fd971f; font-weight: bold;">*buffer,work-directory*</span>
  <span style="color: #fd971f; font-weight: bold;">syscall-number:*getcwd*</span>
  <span style="color: #fd971f; font-weight: bold;">2</span> syscall
  dup <span style="color: #ffffff; font-weight: bold;">negative?</span> <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #e6db74;">"* (work-directory:get) fail"</span> .s .l
    <span style="color: #e6db74;">"  "</span> .s error-code<span style="color: #b0b1a3;">-&gt;</span>string .s .l
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #fd971f; font-weight: bold;">*buffer,work-directory*</span>
  swap
  sub1 <span style="color: #FF8888;">&lt;&lt; for the ending zero &gt;&gt;</span>
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org123d65d" class="outline-3">
<h3 id="org123d65d">work-directory:change</h3>
<div class="outline-text-3" id="text-org123d65d">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">work-directory:change</span>
  <span style="color: #FF8888;">&lt;&lt; directory-path[address, length] -- &gt;&gt;</span>
  <span style="color: #dc322f; font-weight: bold;">&gt;::directory-path</span>
  <span style="color: #5CDD5C; font-weight: bold;">::directory-path</span>
  string<span style="color: #b0b1a3;">-&gt;</span>syscall-string
  <span style="color: #fd971f; font-weight: bold;">syscall-number:*chdir*</span>
  <span style="color: #fd971f; font-weight: bold;">1</span> syscall
  dup <span style="color: #ffffff; font-weight: bold;">negative?</span> <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #e6db74;">"* (work-directory:change) fail"</span> .s .l
    <span style="color: #e6db74;">"  can not change the work directory into : "</span> .s <span style="color: #5CDD5C; font-weight: bold;">::directory-path</span> .s .l
    <span style="color: #e6db74;">"  thus the argument in the stack is not consumed"</span> .s .l
    <span style="color: #e6db74;">"  "</span> .s error-code<span style="color: #b0b1a3;">-&gt;</span>string .s .l
    <span style="color: #5CDD5C; font-weight: bold;">::directory-path</span>
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  drop
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org82224b7" class="outline-3">
<h3 id="org82224b7">pwd</h3>
<div class="outline-text-3" id="text-org82224b7">
<ul class="org-ul">
<li><p>print work-directory</p></li></ul>
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">pwd</span>
  <span style="color: #FF8888;">&lt;&lt; -- &gt;&gt;</span>
  <span style="color: #ffffff; font-weight: bold;">work-directory:</span>get .s .l
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgfc45127" class="outline-3">
<h3 id="orgfc45127">cd</h3>
<div class="outline-text-3" id="text-orgfc45127">
<ul class="org-ul">
<li><p>change work-directory</p></li></ul>
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #e6db74;">"cd"</span> <span style="color: #e6db74;">"work-directory:change"</span> alias
</pre>
</div>
</div>
</div>

<div id="outline-container-org4e6a566" class="outline-3">
<h3 id="org4e6a566"><span class="done test">test</span> </h3>
<div class="outline-text-3" id="text-org4e6a566">
<div class="org-src-container">

<pre class="src src-cicada-nymph">pwd
<span style="color: #e6db74;">"/home"</span> cd
pwd
<span style="color: #e6db74;">"/////home/xyh////cicada/play"</span> cd
pwd
<span style="color: #e6db74;">"//././/home/xyh/././cicada/./"</span> cd
pwd
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org5299cb9" class="outline-2">
<h2 id="org5299cb9">path</h2>
<div class="outline-text-2" id="text-org5299cb9">
</div><div id="outline-container-orgb4187f3" class="outline-3">
<h3 id="orgb4187f3">system-stat</h3>
<div class="outline-text-3" id="text-orgb4187f3">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #fd971f; font-weight: bold;">0</span> <span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">+stat,dev+</span>        <span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #a1ab3a; font-weight: bold;">define-variable,with-tos</span>
<span style="color: #fd971f; font-weight: bold;">0</span> <span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">+stat,ino+</span>        <span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #a1ab3a; font-weight: bold;">define-variable,with-tos</span>
<span style="color: #fd971f; font-weight: bold;">0</span> <span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">+stat,mode+</span>       <span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #a1ab3a; font-weight: bold;">define-variable,with-tos</span>
<span style="color: #fd971f; font-weight: bold;">0</span> <span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">+stat,nlink+</span>      <span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #a1ab3a; font-weight: bold;">define-variable,with-tos</span>
<span style="color: #fd971f; font-weight: bold;">0</span> <span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">+stat,uid+</span>        <span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #a1ab3a; font-weight: bold;">define-variable,with-tos</span>
<span style="color: #fd971f; font-weight: bold;">0</span> <span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">+stat,gid+</span>        <span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #a1ab3a; font-weight: bold;">define-variable,with-tos</span>
<span style="color: #fd971f; font-weight: bold;">0</span> <span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">+stat,rdev+</span>       <span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #a1ab3a; font-weight: bold;">define-variable,with-tos</span>
<span style="color: #fd971f; font-weight: bold;">0</span> <span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">+stat,size+</span>       <span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #a1ab3a; font-weight: bold;">define-variable,with-tos</span>
<span style="color: #fd971f; font-weight: bold;">0</span> <span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">+stat,blksize+</span>    <span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #a1ab3a; font-weight: bold;">define-variable,with-tos</span>
<span style="color: #fd971f; font-weight: bold;">0</span> <span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">+stat,blocks+</span>     <span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #a1ab3a; font-weight: bold;">define-variable,with-tos</span>
<span style="color: #fd971f; font-weight: bold;">0</span> <span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">+stat,atime+</span>      <span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #a1ab3a; font-weight: bold;">define-variable,with-tos</span>
<span style="color: #fd971f; font-weight: bold;">0</span> <span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">+stat,atime_nsec+</span> <span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #a1ab3a; font-weight: bold;">define-variable,with-tos</span>
<span style="color: #fd971f; font-weight: bold;">0</span> <span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">+stat,mtime+</span>      <span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #a1ab3a; font-weight: bold;">define-variable,with-tos</span>
<span style="color: #fd971f; font-weight: bold;">0</span> <span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">+stat,mtime_nsec+</span> <span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #a1ab3a; font-weight: bold;">define-variable,with-tos</span>
<span style="color: #fd971f; font-weight: bold;">0</span> <span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">+stat,ctime+</span>      <span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #a1ab3a; font-weight: bold;">define-variable,with-tos</span>
<span style="color: #fd971f; font-weight: bold;">0</span> <span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">+stat,ctime_nsec+</span> <span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #a1ab3a; font-weight: bold;">define-variable,with-tos</span>
<span style="color: #fd971f; font-weight: bold;">0</span> <span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">+stat,__unused4+</span>     <span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #a1ab3a; font-weight: bold;">define-variable,with-tos</span>
<span style="color: #fd971f; font-weight: bold;">0</span> <span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">+stat,__unused5+</span>     <span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #a1ab3a; font-weight: bold;">define-variable,with-tos</span>
<span style="color: #fd971f; font-weight: bold;">0</span> <span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">+stat,end+</span>           <span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #a1ab3a; font-weight: bold;">define-variable,with-tos</span>

<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">init,stat</span>
  <span style="color: #FF8888;">&lt;&lt; offset -- &gt;&gt;</span>
  <span style="color: #fd971f; font-weight: bold;">*cell-size*</span> <span style="color: #fd971f; font-weight: bold;">4</span> <span style="color: #ffffff; font-weight: bold;">equal?</span> <span style="color: #f92672; font-weight: bold;">if</span>
    dup <span style="color: #f92672; font-weight: bold;">address</span> <span style="color: #fd971f; font-weight: bold;">+stat,dev+</span>        set <span style="color: #fd971f; font-weight: bold;">*cell-size*</span> add
    dup <span style="color: #f92672; font-weight: bold;">address</span> <span style="color: #fd971f; font-weight: bold;">+stat,ino+</span>        set <span style="color: #fd971f; font-weight: bold;">*cell-size*</span> add
    dup <span style="color: #f92672; font-weight: bold;">address</span> <span style="color: #fd971f; font-weight: bold;">+stat,mode+</span>       set <span style="color: #fd971f; font-weight: bold;">2</span> add
    dup <span style="color: #f92672; font-weight: bold;">address</span> <span style="color: #fd971f; font-weight: bold;">+stat,nlink+</span>      set <span style="color: #fd971f; font-weight: bold;">2</span> add
    dup <span style="color: #f92672; font-weight: bold;">address</span> <span style="color: #fd971f; font-weight: bold;">+stat,uid+</span>        set <span style="color: #fd971f; font-weight: bold;">2</span> add
    dup <span style="color: #f92672; font-weight: bold;">address</span> <span style="color: #fd971f; font-weight: bold;">+stat,gid+</span>        set <span style="color: #fd971f; font-weight: bold;">2</span> add
    dup <span style="color: #f92672; font-weight: bold;">address</span> <span style="color: #fd971f; font-weight: bold;">+stat,rdev+</span>       set <span style="color: #fd971f; font-weight: bold;">*cell-size*</span> add
    dup <span style="color: #f92672; font-weight: bold;">address</span> <span style="color: #fd971f; font-weight: bold;">+stat,size+</span>       set <span style="color: #fd971f; font-weight: bold;">*cell-size*</span> add
    dup <span style="color: #f92672; font-weight: bold;">address</span> <span style="color: #fd971f; font-weight: bold;">+stat,blksize+</span>    set <span style="color: #fd971f; font-weight: bold;">*cell-size*</span> add
    dup <span style="color: #f92672; font-weight: bold;">address</span> <span style="color: #fd971f; font-weight: bold;">+stat,blocks+</span>     set <span style="color: #fd971f; font-weight: bold;">*cell-size*</span> add
    dup <span style="color: #f92672; font-weight: bold;">address</span> <span style="color: #fd971f; font-weight: bold;">+stat,atime+</span>      set <span style="color: #fd971f; font-weight: bold;">*cell-size*</span> add
    dup <span style="color: #f92672; font-weight: bold;">address</span> <span style="color: #fd971f; font-weight: bold;">+stat,atime_nsec+</span> set <span style="color: #fd971f; font-weight: bold;">*cell-size*</span> add
    dup <span style="color: #f92672; font-weight: bold;">address</span> <span style="color: #fd971f; font-weight: bold;">+stat,mtime+</span>      set <span style="color: #fd971f; font-weight: bold;">*cell-size*</span> add
    dup <span style="color: #f92672; font-weight: bold;">address</span> <span style="color: #fd971f; font-weight: bold;">+stat,mtime_nsec+</span> set <span style="color: #fd971f; font-weight: bold;">*cell-size*</span> add
    dup <span style="color: #f92672; font-weight: bold;">address</span> <span style="color: #fd971f; font-weight: bold;">+stat,ctime+</span>      set <span style="color: #fd971f; font-weight: bold;">*cell-size*</span> add
    dup <span style="color: #f92672; font-weight: bold;">address</span> <span style="color: #fd971f; font-weight: bold;">+stat,ctime_nsec+</span> set <span style="color: #fd971f; font-weight: bold;">*cell-size*</span> add
    dup <span style="color: #f92672; font-weight: bold;">address</span> <span style="color: #fd971f; font-weight: bold;">+stat,__unused4+</span>     set <span style="color: #fd971f; font-weight: bold;">*cell-size*</span> add
    dup <span style="color: #f92672; font-weight: bold;">address</span> <span style="color: #fd971f; font-weight: bold;">+stat,__unused5+</span>     set <span style="color: #fd971f; font-weight: bold;">*cell-size*</span> add
        <span style="color: #f92672; font-weight: bold;">address</span> <span style="color: #fd971f; font-weight: bold;">+stat,end+</span>           set
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #fd971f; font-weight: bold;">*cell-size*</span> <span style="color: #fd971f; font-weight: bold;">8</span> <span style="color: #ffffff; font-weight: bold;">equal?</span> <span style="color: #f92672; font-weight: bold;">if</span>
    dup <span style="color: #f92672; font-weight: bold;">address</span> <span style="color: #fd971f; font-weight: bold;">+stat,dev+</span>        set <span style="color: #fd971f; font-weight: bold;">*cell-size*</span> add
    dup <span style="color: #f92672; font-weight: bold;">address</span> <span style="color: #fd971f; font-weight: bold;">+stat,ino+</span>        set <span style="color: #fd971f; font-weight: bold;">*cell-size*</span> add
    <span style="color: #FF8888;">&lt;&lt;</span>
<span style="color: #FF8888;">    note the following order changing</span>
<span style="color: #FF8888;">    this is linux' bad</span>
<span style="color: #FF8888;">    &gt;&gt;</span>
    dup <span style="color: #f92672; font-weight: bold;">address</span> <span style="color: #fd971f; font-weight: bold;">+stat,nlink+</span>      set <span style="color: #fd971f; font-weight: bold;">8</span> add
    dup <span style="color: #f92672; font-weight: bold;">address</span> <span style="color: #fd971f; font-weight: bold;">+stat,mode+</span>       set <span style="color: #fd971f; font-weight: bold;">4</span> add

    dup <span style="color: #f92672; font-weight: bold;">address</span> <span style="color: #fd971f; font-weight: bold;">+stat,uid+</span>        set <span style="color: #fd971f; font-weight: bold;">4</span> add
    dup <span style="color: #f92672; font-weight: bold;">address</span> <span style="color: #fd971f; font-weight: bold;">+stat,gid+</span>        set <span style="color: #fd971f; font-weight: bold;">4</span> add
                                         <span style="color: #fd971f; font-weight: bold;">4</span> add <span style="color: #FF8888;">&lt;&lt; padding &gt;&gt;</span>
    dup <span style="color: #f92672; font-weight: bold;">address</span> <span style="color: #fd971f; font-weight: bold;">+stat,rdev+</span>       set <span style="color: #fd971f; font-weight: bold;">*cell-size*</span> add
    dup <span style="color: #f92672; font-weight: bold;">address</span> <span style="color: #fd971f; font-weight: bold;">+stat,size+</span>       set <span style="color: #fd971f; font-weight: bold;">*cell-size*</span> add
    dup <span style="color: #f92672; font-weight: bold;">address</span> <span style="color: #fd971f; font-weight: bold;">+stat,blksize+</span>    set <span style="color: #fd971f; font-weight: bold;">*cell-size*</span> add
    dup <span style="color: #f92672; font-weight: bold;">address</span> <span style="color: #fd971f; font-weight: bold;">+stat,blocks+</span>     set <span style="color: #fd971f; font-weight: bold;">*cell-size*</span> add
    dup <span style="color: #f92672; font-weight: bold;">address</span> <span style="color: #fd971f; font-weight: bold;">+stat,atime+</span>      set <span style="color: #fd971f; font-weight: bold;">*cell-size*</span> add
    dup <span style="color: #f92672; font-weight: bold;">address</span> <span style="color: #fd971f; font-weight: bold;">+stat,atime_nsec+</span> set <span style="color: #fd971f; font-weight: bold;">*cell-size*</span> add
    dup <span style="color: #f92672; font-weight: bold;">address</span> <span style="color: #fd971f; font-weight: bold;">+stat,mtime+</span>      set <span style="color: #fd971f; font-weight: bold;">*cell-size*</span> add
    dup <span style="color: #f92672; font-weight: bold;">address</span> <span style="color: #fd971f; font-weight: bold;">+stat,mtime_nsec+</span> set <span style="color: #fd971f; font-weight: bold;">*cell-size*</span> add
    dup <span style="color: #f92672; font-weight: bold;">address</span> <span style="color: #fd971f; font-weight: bold;">+stat,ctime+</span>      set <span style="color: #fd971f; font-weight: bold;">*cell-size*</span> add
    dup <span style="color: #f92672; font-weight: bold;">address</span> <span style="color: #fd971f; font-weight: bold;">+stat,ctime_nsec+</span> set <span style="color: #fd971f; font-weight: bold;">*cell-size*</span> add
    dup <span style="color: #f92672; font-weight: bold;">address</span> <span style="color: #fd971f; font-weight: bold;">+stat,__unused4+</span>     set <span style="color: #fd971f; font-weight: bold;">*cell-size*</span> add
    dup <span style="color: #f92672; font-weight: bold;">address</span> <span style="color: #fd971f; font-weight: bold;">+stat,__unused5+</span>     set <span style="color: #fd971f; font-weight: bold;">*cell-size*</span> add
        <span style="color: #f92672; font-weight: bold;">address</span> <span style="color: #fd971f; font-weight: bold;">+stat,end+</span>           set
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>

<span style="color: #fd971f; font-weight: bold;">0</span> init,stat
<span style="color: #fd971f; font-weight: bold;">+stat,end+</span> <span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">+stat,length+</span> <span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #a1ab3a; font-weight: bold;">define-variable,with-tos</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org98d5611" class="outline-3">
<h3 id="org98d5611"><span class="done test">test</span> </h3>
<div class="outline-text-3" id="text-org98d5611">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">test,stat</span>
  <span style="color: #FF8888;">&lt;&lt; path[address, length] -- &gt;&gt;</span>
  string<span style="color: #b0b1a3;">-&gt;</span>syscall-string
  <span style="color: #FF4C4C; font-weight: bold;">&gt;:syscall-path</span>
  <span style="color: #fd971f; font-weight: bold;">+stat,length+</span> <span style="color: #AE7C3B; font-weight: bold;">allocate-local-memory</span>
  <span style="color: #FF4C4C; font-weight: bold;">&gt;:stat-structure</span>
  <span style="color: #83EA83; font-weight: bold;">:stat-structure</span>
  <span style="color: #83EA83; font-weight: bold;">:syscall-path</span>
  <span style="color: #fd971f; font-weight: bold;">syscall-number:*stat*</span>
  <span style="color: #fd971f; font-weight: bold;">2</span> syscall
  dup
  <span style="color: #ffffff; font-weight: bold;">negative?</span> <span style="color: #f92672; font-weight: bold;">if</span>
    dup .
    error-code<span style="color: #b0b1a3;">-&gt;</span>string .s .l
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  drop
  <span style="color: #83EA83; font-weight: bold;">:stat-structure</span> init,stat
  <span style="color: #e6db74;">"+stat,dev+ : "</span> .s <span style="color: #fd971f; font-weight: bold;">+stat,dev+</span>        get . .l
  <span style="color: #e6db74;">"+stat,ino+ : "</span> .s <span style="color: #fd971f; font-weight: bold;">+stat,ino+</span>        get . .l
  <span style="color: #fd971f; font-weight: bold;">*cell-size*</span> <span style="color: #fd971f; font-weight: bold;">4</span> <span style="color: #ffffff; font-weight: bold;">equal?</span> <span style="color: #f92672; font-weight: bold;">if</span>
  <span style="color: #e6db74;">"+stat,mode+ : "</span> .s <span style="color: #fd971f; font-weight: bold;">+stat,mode+</span>       get-two-bytes  . .l
  <span style="color: #e6db74;">"+stat,nlink+ : "</span> .s <span style="color: #fd971f; font-weight: bold;">+stat,nlink+</span>      get-two-bytes  . .l
  <span style="color: #e6db74;">"+stat,uid+ : "</span> .s <span style="color: #fd971f; font-weight: bold;">+stat,uid+</span>        get-two-bytes  . .l
  <span style="color: #e6db74;">"+stat,gid+ : "</span> .s <span style="color: #fd971f; font-weight: bold;">+stat,gid+</span>        get-two-bytes  . .l
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #fd971f; font-weight: bold;">*cell-size*</span> <span style="color: #fd971f; font-weight: bold;">8</span> <span style="color: #ffffff; font-weight: bold;">equal?</span> <span style="color: #f92672; font-weight: bold;">if</span>
  <span style="color: #e6db74;">"+stat,nlink+ : "</span> .s <span style="color: #fd971f; font-weight: bold;">+stat,nlink+</span>      get  . .l
  <span style="color: #e6db74;">"+stat,mode+ : "</span> .s <span style="color: #fd971f; font-weight: bold;">+stat,mode+</span>       get-four-bytes  . .l
  <span style="color: #e6db74;">"+stat,uid+ : "</span> .s <span style="color: #fd971f; font-weight: bold;">+stat,uid+</span>        get-four-bytes  . .l
  <span style="color: #e6db74;">"+stat,gid+ : "</span> .s <span style="color: #fd971f; font-weight: bold;">+stat,gid+</span>        get-four-bytes  . .l
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #e6db74;">"+stat,rdev+ : "</span> .s <span style="color: #fd971f; font-weight: bold;">+stat,rdev+</span>       get . .l
  <span style="color: #e6db74;">"+stat,size+ : "</span> .s <span style="color: #fd971f; font-weight: bold;">+stat,size+</span>       get . .l
  <span style="color: #e6db74;">"+stat,blksize+ : "</span> .s <span style="color: #fd971f; font-weight: bold;">+stat,blksize+</span>    get . .l
  <span style="color: #e6db74;">"+stat,blocks+ : "</span> .s <span style="color: #fd971f; font-weight: bold;">+stat,blocks+</span>     get . .l
  <span style="color: #e6db74;">"+stat,atime+ : "</span> .s <span style="color: #fd971f; font-weight: bold;">+stat,atime+</span>      get . .l
  <span style="color: #e6db74;">"+stat,atime_nsec+ : "</span> .s <span style="color: #fd971f; font-weight: bold;">+stat,atime_nsec+</span> get . .l
  <span style="color: #e6db74;">"+stat,mtime+ : "</span> .s <span style="color: #fd971f; font-weight: bold;">+stat,mtime+</span>      get . .l
  <span style="color: #e6db74;">"+stat,mtime_nsec+ : "</span> .s <span style="color: #fd971f; font-weight: bold;">+stat,mtime_nsec+</span> get . .l
  <span style="color: #e6db74;">"+stat,ctime+ : "</span> .s <span style="color: #fd971f; font-weight: bold;">+stat,ctime+</span>      get . .l
  <span style="color: #e6db74;">"+stat,ctime_nsec+ : "</span> .s <span style="color: #fd971f; font-weight: bold;">+stat,ctime_nsec+</span> get . .l
  <span style="color: #e6db74;">"+stat,__unused4+ : "</span> .s <span style="color: #fd971f; font-weight: bold;">+stat,__unused4+</span>     get . .l
  <span style="color: #e6db74;">"+stat,__unused5+ : "</span> .s <span style="color: #fd971f; font-weight: bold;">+stat,__unused5+</span>     get . .l
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>

<span style="color: #e6db74;">"cn"</span> test,stat
<span style="color: #e6db74;">"no"</span> test,stat
</pre>
</div>
</div>
</div>

<div id="outline-container-org5cdd2c0" class="outline-3">
<h3 id="org5cdd2c0"><span class="todo note">note</span> predicate</h3>
<div class="outline-text-3" id="text-org5cdd2c0">
<ul class="org-ul">
<li><p>to use predicate to know more about the file-tree</p><p>before calling a function that makes action on the file-tree</p></li></ul>
</div>
</div>

<div id="outline-container-org60633be" class="outline-3">
<h3 id="org60633be">path:nothing?</h3>
<div class="outline-text-3" id="text-org60633be">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">path:nothing?</span>
  <span style="color: #FF8888;">&lt;&lt; path[address, length] -- bool &gt;&gt;</span>
  string<span style="color: #b0b1a3;">-&gt;</span>syscall-string
  <span style="color: #FF4C4C; font-weight: bold;">&gt;:syscall-path</span>
  <span style="color: #fd971f; font-weight: bold;">+stat,length+</span> <span style="color: #AE7C3B; font-weight: bold;">allocate-local-memory</span>
  <span style="color: #FF4C4C; font-weight: bold;">&gt;:stat-structure</span>
  <span style="color: #83EA83; font-weight: bold;">:stat-structure</span>
  <span style="color: #83EA83; font-weight: bold;">:syscall-path</span>
  <span style="color: #fd971f; font-weight: bold;">syscall-number:*stat*</span>
  <span style="color: #fd971f; font-weight: bold;">2</span> syscall
  <span style="color: #fd971f; font-weight: bold;">-2</span> <span style="color: #ffffff; font-weight: bold;">equal?</span>
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgbe69d56" class="outline-3">
<h3 id="orgbe69d56">path:file?</h3>
<div class="outline-text-3" id="text-orgbe69d56">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">path:file?</span>
  <span style="color: #FF8888;">&lt;&lt; path[address, length] -- bool &gt;&gt;</span>
  string<span style="color: #b0b1a3;">-&gt;</span>syscall-string
  <span style="color: #FF4C4C; font-weight: bold;">&gt;:syscall-path</span>
  <span style="color: #fd971f; font-weight: bold;">+stat,length+</span> <span style="color: #AE7C3B; font-weight: bold;">allocate-local-memory</span>
  <span style="color: #FF4C4C; font-weight: bold;">&gt;:stat-structure</span>
  <span style="color: #83EA83; font-weight: bold;">:stat-structure</span>
  <span style="color: #83EA83; font-weight: bold;">:syscall-path</span>
  <span style="color: #fd971f; font-weight: bold;">syscall-number:*stat*</span>
  <span style="color: #fd971f; font-weight: bold;">2</span> syscall
  dup
  <span style="color: #ffffff; font-weight: bold;">negative?</span> <span style="color: #f92672; font-weight: bold;">if</span>
    drop
    <span style="color: #fd971f; font-weight: bold;">false</span>
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  drop
  <span style="color: #83EA83; font-weight: bold;">:stat-structure</span> init,stat
  <span style="color: #fd971f; font-weight: bold;">*cell-size*</span> <span style="color: #fd971f; font-weight: bold;">4</span> <span style="color: #ffffff; font-weight: bold;">equal?</span> <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #fd971f; font-weight: bold;">+stat,mode+</span>
    get-two-bytes
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #fd971f; font-weight: bold;">*cell-size*</span> <span style="color: #fd971f; font-weight: bold;">8</span> <span style="color: #ffffff; font-weight: bold;">equal?</span> <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #fd971f; font-weight: bold;">+stat,mode+</span>
    get-four-bytes
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #fd971f; font-weight: bold;">12</span> bit-right
  <span style="color: #fd971f; font-weight: bold;">8</span><span style="color: #ffff00;">#</span><span style="color: #fd971f; font-weight: bold;">0010</span>
  <span style="color: #ffffff; font-weight: bold;">equal?</span>
  <span style="color: #FF8888;">&lt;&lt;</span>
<span style="color: #FF8888;">  0170000</span>
<span style="color: #FF8888;">  S_IFDIR       0040000 /* Directory.  */</span>
<span style="color: #FF8888;">  S_IFCHR       0020000 /* Character device.  */</span>
<span style="color: #FF8888;">  S_IFBLK       0060000 /* Block device.  */</span>
<span style="color: #FF8888;">  S_IFREG       0100000 /* Regular file.  */</span>
<span style="color: #FF8888;">  S_IFIFO       0010000 /* FIFO.  */</span>
<span style="color: #FF8888;">  S_IFLNK       0120000 /* Symbolic link.  */</span>
<span style="color: #FF8888;">  S_IFSOCK      0140000 /* Socket.  */</span>
<span style="color: #FF8888;">  &gt;&gt;</span>
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgda036e4" class="outline-3">
<h3 id="orgda036e4">path:directory?</h3>
<div class="outline-text-3" id="text-orgda036e4">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">path:directory?</span>
  <span style="color: #FF8888;">&lt;&lt; path[address, length] -- bool &gt;&gt;</span>
  string<span style="color: #b0b1a3;">-&gt;</span>syscall-string
  <span style="color: #FF4C4C; font-weight: bold;">&gt;:syscall-path</span>
  <span style="color: #fd971f; font-weight: bold;">+stat,length+</span> <span style="color: #AE7C3B; font-weight: bold;">allocate-local-memory</span>
  <span style="color: #FF4C4C; font-weight: bold;">&gt;:stat-structure</span>
  <span style="color: #83EA83; font-weight: bold;">:stat-structure</span>
  <span style="color: #83EA83; font-weight: bold;">:syscall-path</span>
  <span style="color: #fd971f; font-weight: bold;">syscall-number:*stat*</span>
  <span style="color: #fd971f; font-weight: bold;">2</span> syscall
  dup
  <span style="color: #ffffff; font-weight: bold;">negative?</span> <span style="color: #f92672; font-weight: bold;">if</span>
    drop
    <span style="color: #fd971f; font-weight: bold;">false</span>
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  drop
  <span style="color: #83EA83; font-weight: bold;">:stat-structure</span> init,stat
  <span style="color: #fd971f; font-weight: bold;">*cell-size*</span> <span style="color: #fd971f; font-weight: bold;">4</span> <span style="color: #ffffff; font-weight: bold;">equal?</span> <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #fd971f; font-weight: bold;">+stat,mode+</span>
    get-two-bytes
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #fd971f; font-weight: bold;">*cell-size*</span> <span style="color: #fd971f; font-weight: bold;">8</span> <span style="color: #ffffff; font-weight: bold;">equal?</span> <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #fd971f; font-weight: bold;">+stat,mode+</span>
    get-four-bytes
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #fd971f; font-weight: bold;">12</span> bit-right
  <span style="color: #fd971f; font-weight: bold;">8</span><span style="color: #ffff00;">#</span><span style="color: #fd971f; font-weight: bold;">0004</span>
  <span style="color: #ffffff; font-weight: bold;">equal?</span>
  <span style="color: #FF8888;">&lt;&lt;</span>
<span style="color: #FF8888;">  0170000</span>
<span style="color: #FF8888;">  S_IFDIR       00040000 /* Directory.  */</span>
<span style="color: #FF8888;">  S_IFCHR       00020000 /* Character device.  */</span>
<span style="color: #FF8888;">  S_IFBLK       00060000 /* Block device.  */</span>
<span style="color: #FF8888;">  S_IFREG       00100000 /* Regular file.  */</span>
<span style="color: #FF8888;">  S_IFIFO       00010000 /* FIFO.  */</span>
<span style="color: #FF8888;">  S_IFLNK       00120000 /* Symbolic link.  */</span>
<span style="color: #FF8888;">  S_IFSOCK      00140000 /* Socket.  */</span>
<span style="color: #FF8888;">  &gt;&gt;</span>
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org7c334fe" class="outline-3">
<h3 id="org7c334fe"><span class="done test">test</span> </h3>
<div class="outline-text-3" id="text-org7c334fe">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #e6db74;">"cn"</span> <span style="color: #ffffff; font-weight: bold;">path:</span>nothing? . <span style="color: #FF8888;">&lt;&lt; 0 &gt;&gt;</span>
<span style="color: #e6db74;">"core"</span> <span style="color: #ffffff; font-weight: bold;">path:</span>nothing? . <span style="color: #FF8888;">&lt;&lt; 0 &gt;&gt;</span>
<span style="color: #e6db74;">"ai"</span> <span style="color: #ffffff; font-weight: bold;">path:</span>nothing? . <span style="color: #FF8888;">&lt;&lt; 1 &gt;&gt;</span>

<span style="color: #e6db74;">"cn"</span> <span style="color: #ffffff; font-weight: bold;">path:</span>file? . <span style="color: #FF8888;">&lt;&lt; 1 &gt;&gt;</span>
<span style="color: #e6db74;">"core"</span> <span style="color: #ffffff; font-weight: bold;">path:</span>file? . <span style="color: #FF8888;">&lt;&lt; 0 &gt;&gt;</span>
<span style="color: #e6db74;">"ai"</span> <span style="color: #ffffff; font-weight: bold;">path:</span>file? . <span style="color: #FF8888;">&lt;&lt; 0 &gt;&gt;</span>

<span style="color: #e6db74;">"cn"</span> <span style="color: #ffffff; font-weight: bold;">path:</span>directory? . <span style="color: #FF8888;">&lt;&lt; 0 &gt;&gt;</span>
<span style="color: #e6db74;">"core"</span> <span style="color: #ffffff; font-weight: bold;">path:</span>directory? . <span style="color: #FF8888;">&lt;&lt; 1 &gt;&gt;</span>
<span style="color: #e6db74;">"ai"</span> <span style="color: #ffffff; font-weight: bold;">path:</span>directory? . <span style="color: #FF8888;">&lt;&lt; 0 &gt;&gt;</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org1e05c36" class="outline-3">
<h3 id="org1e05c36"><span class="todo _">記</span> 字符串的謂詞</h3>
<div class="outline-text-3" id="text-org1e05c36">
<ul class="org-ul">
<li><p>下面這兩個函數</p><p>其實是在用遞歸函數實現正則表達式對字符串的匹配效果</p></li>
<li><p>是否應該設計 正則表達式 子語言 ?</p><p>還是總是直接使用遞歸函數 ?</p></li></ul>
</div>
</div>

<div id="outline-container-orgd85852c" class="outline-3">
<h3 id="orgd85852c"><span class="todo _">記</span> unix 路徑格式</h3>
<div class="outline-text-3" id="text-orgd85852c">
<ul class="org-ul">
<li><p>"<i>" 相當於 空格</p><p>連續的 "/</i>" 相當於 連續的空格</p><p>這種空格使用在字符串開頭時 代表這是一個 絕對路徑</p></li>
<li><p>"." 相當於 空格</p><p>連續的 ".." 不算 連續的空格 有別的語義</p><p>但是在這種空格使用在最前面的時候 標誌這個</p><p>這種空格使用在字符串開頭時 代表這是一個 相對路徑</p></li>
<li><p>而對於下面的兩個函數我簡單地要求</p><p><ol class="org-ol"></p><p><li>relative-path</p><p>不以 "/" 開頭 的字符串</li></p><p><li>full-path</p><p>以 "/" 開頭 的字符串</li></p><p><li>並且在這裏我允許 path 內 出現空格</p><p>保留對這種路徑的處理能力</p><p>只不過 我不使用這種路徑而已</li></ol></p></li></ul>
</div>
</div>

<div id="outline-container-org505d47b" class="outline-3">
<h3 id="org505d47b">path:relative?</h3>
<div class="outline-text-3" id="text-org505d47b">
<ul class="org-ul">
<li><p>in ASCII "/" is 47</p></li></ul>
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">path:relative?</span>
  <span style="color: #FF8888;">&lt;&lt; string[address, length] -- bool &gt;&gt;</span>
  dup <span style="color: #ffffff; font-weight: bold;">zero?</span> <span style="color: #f92672; font-weight: bold;">if</span>
    drop2
    <span style="color: #fd971f; font-weight: bold;">false</span>
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #ffffff; font-weight: bold;">string:</span>byte
  <span style="color: #fd971f; font-weight: bold;">47</span> <span style="color: #ffffff; font-weight: bold;">equal?</span> not
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org30f7773" class="outline-3">
<h3 id="org30f7773">path:full?</h3>
<div class="outline-text-3" id="text-org30f7773">
<ul class="org-ul">
<li><p>in ASCII "/" is 47</p></li></ul>
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">path:full?</span>
  <span style="color: #FF8888;">&lt;&lt; string[address, length] -- bool &gt;&gt;</span>
  dup <span style="color: #ffffff; font-weight: bold;">zero?</span> <span style="color: #f92672; font-weight: bold;">if</span>
    drop2
    <span style="color: #fd971f; font-weight: bold;">false</span>
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #ffffff; font-weight: bold;">string:</span>byte
  <span style="color: #fd971f; font-weight: bold;">47</span> <span style="color: #ffffff; font-weight: bold;">equal?</span>
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org61af09e" class="outline-3">
<h3 id="org61af09e"><span class="done test">test</span> path:full?</h3>
<div class="outline-text-3" id="text-org61af09e">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #e6db74;">"* (testing) path:full?"</span> .s .l
  <span style="color: #e6db74;">"/home"</span> <span style="color: #ffffff; font-weight: bold;">path:</span>relative? <span style="color: #ffffff; font-weight: bold;">false?</span>
  <span style="color: #e6db74;">"/home"</span> <span style="color: #ffffff; font-weight: bold;">path:</span>full?     <span style="color: #ffffff; font-weight: bold;">true?</span> and
  <span style="color: #e6db74;">"home"</span>  <span style="color: #ffffff; font-weight: bold;">path:</span>relative? <span style="color: #ffffff; font-weight: bold;">true?</span> and
  <span style="color: #e6db74;">"home"</span>  <span style="color: #ffffff; font-weight: bold;">path:</span>full?     <span style="color: #ffffff; font-weight: bold;">false?</span> and <span style="color: #1ef15f; font-weight: bold;">test</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #1ef15f; font-weight: bold;">test-do</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgeb875fb" class="outline-2">
<h2 id="orgeb875fb">poi</h2>
<div class="outline-text-2" id="text-orgeb875fb">
</div><div id="outline-container-orgac615f1" class="outline-3">
<h3 id="orgac615f1"><span class="todo _">記</span> </h3>
<div class="outline-text-3" id="text-orgac615f1">
<ul class="org-ul">
<li><p>poi 是利用文件系統所實現的登記機制</p><p>所登記的 path 信息爲 path-syntax 所用</p></li>
<li><p>module 也是用文件系統所實現的登記機制</p><p>所登記的 path 信息爲 module 機制所用</p></li></ul>
</div>
</div>

<div id="outline-container-orgeca620b" class="outline-3">
<h3 id="orgeca620b"><span class="todo note">note</span> </h3>
<div class="outline-text-3" id="text-orgeca620b">
<ul class="org-ul">
<li><p>poi denotes path-organizer</p><p>it can give a name to a path</p><p>one path one name</p></li>
<li><p>a path as a string must not contain any space bytes</p></li>
<li><p>a name should only consist of number or letter or "-"</p></li></ul>
</div>
</div>

<div id="outline-container-org54475b9" class="outline-3">
<h3 id="org54475b9"><b>poi-directory</b></h3>
<div class="outline-text-3" id="text-org54475b9">
<ul class="org-ul">
<li><p>one directory to store the name path record</p><p>"<i>home/&lt;user&gt;</i>.cicada/poi"</p></li></ul>
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #fd971f; font-weight: bold;">*poi-directory,user,address*</span>
  <span style="color: #fd971f; font-weight: bold;">512</span> <span style="color: #AE7C3B; font-weight: bold;">allocate-memory</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #a1ab3a; font-weight: bold;">define-variable</span>

<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #fd971f; font-weight: bold;">*poi-directory*</span>
  <span style="color: #fd971f; font-weight: bold;">*home-directory*</span> <span style="color: #e6db74;">"/.cicada/poi"</span>
  <span style="color: #fd971f; font-weight: bold;">*poi-directory,user,address*</span>
  <span style="color: #fd971f; font-weight: bold;">2</span> n-string<span style="color: #b0b1a3;">-&gt;</span>buffer!
  <span style="color: #fd971f; font-weight: bold;">*poi-directory,user,address*</span> swap
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #a1ab3a; font-weight: bold;">define-variable</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org356dc7c" class="outline-3">
<h3 id="org356dc7c">poi:find</h3>
<div class="outline-text-3" id="text-org356dc7c">
<ul class="org-ul">
<li><p>note that</p><p>this function uses <b>circular-string-area</b></p></li></ul>
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">poi:find</span>
  <span style="color: #FF8888;">&lt;&lt; name[address, length]</span>
<span style="color: #FF8888;">     -- path[address, length], true</span>
<span style="color: #FF8888;">     -- false &gt;&gt;</span>
  <span style="color: #dc322f; font-weight: bold;">&gt;::name</span>
  <span style="color: #fd971f; font-weight: bold;">512</span> <span style="color: #AE7C3B; font-weight: bold;">allocate-local-memory</span> <span style="color: #FF4C4C; font-weight: bold;">&gt;:buffer</span>
  <span style="color: #fd971f; font-weight: bold;">*poi-directory*</span> <span style="color: #e6db74;">"/"</span> <span style="color: #5CDD5C; font-weight: bold;">::name</span> <span style="color: #e6db74;">"/path"</span>
  <span style="color: #83EA83; font-weight: bold;">:buffer</span>
  <span style="color: #fd971f; font-weight: bold;">4</span> n-string<span style="color: #b0b1a3;">-&gt;</span>buffer! <span style="color: #FF4C4C; font-weight: bold;">&gt;:length</span>

  <span style="color: #83EA83; font-weight: bold;">:buffer</span> <span style="color: #83EA83; font-weight: bold;">:length</span>
  <span style="color: #ffffff; font-weight: bold;">path:</span>file? not <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #fd971f; font-weight: bold;">false</span>
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>

  <span style="color: #fd971f; font-weight: bold;">512</span> <span style="color: #AE7C3B; font-weight: bold;">allocate-local-memory</span> <span style="color: #FF4C4C; font-weight: bold;">&gt;:read-buffer</span>
  <span style="color: #83EA83; font-weight: bold;">:read-buffer</span> <span style="color: #fd971f; font-weight: bold;">512</span>
  <span style="color: #83EA83; font-weight: bold;">:buffer</span> <span style="color: #83EA83; font-weight: bold;">:length</span>
  <span style="color: #ffffff; font-weight: bold;">file:</span>read <span style="color: #FF4C4C; font-weight: bold;">&gt;:read-length</span>

  <span style="color: #fd971f; font-weight: bold;">*circular-string-area,current-free-address*</span>
  <span style="color: #FF4C4C; font-weight: bold;">&gt;:path-address</span>

  <span style="color: #83EA83; font-weight: bold;">:read-buffer</span> <span style="color: #83EA83; font-weight: bold;">:read-length</span>
  circular-string-area,stay

  <span style="color: #83EA83; font-weight: bold;">:path-address</span>
  <span style="color: #83EA83; font-weight: bold;">:read-length</span>
  <span style="color: #fd971f; font-weight: bold;">true</span>
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org1bd6421" class="outline-3">
<h3 id="org1bd6421">poi:add</h3>
<div class="outline-text-3" id="text-org1bd6421">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">poi:add</span>
  <span style="color: #FF8888;">&lt;&lt; name[address, length], relative-path[address, length] -- &gt;&gt;</span>
  <span style="color: #dc322f; font-weight: bold;">&gt;::relative-path</span>
  <span style="color: #dc322f; font-weight: bold;">&gt;::name</span>

  <span style="color: #5CDD5C; font-weight: bold;">::relative-path</span> <span style="color: #ffffff; font-weight: bold;">path:</span>relative? not <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #e6db74;">"* (poi:add) the argument must be a relative-path"</span> .s .l
    <span style="color: #e6db74;">"  but the following is not : "</span> .s <span style="color: #5CDD5C; font-weight: bold;">::relative-path</span> .s .l
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>

  <span style="color: #5CDD5C; font-weight: bold;">::relative-path</span> <span style="color: #ffffff; font-weight: bold;">path:</span>directory? not <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #e6db74;">"* (poi:add) the argument must be a relative-path to a existing directory"</span> .s .l
    <span style="color: #e6db74;">"  but the following path is not to a directory : "</span> .s <span style="color: #5CDD5C; font-weight: bold;">::relative-path</span> .s .l
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>

  <span style="color: #5CDD5C; font-weight: bold;">::name</span> <span style="color: #ffffff; font-weight: bold;">poi:</span>find <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #e6db74;">"* (poi:add) can not add"</span> .s .l
    <span style="color: #e6db74;">"  for the following poi already exist : "</span> .s <span style="color: #5CDD5C; font-weight: bold;">::name</span> .s .l
    <span style="color: #e6db74;">"  name is use as the following directory's name : "</span> .s .s .l
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>

  <span style="color: #fd971f; font-weight: bold;">512</span> <span style="color: #AE7C3B; font-weight: bold;">allocate-local-memory</span> <span style="color: #FF4C4C; font-weight: bold;">&gt;:buffer</span>
  <span style="color: #fd971f; font-weight: bold;">*poi-directory*</span> <span style="color: #e6db74;">"/"</span> <span style="color: #5CDD5C; font-weight: bold;">::name</span>
  <span style="color: #83EA83; font-weight: bold;">:buffer</span>
  <span style="color: #fd971f; font-weight: bold;">3</span> n-string<span style="color: #b0b1a3;">-&gt;</span>buffer!
  <span style="color: #FF4C4C; font-weight: bold;">&gt;:length</span>
  <span style="color: #83EA83; font-weight: bold;">:buffer</span> <span style="color: #83EA83; font-weight: bold;">:length</span>
  <span style="color: #ffffff; font-weight: bold;">directory:</span>create

  <span style="color: #fd971f; font-weight: bold;">*poi-directory*</span> <span style="color: #e6db74;">"/"</span> <span style="color: #5CDD5C; font-weight: bold;">::name</span> <span style="color: #e6db74;">"/path"</span>
  <span style="color: #83EA83; font-weight: bold;">:buffer</span>
  <span style="color: #fd971f; font-weight: bold;">4</span> n-string<span style="color: #b0b1a3;">-&gt;</span>buffer!
  <span style="color: #FF4C4C; font-weight: bold;">&gt;:length</span>
  <span style="color: #83EA83; font-weight: bold;">:buffer</span> <span style="color: #83EA83; font-weight: bold;">:length</span>
  <span style="color: #ffffff; font-weight: bold;">file:</span>create

  <span style="color: #fd971f; font-weight: bold;">512</span> <span style="color: #AE7C3B; font-weight: bold;">allocate-local-memory</span> <span style="color: #FF4C4C; font-weight: bold;">&gt;:address,full-path</span>
  <span style="color: #ffffff; font-weight: bold;">work-directory:</span>get <span style="color: #e6db74;">"/"</span> <span style="color: #5CDD5C; font-weight: bold;">::relative-path</span>
  <span style="color: #83EA83; font-weight: bold;">:address,full-path</span>
  <span style="color: #fd971f; font-weight: bold;">3</span> n-string<span style="color: #b0b1a3;">-&gt;</span>buffer! <span style="color: #FF4C4C; font-weight: bold;">&gt;:length,full-path</span>

  <span style="color: #83EA83; font-weight: bold;">:address,full-path</span> <span style="color: #83EA83; font-weight: bold;">:length,full-path</span>
  <span style="color: #83EA83; font-weight: bold;">:buffer</span> <span style="color: #83EA83; font-weight: bold;">:length</span>
  <span style="color: #ffffff; font-weight: bold;">file:</span>write
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb640688" class="outline-3">
<h3 id="orgb640688">poi:sub</h3>
<div class="outline-text-3" id="text-orgb640688">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">poi:sub</span>
  <span style="color: #FF8888;">&lt;&lt; name[address, length] -- &gt;&gt;</span>
  <span style="color: #dc322f; font-weight: bold;">&gt;::name</span>

  <span style="color: #5CDD5C; font-weight: bold;">::name</span> <span style="color: #ffffff; font-weight: bold;">poi:</span>find not <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #e6db74;">"* (poi:sub) can not sub"</span> .s .l
    <span style="color: #e6db74;">"  for the following poi does not exist : "</span> .s <span style="color: #5CDD5C; font-weight: bold;">::name</span> .s .l
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #dc322f; font-weight: bold;">&gt;::named-directory</span>

  <span style="color: #fd971f; font-weight: bold;">512</span> <span style="color: #AE7C3B; font-weight: bold;">allocate-local-memory</span> <span style="color: #FF4C4C; font-weight: bold;">&gt;:buffer</span>
  <span style="color: #fd971f; font-weight: bold;">*poi-directory*</span> <span style="color: #e6db74;">"/"</span> <span style="color: #5CDD5C; font-weight: bold;">::name</span> <span style="color: #e6db74;">"/path"</span>
  <span style="color: #83EA83; font-weight: bold;">:buffer</span>
  <span style="color: #fd971f; font-weight: bold;">4</span> n-string<span style="color: #b0b1a3;">-&gt;</span>buffer! <span style="color: #FF4C4C; font-weight: bold;">&gt;:length</span>

  <span style="color: #83EA83; font-weight: bold;">:buffer</span> <span style="color: #83EA83; font-weight: bold;">:length</span>
  <span style="color: #ffffff; font-weight: bold;">file:</span>remove

  <span style="color: #fd971f; font-weight: bold;">*poi-directory*</span> <span style="color: #e6db74;">"/"</span> <span style="color: #5CDD5C; font-weight: bold;">::name</span>
  <span style="color: #83EA83; font-weight: bold;">:buffer</span>
  <span style="color: #fd971f; font-weight: bold;">3</span> n-string<span style="color: #b0b1a3;">-&gt;</span>buffer!
  <span style="color: #FF4C4C; font-weight: bold;">&gt;:length</span>
  <span style="color: #83EA83; font-weight: bold;">:buffer</span> <span style="color: #83EA83; font-weight: bold;">:length</span>
  <span style="color: #ffffff; font-weight: bold;">directory:</span>remove
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgcea954a" class="outline-3">
<h3 id="orgcea954a">poi:up</h3>
<div class="outline-text-3" id="text-orgcea954a">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">poi:up</span>
  <span style="color: #FF8888;">&lt;&lt; name[address, length], relative-path[address, length] -- &gt;&gt;</span>
  <span style="color: #dc322f; font-weight: bold;">&gt;::relative-path</span>
  <span style="color: #dc322f; font-weight: bold;">&gt;::name</span>

  <span style="color: #5CDD5C; font-weight: bold;">::relative-path</span> <span style="color: #ffffff; font-weight: bold;">path:</span>relative? not <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #e6db74;">"* (poi:up) the argument must be a relative-path"</span> .s .l
    <span style="color: #e6db74;">"  but the following is not : "</span> .s <span style="color: #5CDD5C; font-weight: bold;">::relative-path</span> .s .l
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>

  <span style="color: #5CDD5C; font-weight: bold;">::relative-path</span> <span style="color: #ffffff; font-weight: bold;">path:</span>directory? not <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #e6db74;">"* (poi:up) the argument must be a relative-path to a existing directory"</span> .s .l
    <span style="color: #e6db74;">"  but the following directory is not exist : "</span> .s <span style="color: #5CDD5C; font-weight: bold;">::relative-path</span> .s .l
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>

  <span style="color: #5CDD5C; font-weight: bold;">::name</span> <span style="color: #ffffff; font-weight: bold;">poi:</span>find not <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #e6db74;">"* (poi:up) can not up"</span> .s .l
    <span style="color: #e6db74;">"  for the following poi does not exist : "</span> .s <span style="color: #5CDD5C; font-weight: bold;">::name</span> .s .l
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #dc322f; font-weight: bold;">&gt;::named-directory</span>

  <span style="color: #fd971f; font-weight: bold;">512</span> <span style="color: #AE7C3B; font-weight: bold;">allocate-local-memory</span> <span style="color: #FF4C4C; font-weight: bold;">&gt;:buffer</span>
  <span style="color: #fd971f; font-weight: bold;">*poi-directory*</span> <span style="color: #e6db74;">"/"</span> <span style="color: #5CDD5C; font-weight: bold;">::name</span> <span style="color: #e6db74;">"/path"</span>
  <span style="color: #83EA83; font-weight: bold;">:buffer</span>
  <span style="color: #fd971f; font-weight: bold;">4</span> n-string<span style="color: #b0b1a3;">-&gt;</span>buffer! <span style="color: #FF4C4C; font-weight: bold;">&gt;:length</span>

  <span style="color: #fd971f; font-weight: bold;">512</span> <span style="color: #AE7C3B; font-weight: bold;">allocate-local-memory</span> <span style="color: #FF4C4C; font-weight: bold;">&gt;:address,full-path</span>
  <span style="color: #ffffff; font-weight: bold;">work-directory:</span>get <span style="color: #e6db74;">"/"</span> <span style="color: #5CDD5C; font-weight: bold;">::relative-path</span>
  <span style="color: #83EA83; font-weight: bold;">:address,full-path</span>
  <span style="color: #fd971f; font-weight: bold;">3</span> n-string<span style="color: #b0b1a3;">-&gt;</span>buffer! <span style="color: #FF4C4C; font-weight: bold;">&gt;:length,full-path</span>

  <span style="color: #83EA83; font-weight: bold;">:address,full-path</span> <span style="color: #83EA83; font-weight: bold;">:length,full-path</span>
  <span style="color: #83EA83; font-weight: bold;">:buffer</span> <span style="color: #83EA83; font-weight: bold;">:length</span>
  <span style="color: #ffffff; font-weight: bold;">file:</span>write
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org3632417" class="outline-3">
<h3 id="org3632417">poi:list</h3>
<div class="outline-text-3" id="text-org3632417">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">poi:list</span>
  <span style="color: #FF8888;">&lt;&lt; -- &gt;&gt;</span>
  <span style="color: #fd971f; font-weight: bold;">*poi-directory*</span>
  <span style="color: #93a8c6;">[</span> <span style="color: #FF8888;">&lt;&lt; -- &gt;&gt;</span>
    <span style="color: #fd971f; font-weight: bold;">+getdents64,type+</span> get-byte
    <span style="color: #fd971f; font-weight: bold;">4</span> <span style="color: #ffffff; font-weight: bold;">equal?</span> <span style="color: #f92672; font-weight: bold;">if</span>
      <span style="color: #fd971f; font-weight: bold;">512</span> <span style="color: #AE7C3B; font-weight: bold;">allocate-local-memory</span> <span style="color: #FF4C4C; font-weight: bold;">&gt;:path-buffer</span>
      <span style="color: #fd971f; font-weight: bold;">+getdents64,name+</span>
      dup <span style="color: #fd971f; font-weight: bold;">256</span>
      <span style="color: #fd971f; font-weight: bold;">0</span> <span style="color: #ffffff; font-weight: bold;">string:</span>find-byte
      drop  <span style="color: #FF8888;">&lt;&lt; drop 0 &gt;&gt;</span>
      over sub <span style="color: #dc322f; font-weight: bold;">&gt;::name</span>

      <span style="color: #e6db74;">".."</span> <span style="color: #5CDD5C; font-weight: bold;">::name</span> <span style="color: #ffffff; font-weight: bold;">string:</span>equal? <span style="color: #f92672; font-weight: bold;">if</span>
        <span style="color: #00ffff; font-weight: bold;">end</span>
      <span style="color: #f92672; font-weight: bold;">then</span>

      <span style="color: #e6db74;">"."</span> <span style="color: #5CDD5C; font-weight: bold;">::name</span> <span style="color: #ffffff; font-weight: bold;">string:</span>equal? <span style="color: #f92672; font-weight: bold;">if</span>
        <span style="color: #00ffff; font-weight: bold;">end</span>
      <span style="color: #f92672; font-weight: bold;">then</span>

      <span style="color: #e6db74;">"  * "</span> .s <span style="color: #5CDD5C; font-weight: bold;">::name</span> .s .l
      <span style="color: #e6db74;">"      "</span> .s

      <span style="color: #fd971f; font-weight: bold;">*poi-directory*</span> <span style="color: #e6db74;">"/"</span> <span style="color: #5CDD5C; font-weight: bold;">::name</span> <span style="color: #e6db74;">"/path"</span>
      <span style="color: #83EA83; font-weight: bold;">:path-buffer</span>
      <span style="color: #fd971f; font-weight: bold;">4</span> n-string<span style="color: #b0b1a3;">-&gt;</span>buffer! <span style="color: #FF4C4C; font-weight: bold;">&gt;:path-length</span>

      <span style="color: #fd971f; font-weight: bold;">512</span> <span style="color: #AE7C3B; font-weight: bold;">allocate-local-memory</span> <span style="color: #FF4C4C; font-weight: bold;">&gt;:reading-buffer</span>
      <span style="color: #83EA83; font-weight: bold;">:reading-buffer</span> <span style="color: #fd971f; font-weight: bold;">512</span>
      <span style="color: #83EA83; font-weight: bold;">:path-buffer</span> <span style="color: #83EA83; font-weight: bold;">:path-length</span>
      <span style="color: #ffffff; font-weight: bold;">file:</span>read <span style="color: #FF4C4C; font-weight: bold;">&gt;:reading-length</span>

      <span style="color: #83EA83; font-weight: bold;">:reading-buffer</span> <span style="color: #83EA83; font-weight: bold;">:reading-length</span>
      .s .l
    <span style="color: #f92672; font-weight: bold;">then</span>
    <span style="color: #00ffff; font-weight: bold;">end</span> <span style="color: #93a8c6;">]</span>
  <span style="color: #ffffff; font-weight: bold;">directory:</span>map
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orga3386e7" class="outline-3">
<h3 id="orga3386e7">poi:help</h3>
<div class="outline-text-3" id="text-orga3386e7">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">poi:help</span>
  <span style="color: #FF8888;">&lt;&lt; -- &gt;&gt;</span>
  <span style="color: #e6db74;">"* (poi:help)"</span> .s .l
  <span style="color: #e6db74;">"  * cn poi add  &lt;new-name&gt; &lt;relative-path-to-existing-directory&gt;"</span> .s .l
  <span style="color: #e6db74;">"  * cn poi sub  &lt;old-name&gt;"</span> .s .l
  <span style="color: #e6db74;">"  * cn poi up   &lt;old-name&gt; &lt;relative-path-to-existing-directory&gt;"</span> .s .l
  <span style="color: #e6db74;">"  * cn poi find &lt;old-name&gt;"</span> .s .l
  <span style="color: #e6db74;">"  * cn poi list"</span> .s .l
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org1026158" class="outline-3">
<h3 id="org1026158"><span class="done test">test</span> </h3>
<div class="outline-text-3" id="text-org1026158">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #e6db74;">"test-cicada-play"</span> <span style="color: #e6db74;">"./play"</span> <span style="color: #ffffff; font-weight: bold;">poi:</span>add
<span style="color: #e6db74;">"test-cicada-play"</span> <span style="color: #ffffff; font-weight: bold;">poi:</span>find
<span style="color: #f92672; font-weight: bold;">if</span> .s .l
<span style="color: #f92672; font-weight: bold;">else</span> <span style="color: #e6db74;">"not found"</span> .s .l
<span style="color: #f92672; font-weight: bold;">then</span>

<span style="color: #e6db74;">"test-cicada-play-2"</span> <span style="color: #e6db74;">"./play-2"</span> <span style="color: #ffffff; font-weight: bold;">poi:</span>add
<span style="color: #e6db74;">"test-cicada-play-2"</span> <span style="color: #ffffff; font-weight: bold;">poi:</span>find
<span style="color: #f92672; font-weight: bold;">if</span> .s .l
<span style="color: #f92672; font-weight: bold;">else</span> <span style="color: #e6db74;">"not found"</span> .s .l
<span style="color: #f92672; font-weight: bold;">then</span>

<span style="color: #e6db74;">"test-cicada-play"</span> <span style="color: #e6db74;">"./contribution"</span> <span style="color: #ffffff; font-weight: bold;">poi:</span>up
<span style="color: #e6db74;">"test-cicada-play"</span> <span style="color: #ffffff; font-weight: bold;">poi:</span>find
<span style="color: #f92672; font-weight: bold;">if</span> .s .l
<span style="color: #f92672; font-weight: bold;">else</span> <span style="color: #e6db74;">"not found"</span> .s .l
<span style="color: #f92672; font-weight: bold;">then</span>

<span style="color: #e6db74;">"test-cicada-play"</span> <span style="color: #ffffff; font-weight: bold;">poi:</span>sub
<span style="color: #e6db74;">"test-cicada-play"</span> <span style="color: #ffffff; font-weight: bold;">poi:</span>find
<span style="color: #f92672; font-weight: bold;">if</span> .s .l
<span style="color: #f92672; font-weight: bold;">else</span> <span style="color: #e6db74;">"not found"</span> .s .l
<span style="color: #f92672; font-weight: bold;">then</span>

<span style="color: #ffffff; font-weight: bold;">poi:</span>list

<span style="color: #ffffff; font-weight: bold;">poi:</span>help
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgff72102" class="outline-2">
<h2 id="orgff72102">word-interpreter-syntax:path</h2>
<div class="outline-text-2" id="text-orgff72102">
</div><div id="outline-container-org5c36035" class="outline-3">
<h3 id="org5c36035"><del>word</del>?</h3>
<div class="outline-text-3" id="text-org5c36035">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">+word+?</span>
  <span style="color: #FF8888;">&lt;&lt; string[address, length] -- bool &gt;&gt;</span>
  dup <span style="color: #fd971f; font-weight: bold;">1</span> <span style="color: #ffffff; font-weight: bold;">less-or-equal?</span> <span style="color: #f92672; font-weight: bold;">if</span>
    drop2
    <span style="color: #fd971f; font-weight: bold;">false</span>
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  over get-byte
  <span style="color: #e6db74;">"+"</span> <span style="color: #ffffff; font-weight: bold;">string:</span>byte <span style="color: #ffffff; font-weight: bold;">equal?</span> not <span style="color: #f92672; font-weight: bold;">if</span>
    drop2
    <span style="color: #fd971f; font-weight: bold;">false</span>
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  add sub1 get-byte
  <span style="color: #e6db74;">"+"</span> <span style="color: #ffffff; font-weight: bold;">string:</span>byte <span style="color: #ffffff; font-weight: bold;">equal?</span>
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org7b3d9b4" class="outline-3">
<h3 id="org7b3d9b4"><del>word</del>-&gt;word</h3>
<div class="outline-text-3" id="text-org7b3d9b4">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">+word+-&gt;word</span>
  <span style="color: #FF8888;">&lt;&lt; +word+[address, length] -- name[address, length] &gt;&gt;</span>
  sub2 swap
  add1 swap
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf6056a6" class="outline-3">
<h3 id="orgf6056a6"><span class="done test">test</span> </h3>
<div class="outline-text-3" id="text-orgf6056a6">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #e6db74;">"+work+"</span> <span style="color: #ffffff; font-weight: bold;">+word+?</span> .
<span style="color: #e6db74;">"work"</span> <span style="color: #ffffff; font-weight: bold;">+word+?</span> .
</pre>
</div>
</div>
</div>

<div id="outline-container-org97d2a86" class="outline-3">
<h3 id="org97d2a86"><span class="todo note">note</span> </h3>
<div class="outline-text-3" id="text-org97d2a86">
<ul class="org-ul">
<li><p>path syntax can be implemented by a new <b>syntax-rule-set</b></p><p>but in the following</p><p>I just simply implemented it</p><p>as a syntax-rule in syntax-rule-set:*word-interpreter*</p></li></ul>
</div>
</div>

<div id="outline-container-orgb4778a9" class="outline-3">
<h3 id="orgb4778a9"><span class="todo note">note</span> format</h3>
<div class="outline-text-3" id="text-orgb4778a9">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #FF8888;">&lt;&lt;</span>
<span style="color: #FF8888;">the following 4 poi are built in</span>
<span style="color: #FF8888;">+root+</span>
<span style="color: #FF8888;">+home+</span>
<span style="color: #FF8888;">+work+</span>
<span style="color: #FF8888;">+back+</span>
<span style="color: #FF8888;">&gt;&gt;</span>

<span style="color: #a6e22e; font-weight: bold;">path:</span> <span style="color: #fd971f; font-weight: bold;">+root+</span> home xyh cicada core core.cn <span style="color: #ffff00; font-weight: bold;">;</span>
<span style="color: #a6e22e; font-weight: bold;">path:</span> <span style="color: #fd971f; font-weight: bold;">+home+</span> cicada core core.cn <span style="color: #ffff00; font-weight: bold;">;</span>
<span style="color: #e6db74;">"/home/xyh/cicada/core/core.cn"</span>

<span style="color: #a6e22e; font-weight: bold;">path:</span> <span style="color: #fd971f; font-weight: bold;">+back+</span> cicada core core.cn <span style="color: #ffff00; font-weight: bold;">;</span>
<span style="color: #e6db74;">"../cicada/core/core.cn"</span>

<span style="color: #a6e22e; font-weight: bold;">path:</span> <span style="color: #fd971f; font-weight: bold;">+work+</span> core core.cn <span style="color: #ffff00; font-weight: bold;">;</span>
<span style="color: #a6e22e; font-weight: bold;">path:</span> core core.cn <span style="color: #ffff00; font-weight: bold;">;</span>


<span style="color: #a6e22e; font-weight: bold;">path:</span> <span style="color: #fd971f; font-weight: bold;">+library+</span> hi.cn <span style="color: #ffff00; font-weight: bold;">;</span>
<span style="color: #e6db74;">"/home/xyh/cicada/library/hi.cn"</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org30d001f" class="outline-3">
<h3 id="org30d001f">path-syntax-word-&gt;path</h3>
<div class="outline-text-3" id="text-org30d001f">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">path-syntax-word-&gt;path</span>
  <span style="color: #FF8888;">&lt;&lt; word[address, length] -- path[address, length] &gt;&gt;</span>
  <span style="color: #dc322f; font-weight: bold;">&gt;::word</span>
  <span style="color: #5CDD5C; font-weight: bold;">::word</span> <span style="color: #e6db74;">"+root+"</span> <span style="color: #ffffff; font-weight: bold;">string:</span>equal? <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #e6db74;">"/"</span>
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #5CDD5C; font-weight: bold;">::word</span> <span style="color: #e6db74;">"+work+"</span> <span style="color: #ffffff; font-weight: bold;">string:</span>equal? <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #ffffff; font-weight: bold;">work-directory:</span>get
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #5CDD5C; font-weight: bold;">::word</span> <span style="color: #e6db74;">"+home+"</span> <span style="color: #ffffff; font-weight: bold;">string:</span>equal? <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #fd971f; font-weight: bold;">*home-directory*</span>
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #5CDD5C; font-weight: bold;">::word</span> <span style="color: #e6db74;">"+back+"</span> <span style="color: #ffffff; font-weight: bold;">string:</span>equal? <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #e6db74;">".."</span>
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #5CDD5C; font-weight: bold;">::word</span> <span style="color: #ffffff; font-weight: bold;">+word+?</span> not <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #5CDD5C; font-weight: bold;">::word</span>
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #5CDD5C; font-weight: bold;">::word</span> +word+<span style="color: #b0b1a3;">-&gt;</span>word <span style="color: #ffffff; font-weight: bold;">poi:</span>find <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #5CDD5C; font-weight: bold;">::word</span>
  <span style="color: #fd971f; font-weight: bold;">'bad-path-syntax-word</span> <span style="color: #00ffff; font-weight: bold;">awake</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf511abe" class="outline-3">
<h3 id="orgf511abe">word-interpreter-syntax:path</h3>
<div class="outline-text-3" id="text-orgf511abe">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">bad-path-syntax-word,loop</span>
  <span style="color: #FF8888;">&lt;&lt; -- &gt;&gt;</span>
  read-word
  dup2 <span style="color: #e6db74;">";"</span> <span style="color: #ffffff; font-weight: bold;">string:</span>equal? <span style="color: #f92672; font-weight: bold;">if</span>
    .s <span style="color: #fd971f; font-weight: bold;">32</span> .b
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  .s <span style="color: #fd971f; font-weight: bold;">32</span> .b
  <span style="color: #00ffff; font-weight: bold;">loop</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>

<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">word-interpreter-syntax:path,loop</span>
  <span style="color: #FF8888;">&lt;&lt; cursor -- cursor &gt;&gt;</span>
  <span style="color: #FF4C4C; font-weight: bold;">&gt;:cursor</span>
  read-word <span style="color: #dc322f; font-weight: bold;">&gt;::word</span>

  <span style="color: #e6db74;">";"</span> <span style="color: #5CDD5C; font-weight: bold;">::word</span> <span style="color: #ffffff; font-weight: bold;">string:</span>equal? <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #83EA83; font-weight: bold;">:cursor</span>
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>

  <span style="color: #5CDD5C; font-weight: bold;">::word</span> path-syntax-word<span style="color: #b0b1a3;">-&gt;</span>path dup <span style="color: #FF4C4C; font-weight: bold;">&gt;:length</span>
  <span style="color: #83EA83; font-weight: bold;">:cursor</span>
  string<span style="color: #b0b1a3;">-&gt;</span>buffer!

  <span style="color: #83EA83; font-weight: bold;">:cursor</span> <span style="color: #83EA83; font-weight: bold;">:length</span> add
    dup
    <span style="color: #e6db74;">"/"</span> <span style="color: #ffffff; font-weight: bold;">string:</span>byte
    swap
    set-byte
  add1
  <span style="color: #00ffff; font-weight: bold;">loop</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>

<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">word-interpreter-syntax:path</span>
  <span style="color: #FF8888;">&lt;&lt; literal-word:path: -- path[address, length] &gt;&gt;</span>
  drop2

  <span style="color: #93a8c6;">[</span> <span style="color: #FF8888;">&lt;&lt; word -- &gt;&gt;</span>
    <span style="color: #e6db74;">"* (word-interpreter-syntax:path) the following word is of bad syntax : "</span> .s .l
    <span style="color: #e6db74;">"    "</span> .s .s .l
    action,reset-the-stack
    <span style="color: #FF8888;">&lt;&lt; -- &gt;&gt;</span>
    <span style="color: #e6db74;">"  the rest of the words in path syntax is as following :"</span> .s .l
    <span style="color: #e6db74;">"    "</span> .s bad-path-syntax-word,loop .l
    <span style="color: #00ffff; font-weight: bold;">end</span> <span style="color: #93a8c6;">]</span>
  <span style="color: #fd971f; font-weight: bold;">'bad-path-syntax-word</span> <span style="color: #1ef15f; font-weight: bold;">await</span>

  <span style="color: #fd971f; font-weight: bold;">512</span> <span style="color: #AE7C3B; font-weight: bold;">allocate-local-memory</span> <span style="color: #FF4C4C; font-weight: bold;">&gt;:buffer</span>
  <span style="color: #83EA83; font-weight: bold;">:buffer</span> <span style="color: #ffffff; font-weight: bold;">word-interpreter-syntax:</span>path,loop <span style="color: #FF4C4C; font-weight: bold;">&gt;:cursor</span>

  <span style="color: #83EA83; font-weight: bold;">:cursor</span> <span style="color: #83EA83; font-weight: bold;">:buffer</span> sub <span style="color: #FF4C4C; font-weight: bold;">&gt;:length</span>

  <span style="color: #fd971f; font-weight: bold;">*circular-string-area,current-free-address*</span>
  <span style="color: #FF4C4C; font-weight: bold;">&gt;:address</span>

  <span style="color: #83EA83; font-weight: bold;">:buffer</span>
  <span style="color: #83EA83; font-weight: bold;">:length</span>
  circular-string-area,stay

  <span style="color: #83EA83; font-weight: bold;">:address</span>
  <span style="color: #83EA83; font-weight: bold;">:length</span>
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org896f64" class="outline-3">
<h3 id="org896f64">more,syntax-rule-set:basic-REPL</h3>
<div class="outline-text-3" id="text-org896f64">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">more,syntax-rule-set:basic-REPL</span>
  <span style="color: #FF8888;">&lt;&lt; -- &gt;&gt;</span>
  <span style="color: #fd971f; font-weight: bold;">syntax-rule-set:*word-interpreter*</span>
  <span style="color: #93a8c6;">[</span><span style="color: #e6db74;">"path:"</span> <span style="color: #ffffff; font-weight: bold;">string:</span>equal? <span style="color: #00ffff; font-weight: bold;">end</span><span style="color: #93a8c6;">]</span>
  <span style="color: #f92672; font-weight: bold;">jo</span> <span style="color: #ffffff; font-weight: bold;">word-interpreter-syntax:</span>path
  <span style="color: #ffffff; font-weight: bold;">syntax-rule:</span>add
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
<span style="color: #ffffff; font-weight: bold;">more,syntax-rule-set:</span>basic-REPL
</pre>
</div>
</div>
</div>

<div id="outline-container-org409f0fd" class="outline-3">
<h3 id="org409f0fd"><span class="done test">test</span> </h3>
<div class="outline-text-3" id="text-org409f0fd">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #a6e22e; font-weight: bold;">path:</span> <span style="color: #fd971f; font-weight: bold;">+root+</span> home xyh cicada core core.cn <span style="color: #ffff00; font-weight: bold;">;</span> .s
<span style="color: #a6e22e; font-weight: bold;">path:</span> <span style="color: #fd971f; font-weight: bold;">+home+</span> cicada core core.cn <span style="color: #ffff00; font-weight: bold;">;</span> .s

<span style="color: #a6e22e; font-weight: bold;">path:</span> <span style="color: #fd971f; font-weight: bold;">+back+</span> cicada core core.cn <span style="color: #ffff00; font-weight: bold;">;</span> .s

<span style="color: #a6e22e; font-weight: bold;">path:</span> <span style="color: #fd971f; font-weight: bold;">+work+</span> core core.cn <span style="color: #ffff00; font-weight: bold;">;</span> .s
<span style="color: #a6e22e; font-weight: bold;">path:</span> core core.cn <span style="color: #ffff00; font-weight: bold;">;</span> .s

<span style="color: #e6db74;">"module"</span> <span style="color: #e6db74;">"module"</span> <span style="color: #ffffff; font-weight: bold;">poi:</span>add
<span style="color: #a6e22e; font-weight: bold;">path:</span> <span style="color: #fd971f; font-weight: bold;">+module+</span> hi.cn <span style="color: #ffff00; font-weight: bold;">;</span> .s
<span style="color: #e6db74;">"module"</span> <span style="color: #ffffff; font-weight: bold;">poi:</span>sub
<span style="color: #FF8888;">&lt;&lt; error &gt;&gt;</span>
<span style="color: #a6e22e; font-weight: bold;">path:</span> <span style="color: #fd971f; font-weight: bold;">+module+</span> hi.cn <span style="color: #ffff00; font-weight: bold;">;</span>
</pre>
</div>
</div>
</div>
</div>


<div id="outline-container-orgcbcb777" class="outline-2">
<h2 id="orgcbcb777">string</h2>
<div class="outline-text-2" id="text-orgcbcb777">
</div><div id="outline-container-orgc39b80" class="outline-3">
<h3 id="orgc39b80">string:full-of-the-same-byte?</h3>
<div class="outline-text-3" id="text-orgc39b80">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">string:full-of-the-same-byte?</span>
  <span style="color: #FF8888;">&lt;&lt; string[address, length], byte -- bool &gt;&gt;</span>
  <span style="color: #FF4C4C; font-weight: bold;">&gt;:byte</span>
  <span style="color: #dc322f; font-weight: bold;">&gt;::string</span>
  <span style="color: #5CDD5C; font-weight: bold;">::string</span> dup <span style="color: #ffffff; font-weight: bold;">zero?</span> <span style="color: #f92672; font-weight: bold;">if</span>
    drop2
    <span style="color: #fd971f; font-weight: bold;">true</span>
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #ffffff; font-weight: bold;">string:</span>byte <span style="color: #83EA83; font-weight: bold;">:byte</span> <span style="color: #ffffff; font-weight: bold;">equal?</span> not <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #fd971f; font-weight: bold;">false</span>
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #5CDD5C; font-weight: bold;">::string</span> <span style="color: #ffffff; font-weight: bold;">string:</span>byte-tail
  <span style="color: #83EA83; font-weight: bold;">:byte</span>
  <span style="color: #00ffff; font-weight: bold;">loop</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org8ba7ebf" class="outline-3">
<h3 id="org8ba7ebf"><span class="done test">test</span> string:full-of-the-same-byte?</h3>
<div class="outline-text-3" id="text-org8ba7ebf">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #e6db74;">"* (testing) string:full-of-the-same-byte?"</span> .s .l
  <span style="color: #e6db74;">"aaa"</span> <span style="color: #e6db74;">"a"</span> <span style="color: #ffffff; font-weight: bold;">string:</span>byte <span style="color: #ffffff; font-weight: bold;">string:</span>full-of-the-same-byte? <span style="color: #ffffff; font-weight: bold;">true?</span>
  <span style="color: #e6db74;">"aba"</span> <span style="color: #e6db74;">"a"</span> <span style="color: #ffffff; font-weight: bold;">string:</span>byte <span style="color: #ffffff; font-weight: bold;">string:</span>full-of-the-same-byte? <span style="color: #ffffff; font-weight: bold;">false?</span> add <span style="color: #1ef15f; font-weight: bold;">test</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #1ef15f; font-weight: bold;">test-do</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org4238d1" class="outline-3">
<h3 id="org4238d1">string:any-word</h3>
<div class="outline-text-3" id="text-org4238d1">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">string:any-word</span>
  <span style="color: #FF8888;">&lt;&lt; string[address, length]</span>
<span style="color: #FF8888;">     function : &lt; word[address, length] -- bool &gt;</span>
<span style="color: #FF8888;">     -- bool &gt;&gt;</span>
  <span style="color: #FF4C4C; font-weight: bold;">&gt;:function</span>
  <span style="color: #dc322f; font-weight: bold;">&gt;::string</span>
  <span style="color: #5CDD5C; font-weight: bold;">::string</span> <span style="color: #ffffff; font-weight: bold;">string:</span>space? <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #fd971f; font-weight: bold;">false</span>
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #5CDD5C; font-weight: bold;">::string</span> <span style="color: #ffffff; font-weight: bold;">string:</span>word <span style="color: #83EA83; font-weight: bold;">:function</span> apply <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #fd971f; font-weight: bold;">true</span>
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #5CDD5C; font-weight: bold;">::string</span> <span style="color: #ffffff; font-weight: bold;">string:</span>word-tail
  <span style="color: #83EA83; font-weight: bold;">:function</span>
  <span style="color: #00ffff; font-weight: bold;">loop</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org2404a50" class="outline-3">
<h3 id="org2404a50">string:every-word</h3>
<div class="outline-text-3" id="text-org2404a50">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">string:every-word</span>
  <span style="color: #FF8888;">&lt;&lt; string[address, length]</span>
<span style="color: #FF8888;">     function : &lt; word[address, length] -- bool &gt;</span>
<span style="color: #FF8888;">     -- bool &gt;&gt;</span>
  <span style="color: #FF4C4C; font-weight: bold;">&gt;:function</span>
  <span style="color: #dc322f; font-weight: bold;">&gt;::string</span>
  <span style="color: #5CDD5C; font-weight: bold;">::string</span> <span style="color: #ffffff; font-weight: bold;">string:</span>space? <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #fd971f; font-weight: bold;">true</span>
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #5CDD5C; font-weight: bold;">::string</span> <span style="color: #ffffff; font-weight: bold;">string:</span>word <span style="color: #83EA83; font-weight: bold;">:function</span> apply not <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #fd971f; font-weight: bold;">false</span>
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #5CDD5C; font-weight: bold;">::string</span> <span style="color: #ffffff; font-weight: bold;">string:</span>word-tail
  <span style="color: #83EA83; font-weight: bold;">:function</span>
  <span style="color: #00ffff; font-weight: bold;">loop</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd5accf5" class="outline-3">
<h3 id="orgd5accf5"><span class="done test">test</span> string:every-word</h3>
<div class="outline-text-3" id="text-orgd5accf5">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">string:every-word,testing</span>
  <span style="color: #FF8888;">&lt;&lt; -- &gt;&gt;</span>
  <span style="color: #e6db74;">"no no name no"</span>
  <span style="color: #93a8c6;">[</span><span style="color: #e6db74;">"name"</span> <span style="color: #ffffff; font-weight: bold;">string:</span>equal? <span style="color: #00ffff; font-weight: bold;">end</span><span style="color: #93a8c6;">]</span>
  <span style="color: #ffffff; font-weight: bold;">string:</span>any-word <span style="color: #ffffff; font-weight: bold;">true?</span>

  <span style="color: #e6db74;">"name name name"</span>
  <span style="color: #93a8c6;">[</span><span style="color: #e6db74;">"name"</span> <span style="color: #ffffff; font-weight: bold;">string:</span>equal? <span style="color: #00ffff; font-weight: bold;">end</span><span style="color: #93a8c6;">]</span>
  <span style="color: #ffffff; font-weight: bold;">string:</span>every-word <span style="color: #ffffff; font-weight: bold;">true?</span> and

  <span style="color: #e6db74;">"name name name"</span>
  <span style="color: #93a8c6;">[</span><span style="color: #e6db74;">"name"</span> <span style="color: #ffffff; font-weight: bold;">string:</span>equal? not <span style="color: #00ffff; font-weight: bold;">end</span><span style="color: #93a8c6;">]</span>
  <span style="color: #ffffff; font-weight: bold;">string:</span>every-word <span style="color: #ffffff; font-weight: bold;">false?</span> and

  <span style="color: #e6db74;">"no no name no"</span>
  <span style="color: #93a8c6;">[</span><span style="color: #e6db74;">"name"</span> <span style="color: #ffffff; font-weight: bold;">string:</span>equal? <span style="color: #00ffff; font-weight: bold;">end</span><span style="color: #93a8c6;">]</span>
  <span style="color: #ffffff; font-weight: bold;">string:</span>every-word <span style="color: #ffffff; font-weight: bold;">false?</span> and <span style="color: #1ef15f; font-weight: bold;">test</span>
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #1ef15f; font-weight: bold;">test-function</span>

<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #e6db74;">"* (testing) string:every-word"</span> .s .l
  <span style="color: #ffffff; font-weight: bold;">string:</span>every-word,testing
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #1ef15f; font-weight: bold;">test-do</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgbfaa93c" class="outline-3">
<h3 id="orgbfaa93c">string:word-end-back</h3>
<div class="outline-text-3" id="text-orgbfaa93c">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">string:word-end-back</span>
  <span style="color: #FF8888;">&lt;&lt; string[address, length] -- string[address, length] &gt;&gt;</span>
  dup <span style="color: #ffffff; font-weight: bold;">zero?</span> <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #FF8888;">&lt;&lt;</span>
<span style="color: #FF8888;">    no error handling</span>
<span style="color: #FF8888;">    the same empty-string is returned</span>
<span style="color: #FF8888;">    &gt;&gt;</span>
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  dup2 <span style="color: #ffffff; font-weight: bold;">string:</span>byte-back
  <span style="color: #ffffff; font-weight: bold;">string:</span>byte <span style="color: #ffffff; font-weight: bold;">space-byte?</span> not <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #ffffff; font-weight: bold;">string:</span>byte-back
  <span style="color: #00ffff; font-weight: bold;">loop</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orged57417" class="outline-3">
<h3 id="orged57417">string:word-begin-back</h3>
<div class="outline-text-3" id="text-orged57417">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">string:word-begin-back,loop</span>
  <span style="color: #FF8888;">&lt;&lt; string[address, length] -- string[address, length] &gt;&gt;</span>
  dup <span style="color: #ffffff; font-weight: bold;">zero?</span> <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #FF8888;">&lt;&lt;</span>
<span style="color: #FF8888;">    no error handling</span>
<span style="color: #FF8888;">    the current empty-string is returned</span>
<span style="color: #FF8888;">    &gt;&gt;</span>
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  dup2 <span style="color: #ffffff; font-weight: bold;">string:</span>byte-back
  <span style="color: #ffffff; font-weight: bold;">string:</span>byte <span style="color: #ffffff; font-weight: bold;">space-byte?</span> <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  dup2 <span style="color: #ffffff; font-weight: bold;">string:</span>byte-back
  <span style="color: #ffffff; font-weight: bold;">string:</span>byte <span style="color: #ffffff; font-weight: bold;">bar-ket-byte?</span> <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #ffffff; font-weight: bold;">string:</span>byte-back
  <span style="color: #00ffff; font-weight: bold;">loop</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>

<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">string:word-begin-back</span>
  <span style="color: #FF8888;">&lt;&lt; string[address, length] -- string[address, length] &gt;&gt;</span>
  dup <span style="color: #ffffff; font-weight: bold;">zero?</span> <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #FF8888;">&lt;&lt;</span>
<span style="color: #FF8888;">    no error handling</span>
<span style="color: #FF8888;">    the same empty-string is returned</span>
<span style="color: #FF8888;">    &gt;&gt;</span>
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  dup2 <span style="color: #ffffff; font-weight: bold;">string:</span>byte-back
  <span style="color: #ffffff; font-weight: bold;">string:</span>byte <span style="color: #ffffff; font-weight: bold;">bar-ket-byte?</span> <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #ffffff; font-weight: bold;">string:</span>byte-back
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #ffffff; font-weight: bold;">string:</span>word-begin-back,loop
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgdc21eb" class="outline-3">
<h3 id="orgdc21eb">string:word-back</h3>
<div class="outline-text-3" id="text-orgdc21eb">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">string:word-back</span>
  <span style="color: #FF8888;">&lt;&lt; string[address, length] -- string[address, length] &gt;&gt;</span>
  <span style="color: #ffffff; font-weight: bold;">string:</span>word-end-back
  <span style="color: #ffffff; font-weight: bold;">string:</span>word-begin-back
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org811dcc6" class="outline-3">
<h3 id="org811dcc6"><span class="done test">test</span> string:word-back</h3>
<div class="outline-text-3" id="text-org811dcc6">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #e6db74;">"* (testing) string:word-back"</span> .s .l
  <span style="color: #e6db74;">"   aaa   aaa   aaa"</span>
  <span style="color: #ffffff; font-weight: bold;">string:</span>word-tail dup2 <span style="color: #e6db74;">"   aaa   aaa"</span> <span style="color: #ffffff; font-weight: bold;">string:</span>equal? <span style="color: #1ef15f; font-weight: bold;">test</span>
  <span style="color: #ffffff; font-weight: bold;">string:</span>word-back dup2 <span style="color: #e6db74;">"aaa   aaa   aaa"</span> <span style="color: #ffffff; font-weight: bold;">string:</span>equal? <span style="color: #1ef15f; font-weight: bold;">test</span>
  <span style="color: #ffffff; font-weight: bold;">string:</span>word <span style="color: #e6db74;">"aaa"</span> <span style="color: #ffffff; font-weight: bold;">string:</span>equal? <span style="color: #1ef15f; font-weight: bold;">test</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #1ef15f; font-weight: bold;">test-do</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org64603e1" class="outline-2">
<h2 id="org64603e1">reading-stack</h2>
<div class="outline-text-2" id="text-org64603e1">
</div><div id="outline-container-org8f80a51" class="outline-3">
<h3 id="org8f80a51">unread-word</h3>
<div class="outline-text-3" id="text-org8f80a51">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">unread-word</span>
  <span style="color: #FF8888;">&lt;&lt; -- &gt;&gt;</span>
  pop-reading-stack
  <span style="color: #ffffff; font-weight: bold;">string:</span>word-back
  push-reading-stack
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf51590" class="outline-3">
<h3 id="orgf51590"><span class="done test">test</span> </h3>
<div class="outline-text-3" id="text-orgf51590">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">unread-word,test</span>
  <span style="color: #FF8888;">&lt;&lt; -- &gt;&gt;</span>
  <span style="color: #e6db74;">"type a word : "</span> .s
  read-word <span style="color: #e6db74;">"* read-word : "</span> .s .s .l
  unread-word
  read-word <span style="color: #e6db74;">"* read-word again : "</span> .s .s .l
  unread-word
  read-word <span style="color: #e6db74;">"* read-word again : "</span> .s .s .l
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
unread-word,test
</pre>
</div>
</div>
</div>
</div>


<div id="outline-container-org611128c" class="outline-2">
<h2 id="org611128c"><span class="todo _">記</span> 模塊</h2>
<div class="outline-text-2" id="text-org611128c">
</div><div id="outline-container-orgcfc37ab" class="outline-3">
<h3 id="orgcfc37ab">元數據 之 語法</h3>
<div class="outline-text-3" id="text-orgcfc37ab">
<ul class="org-ul">
<li><p><p></p><p>舉例</p><p></p></p><p><div class="org-src-container"></p><p></p><p><pre class="src src-cicada-nymph"><span style="color: #ef5939; font-weight: bold;">:::::::::</span></p><p><span style="color: #a6e22e; font-weight: bold;">import:</span> combinator math</p><p><span style="color: #a6e22e; font-weight: bold;">module:</span> assembler</p><p><span style="color: #a6e22e; font-weight: bold;">do:</span> <span style="color: #e6db74;">"assembler loaded"</span> .s .l</p><p><span style="color: #ae81ff; font-weight: bold;">=========</span></p><p></pre></p><p></div></p></li>
<li><p>元數據中所包含的信息應該只和如何運行這個程序有關</p><p>因爲其他信息可能會在各個文件中重複</p><p>這些可能重複的信息應該另行保存</p></li>
<li><p>有了 元數據 之後</p><p>就可以對文件實現相對豐富的謂詞</p></li>
<li><p>元數據 中 所能包含的信息類型</p><p>還有聲明這些信息的語法</p><p>都是可以擴展的</p></li>
<li><p>語法關鍵詞都形如 "word:"</p><p>每次通過找下一個 "word:" 來確定其截止位置</p></li>
<li><p>遇不被識別的 "word:"</p><p>就忽略 而找到下一個 "word:"</p></li></ul>
</div>
</div>

<div id="outline-container-org39ab698" class="outline-3">
<h3 id="org39ab698">減載</h3>
<div class="outline-text-3" id="text-org39ab698">
<ul class="org-ul">
<li><p>或者說 撤銷加載 (unload)</p><p>它利用 (undo) 來實現</p></li></ul>
</div>
</div>

<div id="outline-container-orgc8b3e11" class="outline-3">
<h3 id="orgc8b3e11">加載棧</h3>
<div class="outline-text-3" id="text-orgc8b3e11">
<ul class="org-ul">
<li><p>加載棧 記錄</p><p><ol class="org-ol"></p><p><li>所有被加載的模塊的信息[模塊元數據字符串]</li></p><p><li>模塊被加載的順序</li></p><p><li>被加載的模塊是被直接加載還是間接加載</li></p><p><li>時間 路徑 等等 其他根系統狀態有關的元數據</li></ol></p></li>
<li><p>(import) 就利用了這些信息</p><p>用以聞訊</p><p>同時</p><p>這些信息 也可以幫助實現詳細的 report</p></li></ul>
</div>
</div>

<div id="outline-container-orgff7202e" class="outline-3">
<h3 id="orgff7202e">模塊命名棧 與 全局命名棧</h3>
<div class="outline-text-3" id="text-orgff7202e">
<ul class="org-ul">
<li><p>應該用兩種 命名棧</p><p>全局命名棧[global-naming-stack] 所有名字都沒有 模塊前綴</p><p>模塊命名棧[module-naming-stack] 所有名字都有 模塊前綴</p></li>
<li><p>加載模塊時入 global-naming-stack</p><p>之後統一移到 module-naming-stack</p><p>這樣就不必更改 定義者 的接口了</p><p>定義者 只要向 global-naming-stack 中入值 就行了</p><p>根 module-naming-stack 有關的操作 由其他函數 另行完成</p></li></ul>
</div>
</div>

<div id="outline-container-orge5a17f3" class="outline-3">
<h3 id="orge5a17f3">模塊與文件一一對應</h3>
<div class="outline-text-3" id="text-orge5a17f3">
<ul class="org-ul">
<li><p>要求 模塊與文件一一對應</p><p>這種 對應關係 影響對模塊機制的理解與使用</p></li>
<li><p>在啓動時</p><p>解釋器不會加載 core 之外的任何 module</p></li>
<li><p>所加載者 爲模塊 而非文件</p><p>不用路徑來加載模塊</p><p>而預先登記其路徑 然後直接通過模塊名來加載</p></li>
<li><p>我提供 命令行函數 來幫助在啓動時加載模塊</p></li></ul>
</div>
</div>

<div id="outline-container-org16936e7" class="outline-3">
<h3 id="org16936e7">循環引入</h3>
<div class="outline-text-3" id="text-org16936e7">
<ul class="org-ul">
<li><p>爲了處理循環引入</p><p>我需要一個 importing-stack</p><p>用以記錄 模塊之網中 由一點之引入所形成的有向路</p><p>只要在增添新的有向邊的時候 不要形成圈 就行了</p></li></ul>
</div>
</div>
</div>

<div id="outline-container-orgd0ccabf" class="outline-2">
<h2 id="orgd0ccabf">module-naming-stack</h2>
<div class="outline-text-2" id="text-orgd0ccabf">
</div><div id="outline-container-org5248c4" class="outline-3">
<h3 id="org5248c4"><span class="todo note">note</span> module-naming-stack</h3>
<div class="outline-text-3" id="text-org5248c4">
<ul class="org-ul">
<li><p>(define-*) push</p><p>(undo) pop</p></li></ul>
</div>
</div>

<div id="outline-container-org98bd43b" class="outline-3">
<h3 id="org98bd43b"><span class="todo note">note</span> name-record</h3>
<div class="outline-text-3" id="text-org98bd43b">
<ul class="org-ul">
<li><p><b>module-naming-stack</b> contain name-record</p></li>
<li><p><p></p><p>structure</p><p></p></p><p><table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides"></p><p></p><p></p><p><colgroup></p><p><col  class="org-left" /></p><p></p><p><col  class="org-left" /></p><p></colgroup></p><p><tbody></p><p><tr></p><p><td class="org-left">name-record</td></p><p><td class="org-left">old-jo</td></p><p></tr></p><p></p><p><tr></p><p><td class="org-left">&#xa0;</td></p><p><td class="org-left">name</td></p><p></tr></p><p></p><p><tr></p><p><td class="org-left">&#xa0;</td></p><p><td class="org-left">new-jo</td></p><p></tr></p><p></tbody></p><p></table></p></li></ul>
</div>
</div>

<div id="outline-container-org4564e79" class="outline-3">
<h3 id="org4564e79"><b>module-naming-stack</b></h3>
<div class="outline-text-3" id="text-org4564e79">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #fd971f; font-weight: bold;">100</span> <span style="color: #fd971f; font-weight: bold;">1024</span> mul
<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #fd971f; font-weight: bold;">module-naming-stack:*size*</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #a1ab3a; font-weight: bold;">define-variable,with-tos</span>

<span style="color: #fd971f; font-weight: bold;">3</span> <span style="color: #fd971f; font-weight: bold;">*cell-size*</span> mul
<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #fd971f; font-weight: bold;">module-naming-stack:*unit*</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #a1ab3a; font-weight: bold;">define-variable,with-tos</span>

<span style="color: #fd971f; font-weight: bold;">module-naming-stack:*size*</span>
<span style="color: #fd971f; font-weight: bold;">module-naming-stack:*unit*</span> mul <span style="color: #AE7C3B; font-weight: bold;">allocate-memory</span>
<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #fd971f; font-weight: bold;">*module-naming-stack*</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #a1ab3a; font-weight: bold;">define-variable,with-tos</span>

<span style="color: #fd971f; font-weight: bold;">*module-naming-stack*</span>
<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #fd971f; font-weight: bold;">module-naming-stack:*pointer*</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #a1ab3a; font-weight: bold;">define-variable,with-tos</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org4338504" class="outline-2">
<h2 id="org4338504">moi</h2>
<div class="outline-text-2" id="text-org4338504">
</div><div id="outline-container-org16594e7" class="outline-3">
<h3 id="org16594e7"><span class="todo note">note</span> </h3>
<div class="outline-text-3" id="text-org16594e7">
<ul class="org-ul">
<li><p>like &lt;poi&gt;</p></li></ul>
</div>
</div>

<div id="outline-container-orgf2c683d" class="outline-3">
<h3 id="orgf2c683d"><b>module-directory</b></h3>
<div class="outline-text-3" id="text-orgf2c683d">
<ul class="org-ul">
<li><p>one directory to store the name path record</p><p>"<i>home/&lt;user&gt;</i>.cicada/module"</p></li></ul>
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #fd971f; font-weight: bold;">*module-directory,user,address*</span>
  <span style="color: #fd971f; font-weight: bold;">512</span> <span style="color: #AE7C3B; font-weight: bold;">allocate-memory</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #a1ab3a; font-weight: bold;">define-variable</span>

<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #fd971f; font-weight: bold;">*module-directory*</span>
  <span style="color: #fd971f; font-weight: bold;">*home-directory*</span> <span style="color: #e6db74;">"/.cicada/moi"</span>
  <span style="color: #fd971f; font-weight: bold;">*module-directory,user,address*</span>
  <span style="color: #fd971f; font-weight: bold;">2</span> n-string<span style="color: #b0b1a3;">-&gt;</span>buffer!
  <span style="color: #fd971f; font-weight: bold;">*module-directory,user,address*</span> swap
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #a1ab3a; font-weight: bold;">define-variable</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org106acd0" class="outline-3">
<h3 id="org106acd0">moi:find</h3>
<div class="outline-text-3" id="text-org106acd0">
<ul class="org-ul">
<li><p>note that</p><p>this function uses <b>circular-string-area</b></p></li></ul>
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">moi:find</span>
  <span style="color: #FF8888;">&lt;&lt; name[address, length]</span>
<span style="color: #FF8888;">     -- path[address, length], true</span>
<span style="color: #FF8888;">     -- false &gt;&gt;</span>
  <span style="color: #dc322f; font-weight: bold;">&gt;::name</span>
  <span style="color: #fd971f; font-weight: bold;">512</span> <span style="color: #AE7C3B; font-weight: bold;">allocate-local-memory</span> <span style="color: #FF4C4C; font-weight: bold;">&gt;:buffer</span>
  <span style="color: #fd971f; font-weight: bold;">*module-directory*</span> <span style="color: #e6db74;">"/"</span> <span style="color: #5CDD5C; font-weight: bold;">::name</span> <span style="color: #e6db74;">"/path"</span>
  <span style="color: #83EA83; font-weight: bold;">:buffer</span>
  <span style="color: #fd971f; font-weight: bold;">4</span> n-string<span style="color: #b0b1a3;">-&gt;</span>buffer! <span style="color: #FF4C4C; font-weight: bold;">&gt;:length</span>

  <span style="color: #83EA83; font-weight: bold;">:buffer</span> <span style="color: #83EA83; font-weight: bold;">:length</span>
  <span style="color: #ffffff; font-weight: bold;">path:</span>file? not <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #fd971f; font-weight: bold;">false</span>
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>

  <span style="color: #fd971f; font-weight: bold;">512</span> <span style="color: #AE7C3B; font-weight: bold;">allocate-local-memory</span> <span style="color: #FF4C4C; font-weight: bold;">&gt;:read-buffer</span>
  <span style="color: #83EA83; font-weight: bold;">:read-buffer</span> <span style="color: #fd971f; font-weight: bold;">512</span>
  <span style="color: #83EA83; font-weight: bold;">:buffer</span> <span style="color: #83EA83; font-weight: bold;">:length</span>
  <span style="color: #ffffff; font-weight: bold;">file:</span>read <span style="color: #FF4C4C; font-weight: bold;">&gt;:read-length</span>

  <span style="color: #fd971f; font-weight: bold;">*circular-string-area,current-free-address*</span>
  <span style="color: #FF4C4C; font-weight: bold;">&gt;:path-address</span>

  <span style="color: #83EA83; font-weight: bold;">:read-buffer</span> <span style="color: #83EA83; font-weight: bold;">:read-length</span>
  circular-string-area,stay

  <span style="color: #83EA83; font-weight: bold;">:path-address</span>
  <span style="color: #83EA83; font-weight: bold;">:read-length</span>
  <span style="color: #fd971f; font-weight: bold;">true</span>
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org4c2b0eb" class="outline-3">
<h3 id="org4c2b0eb">moi:add</h3>
<div class="outline-text-3" id="text-org4c2b0eb">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">moi:add</span>
  <span style="color: #FF8888;">&lt;&lt; name[address, length], relative-path[address, length] -- &gt;&gt;</span>
  <span style="color: #dc322f; font-weight: bold;">&gt;::relative-path</span>
  <span style="color: #dc322f; font-weight: bold;">&gt;::name</span>

  <span style="color: #5CDD5C; font-weight: bold;">::relative-path</span> <span style="color: #ffffff; font-weight: bold;">path:</span>relative? not <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #e6db74;">"* (moi:add) the argument must be a relative-path"</span> .s .l
    <span style="color: #e6db74;">"  but the following is not : "</span> .s <span style="color: #5CDD5C; font-weight: bold;">::relative-path</span> .s .l
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>

  <span style="color: #5CDD5C; font-weight: bold;">::relative-path</span> <span style="color: #ffffff; font-weight: bold;">path:</span>file? not <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #e6db74;">"* (moi:add) the argument must be a relative-path to a existing file"</span> .s .l
    <span style="color: #e6db74;">"  but the following path is not to a file : "</span> .s <span style="color: #5CDD5C; font-weight: bold;">::relative-path</span> .s .l
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>

  <span style="color: #5CDD5C; font-weight: bold;">::name</span> <span style="color: #ffffff; font-weight: bold;">moi:</span>find <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #e6db74;">"* (moi:add) can not add"</span> .s .l
    <span style="color: #e6db74;">"  for the following module already exist : "</span> .s <span style="color: #5CDD5C; font-weight: bold;">::name</span> .s .l
    <span style="color: #e6db74;">"  name is use as the following directory's name : "</span> .s .s .l
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>

  <span style="color: #fd971f; font-weight: bold;">512</span> <span style="color: #AE7C3B; font-weight: bold;">allocate-local-memory</span> <span style="color: #FF4C4C; font-weight: bold;">&gt;:buffer</span>
  <span style="color: #fd971f; font-weight: bold;">*module-directory*</span> <span style="color: #e6db74;">"/"</span> <span style="color: #5CDD5C; font-weight: bold;">::name</span>
  <span style="color: #83EA83; font-weight: bold;">:buffer</span>
  <span style="color: #fd971f; font-weight: bold;">3</span> n-string<span style="color: #b0b1a3;">-&gt;</span>buffer!
  <span style="color: #FF4C4C; font-weight: bold;">&gt;:length</span>
  <span style="color: #83EA83; font-weight: bold;">:buffer</span> <span style="color: #83EA83; font-weight: bold;">:length</span>
  <span style="color: #ffffff; font-weight: bold;">directory:</span>create

  <span style="color: #fd971f; font-weight: bold;">*module-directory*</span> <span style="color: #e6db74;">"/"</span> <span style="color: #5CDD5C; font-weight: bold;">::name</span> <span style="color: #e6db74;">"/path"</span>
  <span style="color: #83EA83; font-weight: bold;">:buffer</span>
  <span style="color: #fd971f; font-weight: bold;">4</span> n-string<span style="color: #b0b1a3;">-&gt;</span>buffer!
  <span style="color: #FF4C4C; font-weight: bold;">&gt;:length</span>
  <span style="color: #83EA83; font-weight: bold;">:buffer</span> <span style="color: #83EA83; font-weight: bold;">:length</span>
  <span style="color: #ffffff; font-weight: bold;">file:</span>create

  <span style="color: #fd971f; font-weight: bold;">512</span> <span style="color: #AE7C3B; font-weight: bold;">allocate-local-memory</span> <span style="color: #FF4C4C; font-weight: bold;">&gt;:address,full-path</span>
  <span style="color: #ffffff; font-weight: bold;">work-directory:</span>get <span style="color: #e6db74;">"/"</span> <span style="color: #5CDD5C; font-weight: bold;">::relative-path</span>
  <span style="color: #83EA83; font-weight: bold;">:address,full-path</span>
  <span style="color: #fd971f; font-weight: bold;">3</span> n-string<span style="color: #b0b1a3;">-&gt;</span>buffer! <span style="color: #FF4C4C; font-weight: bold;">&gt;:length,full-path</span>

  <span style="color: #83EA83; font-weight: bold;">:address,full-path</span> <span style="color: #83EA83; font-weight: bold;">:length,full-path</span>
  <span style="color: #83EA83; font-weight: bold;">:buffer</span> <span style="color: #83EA83; font-weight: bold;">:length</span>
  <span style="color: #ffffff; font-weight: bold;">file:</span>write
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org554d619" class="outline-3">
<h3 id="org554d619">moi:sub</h3>
<div class="outline-text-3" id="text-org554d619">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">moi:sub</span>
  <span style="color: #FF8888;">&lt;&lt; name[address, length] -- &gt;&gt;</span>
  <span style="color: #dc322f; font-weight: bold;">&gt;::name</span>

  <span style="color: #5CDD5C; font-weight: bold;">::name</span> <span style="color: #ffffff; font-weight: bold;">moi:</span>find not <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #e6db74;">"* (moi:sub) can not sub"</span> .s .l
    <span style="color: #e6db74;">"  for the following module does not exist : "</span> .s <span style="color: #5CDD5C; font-weight: bold;">::name</span> .s .l
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #dc322f; font-weight: bold;">&gt;::named-directory</span>

  <span style="color: #fd971f; font-weight: bold;">512</span> <span style="color: #AE7C3B; font-weight: bold;">allocate-local-memory</span> <span style="color: #FF4C4C; font-weight: bold;">&gt;:buffer</span>
  <span style="color: #fd971f; font-weight: bold;">*module-directory*</span> <span style="color: #e6db74;">"/"</span> <span style="color: #5CDD5C; font-weight: bold;">::name</span> <span style="color: #e6db74;">"/path"</span>
  <span style="color: #83EA83; font-weight: bold;">:buffer</span>
  <span style="color: #fd971f; font-weight: bold;">4</span> n-string<span style="color: #b0b1a3;">-&gt;</span>buffer! <span style="color: #FF4C4C; font-weight: bold;">&gt;:length</span>

  <span style="color: #83EA83; font-weight: bold;">:buffer</span> <span style="color: #83EA83; font-weight: bold;">:length</span>
  <span style="color: #ffffff; font-weight: bold;">file:</span>remove

  <span style="color: #fd971f; font-weight: bold;">*module-directory*</span> <span style="color: #e6db74;">"/"</span> <span style="color: #5CDD5C; font-weight: bold;">::name</span>
  <span style="color: #83EA83; font-weight: bold;">:buffer</span>
  <span style="color: #fd971f; font-weight: bold;">3</span> n-string<span style="color: #b0b1a3;">-&gt;</span>buffer!
  <span style="color: #FF4C4C; font-weight: bold;">&gt;:length</span>
  <span style="color: #83EA83; font-weight: bold;">:buffer</span> <span style="color: #83EA83; font-weight: bold;">:length</span>
  <span style="color: #ffffff; font-weight: bold;">directory:</span>remove
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org1b6093f" class="outline-3">
<h3 id="org1b6093f">moi:up</h3>
<div class="outline-text-3" id="text-org1b6093f">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">moi:up</span>
  <span style="color: #FF8888;">&lt;&lt; name[address, length], relative-path[address, length] -- &gt;&gt;</span>
  <span style="color: #dc322f; font-weight: bold;">&gt;::relative-path</span>
  <span style="color: #dc322f; font-weight: bold;">&gt;::name</span>

  <span style="color: #5CDD5C; font-weight: bold;">::relative-path</span> <span style="color: #ffffff; font-weight: bold;">path:</span>relative? not <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #e6db74;">"* (moi:up) the argument must be a relative-path"</span> .s .l
    <span style="color: #e6db74;">"  but the following is not : "</span> .s <span style="color: #5CDD5C; font-weight: bold;">::relative-path</span> .s .l
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>

  <span style="color: #5CDD5C; font-weight: bold;">::relative-path</span> <span style="color: #ffffff; font-weight: bold;">path:</span>file? not <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #e6db74;">"* (moi:up) the argument must be a relative-path to a existing file"</span> .s .l
    <span style="color: #e6db74;">"  but the following file is not exist : "</span> .s <span style="color: #5CDD5C; font-weight: bold;">::relative-path</span> .s .l
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>

  <span style="color: #5CDD5C; font-weight: bold;">::name</span> <span style="color: #ffffff; font-weight: bold;">moi:</span>find not <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #e6db74;">"* (moi:up) can not up"</span> .s .l
    <span style="color: #e6db74;">"  for the following module does not exist : "</span> .s <span style="color: #5CDD5C; font-weight: bold;">::name</span> .s .l
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #dc322f; font-weight: bold;">&gt;::named-directory</span>

  <span style="color: #fd971f; font-weight: bold;">512</span> <span style="color: #AE7C3B; font-weight: bold;">allocate-local-memory</span> <span style="color: #FF4C4C; font-weight: bold;">&gt;:buffer</span>
  <span style="color: #fd971f; font-weight: bold;">*module-directory*</span> <span style="color: #e6db74;">"/"</span> <span style="color: #5CDD5C; font-weight: bold;">::name</span> <span style="color: #e6db74;">"/path"</span>
  <span style="color: #83EA83; font-weight: bold;">:buffer</span>
  <span style="color: #fd971f; font-weight: bold;">4</span> n-string<span style="color: #b0b1a3;">-&gt;</span>buffer! <span style="color: #FF4C4C; font-weight: bold;">&gt;:length</span>

  <span style="color: #fd971f; font-weight: bold;">512</span> <span style="color: #AE7C3B; font-weight: bold;">allocate-local-memory</span> <span style="color: #FF4C4C; font-weight: bold;">&gt;:address,full-path</span>
  <span style="color: #ffffff; font-weight: bold;">work-directory:</span>get <span style="color: #e6db74;">"/"</span> <span style="color: #5CDD5C; font-weight: bold;">::relative-path</span>
  <span style="color: #83EA83; font-weight: bold;">:address,full-path</span>
  <span style="color: #fd971f; font-weight: bold;">3</span> n-string<span style="color: #b0b1a3;">-&gt;</span>buffer! <span style="color: #FF4C4C; font-weight: bold;">&gt;:length,full-path</span>

  <span style="color: #83EA83; font-weight: bold;">:address,full-path</span> <span style="color: #83EA83; font-weight: bold;">:length,full-path</span>
  <span style="color: #83EA83; font-weight: bold;">:buffer</span> <span style="color: #83EA83; font-weight: bold;">:length</span>
  <span style="color: #ffffff; font-weight: bold;">file:</span>write
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org739f496" class="outline-3">
<h3 id="org739f496">moi:list</h3>
<div class="outline-text-3" id="text-org739f496">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">moi:list</span>
  <span style="color: #FF8888;">&lt;&lt; -- &gt;&gt;</span>
  <span style="color: #fd971f; font-weight: bold;">*module-directory*</span>
  <span style="color: #93a8c6;">[</span> <span style="color: #FF8888;">&lt;&lt; -- &gt;&gt;</span>
    <span style="color: #fd971f; font-weight: bold;">+getdents64,type+</span> get-byte
    <span style="color: #fd971f; font-weight: bold;">4</span> <span style="color: #ffffff; font-weight: bold;">equal?</span> <span style="color: #f92672; font-weight: bold;">if</span>
      <span style="color: #fd971f; font-weight: bold;">512</span> <span style="color: #AE7C3B; font-weight: bold;">allocate-local-memory</span> <span style="color: #FF4C4C; font-weight: bold;">&gt;:path-buffer</span>
      <span style="color: #fd971f; font-weight: bold;">+getdents64,name+</span>
      dup <span style="color: #fd971f; font-weight: bold;">256</span>
      <span style="color: #fd971f; font-weight: bold;">0</span> <span style="color: #ffffff; font-weight: bold;">string:</span>find-byte
      drop  <span style="color: #FF8888;">&lt;&lt; drop 0 &gt;&gt;</span>
      over sub <span style="color: #dc322f; font-weight: bold;">&gt;::name</span>

      <span style="color: #e6db74;">".."</span> <span style="color: #5CDD5C; font-weight: bold;">::name</span> <span style="color: #ffffff; font-weight: bold;">string:</span>equal? <span style="color: #f92672; font-weight: bold;">if</span>
        <span style="color: #00ffff; font-weight: bold;">end</span>
      <span style="color: #f92672; font-weight: bold;">then</span>

      <span style="color: #e6db74;">"."</span> <span style="color: #5CDD5C; font-weight: bold;">::name</span> <span style="color: #ffffff; font-weight: bold;">string:</span>equal? <span style="color: #f92672; font-weight: bold;">if</span>
        <span style="color: #00ffff; font-weight: bold;">end</span>
      <span style="color: #f92672; font-weight: bold;">then</span>

      <span style="color: #e6db74;">"  * "</span> .s <span style="color: #5CDD5C; font-weight: bold;">::name</span> .s .l
      <span style="color: #e6db74;">"      "</span> .s

      <span style="color: #fd971f; font-weight: bold;">*module-directory*</span> <span style="color: #e6db74;">"/"</span> <span style="color: #5CDD5C; font-weight: bold;">::name</span> <span style="color: #e6db74;">"/path"</span>
      <span style="color: #83EA83; font-weight: bold;">:path-buffer</span>
      <span style="color: #fd971f; font-weight: bold;">4</span> n-string<span style="color: #b0b1a3;">-&gt;</span>buffer! <span style="color: #FF4C4C; font-weight: bold;">&gt;:path-length</span>

      <span style="color: #fd971f; font-weight: bold;">512</span> <span style="color: #AE7C3B; font-weight: bold;">allocate-local-memory</span> <span style="color: #FF4C4C; font-weight: bold;">&gt;:reading-buffer</span>
      <span style="color: #83EA83; font-weight: bold;">:reading-buffer</span> <span style="color: #fd971f; font-weight: bold;">512</span>
      <span style="color: #83EA83; font-weight: bold;">:path-buffer</span> <span style="color: #83EA83; font-weight: bold;">:path-length</span>
      <span style="color: #ffffff; font-weight: bold;">file:</span>read <span style="color: #FF4C4C; font-weight: bold;">&gt;:reading-length</span>

      <span style="color: #83EA83; font-weight: bold;">:reading-buffer</span> <span style="color: #83EA83; font-weight: bold;">:reading-length</span>
      .s .l
    <span style="color: #f92672; font-weight: bold;">then</span>
    <span style="color: #00ffff; font-weight: bold;">end</span> <span style="color: #93a8c6;">]</span>
  <span style="color: #ffffff; font-weight: bold;">directory:</span>map
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org64bc8fb" class="outline-3">
<h3 id="org64bc8fb">moi:help</h3>
<div class="outline-text-3" id="text-org64bc8fb">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">moi:help</span>
  <span style="color: #FF8888;">&lt;&lt; -- &gt;&gt;</span>
  <span style="color: #e6db74;">"* (moi:help)"</span> .s .l
  <span style="color: #e6db74;">"  * cn moi add  &lt;new-module-name&gt;      &lt;relative-path-to-existing-file&gt;"</span> .s .l
  <span style="color: #e6db74;">"  * cn moi sub  &lt;existing-module-name&gt;"</span> .s .l
  <span style="color: #e6db74;">"  * cn moi up   &lt;existing-module-name&gt; &lt;relative-path-to-existing-file&gt;"</span> .s .l
  <span style="color: #e6db74;">"  * cn moi find &lt;existing-module-name&gt;"</span> .s .l
  <span style="color: #e6db74;">"  * cn moi list"</span> .s .l
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org606a19d" class="outline-3">
<h3 id="org606a19d"><span class="done test">test</span> </h3>
<div class="outline-text-3" id="text-org606a19d">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #e6db74;">"test-cicada-play"</span> <span style="color: #e6db74;">"./play"</span> <span style="color: #ffffff; font-weight: bold;">moi:</span>add
<span style="color: #e6db74;">"test-cicada-play"</span> <span style="color: #ffffff; font-weight: bold;">moi:</span>find
<span style="color: #f92672; font-weight: bold;">if</span> .s .l
<span style="color: #f92672; font-weight: bold;">else</span> <span style="color: #e6db74;">"not found"</span> .s .l
<span style="color: #f92672; font-weight: bold;">then</span>

<span style="color: #e6db74;">"test-cicada-play-2"</span> <span style="color: #e6db74;">"./play-2"</span> <span style="color: #ffffff; font-weight: bold;">moi:</span>add
<span style="color: #e6db74;">"test-cicada-play-2"</span> <span style="color: #ffffff; font-weight: bold;">moi:</span>find
<span style="color: #f92672; font-weight: bold;">if</span> .s .l
<span style="color: #f92672; font-weight: bold;">else</span> <span style="color: #e6db74;">"not found"</span> .s .l
<span style="color: #f92672; font-weight: bold;">then</span>

<span style="color: #e6db74;">"test-cicada-play"</span> <span style="color: #e6db74;">"./contribution"</span> <span style="color: #ffffff; font-weight: bold;">moi:</span>up
<span style="color: #e6db74;">"test-cicada-play"</span> <span style="color: #ffffff; font-weight: bold;">moi:</span>find
<span style="color: #f92672; font-weight: bold;">if</span> .s .l
<span style="color: #f92672; font-weight: bold;">else</span> <span style="color: #e6db74;">"not found"</span> .s .l
<span style="color: #f92672; font-weight: bold;">then</span>

<span style="color: #e6db74;">"test-cicada-play"</span> <span style="color: #ffffff; font-weight: bold;">moi:</span>sub
<span style="color: #e6db74;">"test-cicada-play"</span> <span style="color: #ffffff; font-weight: bold;">moi:</span>find
<span style="color: #f92672; font-weight: bold;">if</span> .s .l
<span style="color: #f92672; font-weight: bold;">else</span> <span style="color: #e6db74;">"not found"</span> .s .l
<span style="color: #f92672; font-weight: bold;">then</span>

<span style="color: #ffffff; font-weight: bold;">moi:</span>list

<span style="color: #ffffff; font-weight: bold;">moi:</span>help
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgfe67d59" class="outline-2">
<h2 id="orgfe67d59">module-stack &amp; module-info</h2>
<div class="outline-text-2" id="text-orgfe67d59">
</div><div id="outline-container-orga75a77" class="outline-3">
<h3 id="orga75a77"><span class="todo _">記</span> 用法</h3>
<div class="outline-text-3" id="text-orga75a77">
<ul class="org-ul">
<li><p>遞歸引入</p><p>返回時入此棧</p></li>
<li><p>其中保存的值用於問詢引入的模塊之狀態</p><p>比如 記錄是否帶有測試加載</p><p>比如 記錄測試成功與失敗的次數</p></li></ul>
</div>
</div>

<div id="outline-container-org4236ed7" class="outline-3">
<h3 id="org4236ed7"><b>module-stack</b></h3>
<div class="outline-text-3" id="text-org4236ed7">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #fd971f; font-weight: bold;">10</span> <span style="color: #fd971f; font-weight: bold;">1024</span> mul
<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #fd971f; font-weight: bold;">module-stack:*size*</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #a1ab3a; font-weight: bold;">define-variable,with-tos</span>

<span style="color: #fd971f; font-weight: bold;">8</span> <span style="color: #fd971f; font-weight: bold;">*cell-size*</span> mul
<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #fd971f; font-weight: bold;">module-stack:*unit*</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #a1ab3a; font-weight: bold;">define-variable,with-tos</span>

<span style="color: #fd971f; font-weight: bold;">module-stack:*size*</span>
<span style="color: #fd971f; font-weight: bold;">module-stack:*unit*</span> mul <span style="color: #AE7C3B; font-weight: bold;">allocate-memory</span>
<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #fd971f; font-weight: bold;">*module-stack*</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #a1ab3a; font-weight: bold;">define-variable,with-tos</span>

<span style="color: #fd971f; font-weight: bold;">*module-stack*</span>
<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #fd971f; font-weight: bold;">module-stack:*pointer*</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #a1ab3a; font-weight: bold;">define-variable,with-tos</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgfc0b18" class="outline-3">
<h3 id="orgfc0b18"><span class="todo note">note</span> &lt;module-info&gt;</h3>
<div class="outline-text-3" id="text-orgfc0b18">
<ul class="org-ul">
<li><p><b>module-stack</b> contain module-info</p></li>
<li><p><p></p><p>structure</p><p></p></p><p><table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides"></p><p></p><p></p><p><colgroup></p><p><col  class="org-left" /></p><p></p><p><col  class="org-left" /></p><p></colgroup></p><p><tbody></p><p><tr></p><p><td class="org-left">module-info</td></p><p><td class="org-left">meta-string address</td></p><p></tr></p><p></p><p><tr></p><p><td class="org-left">&#xa0;</td></p><p><td class="org-left">meta-string length</td></p><p></tr></p><p></p><p><tr></p><p><td class="org-left">&#xa0;</td></p><p><td class="org-left">name</td></p><p></tr></p><p></p><p><tr></p><p><td class="org-left">&#xa0;</td></p><p><td class="org-left">name-record-begin</td></p><p></tr></p><p></p><p><tr></p><p><td class="org-left">&#xa0;</td></p><p><td class="org-left">name-record-end</td></p><p></tr></p><p></p><p><tr></p><p><td class="org-left">&#xa0;</td></p><p><td class="org-left">tested-flag</td></p><p></tr></p><p></p><p><tr></p><p><td class="org-left">&#xa0;</td></p><p><td class="org-left">success-counter</td></p><p></tr></p><p></p><p><tr></p><p><td class="org-left">&#xa0;</td></p><p><td class="org-left">fail-counter</td></p><p></tr></p><p></tbody></p><p></table></p></li></ul>
</div>
</div>

<div id="outline-container-orgabb1490" class="outline-3">
<h3 id="orgabb1490">module-<a href="[get|set]-meta-string.html#Top">[get|set]-meta-string</a></h3>
<div class="outline-text-3" id="text-orgabb1490">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">module-info:get-meta-string</span>
  <span style="color: #FF8888;">&lt;&lt; module-info -- meta-string[address, length] &gt;&gt;</span>
  <span style="color: #fd971f; font-weight: bold;">2</span> n-get
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>

<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">module-info:set-meta-string</span>
  <span style="color: #FF8888;">&lt;&lt; meta-string[address, length], module-info -- &gt;&gt;</span>
  xx<span style="color: #b0b1a3;">|</span>swap<span style="color: #b0b1a3;">|</span>x make-string x<span style="color: #b0b1a3;">|</span>swap<span style="color: #b0b1a3;">|</span>xx
  <span style="color: #fd971f; font-weight: bold;">2</span> n-set
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org56e12a2" class="outline-3">
<h3 id="org56e12a2">module-<a href="[get|set]-name.html#Top">[get|set]-name</a></h3>
<div class="outline-text-3" id="text-org56e12a2">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">module-info:get-name</span>
  <span style="color: #FF8888;">&lt;&lt; module-info -- name &gt;&gt;</span>
  <span style="color: #fd971f; font-weight: bold;">*cell-size*</span> <span style="color: #fd971f; font-weight: bold;">2</span> mul add
  get
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>

<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">module-info:set-name</span>
  <span style="color: #FF8888;">&lt;&lt; name, module-info -- &gt;&gt;</span>
  <span style="color: #fd971f; font-weight: bold;">*cell-size*</span> <span style="color: #fd971f; font-weight: bold;">2</span> mul add
  set
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org132782c" class="outline-3">
<h3 id="org132782c">module-<a href="[get|set]-name-record-begin.html#Top">[get|set]-name-record-begin</a></h3>
<div class="outline-text-3" id="text-org132782c">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">module-info:get-name-record-begin</span>
  <span style="color: #FF8888;">&lt;&lt; module-info -- name &gt;&gt;</span>
  <span style="color: #fd971f; font-weight: bold;">*cell-size*</span> <span style="color: #fd971f; font-weight: bold;">3</span> mul add
  get
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>

<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">module-info:set-name-record-begin</span>
  <span style="color: #FF8888;">&lt;&lt; name, module-info -- &gt;&gt;</span>
  <span style="color: #fd971f; font-weight: bold;">*cell-size*</span> <span style="color: #fd971f; font-weight: bold;">3</span> mul add
  set
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc1b37c7" class="outline-3">
<h3 id="orgc1b37c7">module-<a href="[get|set]-name-record-end.html#Top">[get|set]-name-record-end</a></h3>
<div class="outline-text-3" id="text-orgc1b37c7">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">module-info:get-name-record-end</span>
  <span style="color: #FF8888;">&lt;&lt; module-info -- name &gt;&gt;</span>
  <span style="color: #fd971f; font-weight: bold;">*cell-size*</span> <span style="color: #fd971f; font-weight: bold;">4</span> mul add
  get
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>

<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">module-info:set-name-record-end</span>
  <span style="color: #FF8888;">&lt;&lt; name, module-info -- &gt;&gt;</span>
  <span style="color: #fd971f; font-weight: bold;">*cell-size*</span> <span style="color: #fd971f; font-weight: bold;">4</span> mul add
  set
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orga5b3714" class="outline-3">
<h3 id="orga5b3714">module-<a href="[get|set]-tested-flag.html#Top">[get|set]-tested-flag</a></h3>
<div class="outline-text-3" id="text-orga5b3714">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">module-info:get-tested-flag</span>
  <span style="color: #FF8888;">&lt;&lt; module-info -- name &gt;&gt;</span>
  <span style="color: #fd971f; font-weight: bold;">*cell-size*</span> <span style="color: #fd971f; font-weight: bold;">5</span> mul add
  get
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>

<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">module-info:set-tested-flag</span>
  <span style="color: #FF8888;">&lt;&lt; name, module-info -- &gt;&gt;</span>
  <span style="color: #fd971f; font-weight: bold;">*cell-size*</span> <span style="color: #fd971f; font-weight: bold;">5</span> mul add
  set
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org91607a6" class="outline-3">
<h3 id="org91607a6">module-<a href="[get|set|inc]-success-counter.html#Top">[get|set|inc]-success-counter</a></h3>
<div class="outline-text-3" id="text-org91607a6">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">module-info:get-success-counter</span>
  <span style="color: #FF8888;">&lt;&lt; module-info -- name &gt;&gt;</span>
  <span style="color: #fd971f; font-weight: bold;">*cell-size*</span> <span style="color: #fd971f; font-weight: bold;">6</span> mul add
  get
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>

<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">module-info:set-success-counter</span>
  <span style="color: #FF8888;">&lt;&lt; name, module-info -- &gt;&gt;</span>
  <span style="color: #fd971f; font-weight: bold;">*cell-size*</span> <span style="color: #fd971f; font-weight: bold;">6</span> mul add
  set
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>

<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">module-info:inc-success-counter</span>
  <span style="color: #FF8888;">&lt;&lt; module-info -- &gt;&gt;</span>
  <span style="color: #fd971f; font-weight: bold;">*cell-size*</span> <span style="color: #fd971f; font-weight: bold;">6</span> mul add
  <span style="color: #fd971f; font-weight: bold;">1</span> swap
  add-set
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org83aa180" class="outline-3">
<h3 id="org83aa180">module-<a href="[get|set|inc]-fail-counter.html#Top">[get|set|inc]-fail-counter</a></h3>
<div class="outline-text-3" id="text-org83aa180">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">module-info:get-fail-counter</span>
  <span style="color: #FF8888;">&lt;&lt; module-info -- name &gt;&gt;</span>
  <span style="color: #fd971f; font-weight: bold;">*cell-size*</span> <span style="color: #fd971f; font-weight: bold;">7</span> mul add
  get
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>

<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">module-info:set-fail-counter</span>
  <span style="color: #FF8888;">&lt;&lt; name, module-info -- &gt;&gt;</span>
  <span style="color: #fd971f; font-weight: bold;">*cell-size*</span> <span style="color: #fd971f; font-weight: bold;">7</span> mul add
  set
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>

<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">module-info:inc-fail-counter</span>
  <span style="color: #FF8888;">&lt;&lt; module-info -- &gt;&gt;</span>
  <span style="color: #fd971f; font-weight: bold;">*cell-size*</span> <span style="color: #fd971f; font-weight: bold;">7</span> mul add
  <span style="color: #fd971f; font-weight: bold;">1</span> swap
  add-set
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org91262bf" class="outline-3">
<h3 id="org91262bf">module-stack:find</h3>
<div class="outline-text-3" id="text-org91262bf">
<ul class="org-ul">
<li><p>from the base to the pointer</p></li></ul>
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">module-stack:find,loop</span>
  <span style="color: #FF8888;">&lt;&lt; name, cursor</span>
<span style="color: #FF8888;">     -- module-info, true</span>
<span style="color: #FF8888;">     -- false &gt;&gt;</span>
  dup <span style="color: #fd971f; font-weight: bold;">module-stack:*pointer*</span> <span style="color: #ffffff; font-weight: bold;">equal?</span> <span style="color: #f92672; font-weight: bold;">if</span>
    drop2
    <span style="color: #fd971f; font-weight: bold;">false</span>
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #FF4C4C; font-weight: bold;">&gt;:cursor</span>
  <span style="color: #FF4C4C; font-weight: bold;">&gt;:name</span>
  <span style="color: #83EA83; font-weight: bold;">:cursor</span> <span style="color: #ffffff; font-weight: bold;">module-info:</span>get-name
  <span style="color: #83EA83; font-weight: bold;">:name</span> <span style="color: #ffffff; font-weight: bold;">equal?</span> <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #83EA83; font-weight: bold;">:cursor</span>
    <span style="color: #fd971f; font-weight: bold;">true</span>
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #83EA83; font-weight: bold;">:name</span>
  <span style="color: #83EA83; font-weight: bold;">:cursor</span> <span style="color: #fd971f; font-weight: bold;">module-stack:*unit*</span> add
  <span style="color: #00ffff; font-weight: bold;">loop</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>

<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">module-stack:find</span>
  <span style="color: #FF8888;">&lt;&lt; name</span>
<span style="color: #FF8888;">     -- module-info, true</span>
<span style="color: #FF8888;">     -- false &gt;&gt;</span>
  <span style="color: #fd971f; font-weight: bold;">*module-stack*</span>
  <span style="color: #ffffff; font-weight: bold;">module-stack:</span>find,loop
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgced406f" class="outline-2">
<h2 id="orgced406f">importing-stack &amp; importing-record</h2>
<div class="outline-text-2" id="text-orgced406f">
</div><div id="outline-container-orge96cf6e" class="outline-3">
<h3 id="orge96cf6e"><span class="todo _">記</span> 用法</h3>
<div class="outline-text-3" id="text-orge96cf6e">
<ul class="org-ul">
<li><p>遞歸引入</p><p>展開時入此棧</p><p>返回時出此棧</p></li>
<li><p>其中保存的值</p><p>在 eval-string 的過程中可以用到</p><p>比如 探測循環引入</p><p>比如 記錄當前的模塊是否帶測試引入</p></li></ul>
</div>
</div>

<div id="outline-container-orgf166db8" class="outline-3">
<h3 id="orgf166db8"><b>importing-stack</b> &amp; <b>testing-flag</b></h3>
<div class="outline-text-3" id="text-orgf166db8">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #fd971f; font-weight: bold;">10</span> <span style="color: #fd971f; font-weight: bold;">1024</span> mul
<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #fd971f; font-weight: bold;">importing-stack:*size*</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #a1ab3a; font-weight: bold;">define-variable,with-tos</span>

<span style="color: #fd971f; font-weight: bold;">2</span> <span style="color: #fd971f; font-weight: bold;">*cell-size*</span> mul
<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #fd971f; font-weight: bold;">importing-stack:*unit*</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #a1ab3a; font-weight: bold;">define-variable,with-tos</span>

<span style="color: #fd971f; font-weight: bold;">*cell-size*</span> <span style="color: #AE7C3B; font-weight: bold;">allocate-memory</span> drop
<span style="color: #fd971f; font-weight: bold;">*cell-size*</span> <span style="color: #AE7C3B; font-weight: bold;">allocate-memory</span>
<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #fd971f; font-weight: bold;">*testing-flag*</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #a1ab3a; font-weight: bold;">define-variable,with-tos</span>

<span style="color: #fd971f; font-weight: bold;">importing-stack:*size*</span>
<span style="color: #fd971f; font-weight: bold;">importing-stack:*unit*</span> mul <span style="color: #AE7C3B; font-weight: bold;">allocate-memory</span>
<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #fd971f; font-weight: bold;">*importing-stack*</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #a1ab3a; font-weight: bold;">define-variable,with-tos</span>

<span style="color: #fd971f; font-weight: bold;">*importing-stack*</span>
<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #fd971f; font-weight: bold;">importing-stack:*pointer*</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #a1ab3a; font-weight: bold;">define-variable,with-tos</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org2537608" class="outline-3">
<h3 id="org2537608"><span class="todo note">note</span> &lt;importing-record&gt;</h3>
<div class="outline-text-3" id="text-org2537608">
<ul class="org-ul">
<li><p><p></p><p>structure</p><p></p></p><p><table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides"></p><p></p><p></p><p><colgroup></p><p><col  class="org-left" /></p><p></p><p><col  class="org-left" /></p><p></colgroup></p><p><tbody></p><p><tr></p><p><td class="org-left">importing-record</td></p><p><td class="org-left">name</td></p><p></tr></p><p></p><p><tr></p><p><td class="org-left">&#xa0;</td></p><p><td class="org-left">testing-flag</td></p><p></tr></p><p></tbody></p><p></table></p></li></ul>
</div>
</div>

<div id="outline-container-org3c87d19" class="outline-3">
<h3 id="org3c87d19">importing-record:[get|set]-name</h3>
<div class="outline-text-3" id="text-org3c87d19">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">importing-record:get-name</span>
  <span style="color: #FF8888;">&lt;&lt; module-info -- name &gt;&gt;</span>
  get
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>

<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">importing-record:set-name</span>
  <span style="color: #FF8888;">&lt;&lt; name, module-info -- &gt;&gt;</span>
  set
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb247ae7" class="outline-3">
<h3 id="orgb247ae7">importing-record:[get|set]-testing-flag</h3>
<div class="outline-text-3" id="text-orgb247ae7">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">importing-record:get-testing-flag</span>
  <span style="color: #FF8888;">&lt;&lt; module-info -- bool &gt;&gt;</span>
  <span style="color: #fd971f; font-weight: bold;">*cell-size*</span> add get
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>

<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">importing-record:set-testing-flag</span>
  <span style="color: #FF8888;">&lt;&lt; bool, module-info -- &gt;&gt;</span>
  <span style="color: #fd971f; font-weight: bold;">*cell-size*</span> add set
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org35e358f" class="outline-3">
<h3 id="org35e358f">importing-stack:find</h3>
<div class="outline-text-3" id="text-org35e358f">
<ul class="org-ul">
<li><p>from the base to the pointer</p></li></ul>
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">importing-stack:find,loop</span>
  <span style="color: #FF8888;">&lt;&lt; name, cursor</span>
<span style="color: #FF8888;">     -- importing-record, true</span>
<span style="color: #FF8888;">     -- false &gt;&gt;</span>
  dup <span style="color: #fd971f; font-weight: bold;">importing-stack:*pointer*</span> <span style="color: #ffffff; font-weight: bold;">equal?</span> <span style="color: #f92672; font-weight: bold;">if</span>
    drop2
    <span style="color: #fd971f; font-weight: bold;">false</span>
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #FF4C4C; font-weight: bold;">&gt;:cursor</span>
  <span style="color: #FF4C4C; font-weight: bold;">&gt;:name</span>
  <span style="color: #83EA83; font-weight: bold;">:cursor</span> <span style="color: #ffffff; font-weight: bold;">importing-record:</span>get-name
  <span style="color: #83EA83; font-weight: bold;">:name</span> <span style="color: #ffffff; font-weight: bold;">equal?</span> <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #83EA83; font-weight: bold;">:cursor</span>
    <span style="color: #fd971f; font-weight: bold;">true</span>
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #83EA83; font-weight: bold;">:name</span>
  <span style="color: #83EA83; font-weight: bold;">:cursor</span> <span style="color: #fd971f; font-weight: bold;">importing-stack:*unit*</span> add
  <span style="color: #00ffff; font-weight: bold;">loop</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>

<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">importing-stack:find</span>
  <span style="color: #FF8888;">&lt;&lt; name</span>
<span style="color: #FF8888;">     -- importing-record, true</span>
<span style="color: #FF8888;">     -- false &gt;&gt;</span>
  <span style="color: #fd971f; font-weight: bold;">*importing-stack*</span>
  <span style="color: #ffffff; font-weight: bold;">importing-stack:</span>find,loop
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org3734eda" class="outline-3">
<h3 id="org3734eda">importing-stack:drop</h3>
<div class="outline-text-3" id="text-org3734eda">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">importing-stack:drop</span>
  <span style="color: #FF8888;">&lt;&lt; -- &gt;&gt;</span>
  <span style="color: #fd971f; font-weight: bold;">importing-stack:*unit*</span> <span style="color: #f92672; font-weight: bold;">address</span> <span style="color: #fd971f; font-weight: bold;">importing-stack:*pointer*</span> sub-set
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org84a0a5e" class="outline-3">
<h3 id="org84a0a5e">t</h3>
<div class="outline-text-3" id="text-org84a0a5e">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">t</span>
  <span style="color: #FF8888;">&lt;&lt; -- &gt;&gt;</span>
  <span style="color: #fd971f; font-weight: bold;">*testing-flag*</span> get <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #fd971f; font-weight: bold;">0</span> <span style="color: #fd971f; font-weight: bold;">*testing-flag*</span> set
    <span style="color: #e6db74;">"* (testing) *testing-flag* off"</span> .s .l
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">else</span>
    <span style="color: #fd971f; font-weight: bold;">1</span> <span style="color: #fd971f; font-weight: bold;">*testing-flag*</span> set
    <span style="color: #e6db74;">"* (testing) *testing-flag* on"</span> .s .l
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org818676c" class="outline-2">
<h2 id="org818676c">global-naming-stack &amp; module-naming-stack</h2>
<div class="outline-text-2" id="text-org818676c">
</div><div id="outline-container-orgccf3350" class="outline-3">
<h3 id="orgccf3350">---------------------------------</h3>
</div>

<div id="outline-container-org3b93677" class="outline-3">
<h3 id="org3b93677"><span class="todo _">記</span> 接口</h3>
<div class="outline-text-3" id="text-org3b93677">
<ul class="org-ul">
<li><p>每個 模塊 都對應於 module-naming-stack 中的兩個 name-record</p><p>一個開始</p><p>一個結束</p><p>因此接口就要圍繞這對值來設計</p></li>
<li><p>undo 中關於 global-naming-stack 和 module-naming-stack 的部分</p><p>可以利用這裏的接口</p></li>
<li><p>(clear-naming)</p><p>name-record-begin &lt;&#x2013; name-record-end</p><p>(prefix-naming)</p><p>name-record-begin &#x2013;&gt; name-record-end</p><p>(expose-naming)</p><p>name-record-begin &#x2013;&gt; name-record-end</p></li></ul>
</div>
</div>

<div id="outline-container-orgc8555b1" class="outline-3">
<h3 id="orgc8555b1">---------------------------------</h3>
</div>

<div id="outline-container-orgd090763" class="outline-3">
<h3 id="orgd090763">module-naming-stack:record-jo</h3>
<div class="outline-text-3" id="text-orgd090763">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">module-naming-stack:record-jo</span>
  <span style="color: #FF8888;">&lt;&lt; jo, name -- &gt;&gt;</span>
  dup name,get-jo
  <span style="color: #fd971f; font-weight: bold;">module-naming-stack:*pointer*</span> <span style="color: #ffffff; font-weight: bold;">name-record:</span>set-old-jo
  dup2 name,set-jo
  <span style="color: #fd971f; font-weight: bold;">module-naming-stack:*pointer*</span> <span style="color: #ffffff; font-weight: bold;">name-record:</span>set-name
  <span style="color: #fd971f; font-weight: bold;">module-naming-stack:*pointer*</span> <span style="color: #ffffff; font-weight: bold;">name-record:</span>set-new-jo
  <span style="color: #fd971f; font-weight: bold;">module-naming-stack:*unit*</span> <span style="color: #f92672; font-weight: bold;">address</span> <span style="color: #fd971f; font-weight: bold;">module-naming-stack:*pointer*</span> add-set
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org2c2dda1" class="outline-3">
<h3 id="org2c2dda1">module-naming-stack:delete-last-record</h3>
<div class="outline-text-3" id="text-org2c2dda1">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">module-naming-stack:delete-last-record</span>
  <span style="color: #FF8888;">&lt;&lt; -- &gt;&gt;</span>
  <span style="color: #fd971f; font-weight: bold;">module-naming-stack:*unit*</span>
  <span style="color: #f92672; font-weight: bold;">address</span> <span style="color: #fd971f; font-weight: bold;">module-naming-stack:*pointer*</span>
  sub-set
  <span style="color: #fd971f; font-weight: bold;">module-naming-stack:*pointer*</span> <span style="color: #ffffff; font-weight: bold;">name-record:</span>get-old-jo
  <span style="color: #fd971f; font-weight: bold;">module-naming-stack:*pointer*</span> <span style="color: #ffffff; font-weight: bold;">name-record:</span>get-name
  name,set-jo
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd4604e0" class="outline-3">
<h3 id="orgd4604e0">---------------------------------</h3>
</div>

<div id="outline-container-org4b2eb64" class="outline-3">
<h3 id="org4b2eb64">global-naming-stack:clear-naming</h3>
<div class="outline-text-3" id="text-org4b2eb64">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">global-naming-stack:clear-naming</span>
  <span style="color: #FF8888;">&lt;&lt; name-record-begin, name-record-end -- &gt;&gt;</span>
  dup2 <span style="color: #ffffff; font-weight: bold;">equal?</span> <span style="color: #f92672; font-weight: bold;">if</span>
    drop2
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #fd971f; font-weight: bold;">global-naming-stack:*unit*</span> sub
  dup <span style="color: #FF4C4C; font-weight: bold;">&gt;:name-record</span>
  <span style="color: #83EA83; font-weight: bold;">:name-record</span> <span style="color: #ffffff; font-weight: bold;">name-record:</span>get-old-jo
  <span style="color: #83EA83; font-weight: bold;">:name-record</span> <span style="color: #ffffff; font-weight: bold;">name-record:</span>get-name
  name,set-jo
  <span style="color: #00ffff; font-weight: bold;">loop</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orga461dff" class="outline-3">
<h3 id="orga461dff">module-naming-stack:clear-naming</h3>
<div class="outline-text-3" id="text-orga461dff">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">module-naming-stack:clear-naming</span>
  <span style="color: #FF8888;">&lt;&lt; name-record-begin, name-record-end -- &gt;&gt;</span>
  dup2 <span style="color: #ffffff; font-weight: bold;">equal?</span> <span style="color: #f92672; font-weight: bold;">if</span>
    drop2
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #fd971f; font-weight: bold;">module-naming-stack:*unit*</span> sub
  dup <span style="color: #FF4C4C; font-weight: bold;">&gt;:name-record</span>
  <span style="color: #83EA83; font-weight: bold;">:name-record</span> <span style="color: #ffffff; font-weight: bold;">name-record:</span>get-old-jo
  <span style="color: #83EA83; font-weight: bold;">:name-record</span> <span style="color: #ffffff; font-weight: bold;">name-record:</span>get-name
  name,set-jo
  <span style="color: #00ffff; font-weight: bold;">loop</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org26ef046" class="outline-3">
<h3 id="org26ef046">---------------------------------</h3>
</div>

<div id="outline-container-org2d56cfa" class="outline-3">
<h3 id="org2d56cfa">global-naming-stack:prefix-naming</h3>
<div class="outline-text-3" id="text-org2d56cfa">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">global-naming-stack:prefix-naming</span>
  <span style="color: #FF8888;">&lt;&lt; name-record-begin, name-record-end, prefix[name-index] -- &gt;&gt;</span>
  <span style="color: #FF4C4C; font-weight: bold;">&gt;:prefix</span>
  <span style="color: #FF4C4C; font-weight: bold;">&gt;:end</span>
  <span style="color: #FF4C4C; font-weight: bold;">&gt;:begin</span>
  <span style="color: #83EA83; font-weight: bold;">:end</span> <span style="color: #83EA83; font-weight: bold;">:begin</span> <span style="color: #ffffff; font-weight: bold;">equal?</span> <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>

  <span style="color: #fd971f; font-weight: bold;">512</span> <span style="color: #AE7C3B; font-weight: bold;">allocate-local-memory</span> <span style="color: #FF4C4C; font-weight: bold;">&gt;:buffer</span>
  <span style="color: #83EA83; font-weight: bold;">:prefix</span> name<span style="color: #b0b1a3;">-&gt;</span>string <span style="color: #e6db74;">" "</span> <span style="color: #83EA83; font-weight: bold;">:begin</span> <span style="color: #ffffff; font-weight: bold;">name-record:</span>get-name name<span style="color: #b0b1a3;">-&gt;</span>string
  <span style="color: #83EA83; font-weight: bold;">:buffer</span> <span style="color: #fd971f; font-weight: bold;">3</span> n-string<span style="color: #b0b1a3;">-&gt;</span>buffer! <span style="color: #FF4C4C; font-weight: bold;">&gt;:length</span>

  <span style="color: #83EA83; font-weight: bold;">:begin</span> <span style="color: #ffffff; font-weight: bold;">name-record:</span>get-new-jo
  <span style="color: #83EA83; font-weight: bold;">:buffer</span> <span style="color: #83EA83; font-weight: bold;">:length</span> string<span style="color: #b0b1a3;">-&gt;</span>name
  <span style="color: #ffffff; font-weight: bold;">module-naming-stack:</span>record-jo

  <span style="color: #83EA83; font-weight: bold;">:begin</span> <span style="color: #fd971f; font-weight: bold;">global-naming-stack:*unit*</span> add
  <span style="color: #83EA83; font-weight: bold;">:end</span>
  <span style="color: #83EA83; font-weight: bold;">:prefix</span>
  <span style="color: #00ffff; font-weight: bold;">loop</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orge464ac7" class="outline-3">
<h3 id="orge464ac7">module-naming-stack:expose-naming</h3>
<div class="outline-text-3" id="text-orge464ac7">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">module-naming-stack:expose-naming</span>
  <span style="color: #FF8888;">&lt;&lt; name-record-begin, name-record-end -- &gt;&gt;</span>
  <span style="color: #FF4C4C; font-weight: bold;">&gt;:end</span>
  <span style="color: #FF4C4C; font-weight: bold;">&gt;:begin</span>
  <span style="color: #83EA83; font-weight: bold;">:end</span> <span style="color: #83EA83; font-weight: bold;">:begin</span> <span style="color: #ffffff; font-weight: bold;">equal?</span> <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>

  <span style="color: #83EA83; font-weight: bold;">:begin</span> <span style="color: #ffffff; font-weight: bold;">name-record:</span>get-new-jo
  <span style="color: #83EA83; font-weight: bold;">:begin</span> <span style="color: #ffffff; font-weight: bold;">name-record:</span>get-name
  name<span style="color: #b0b1a3;">-&gt;</span>string
  <span style="color: #ffffff; font-weight: bold;">string:</span>word-tail <span style="color: #ffffff; font-weight: bold;">string:</span>byte-tail
  string<span style="color: #b0b1a3;">-&gt;</span>name
  <span style="color: #ffffff; font-weight: bold;">global-naming-stack:</span>record-jo

  <span style="color: #83EA83; font-weight: bold;">:begin</span> <span style="color: #fd971f; font-weight: bold;">module-naming-stack:*unit*</span> add
  <span style="color: #83EA83; font-weight: bold;">:end</span>
  <span style="color: #00ffff; font-weight: bold;">loop</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org1644c23" class="outline-3">
<h3 id="org1644c23">---------------------------------</h3>
</div>
</div>

<div id="outline-container-org405da1b" class="outline-2">
<h2 id="org405da1b">undo</h2>
<div class="outline-text-2" id="text-org405da1b">
</div><div id="outline-container-orga4ae344" class="outline-3">
<h3 id="orga4ae344"><span class="todo _">記</span> 撤銷</h3>
<div class="outline-text-3" id="text-orga4ae344">
<ul class="org-ul">
<li><p>因爲 name-hash-table 的存在</p><p>導致我實現 undo 這個特性的機制</p><p>必須是去記錄差別 而不能是記錄歷史</p></li>
<li><p>具體地</p><p>在每個 undo-point 之後</p><p>所有對 jo 的 redefine 都需要被記錄</p><p>在需要退回到這個 undo-point 之時</p><p>恢復這些被從 name-hash-table 中踢出去的 jo</p></li>
<li><p>這樣</p><p>每一個 jo 被踢出 name-hash-table 時</p><p>會存入 jo name 的對子在 undo-stack 中</p></li>
<li><p>注意</p><p>每一次重新定義都對應一次恢復</p><p><ul class="org-ul"></p><p><li><p>缺點是</p><p>這樣 在兩個 undo-point 之間 對一個 jo 的多次重複定義</p><p>就帶來了一些沒必要的恢復</p></li></p><p><li><p>優點是</p><p>這樣就避免了對 多次重複定義的 jo 的特殊處理</p><p>不論是在效率上</p><p>還是實現的簡潔性上</p><p>這種實現方式都是更優的</p></li></ul></p></li></ul>
</div>
</div>

<div id="outline-container-orge1dd05c" class="outline-3">
<h3 id="orge1dd05c"><span class="todo note">note</span> global states</h3>
<div class="outline-text-3" id="text-orge1dd05c">
<ul class="org-ul">
<li><p>jojo-area</p></li>
<li><p>string-area</p></li>
<li><p>name-hash-table</p></li>
<li><p>global-naming-stack</p></li>
<li><p>module-naming-stack</p></li>
<li><p>importing-stack</p></li>
<li><p>syntax-backup-area</p></li>
<li><p>syntax-stack</p><p>and syntax-rule-set in it</p></li></ul>
</div>
</div>

<div id="outline-container-orgfee5774" class="outline-3">
<h3 id="orgfee5774"><b>undo-stack</b></h3>
<div class="outline-text-3" id="text-orgfee5774">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #fd971f; font-weight: bold;">60</span> <span style="color: #fd971f; font-weight: bold;">1024</span> mul
<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #fd971f; font-weight: bold;">undo-stack:*size*</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #a1ab3a; font-weight: bold;">define-variable,with-tos</span>

<span style="color: #fd971f; font-weight: bold;">7</span> <span style="color: #fd971f; font-weight: bold;">*cell-size*</span> mul
<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #fd971f; font-weight: bold;">undo-stack:*unit*</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #a1ab3a; font-weight: bold;">define-variable,with-tos</span>

<span style="color: #fd971f; font-weight: bold;">undo-stack:*size*</span>
<span style="color: #fd971f; font-weight: bold;">undo-stack:*unit*</span> mul <span style="color: #AE7C3B; font-weight: bold;">allocate-memory</span>
<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #fd971f; font-weight: bold;">*undo-stack*</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #a1ab3a; font-weight: bold;">define-variable,with-tos</span>

<span style="color: #fd971f; font-weight: bold;">*undo-stack*</span>
<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #fd971f; font-weight: bold;">undo-stack:*pointer*</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #a1ab3a; font-weight: bold;">define-variable,with-tos</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd0b0fc1" class="outline-3">
<h3 id="orgd0b0fc1"><span class="todo note">note</span> undo-point</h3>
<div class="outline-text-3" id="text-orgd0b0fc1">
<ul class="org-ul">
<li><p><b>undo-stack</b> contain undo-point</p></li>
<li><p><p></p><p>structure</p><p></p></p><p><table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides"></p><p></p><p></p><p><colgroup></p><p><col  class="org-left" /></p><p></p><p><col  class="org-left" /></p><p></colgroup></p><p><tbody></p><p><tr></p><p><td class="org-left">undo-point</td></p><p><td class="org-left">jojo-area</td></p><p></tr></p><p></p><p><tr></p><p><td class="org-left">&#xa0;</td></p><p><td class="org-left">string-area</td></p><p></tr></p><p></p><p><tr></p><p><td class="org-left">&#xa0;</td></p><p><td class="org-left">global-naming-stack</td></p><p></tr></p><p></p><p><tr></p><p><td class="org-left">&#xa0;</td></p><p><td class="org-left">module-naming-stack</td></p><p></tr></p><p></p><p><tr></p><p><td class="org-left">&#xa0;</td></p><p><td class="org-left">syntax-backup-area</td></p><p></tr></p><p></p><p><tr></p><p><td class="org-left">&#xa0;</td></p><p><td class="org-left">number of syntax-rule-sets</td></p><p></tr></p><p></p><p><tr></p><p><td class="org-left">&#xa0;</td></p><p><td class="org-left">importing-stack</td></p><p></tr></p><p></tbody></p><p></table></p></li>
<li><p>the undo-point used to undo</p><p>will be used to reset the pointer of undo-stack</p><p>[the current-free-address of undo-stack]</p></li></ul>
</div>
</div>

<div id="outline-container-org9a843a7" class="outline-3">
<h3 id="org9a843a7">interface of &lt;undo-point&gt;</h3>
<div class="outline-text-3" id="text-org9a843a7">
</div><div id="outline-container-orgdd77cab" class="outline-4">
<h4 id="orgdd77cab">undo-point:[get|set]-jojo-area</h4>
<div class="outline-text-4" id="text-orgdd77cab">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">undo-point:get-jojo-area</span>
  <span style="color: #FF8888;">&lt;&lt; undo-point -- jojo-area current-free-address &gt;&gt;</span>
  get
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>

<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">undo-point:set-jojo-area</span>
  <span style="color: #FF8888;">&lt;&lt; jojo-area current-free-address, undo-point -- &gt;&gt;</span>
  set
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgdfe2ee1" class="outline-4">
<h4 id="orgdfe2ee1">undo-point:[get|set]-string-area</h4>
<div class="outline-text-4" id="text-orgdfe2ee1">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">undo-point:get-string-area</span>
  <span style="color: #FF8888;">&lt;&lt; undo-point -- jojo-area current-free-address &gt;&gt;</span>
  <span style="color: #fd971f; font-weight: bold;">*cell-size*</span> add get
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>

<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">undo-point:set-string-area</span>
  <span style="color: #FF8888;">&lt;&lt; jojo-area current-free-address, undo-point -- &gt;&gt;</span>
  <span style="color: #fd971f; font-weight: bold;">*cell-size*</span> add set
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orge22f1a4" class="outline-4">
<h4 id="orge22f1a4">undo-point:[get|set]-global-naming-stack</h4>
<div class="outline-text-4" id="text-orge22f1a4">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">undo-point:get-global-naming-stack</span>
  <span style="color: #FF8888;">&lt;&lt; undo-point -- jojo-area current-free-address &gt;&gt;</span>
  <span style="color: #fd971f; font-weight: bold;">*cell-size*</span> <span style="color: #fd971f; font-weight: bold;">2</span> mul add get
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>

<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">undo-point:set-global-naming-stack</span>
  <span style="color: #FF8888;">&lt;&lt; jojo-area current-free-address, undo-point -- &gt;&gt;</span>
  <span style="color: #fd971f; font-weight: bold;">*cell-size*</span> <span style="color: #fd971f; font-weight: bold;">2</span> mul add set
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgaad8958" class="outline-4">
<h4 id="orgaad8958">undo-point:[get|set]-module-naming-stack</h4>
<div class="outline-text-4" id="text-orgaad8958">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">undo-point:get-module-naming-stack</span>
  <span style="color: #FF8888;">&lt;&lt; undo-point -- jojo-area current-free-address &gt;&gt;</span>
  <span style="color: #fd971f; font-weight: bold;">*cell-size*</span> <span style="color: #fd971f; font-weight: bold;">3</span> mul add get
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>

<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">undo-point:set-module-naming-stack</span>
  <span style="color: #FF8888;">&lt;&lt; jojo-area current-free-address, undo-point -- &gt;&gt;</span>
  <span style="color: #fd971f; font-weight: bold;">*cell-size*</span> <span style="color: #fd971f; font-weight: bold;">3</span> mul add set
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orga1174ee" class="outline-4">
<h4 id="orga1174ee">undo-point:[get|set]-syntax-backup-area</h4>
<div class="outline-text-4" id="text-orga1174ee">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">undo-point:get-syntax-backup-area</span>
  <span style="color: #FF8888;">&lt;&lt; undo-point -- jojo-area current-free-address &gt;&gt;</span>
  <span style="color: #fd971f; font-weight: bold;">*cell-size*</span> <span style="color: #fd971f; font-weight: bold;">4</span> mul add get
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>

<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">undo-point:set-syntax-backup-area</span>
  <span style="color: #FF8888;">&lt;&lt; jojo-area current-free-address, undo-point -- &gt;&gt;</span>
  <span style="color: #fd971f; font-weight: bold;">*cell-size*</span> <span style="color: #fd971f; font-weight: bold;">4</span> mul add set
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org56d1ff2" class="outline-4">
<h4 id="org56d1ff2">undo-point:[get|set]-number-of-syntax-rule-sets</h4>
<div class="outline-text-4" id="text-org56d1ff2">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">undo-point:get-number-of-syntax-rule-sets</span>
  <span style="color: #FF8888;">&lt;&lt; undo-point -- jojo-area current-free-address &gt;&gt;</span>
  <span style="color: #fd971f; font-weight: bold;">*cell-size*</span> <span style="color: #fd971f; font-weight: bold;">5</span> mul add get
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>

<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">undo-point:set-number-of-syntax-rule-sets</span>
  <span style="color: #FF8888;">&lt;&lt; jojo-area current-free-address, undo-point -- &gt;&gt;</span>
  <span style="color: #fd971f; font-weight: bold;">*cell-size*</span> <span style="color: #fd971f; font-weight: bold;">5</span> mul add set
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org60c266e" class="outline-4">
<h4 id="org60c266e">undo-point:[get|set]-importing-stack</h4>
<div class="outline-text-4" id="text-org60c266e">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">undo-point:get-importing-stack</span>
  <span style="color: #FF8888;">&lt;&lt; undo-point -- jojo-area current-free-address &gt;&gt;</span>
  <span style="color: #fd971f; font-weight: bold;">*cell-size*</span> <span style="color: #fd971f; font-weight: bold;">6</span> mul add get
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>

<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">undo-point:set-importing-stack</span>
  <span style="color: #FF8888;">&lt;&lt; jojo-area current-free-address, undo-point -- &gt;&gt;</span>
  <span style="color: #fd971f; font-weight: bold;">*cell-size*</span> <span style="color: #fd971f; font-weight: bold;">6</span> mul add set
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org339686a" class="outline-3">
<h3 id="org339686a"><b>syntax-backup-area</b></h3>
<div class="outline-text-3" id="text-org339686a">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #fd971f; font-weight: bold;">20</span> <span style="color: #fd971f; font-weight: bold;">1024</span> mul
<span style="color: #fd971f; font-weight: bold;">*cell-size*</span> mul
<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #fd971f; font-weight: bold;">*syntax-backup-area,size*</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #a1ab3a; font-weight: bold;">define-variable,with-tos</span>

<span style="color: #fd971f; font-weight: bold;">*syntax-backup-area,size*</span> <span style="color: #AE7C3B; font-weight: bold;">allocate-memory</span>
<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #fd971f; font-weight: bold;">*syntax-backup-area*</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #a1ab3a; font-weight: bold;">define-variable,with-tos</span>

<span style="color: #fd971f; font-weight: bold;">*syntax-backup-area*</span>
<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #fd971f; font-weight: bold;">*syntax-backup-area,current-free-address*</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #a1ab3a; font-weight: bold;">define-variable,with-tos</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org274a10d" class="outline-3">
<h3 id="org274a10d">undo-point:create</h3>
<div class="outline-text-3" id="text-org274a10d">
</div><div id="outline-container-org4411365" class="outline-4">
<h4 id="org4411365"><span class="todo _">記</span> </h4>
<div class="outline-text-4" id="text-org4411365">
<ul class="org-ul">
<li><p>將 undo-point 這個數據結構入 undo-stack</p><p>並返回剛入棧的數據結構的地址</p></li></ul>
</div>
</div>

<div id="outline-container-org6dfe7e9" class="outline-4">
<h4 id="org6dfe7e9">undo-point:create,copy-syntax,one-syntax-rule-set</h4>
<div class="outline-text-4" id="text-org6dfe7e9">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">undo-point:create,copy-syntax,one-syntax-rule-set</span>
  <span style="color: #FF8888;">&lt;&lt; syntax-rule-set -- &gt;&gt;</span>
  <span style="color: #FF4C4C; font-weight: bold;">&gt;:syntax-rule-set</span>
  <span style="color: #83EA83; font-weight: bold;">:syntax-rule-set</span> <span style="color: #ffffff; font-weight: bold;">syntax-rule-set:</span>get-border <span style="color: #FF4C4C; font-weight: bold;">&gt;:border</span>
  <span style="color: #83EA83; font-weight: bold;">:border</span> <span style="color: #83EA83; font-weight: bold;">:syntax-rule-set</span> sub
  <span style="color: #fd971f; font-weight: bold;">*cell-size*</span> div <span style="color: #FF4C4C; font-weight: bold;">&gt;:n</span>

  <span style="color: #83EA83; font-weight: bold;">:syntax-rule-set</span>
  <span style="color: #fd971f; font-weight: bold;">*syntax-backup-area,current-free-address*</span> set
  <span style="color: #fd971f; font-weight: bold;">*cell-size*</span> <span style="color: #f92672; font-weight: bold;">address</span> <span style="color: #fd971f; font-weight: bold;">*syntax-backup-area,current-free-address*</span> add-set

  <span style="color: #83EA83; font-weight: bold;">:n</span>
  <span style="color: #fd971f; font-weight: bold;">*syntax-backup-area,current-free-address*</span> set
  <span style="color: #fd971f; font-weight: bold;">*cell-size*</span> <span style="color: #f92672; font-weight: bold;">address</span> <span style="color: #fd971f; font-weight: bold;">*syntax-backup-area,current-free-address*</span> add-set

  <span style="color: #83EA83; font-weight: bold;">:syntax-rule-set</span>
  <span style="color: #83EA83; font-weight: bold;">:n</span> n-get
  <span style="color: #fd971f; font-weight: bold;">*syntax-backup-area,current-free-address*</span>
  <span style="color: #83EA83; font-weight: bold;">:n</span> n-set
  <span style="color: #fd971f; font-weight: bold;">*cell-size*</span> <span style="color: #83EA83; font-weight: bold;">:n</span> mul
  <span style="color: #f92672; font-weight: bold;">address</span> <span style="color: #fd971f; font-weight: bold;">*syntax-backup-area,current-free-address*</span> add-set
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org1c3f547" class="outline-4">
<h4 id="org1c3f547">undo-point:create,copy-syntax</h4>
<div class="outline-text-4" id="text-org1c3f547">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">undo-point:create,copy-syntax</span>
  <span style="color: #FF8888;">&lt;&lt; cursor -- &gt;&gt;</span>
  dup <span style="color: #fd971f; font-weight: bold;">syntax-stack:*pointer*</span> <span style="color: #ffffff; font-weight: bold;">equal?</span> <span style="color: #f92672; font-weight: bold;">if</span>
    drop
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  dup get <span style="color: #ffffff; font-weight: bold;">undo-point:</span>create,copy-syntax,one-syntax-rule-set
  <span style="color: #fd971f; font-weight: bold;">*cell-size*</span> add
  <span style="color: #00ffff; font-weight: bold;">loop</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgcf7eeef" class="outline-4">
<h4 id="orgcf7eeef">undo-point:create</h4>
<div class="outline-text-4" id="text-orgcf7eeef">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">undo-point:create</span>
  <span style="color: #FF8888;">&lt;&lt; -- undo-point &gt;&gt;</span>
  <span style="color: #fd971f; font-weight: bold;">undo-stack:*pointer*</span>
  <span style="color: #FF4C4C; font-weight: bold;">&gt;:undo-point</span>

  <span style="color: #fd971f; font-weight: bold;">undo-stack:*unit*</span>
  <span style="color: #f92672; font-weight: bold;">address</span> <span style="color: #fd971f; font-weight: bold;">undo-stack:*pointer*</span>
  add-set

  <span style="color: #fd971f; font-weight: bold;">*jojo-area,current-free-address*</span>
  <span style="color: #83EA83; font-weight: bold;">:undo-point</span>
  <span style="color: #ffffff; font-weight: bold;">undo-point:</span>set-jojo-area

  <span style="color: #fd971f; font-weight: bold;">*string-area,current-free-address*</span>
  <span style="color: #83EA83; font-weight: bold;">:undo-point</span>
  <span style="color: #ffffff; font-weight: bold;">undo-point:</span>set-string-area

  <span style="color: #fd971f; font-weight: bold;">global-naming-stack:*pointer*</span>
  <span style="color: #83EA83; font-weight: bold;">:undo-point</span>
  <span style="color: #ffffff; font-weight: bold;">undo-point:</span>set-global-naming-stack

  <span style="color: #fd971f; font-weight: bold;">module-naming-stack:*pointer*</span>
  <span style="color: #83EA83; font-weight: bold;">:undo-point</span>
  <span style="color: #ffffff; font-weight: bold;">undo-point:</span>set-module-naming-stack

  <span style="color: #fd971f; font-weight: bold;">importing-stack:*pointer*</span>
  <span style="color: #83EA83; font-weight: bold;">:undo-point</span>
  <span style="color: #ffffff; font-weight: bold;">undo-point:</span>set-importing-stack

  <span style="color: #fd971f; font-weight: bold;">*syntax-backup-area,current-free-address*</span>
  <span style="color: #83EA83; font-weight: bold;">:undo-point</span>
  <span style="color: #ffffff; font-weight: bold;">undo-point:</span>set-syntax-backup-area

  <span style="color: #fd971f; font-weight: bold;">syntax-stack:*address*</span>
  <span style="color: #ffffff; font-weight: bold;">undo-point:</span>create,copy-syntax

  <span style="color: #fd971f; font-weight: bold;">syntax-stack:*pointer*</span>
  <span style="color: #fd971f; font-weight: bold;">syntax-stack:*address*</span> sub
  <span style="color: #fd971f; font-weight: bold;">*cell-size*</span> div
  <span style="color: #83EA83; font-weight: bold;">:undo-point</span>
  <span style="color: #ffffff; font-weight: bold;">undo-point:</span>set-number-of-syntax-rule-sets

  <span style="color: #83EA83; font-weight: bold;">:undo-point</span>
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org4d75772" class="outline-3">
<h3 id="org4d75772">undo-point:restore</h3>
<div class="outline-text-3" id="text-org4d75772">
</div><div id="outline-container-orgbaf1eda" class="outline-4">
<h4 id="orgbaf1eda">undo-point:restore-jojo-area</h4>
<div class="outline-text-4" id="text-orgbaf1eda">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">undo-point:restore-jojo-area</span>
  <span style="color: #FF8888;">&lt;&lt; undo-point -- &gt;&gt;</span>
  <span style="color: #ffffff; font-weight: bold;">undo-point:</span>get-jojo-area
  <span style="color: #f92672; font-weight: bold;">address</span> <span style="color: #fd971f; font-weight: bold;">*jojo-area,current-free-address*</span>
  set
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org6d0f673" class="outline-4">
<h4 id="org6d0f673">undo-point:restore-string-area</h4>
<div class="outline-text-4" id="text-org6d0f673">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">undo-point:restore-string-area</span>
  <span style="color: #FF8888;">&lt;&lt; undo-point -- &gt;&gt;</span>
  <span style="color: #ffffff; font-weight: bold;">undo-point:</span>get-string-area
  <span style="color: #f92672; font-weight: bold;">address</span> <span style="color: #fd971f; font-weight: bold;">*string-area,current-free-address*</span>
  set
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org3a7eb58" class="outline-4">
<h4 id="org3a7eb58">undo-point:restore-global-naming-stack</h4>
<div class="outline-text-4" id="text-org3a7eb58">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">undo-point:restore-global-naming-stack</span>
  <span style="color: #FF8888;">&lt;&lt; undo-point -- &gt;&gt;</span>
  <span style="color: #ffffff; font-weight: bold;">undo-point:</span>get-global-naming-stack <span style="color: #FF4C4C; font-weight: bold;">&gt;:old-record</span>

  <span style="color: #83EA83; font-weight: bold;">:old-record</span>
  <span style="color: #fd971f; font-weight: bold;">global-naming-stack:*pointer*</span>
  <span style="color: #ffffff; font-weight: bold;">global-naming-stack:</span>clear-naming

  <span style="color: #83EA83; font-weight: bold;">:old-record</span> <span style="color: #f92672; font-weight: bold;">address</span> <span style="color: #fd971f; font-weight: bold;">global-naming-stack:*pointer*</span> set
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org84a5022" class="outline-4">
<h4 id="org84a5022">undo-point:restore-module-naming-stack</h4>
<div class="outline-text-4" id="text-org84a5022">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">undo-point:restore-module-naming-stack</span>
  <span style="color: #FF8888;">&lt;&lt; undo-point -- &gt;&gt;</span>
  <span style="color: #ffffff; font-weight: bold;">undo-point:</span>get-module-naming-stack <span style="color: #FF4C4C; font-weight: bold;">&gt;:old-record</span>

  <span style="color: #83EA83; font-weight: bold;">:old-record</span>
  <span style="color: #fd971f; font-weight: bold;">module-naming-stack:*pointer*</span>
  <span style="color: #ffffff; font-weight: bold;">module-naming-stack:</span>clear-naming

  <span style="color: #83EA83; font-weight: bold;">:old-record</span> <span style="color: #f92672; font-weight: bold;">address</span> <span style="color: #fd971f; font-weight: bold;">module-naming-stack:*pointer*</span> set
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org7c5a3f1" class="outline-4">
<h4 id="org7c5a3f1"><span class="todo _">記</span> 語法棧的備份</h4>
<div class="outline-text-4" id="text-org7c5a3f1">
<ul class="org-ul">
<li><p>複製出去的時候 從頭到尾[從棧底到棧頂]掃描 語法棧</p><p>複製回來的時候 從頭到尾掃描 語法備份區</p></li>
<li><p><p></p><p>規則集 本身做爲數據結構的存在是</p><p></p></p><p><table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides"></p><p></p><p></p><p><colgroup></p><p><col  class="org-left" /></p><p></p><p><col  class="org-left" /></p><p></colgroup></p><p><thead></p><p><tr></p><p><th scope="col" class="org-left">&#xa0;</th></p><p><th scope="col" class="org-left">border</th></p><p></tr></p><p></thead></p><p><tbody></p><p><tr></p><p><td class="org-left">syntax-rule-set</td></p><p><td class="org-left">predicate</td></p><p></tr></p><p></p><p><tr></p><p><td class="org-left">&#xa0;</td></p><p><td class="org-left">function</td></p><p></tr></p><p></tbody></p><p><tbody></p><p><tr></p><p><td class="org-left">&#xa0;</td></p><p><td class="org-left">predicate</td></p><p></tr></p><p></p><p><tr></p><p><td class="org-left">&#xa0;</td></p><p><td class="org-left">function</td></p><p></tr></p><p></tbody></p><p><tbody></p><p><tr></p><p><td class="org-left">&#xa0;</td></p><p><td class="org-left">&#x2026;</td></p><p></tr></p><p></tbody></p><p></table></p></li>
<li><p><p></p><p>語法棧中的每一個 規則集 在備份中的存在是</p><p></p></p><p><table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides"></p><p></p><p></p><p><colgroup></p><p><col  class="org-left" /></p><p></colgroup></p><p><tbody></p><p><tr></p><p><td class="org-left">address</td></p><p></tr></p><p></p><p><tr></p><p><td class="org-left">length</td></p><p></tr></p><p></p><p><tr></p><p><td class="org-left">jo</td></p><p></tr></p><p></p><p><tr></p><p><td class="org-left">jo</td></p><p></tr></p><p></p><p><tr></p><p><td class="org-left">&#x2026;</td></p><p></tr></p><p></tbody></p><p></table></p><p><p></p><p>此處把 jo 按順序複製回 address 所代表的 規則集</p><p>然後重置 current-free-address 就行了</p><p>並不必知道 jo 的語義</p><p></p></p></li></ul>
</div>
</div>

<div id="outline-container-org368c511" class="outline-4">
<h4 id="org368c511">undo-point:restore-syntax-backup-area,set-syntax</h4>
<div class="outline-text-4" id="text-org368c511">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">undo-point:restore-syntax-backup-area,set-syntax</span>
  <span style="color: #FF8888;">&lt;&lt; cursor, syntax-rule-set-copy, number-of-syntax-rule-sets -- cursor &gt;&gt;</span>
  dup <span style="color: #ffffff; font-weight: bold;">zero?</span> <span style="color: #f92672; font-weight: bold;">if</span>
    drop2
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #FF4C4C; font-weight: bold;">&gt;:number-of-syntax-rule-sets</span>
  <span style="color: #FF4C4C; font-weight: bold;">&gt;:syntax-rule-set-copy</span>
  <span style="color: #FF4C4C; font-weight: bold;">&gt;:cursor</span>

  <span style="color: #83EA83; font-weight: bold;">:syntax-rule-set-copy</span> get <span style="color: #FF4C4C; font-weight: bold;">&gt;:syntax-rule-set</span>
  <span style="color: #83EA83; font-weight: bold;">:syntax-rule-set-copy</span> <span style="color: #fd971f; font-weight: bold;">*cell-size*</span> add get <span style="color: #FF4C4C; font-weight: bold;">&gt;:n</span>

  <span style="color: #83EA83; font-weight: bold;">:syntax-rule-set</span> <span style="color: #83EA83; font-weight: bold;">:cursor</span> set

  <span style="color: #83EA83; font-weight: bold;">:syntax-rule-set-copy</span> <span style="color: #fd971f; font-weight: bold;">*cell-size*</span> <span style="color: #fd971f; font-weight: bold;">2</span> mul add
  <span style="color: #83EA83; font-weight: bold;">:n</span> n-get
  <span style="color: #83EA83; font-weight: bold;">:syntax-rule-set</span>
  <span style="color: #83EA83; font-weight: bold;">:n</span> n-set

  <span style="color: #fd971f; font-weight: bold;">*cell-size*</span>
  <span style="color: #83EA83; font-weight: bold;">:n</span> mul
  <span style="color: #83EA83; font-weight: bold;">:syntax-rule-set</span> add
  <span style="color: #83EA83; font-weight: bold;">:syntax-rule-set</span> <span style="color: #ffffff; font-weight: bold;">syntax-rule-set:</span>set-border

  <span style="color: #83EA83; font-weight: bold;">:cursor</span> <span style="color: #fd971f; font-weight: bold;">*cell-size*</span> add
  <span style="color: #83EA83; font-weight: bold;">:syntax-rule-set-copy</span> <span style="color: #fd971f; font-weight: bold;">*cell-size*</span> <span style="color: #83EA83; font-weight: bold;">:n</span> <span style="color: #fd971f; font-weight: bold;">2</span> add mul add
  <span style="color: #83EA83; font-weight: bold;">:number-of-syntax-rule-sets</span> sub1
  <span style="color: #00ffff; font-weight: bold;">loop</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org9a3dd91" class="outline-4">
<h4 id="org9a3dd91">undo-point:restore-syntax-backup-area</h4>
<div class="outline-text-4" id="text-org9a3dd91">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">undo-point:restore-syntax-backup-area</span>
  <span style="color: #FF8888;">&lt;&lt; undo-point -- &gt;&gt;</span>
  <span style="color: #FF4C4C; font-weight: bold;">&gt;:undo-point</span>
  <span style="color: #83EA83; font-weight: bold;">:undo-point</span> <span style="color: #ffffff; font-weight: bold;">undo-point:</span>get-syntax-backup-area <span style="color: #FF4C4C; font-weight: bold;">&gt;:old-address</span>
  <span style="color: #83EA83; font-weight: bold;">:undo-point</span> <span style="color: #ffffff; font-weight: bold;">undo-point:</span>get-number-of-syntax-rule-sets <span style="color: #FF4C4C; font-weight: bold;">&gt;:number-of-syntax-rule-sets</span>

  <span style="color: #fd971f; font-weight: bold;">syntax-stack:*address*</span>
  <span style="color: #83EA83; font-weight: bold;">:old-address</span>
  <span style="color: #83EA83; font-weight: bold;">:number-of-syntax-rule-sets</span>
  <span style="color: #ffffff; font-weight: bold;">undo-point:</span>restore-syntax-backup-area,set-syntax <span style="color: #FF4C4C; font-weight: bold;">&gt;:cursor</span>

  <span style="color: #83EA83; font-weight: bold;">:cursor</span>
  <span style="color: #f92672; font-weight: bold;">address</span> <span style="color: #fd971f; font-weight: bold;">syntax-stack:*pointer*</span>
  set

  <span style="color: #83EA83; font-weight: bold;">:old-address</span>
  <span style="color: #f92672; font-weight: bold;">address</span> <span style="color: #fd971f; font-weight: bold;">*syntax-backup-area,current-free-address*</span>
  set
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org2e297c1" class="outline-4">
<h4 id="org2e297c1">undo-point:restore-importing-stack</h4>
<div class="outline-text-4" id="text-org2e297c1">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">undo-point:restore-importing-stack</span>
  <span style="color: #FF8888;">&lt;&lt; undo-point -- &gt;&gt;</span>
  <span style="color: #ffffff; font-weight: bold;">undo-point:</span>get-importing-stack
  <span style="color: #f92672; font-weight: bold;">address</span> <span style="color: #fd971f; font-weight: bold;">importing-stack:*pointer*</span>
  set
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org499ff59" class="outline-4">
<h4 id="org499ff59">undo-point:restore-undo-stack</h4>
<div class="outline-text-4" id="text-org499ff59">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">undo-point:restore-undo-stack</span>
  <span style="color: #FF8888;">&lt;&lt; undo-point -- &gt;&gt;</span>
  <span style="color: #f92672; font-weight: bold;">address</span> <span style="color: #fd971f; font-weight: bold;">undo-stack:*pointer*</span>
  set
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org949d9d8" class="outline-3">
<h3 id="org949d9d8">undo</h3>
<div class="outline-text-3" id="text-org949d9d8">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">undo</span>
  <span style="color: #FF8888;">&lt;&lt; undo-point -- &gt;&gt;</span>
  <span style="color: #FF4C4C; font-weight: bold;">&gt;:undo-point</span>
  <span style="color: #83EA83; font-weight: bold;">:undo-point</span> <span style="color: #ffffff; font-weight: bold;">undo-point:</span>restore-jojo-area
  <span style="color: #83EA83; font-weight: bold;">:undo-point</span> <span style="color: #ffffff; font-weight: bold;">undo-point:</span>restore-string-area
  <span style="color: #83EA83; font-weight: bold;">:undo-point</span> <span style="color: #ffffff; font-weight: bold;">undo-point:</span>restore-global-naming-stack
  <span style="color: #83EA83; font-weight: bold;">:undo-point</span> <span style="color: #ffffff; font-weight: bold;">undo-point:</span>restore-module-naming-stack
  <span style="color: #83EA83; font-weight: bold;">:undo-point</span> <span style="color: #ffffff; font-weight: bold;">undo-point:</span>restore-syntax-backup-area
  <span style="color: #83EA83; font-weight: bold;">:undo-point</span> <span style="color: #ffffff; font-weight: bold;">undo-point:</span>restore-importing-stack
  <span style="color: #83EA83; font-weight: bold;">:undo-point</span> <span style="color: #ffffff; font-weight: bold;">undo-point:</span>restore-undo-stack
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org3f25ca9" class="outline-3">
<h3 id="org3f25ca9"><span class="done test">test</span> undo</h3>
<div class="outline-text-3" id="text-org3f25ca9">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffffff; font-weight: bold;">undo-point:</span>create
<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #fd971f; font-weight: bold;">*undo-point*</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #a1ab3a; font-weight: bold;">define-variable,with-tos</span>

<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">test,undo</span>
  <span style="color: #FF8888;">&lt;&lt; -- &gt;&gt;</span>
  <span style="color: #e6db74;">"testing undo"</span> .s .l
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>

test,undo <span style="color: #FF8888;">&lt;&lt; testing undo &gt;&gt;</span>

<span style="color: #fd971f; font-weight: bold;">*undo-point*</span> undo

test,undo <span style="color: #FF8888;">&lt;&lt; undefined &gt;&gt;</span>

<span style="color: #fd971f; font-weight: bold;">*undo-point*</span> <span style="color: #FF8888;">&lt;&lt; undefined &gt;&gt;</span>


<span style="color: #FF8888;">&lt;&lt; with global-naming-stack &gt;&gt;</span>

<span style="color: #ffffff; font-weight: bold;">undo-point:</span>create
<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #fd971f; font-weight: bold;">*undo-point*</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #a1ab3a; font-weight: bold;">define-variable,with-tos</span>

<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">test,undo</span>
  <span style="color: #FF8888;">&lt;&lt; -- &gt;&gt;</span>
  <span style="color: #e6db74;">"before undo"</span> .s .l
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>

test,undo <span style="color: #FF8888;">&lt;&lt; before undo &gt;&gt;</span>

<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">test,undo</span>
  <span style="color: #FF8888;">&lt;&lt; -- &gt;&gt;</span>
  <span style="color: #e6db74;">"after undo"</span> .s .l
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>

test,undo <span style="color: #FF8888;">&lt;&lt; after undo &gt;&gt;</span>

<span style="color: #fd971f; font-weight: bold;">*undo-point*</span> undo

test,undo <span style="color: #FF8888;">&lt;&lt; undefined &gt;&gt;</span>

<span style="color: #fd971f; font-weight: bold;">*undo-point*</span> <span style="color: #FF8888;">&lt;&lt; undefined &gt;&gt;</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org7f156c1" class="outline-3">
<h3 id="org7f156c1"><span class="done test">test</span> undo with syntax-stack</h3>
<div class="outline-text-3" id="text-org7f156c1">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffffff; font-weight: bold;">undo-point:</span>create
<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #fd971f; font-weight: bold;">*undo-point*</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #a1ab3a; font-weight: bold;">define-variable,with-tos</span>

<span style="color: #fd971f; font-weight: bold;">syntax-rule-set:*word-interpreter*</span>
<span style="color: #f92672; font-weight: bold;">jo</span> <span style="color: #ffffff; font-weight: bold;">integer-string?</span>
<span style="color: #f92672; font-weight: bold;">jo</span> hi
<span style="color: #ffffff; font-weight: bold;">syntax-rule:</span>add

<span style="color: #fd971f; font-weight: bold;">syntax-rule-set:*word-interpreter*</span> push-syntax-stack

<span style="color: #fd971f; font-weight: bold;">123</span> drop2 <span style="color: #FF8888;">&lt;&lt; hi &gt;&gt;</span>

<span style="color: #fd971f; font-weight: bold;">syntax-stack:*pointer*</span>
<span style="color: #fd971f; font-weight: bold;">syntax-stack:*address*</span> sub
<span style="color: #fd971f; font-weight: bold;">*cell-size*</span> div . <span style="color: #FF8888;">&lt;&lt; 2 &gt;&gt;</span>

<span style="color: #FF8888;">&lt;&lt;</span>
<span style="color: #FF8888;">report:syntax</span>
<span style="color: #FF8888;">&gt;&gt;</span>

<span style="color: #fd971f; font-weight: bold;">*undo-point*</span> undo

<span style="color: #fd971f; font-weight: bold;">123</span> . <span style="color: #FF8888;">&lt;&lt; 123 &gt;&gt;</span>

<span style="color: #fd971f; font-weight: bold;">syntax-stack:*pointer*</span>
<span style="color: #fd971f; font-weight: bold;">syntax-stack:*address*</span> sub
<span style="color: #fd971f; font-weight: bold;">*cell-size*</span> div . <span style="color: #FF8888;">&lt;&lt; 1 &gt;&gt;</span>

<span style="color: #FF8888;">&lt;&lt;</span>
<span style="color: #FF8888;">report:syntax</span>
<span style="color: #FF8888;">&gt;&gt;</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org8b28949" class="outline-3">
<h3 id="org8b28949"><span class="done test">test</span> undo with alias</h3>
<div class="outline-text-3" id="text-org8b28949">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffffff; font-weight: bold;">undo-point:</span>create
<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #fd971f; font-weight: bold;">*undo-point*</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #a1ab3a; font-weight: bold;">define-variable,with-tos</span>

<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">test,undo</span>
  <span style="color: #FF8888;">&lt;&lt; -- &gt;&gt;</span>
  <span style="color: #e6db74;">"testing undo"</span> .s .l
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>

<span style="color: #e6db74;">"t,u"</span> <span style="color: #e6db74;">"test,undo"</span> alias

test,undo <span style="color: #FF8888;">&lt;&lt; testing undo &gt;&gt;</span>
t,u <span style="color: #FF8888;">&lt;&lt; testing undo &gt;&gt;</span>

<span style="color: #fd971f; font-weight: bold;">*undo-point*</span> undo

test,undo <span style="color: #FF8888;">&lt;&lt; undefined &gt;&gt;</span>
t,u <span style="color: #FF8888;">&lt;&lt; undefined &gt;&gt;</span>

<span style="color: #fd971f; font-weight: bold;">*undo-point*</span> <span style="color: #FF8888;">&lt;&lt; undefined &gt;&gt;</span>


<span style="color: #FF8888;">&lt;&lt; with global-naming-stack &gt;&gt;</span>

<span style="color: #ffffff; font-weight: bold;">undo-point:</span>create
<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #fd971f; font-weight: bold;">*undo-point*</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #a1ab3a; font-weight: bold;">define-variable,with-tos</span>

<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">test,undo</span>
  <span style="color: #FF8888;">&lt;&lt; -- &gt;&gt;</span>
  <span style="color: #e6db74;">"before undo"</span> .s .l
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>

<span style="color: #e6db74;">"t,u"</span> <span style="color: #e6db74;">"test,undo"</span> alias

test,undo <span style="color: #FF8888;">&lt;&lt; before undo &gt;&gt;</span>
t,u  <span style="color: #FF8888;">&lt;&lt; before undo &gt;&gt;</span>

<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">test,undo</span>
  <span style="color: #FF8888;">&lt;&lt; -- &gt;&gt;</span>
  <span style="color: #e6db74;">"after undo"</span> .s .l
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>

test,undo <span style="color: #FF8888;">&lt;&lt; after undo &gt;&gt;</span>

t,u  <span style="color: #FF8888;">&lt;&lt; before undo &gt;&gt;</span>

<span style="color: #e6db74;">"t,u"</span> <span style="color: #e6db74;">"test,undo"</span> alias

t,u  <span style="color: #FF8888;">&lt;&lt; after undo &gt;&gt;</span>

<span style="color: #fd971f; font-weight: bold;">*undo-point*</span> undo


test,undo <span style="color: #FF8888;">&lt;&lt; undefined &gt;&gt;</span>
t,u  <span style="color: #FF8888;">&lt;&lt; undefined &gt;&gt;</span>

<span style="color: #fd971f; font-weight: bold;">*undo-point*</span> <span style="color: #FF8888;">&lt;&lt; undefined &gt;&gt;</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org9e4dd80" class="outline-2">
<h2 id="org9e4dd80">pre-module:*syntax-rule-set*</h2>
<div class="outline-text-2" id="text-org9e4dd80">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #fd971f; font-weight: bold;">pre-module:*syntax-rule-set:size*</span>
  <span style="color: #fd971f; font-weight: bold;">1024</span> <span style="color: #fd971f; font-weight: bold;">*cell-size*</span> mul
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #a1ab3a; font-weight: bold;">define-variable</span>

<span style="color: #FF8888;">&lt;&lt; for cursor &gt;&gt;</span>
<span style="color: #fd971f; font-weight: bold;">*cell-size*</span> <span style="color: #AE7C3B; font-weight: bold;">allocate-memory</span> drop

<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #fd971f; font-weight: bold;">pre-module:*syntax-rule-set*</span>
  <span style="color: #fd971f; font-weight: bold;">pre-module:*syntax-rule-set:size*</span> <span style="color: #AE7C3B; font-weight: bold;">allocate-memory</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #a1ab3a; font-weight: bold;">define-variable</span>

<span style="color: #fd971f; font-weight: bold;">pre-module:*syntax-rule-set*</span>
<span style="color: #fd971f; font-weight: bold;">pre-module:*syntax-rule-set*</span> <span style="color: #fd971f; font-weight: bold;">*cell-size*</span> sub
set
</pre>
</div>
</div>
</div>

<div id="outline-container-org3c443af" class="outline-2">
<h2 id="org3c443af">syntax-rule-set:*post-module*</h2>
<div class="outline-text-2" id="text-org3c443af">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #fd971f; font-weight: bold;">post-module:*syntax-rule-set:size*</span>
  <span style="color: #fd971f; font-weight: bold;">1024</span> <span style="color: #fd971f; font-weight: bold;">*cell-size*</span> mul
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #a1ab3a; font-weight: bold;">define-variable</span>

<span style="color: #FF8888;">&lt;&lt; for cursor &gt;&gt;</span>
<span style="color: #fd971f; font-weight: bold;">*cell-size*</span> <span style="color: #AE7C3B; font-weight: bold;">allocate-memory</span> drop

<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #fd971f; font-weight: bold;">syntax-rule-set:*post-module*</span>
  <span style="color: #fd971f; font-weight: bold;">post-module:*syntax-rule-set:size*</span> <span style="color: #AE7C3B; font-weight: bold;">allocate-memory</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #a1ab3a; font-weight: bold;">define-variable</span>

<span style="color: #fd971f; font-weight: bold;">syntax-rule-set:*post-module*</span>
<span style="color: #fd971f; font-weight: bold;">syntax-rule-set:*post-module*</span> <span style="color: #fd971f; font-weight: bold;">*cell-size*</span> sub
set
</pre>
</div>
</div>
</div>

<div id="outline-container-org98b5029" class="outline-2">
<h2 id="org98b5029">module-buffer</h2>
<div class="outline-text-2" id="text-org98b5029">
</div><div id="outline-container-orgb8e5fc1" class="outline-3">
<h3 id="orgb8e5fc1">module-meta-begin-word?</h3>
<div class="outline-text-3" id="text-orgb8e5fc1">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">module-meta-begin-word?</span>
  <span style="color: #FF8888;">&lt;&lt; string[address, length] -- bool &gt;&gt;</span>
  dup <span style="color: #fd971f; font-weight: bold;">6</span> <span style="color: #ffffff; font-weight: bold;">less-than?</span> <span style="color: #f92672; font-weight: bold;">if</span>
    drop2
    <span style="color: #fd971f; font-weight: bold;">false</span>
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #e6db74;">":"</span> <span style="color: #ffffff; font-weight: bold;">string:</span>byte
  <span style="color: #ffffff; font-weight: bold;">string:</span>full-of-the-same-byte?
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orge3b2384" class="outline-3">
<h3 id="orge3b2384">module-meta-end-word?</h3>
<div class="outline-text-3" id="text-orge3b2384">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">module-meta-end-word?</span>
  <span style="color: #FF8888;">&lt;&lt; string[address, length] -- bool &gt;&gt;</span>
  dup <span style="color: #fd971f; font-weight: bold;">6</span> <span style="color: #ffffff; font-weight: bold;">less-than?</span> <span style="color: #f92672; font-weight: bold;">if</span>
    drop2
    <span style="color: #fd971f; font-weight: bold;">false</span>
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #e6db74;">"="</span> <span style="color: #ffffff; font-weight: bold;">string:</span>byte
  <span style="color: #ffffff; font-weight: bold;">string:</span>full-of-the-same-byte?
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org86764b8" class="outline-3">
<h3 id="org86764b8">module-meta-word?</h3>
<div class="outline-text-3" id="text-org86764b8">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">module-meta-word?</span>
  <span style="color: #FF8888;">&lt;&lt; string[address, length] -- bool &gt;&gt;</span>
  dup2 <span style="color: #ffffff; font-weight: bold;">module-meta-begin-word?</span> <span style="color: #f92672; font-weight: bold;">if</span>
    drop2
    <span style="color: #fd971f; font-weight: bold;">true</span>
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  dup2 <span style="color: #ffffff; font-weight: bold;">module-meta-end-word?</span> <span style="color: #f92672; font-weight: bold;">if</span>
    drop2
    <span style="color: #fd971f; font-weight: bold;">true</span>
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  dup <span style="color: #fd971f; font-weight: bold;">1</span> <span style="color: #ffffff; font-weight: bold;">less-or-equal?</span> <span style="color: #f92672; font-weight: bold;">if</span>
    drop2
    <span style="color: #fd971f; font-weight: bold;">false</span>
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #FF4C4C; font-weight: bold;">&gt;:length</span>
  <span style="color: #FF4C4C; font-weight: bold;">&gt;:address</span>
  <span style="color: #83EA83; font-weight: bold;">:address</span> <span style="color: #83EA83; font-weight: bold;">:length</span> add sub1 get-byte <span style="color: #FF4C4C; font-weight: bold;">&gt;:last-byte</span>
  <span style="color: #83EA83; font-weight: bold;">:address</span> <span style="color: #83EA83; font-weight: bold;">:length</span> add sub1 sub1 get-byte <span style="color: #FF4C4C; font-weight: bold;">&gt;:the-byte-before-last-byte</span>
  <span style="color: #83EA83; font-weight: bold;">:last-byte</span>
  <span style="color: #e6db74;">":"</span> <span style="color: #ffffff; font-weight: bold;">string:</span>byte <span style="color: #ffffff; font-weight: bold;">equal?</span> not <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #fd971f; font-weight: bold;">false</span>
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #83EA83; font-weight: bold;">:the-byte-before-last-byte</span>
  <span style="color: #e6db74;">":"</span> <span style="color: #ffffff; font-weight: bold;">string:</span>byte <span style="color: #ffffff; font-weight: bold;">equal?</span> <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #fd971f; font-weight: bold;">false</span>
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #fd971f; font-weight: bold;">true</span>
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org1a0ae7d" class="outline-3">
<h3 id="org1a0ae7d"><span class="done test">test</span> module-meta-begin-word? &amp; module-meta-begin-word?</h3>
<div class="outline-text-3" id="text-org1a0ae7d">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #e6db74;">"* (testing) module-meta-begin-word? &amp; module-meta-begin-word?"</span> .s .l
  <span style="color: #e6db74;">"::::::"</span> <span style="color: #ffffff; font-weight: bold;">module-meta-begin-word?</span> <span style="color: #ffffff; font-weight: bold;">true?</span>
  <span style="color: #e6db74;">"======"</span> <span style="color: #ffffff; font-weight: bold;">module-meta-end-word?</span> <span style="color: #ffffff; font-weight: bold;">true?</span> and

  <span style="color: #e6db74;">":::::"</span> <span style="color: #ffffff; font-weight: bold;">module-meta-begin-word?</span> <span style="color: #ffffff; font-weight: bold;">false?</span> and
  <span style="color: #e6db74;">"====="</span> <span style="color: #ffffff; font-weight: bold;">module-meta-end-word?</span> <span style="color: #ffffff; font-weight: bold;">false?</span> and

  <span style="color: #e6db74;">":::&gt;&lt;:::"</span> <span style="color: #ffffff; font-weight: bold;">module-meta-begin-word?</span> <span style="color: #ffffff; font-weight: bold;">false?</span> and
  <span style="color: #e6db74;">"===&gt;&lt;==="</span> <span style="color: #ffffff; font-weight: bold;">module-meta-end-word?</span> <span style="color: #ffffff; font-weight: bold;">false?</span> and <span style="color: #1ef15f; font-weight: bold;">test</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #1ef15f; font-weight: bold;">test-do</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org67ec8db" class="outline-3">
<h3 id="org67ec8db"><span class="todo _">記</span> 謂詞</h3>
<div class="outline-text-3" id="text-org67ec8db">
<ul class="org-ul">
<li><p>作用於 module-buffer 的函數</p><p>均假設 module-buffer 格式良好</p><p>在調用它們之前</p><p>應該利用有關謂詞保證其格式良好</p></li>
<li><p>謂詞是針對 module-buffer 的</p><p>[即 針對字符串的]</p><p>而不是針對文件的</p><p>否則就會重複閱讀文件</p></li></ul>
</div>
</div>

<div id="outline-container-org90d3d08" class="outline-3">
<h3 id="org90d3d08">module-buffer:good-format?</h3>
<div class="outline-text-3" id="text-org90d3d08">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">module-buffer:good-format?</span>
  <span style="color: #FF8888;">&lt;&lt; module-buffer[address, length] -- bool &gt;&gt;</span>
  dup2 <span style="color: #ffffff; font-weight: bold;">string:</span>space? <span style="color: #f92672; font-weight: bold;">if</span>
    drop2
    <span style="color: #fd971f; font-weight: bold;">false</span>
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  dup2 <span style="color: #ffffff; font-weight: bold;">string:</span>word
  <span style="color: #ffffff; font-weight: bold;">module-meta-begin-word?</span> not <span style="color: #f92672; font-weight: bold;">if</span>
    drop2
    <span style="color: #fd971f; font-weight: bold;">false</span>
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #f92672; font-weight: bold;">jo</span> <span style="color: #ffffff; font-weight: bold;">module-meta-end-word?</span> <span style="color: #ffffff; font-weight: bold;">string:</span>any-word
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orge6bc31b" class="outline-3">
<h3 id="orge6bc31b"><span class="done test">test</span> module-buffer:good-format?</h3>
<div class="outline-text-3" id="text-orge6bc31b">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #e6db74;">"* (testing) module-buffer:good-format"</span> .s .l
  "
  <span style="color: #ef5939; font-weight: bold;">:::::::::</span>
  <span style="color: #a6e22e; font-weight: bold;">import:</span> combinator math
  <span style="color: #a6e22e; font-weight: bold;">module:</span> assembler
  <span style="color: #ae81ff; font-weight: bold;">=========</span>
  hi
  kkk took my baby away!
  "
  <span style="color: #ffffff; font-weight: bold;">module-buffer:</span>good-format? <span style="color: #ffffff; font-weight: bold;">true?</span>

  "
  <span style="color: #ef5939; font-weight: bold;">:::::::::</span>
  <span style="color: #a6e22e; font-weight: bold;">import:</span> combinator math
  <span style="color: #a6e22e; font-weight: bold;">module:</span> assembler
  hi
  kkk took my baby away!
  "
  <span style="color: #ffffff; font-weight: bold;">module-buffer:</span>good-format? <span style="color: #ffffff; font-weight: bold;">false?</span> and <span style="color: #1ef15f; font-weight: bold;">test</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #1ef15f; font-weight: bold;">test-do</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgea6e15f" class="outline-3">
<h3 id="orgea6e15f">module-buffer:get-code-string</h3>
<div class="outline-text-3" id="text-orgea6e15f">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">module-buffer:get-code-string</span>
  <span style="color: #FF8888;">&lt;&lt; module-buffer[address, length] -- meta-string[address, length] &gt;&gt;</span>
  dup2 <span style="color: #ffffff; font-weight: bold;">string:</span>word
  <span style="color: #ffffff; font-weight: bold;">module-meta-end-word?</span> <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #ffffff; font-weight: bold;">string:</span>word-tail
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #ffffff; font-weight: bold;">string:</span>word-tail
  <span style="color: #00ffff; font-weight: bold;">loop</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org712d117" class="outline-3">
<h3 id="org712d117">module-buffer:get-meta-string</h3>
<div class="outline-text-3" id="text-org712d117">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">module-buffer:get-meta-string,loop</span>
  <span style="color: #FF8888;">&lt;&lt; module-buffer[address, length] -- cursor &gt;&gt;</span>
  dup2 <span style="color: #ffffff; font-weight: bold;">string:</span>word
  <span style="color: #ffffff; font-weight: bold;">module-meta-end-word?</span> <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #ffffff; font-weight: bold;">string:</span>word-tail
    drop
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #ffffff; font-weight: bold;">string:</span>word-tail
  <span style="color: #00ffff; font-weight: bold;">loop</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>

<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">module-buffer:get-meta-string</span>
  <span style="color: #FF8888;">&lt;&lt; module-buffer[address, length] -- meta-string[address, length] &gt;&gt;</span>
  dup2 <span style="color: #ffffff; font-weight: bold;">module-buffer:</span>get-meta-string,loop <span style="color: #FF4C4C; font-weight: bold;">&gt;:cursor</span>
  drop <span style="color: #FF4C4C; font-weight: bold;">&gt;:address</span>
  <span style="color: #83EA83; font-weight: bold;">:address</span>
  <span style="color: #83EA83; font-weight: bold;">:cursor</span> <span style="color: #83EA83; font-weight: bold;">:address</span> sub
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org7771e6e" class="outline-3">
<h3 id="org7771e6e"><span class="done test">test</span> module-buffer:get-meta-string</h3>
<div class="outline-text-3" id="text-org7771e6e">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #e6db74;">"* (testing) module-buffer:get-meta-string"</span> .s .l
  "
  <span style="color: #ef5939; font-weight: bold;">:::::::::</span>
  <span style="color: #a6e22e; font-weight: bold;">import:</span> combinator math
  <span style="color: #a6e22e; font-weight: bold;">module:</span> assembler
  <span style="color: #ae81ff; font-weight: bold;">=========</span>
  hi
  kkk took my baby away!
  "
  <span style="color: #ffffff; font-weight: bold;">module-buffer:</span>get-meta-string
  "
  <span style="color: #ef5939; font-weight: bold;">:::::::::</span>
  <span style="color: #a6e22e; font-weight: bold;">import:</span> combinator math
  <span style="color: #a6e22e; font-weight: bold;">module:</span> assembler
  ========="
  <span style="color: #ffffff; font-weight: bold;">string:</span>equal? <span style="color: #1ef15f; font-weight: bold;">test</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #1ef15f; font-weight: bold;">test-do</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orga199856" class="outline-2">
<h2 id="orga199856">import &amp; load &amp; load-with-test</h2>
<div class="outline-text-2" id="text-orga199856">
</div><div id="outline-container-org4881da3" class="outline-3">
<h3 id="org4881da3"><span class="todo _">記</span> 避免相互遞歸函數</h3>
<div class="outline-text-3" id="text-org4881da3">
<ul class="org-ul">
<li><p>沒有相互遞歸函數 (load) (import) 不可相互調用</p><p>加載[load] 不是遞歸函數 而待</p><p>引入[import] 是遞歸函數 而覺</p></li>
<li><p><p></p><p>分析一下遞歸函數</p><p>每次分析遞歸函數 就是要知道</p><p></p></p><p><ol class="org-ol"></p><p><li>如何展開 每個遞歸調用就是展開</p><p>展開就是</p><p>返回棧增加一珠珠</p><p>分配內存給局部數據</li></p><p><li>如何收回 每次函數退出就是收回</li></p><p><li>比如</p><p>pre-function</p><p>recur</p><p>post-function</p><p>end</p><p>其中 pre-function 是展開過程中調用的函數 調用它們的順序是 珠珠 入棧的順序</p><p>而 post-function 是收回過程中調用的函數 調用它們的順序是 珠珠 出棧的順序</p><p>考錄 返回棧 之變化情況就很清楚啦</li></ol></p><p><p></p><p>這次</p><p></p></p><p><ol class="org-ol"></p><p><li>展開</p><p>入 引入棧</li></p><p><li>遞歸</p><p>遞歸發生在 對語法關鍵詞 "import:" 的處理過程中</li></p><p><li>返回</p><p>入 加載棧</p><p>解釋代碼</li></ol></p></li></ul>
</div>
</div>

<div id="outline-container-org57db903" class="outline-3">
<h3 id="org57db903">name-&gt;module-prefix</h3>
<div class="outline-text-3" id="text-org57db903">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">name-&gt;module-prefix</span>
  <span style="color: #FF8888;">&lt;&lt; name -- module-prefix &gt;&gt;</span>
  <span style="color: #FF4C4C; font-weight: bold;">&gt;:name</span>

  <span style="color: #fd971f; font-weight: bold;">512</span> <span style="color: #AE7C3B; font-weight: bold;">allocate-local-memory</span> <span style="color: #FF4C4C; font-weight: bold;">&gt;:buffer</span>

  <span style="color: #e6db74;">"|"</span> <span style="color: #83EA83; font-weight: bold;">:name</span> name<span style="color: #b0b1a3;">-&gt;</span>string <span style="color: #e6db74;">"|"</span>
  <span style="color: #83EA83; font-weight: bold;">:buffer</span>
  <span style="color: #fd971f; font-weight: bold;">3</span> n-string<span style="color: #b0b1a3;">-&gt;</span>buffer! <span style="color: #FF4C4C; font-weight: bold;">&gt;:length</span>

  <span style="color: #83EA83; font-weight: bold;">:buffer</span>
  <span style="color: #83EA83; font-weight: bold;">:length</span>
  string<span style="color: #b0b1a3;">-&gt;</span>name
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb6d8084" class="outline-3">
<h3 id="orgb6d8084">import</h3>
<div class="outline-text-3" id="text-orgb6d8084">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">import</span>
  <span style="color: #FF8888;">&lt;&lt; module-name-string[address, length] -- &gt;&gt;</span>
  <span style="color: #dc322f; font-weight: bold;">&gt;::module-name-string</span>
  <span style="color: #5CDD5C; font-weight: bold;">::module-name-string</span> string<span style="color: #b0b1a3;">-&gt;</span>name <span style="color: #FF4C4C; font-weight: bold;">&gt;:module-name-index</span>
  <span style="color: #83EA83; font-weight: bold;">:module-name-index</span> name<span style="color: #b0b1a3;">-&gt;</span>module-prefix <span style="color: #FF4C4C; font-weight: bold;">&gt;:module-prefix</span>

  <span style="color: #83EA83; font-weight: bold;">:module-name-index</span> <span style="color: #ffffff; font-weight: bold;">module-stack:</span>find <span style="color: #f92672; font-weight: bold;">if</span>
    drop
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>

  <span style="color: #83EA83; font-weight: bold;">:module-name-index</span> <span style="color: #ffffff; font-weight: bold;">importing-stack:</span>find <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #e6db74;">"* (import) circular import of : "</span> .s <span style="color: #5CDD5C; font-weight: bold;">::module-name-string</span> .s .l
    <span style="color: #fd971f; font-weight: bold;">'fail-to-load</span> <span style="color: #00ffff; font-weight: bold;">awake</span>
  <span style="color: #f92672; font-weight: bold;">then</span>

  <span style="color: #5CDD5C; font-weight: bold;">::module-name-string</span> <span style="color: #ffffff; font-weight: bold;">moi:</span>find not <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #e6db74;">"* (import) can not find module : "</span> .s <span style="color: #5CDD5C; font-weight: bold;">::module-name-string</span> .s .l
    <span style="color: #fd971f; font-weight: bold;">'fail-to-load</span> <span style="color: #00ffff; font-weight: bold;">awake</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #dc322f; font-weight: bold;">&gt;::module-path</span>

  <span style="color: #fd971f; font-weight: bold;">64</span> <span style="color: #fd971f; font-weight: bold;">1024</span> mul <span style="color: #AE7C3B; font-weight: bold;">allocate-local-memory</span> <span style="color: #FF4C4C; font-weight: bold;">&gt;:buffer</span>

  <span style="color: #83EA83; font-weight: bold;">:buffer</span>
  <span style="color: #fd971f; font-weight: bold;">64</span> <span style="color: #fd971f; font-weight: bold;">1024</span> mul
  <span style="color: #5CDD5C; font-weight: bold;">::module-path</span>
  <span style="color: #ffffff; font-weight: bold;">file:</span>read <span style="color: #FF4C4C; font-weight: bold;">&gt;:length</span>

  <span style="color: #83EA83; font-weight: bold;">:buffer</span> <span style="color: #83EA83; font-weight: bold;">:length</span> <span style="color: #ffffff; font-weight: bold;">module-buffer:</span>good-format? not <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #e6db74;">"* (import) fail to import module : "</span> .s <span style="color: #5CDD5C; font-weight: bold;">::module-name-string</span> .s .l
    <span style="color: #e6db74;">"  for the file is not well formated cicada-nymph source code"</span> .s .l
    <span style="color: #fd971f; font-weight: bold;">'fail-to-load</span> <span style="color: #00ffff; font-weight: bold;">awake</span>
  <span style="color: #f92672; font-weight: bold;">then</span>

  <span style="color: #83EA83; font-weight: bold;">:buffer</span> <span style="color: #83EA83; font-weight: bold;">:length</span> <span style="color: #ffffff; font-weight: bold;">module-buffer:</span>get-meta-string <span style="color: #dc322f; font-weight: bold;">&gt;::meta-string</span>
  <span style="color: #83EA83; font-weight: bold;">:buffer</span> <span style="color: #83EA83; font-weight: bold;">:length</span> <span style="color: #ffffff; font-weight: bold;">module-buffer:</span>get-code-string <span style="color: #dc322f; font-weight: bold;">&gt;::code-string</span>

  <span style="color: #fd971f; font-weight: bold;">false</span>
  <span style="color: #fd971f; font-weight: bold;">module-stack:*pointer*</span>
  <span style="color: #ffffff; font-weight: bold;">module-info:</span>set-tested-flag

  <span style="color: #fd971f; font-weight: bold;">false</span>
  <span style="color: #fd971f; font-weight: bold;">importing-stack:*pointer*</span>
  <span style="color: #ffffff; font-weight: bold;">importing-record:</span>set-testing-flag
  <span style="color: #83EA83; font-weight: bold;">:module-name-index</span>
  <span style="color: #fd971f; font-weight: bold;">importing-stack:*pointer*</span>
  <span style="color: #ffffff; font-weight: bold;">importing-record:</span>set-name
  <span style="color: #fd971f; font-weight: bold;">importing-stack:*unit*</span> <span style="color: #f92672; font-weight: bold;">address</span> <span style="color: #fd971f; font-weight: bold;">importing-stack:*pointer*</span> add-set

  <span style="color: #fd971f; font-weight: bold;">global-naming-stack:*pointer*</span> <span style="color: #FF4C4C; font-weight: bold;">&gt;:global-name-record-before-import</span>

  <span style="color: #fd971f; font-weight: bold;">pre-module:*syntax-rule-set*</span> push-syntax-stack
  <span style="color: #5CDD5C; font-weight: bold;">::meta-string</span> eval-string
  drop-syntax-stack

  <span style="color: #fd971f; font-weight: bold;">global-naming-stack:*pointer*</span> <span style="color: #FF4C4C; font-weight: bold;">&gt;:global-name-record-begin</span>
  <span style="color: #fd971f; font-weight: bold;">syntax-rule-set:*word-interpreter*</span> push-syntax-stack
  <span style="color: #5CDD5C; font-weight: bold;">::code-string</span> eval-string
  drop-syntax-stack
  <span style="color: #fd971f; font-weight: bold;">global-naming-stack:*pointer*</span> <span style="color: #FF4C4C; font-weight: bold;">&gt;:global-name-record-end</span>

  <span style="color: #fd971f; font-weight: bold;">syntax-rule-set:*post-module*</span> push-syntax-stack
  <span style="color: #5CDD5C; font-weight: bold;">::meta-string</span> eval-string
  drop-syntax-stack

  <span style="color: #ffffff; font-weight: bold;">importing-stack:</span>drop

  <span style="color: #fd971f; font-weight: bold;">module-naming-stack:*pointer*</span> <span style="color: #FF4C4C; font-weight: bold;">&gt;:module-name-record-begin</span>
  <span style="color: #83EA83; font-weight: bold;">:global-name-record-begin</span>
  <span style="color: #83EA83; font-weight: bold;">:global-name-record-end</span>
  <span style="color: #83EA83; font-weight: bold;">:module-prefix</span>
  <span style="color: #ffffff; font-weight: bold;">global-naming-stack:</span>prefix-naming
  <span style="color: #fd971f; font-weight: bold;">module-naming-stack:*pointer*</span> <span style="color: #FF4C4C; font-weight: bold;">&gt;:module-name-record-end</span>

  <span style="color: #83EA83; font-weight: bold;">:global-name-record-before-import</span>
  <span style="color: #fd971f; font-weight: bold;">global-naming-stack:*pointer*</span>
  <span style="color: #ffffff; font-weight: bold;">global-naming-stack:</span>clear-naming

  <span style="color: #83EA83; font-weight: bold;">:global-name-record-before-import</span> <span style="color: #f92672; font-weight: bold;">address</span> <span style="color: #fd971f; font-weight: bold;">global-naming-stack:*pointer*</span> set

  <span style="color: #83EA83; font-weight: bold;">:module-name-record-begin</span>
  <span style="color: #fd971f; font-weight: bold;">module-stack:*pointer*</span>
  <span style="color: #ffffff; font-weight: bold;">module-info:</span>set-name-record-begin
  <span style="color: #83EA83; font-weight: bold;">:module-name-record-end</span>
  <span style="color: #fd971f; font-weight: bold;">module-stack:*pointer*</span>
  <span style="color: #ffffff; font-weight: bold;">module-info:</span>set-name-record-end
  <span style="color: #5CDD5C; font-weight: bold;">::meta-string</span>
  <span style="color: #fd971f; font-weight: bold;">module-stack:*pointer*</span>
  <span style="color: #ffffff; font-weight: bold;">module-info:</span>set-meta-string
  <span style="color: #83EA83; font-weight: bold;">:module-name-index</span>
  <span style="color: #fd971f; font-weight: bold;">module-stack:*pointer*</span>
  <span style="color: #ffffff; font-weight: bold;">module-info:</span>set-name
  <span style="color: #fd971f; font-weight: bold;">module-stack:*unit*</span> <span style="color: #f92672; font-weight: bold;">address</span> <span style="color: #fd971f; font-weight: bold;">module-stack:*pointer*</span> add-set
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc208737" class="outline-3">
<h3 id="orgc208737">module-syntax:unknow-meta-word</h3>
<div class="outline-text-3" id="text-orgc208737">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">module-syntax:unknow-meta-word,loop</span>
  <span style="color: #FF8888;">&lt;&lt; -- &gt;&gt;</span>
  read-word <span style="color: #ffffff; font-weight: bold;">module-meta-word?</span> <span style="color: #f92672; font-weight: bold;">if</span>
    unread-word
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #00ffff; font-weight: bold;">loop</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>

<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">module-syntax:unknow-meta-word</span>
  <span style="color: #FF8888;">&lt;&lt; meta-word -- &gt;&gt;</span>
  drop2
  <span style="color: #ffffff; font-weight: bold;">module-syntax:</span>unknow-meta-word,loop
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org9e0d9c7" class="outline-3">
<h3 id="org9e0d9c7">pre-module-syntax</h3>
<div class="outline-text-3" id="text-org9e0d9c7">
</div><div id="outline-container-org1936211" class="outline-4">
<h4 id="org1936211">meta-literal-word:import?</h4>
<div class="outline-text-4" id="text-org1936211">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">meta-literal-word:import?</span>
  <span style="color: #FF8888;">&lt;&lt; word[address, length] -- bool &gt;&gt;</span>
  <span style="color: #e6db74;">"import:"</span> <span style="color: #ffffff; font-weight: bold;">string:</span>equal?
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgfcd6b17" class="outline-4">
<h4 id="orgfcd6b17">pre-module-syntax:import</h4>
<div class="outline-text-4" id="text-orgfcd6b17">
<ul class="org-ul">
<li><p>import module and expose-naming</p><p>one by one</p></li></ul>
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">pre-module-syntax:import,loop</span>
  <span style="color: #FF8888;">&lt;&lt; -- unknow &gt;&gt;</span>
  read-word <span style="color: #dc322f; font-weight: bold;">&gt;::word</span>
  <span style="color: #5CDD5C; font-weight: bold;">::word</span> string<span style="color: #b0b1a3;">-&gt;</span>name <span style="color: #FF4C4C; font-weight: bold;">&gt;:name</span>
  <span style="color: #5CDD5C; font-weight: bold;">::word</span> <span style="color: #ffffff; font-weight: bold;">module-meta-word?</span> <span style="color: #f92672; font-weight: bold;">if</span>
    unread-word
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #5CDD5C; font-weight: bold;">::word</span> <span style="color: #a6e22e; font-weight: bold;">import</span>
  <span style="color: #83EA83; font-weight: bold;">:name</span> <span style="color: #ffffff; font-weight: bold;">module-stack:</span>find not <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #e6db74;">"* (pre-module-syntax:import,loop) after import module : "</span> .s
       <span style="color: #83EA83; font-weight: bold;">:name</span> name<span style="color: #b0b1a3;">-&gt;</span>string .s .l
    <span style="color: #e6db74;">"  still can not find it in the module-stack"</span> .s .l
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #FF4C4C; font-weight: bold;">&gt;:module-info</span>
  <span style="color: #83EA83; font-weight: bold;">:module-info</span> <span style="color: #ffffff; font-weight: bold;">module-info:</span>get-name-record-begin
  <span style="color: #83EA83; font-weight: bold;">:module-info</span> <span style="color: #ffffff; font-weight: bold;">module-info:</span>get-name-record-end
  <span style="color: #ffffff; font-weight: bold;">module-naming-stack:</span>expose-naming
  <span style="color: #00ffff; font-weight: bold;">loop</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>

<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">pre-module-syntax:import</span>
  <span style="color: #FF8888;">&lt;&lt; meta-literal-word:import -- unknow &gt;&gt;</span>
  drop2
  <span style="color: #ffffff; font-weight: bold;">pre-module-syntax:</span>import,loop
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org1a6f872" class="outline-4">
<h4 id="org1a6f872">add syntax-rule</h4>
<div class="outline-text-4" id="text-org1a6f872">
<ul class="org-ul">
<li><p>the order matters</p></li></ul>
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #fd971f; font-weight: bold;">pre-module:*syntax-rule-set*</span>
<span style="color: #fd971f; font-weight: bold;">syntax-rule-set:*word-interpreter*</span>
<span style="color: #ffffff; font-weight: bold;">syntax-rule-set:</span>mixin

<span style="color: #fd971f; font-weight: bold;">pre-module:*syntax-rule-set*</span>
<span style="color: #f92672; font-weight: bold;">jo</span> <span style="color: #ffffff; font-weight: bold;">module-meta-word?</span>
<span style="color: #f92672; font-weight: bold;">jo</span> <span style="color: #ffffff; font-weight: bold;">module-syntax:</span>unknow-meta-word
<span style="color: #ffffff; font-weight: bold;">syntax-rule:</span>add

<span style="color: #fd971f; font-weight: bold;">pre-module:*syntax-rule-set*</span>
<span style="color: #f92672; font-weight: bold;">jo</span> <span style="color: #ffffff; font-weight: bold;">module-meta-begin-word?</span>
<span style="color: #f92672; font-weight: bold;">jo</span> drop2
<span style="color: #ffffff; font-weight: bold;">syntax-rule:</span>add

<span style="color: #fd971f; font-weight: bold;">pre-module:*syntax-rule-set*</span>
<span style="color: #f92672; font-weight: bold;">jo</span> <span style="color: #ffffff; font-weight: bold;">module-meta-end-word?</span>
<span style="color: #f92672; font-weight: bold;">jo</span> drop2
<span style="color: #ffffff; font-weight: bold;">syntax-rule:</span>add

<span style="color: #fd971f; font-weight: bold;">pre-module:*syntax-rule-set*</span>
<span style="color: #f92672; font-weight: bold;">jo</span> <span style="color: #ffffff; font-weight: bold;">meta-literal-word:</span>import?
<span style="color: #f92672; font-weight: bold;">jo</span> <span style="color: #ffffff; font-weight: bold;">pre-module-syntax:</span>import
<span style="color: #ffffff; font-weight: bold;">syntax-rule:</span>add
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org87ce485" class="outline-3">
<h3 id="org87ce485">post-module-syntax</h3>
<div class="outline-text-3" id="text-org87ce485">
</div><div id="outline-container-orge7761b4" class="outline-4">
<h4 id="orge7761b4">meta-literal-word:do?</h4>
<div class="outline-text-4" id="text-orge7761b4">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">meta-literal-word:do?</span>
  <span style="color: #FF8888;">&lt;&lt; word[address, length] -- bool &gt;&gt;</span>
  <span style="color: #e6db74;">"do:"</span> <span style="color: #ffffff; font-weight: bold;">string:</span>equal?
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orge814897" class="outline-4">
<h4 id="orge814897">post-module-syntax:do</h4>
<div class="outline-text-4" id="text-orge814897">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">post-module-syntax:do,loop</span>
  <span style="color: #FF8888;">&lt;&lt; -- &gt;&gt;</span>
  read-word <span style="color: #dc322f; font-weight: bold;">&gt;::word</span>
  <span style="color: #5CDD5C; font-weight: bold;">::word</span> <span style="color: #ffffff; font-weight: bold;">module-meta-word?</span> <span style="color: #f92672; font-weight: bold;">if</span>
    unread-word
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #5CDD5C; font-weight: bold;">::word</span> word-interpreter
  <span style="color: #00ffff; font-weight: bold;">loop</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>

<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">post-module-syntax:do</span>
  <span style="color: #FF8888;">&lt;&lt; meta-literal-word:do -- &gt;&gt;</span>
  drop2
  <span style="color: #ffffff; font-weight: bold;">post-module-syntax:</span>do,loop
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org7e95f13" class="outline-4">
<h4 id="org7e95f13">add syntax-rule</h4>
<div class="outline-text-4" id="text-org7e95f13">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #fd971f; font-weight: bold;">syntax-rule-set:*post-module*</span>
<span style="color: #fd971f; font-weight: bold;">syntax-rule-set:*word-interpreter*</span>
<span style="color: #ffffff; font-weight: bold;">syntax-rule-set:</span>mixin

<span style="color: #fd971f; font-weight: bold;">syntax-rule-set:*post-module*</span>
<span style="color: #f92672; font-weight: bold;">jo</span> <span style="color: #ffffff; font-weight: bold;">module-meta-word?</span>
<span style="color: #f92672; font-weight: bold;">jo</span> <span style="color: #ffffff; font-weight: bold;">module-syntax:</span>unknow-meta-word
<span style="color: #ffffff; font-weight: bold;">syntax-rule:</span>add

<span style="color: #fd971f; font-weight: bold;">syntax-rule-set:*post-module*</span>
<span style="color: #f92672; font-weight: bold;">jo</span> <span style="color: #ffffff; font-weight: bold;">module-meta-begin-word?</span>
<span style="color: #f92672; font-weight: bold;">jo</span> drop2
<span style="color: #ffffff; font-weight: bold;">syntax-rule:</span>add

<span style="color: #fd971f; font-weight: bold;">syntax-rule-set:*post-module*</span>
<span style="color: #f92672; font-weight: bold;">jo</span> <span style="color: #ffffff; font-weight: bold;">module-meta-end-word?</span>
<span style="color: #f92672; font-weight: bold;">jo</span> drop2
<span style="color: #ffffff; font-weight: bold;">syntax-rule:</span>add

<span style="color: #fd971f; font-weight: bold;">syntax-rule-set:*post-module*</span>
<span style="color: #f92672; font-weight: bold;">jo</span> <span style="color: #ffffff; font-weight: bold;">meta-literal-word:</span>do?
<span style="color: #f92672; font-weight: bold;">jo</span> <span style="color: #ffffff; font-weight: bold;">post-module-syntax:</span>do
<span style="color: #ffffff; font-weight: bold;">syntax-rule:</span>add
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org6801312" class="outline-3">
<h3 id="org6801312"><span class="done test">test</span> </h3>
<div class="outline-text-3" id="text-org6801312">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #FF8888;">&lt;&lt; in system shell</span>
<span style="color: #FF8888;">cn moi add hi module/hi.cn</span>
<span style="color: #FF8888;">cn moi add hihi module/hihi.cn</span>
<span style="color: #FF8888;">&gt;&gt;</span>

<span style="color: #e6db74;">"hihi"</span> <span style="color: #a6e22e; font-weight: bold;">import</span>

hihi <span style="color: #FF8888;">&lt;&lt; undefined &gt;&gt;</span>

<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #fd971f; font-weight: bold;">*test-module-info*</span>
  <span style="color: #f92672; font-weight: bold;">name</span> hihi <span style="color: #ffffff; font-weight: bold;">module-stack:</span>find <span style="color: #f92672; font-weight: bold;">if</span>
  <span style="color: #f92672; font-weight: bold;">else</span>
    <span style="color: #e6db74;">"* can not found hihi"</span> .s .l
  <span style="color: #f92672; font-weight: bold;">then</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #a1ab3a; font-weight: bold;">define-variable</span>

<span style="color: #fd971f; font-weight: bold;">*test-module-info*</span> <span style="color: #ffffff; font-weight: bold;">module-info:</span>get-meta-string .s .l
<span style="color: #fd971f; font-weight: bold;">*test-module-info*</span> <span style="color: #ffffff; font-weight: bold;">module-info:</span>get-name name<span style="color: #b0b1a3;">-&gt;</span>string .s .l

hihi <span style="color: #FF8888;">&lt;&lt; undefined &gt;&gt;</span>

<span style="color: #fd971f; font-weight: bold;">*test-module-info*</span> <span style="color: #ffffff; font-weight: bold;">module-info:</span>get-name-record-begin
<span style="color: #fd971f; font-weight: bold;">*test-module-info*</span> <span style="color: #ffffff; font-weight: bold;">module-info:</span>get-name-record-end
<span style="color: #ffffff; font-weight: bold;">module-naming-stack:</span>expose-naming

hihi
</pre>
</div>
</div>
</div>

<div id="outline-container-orgea6f7d0" class="outline-3">
<h3 id="orgea6f7d0">load</h3>
<div class="outline-text-3" id="text-orgea6f7d0">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">load</span>
  <span style="color: #FF8888;">&lt;&lt; module-name-string[address, length] -- &gt;&gt;</span>
  <span style="color: #dc322f; font-weight: bold;">&gt;::module-name-string</span>

  <span style="color: #5CDD5C; font-weight: bold;">::module-name-string</span>
  <span style="color: #ffffff; font-weight: bold;">undo-point:</span>create
  <span style="color: #fd971f; font-weight: bold;">reading-stack:*pointer*</span>
  <span style="color: #FF8888;">&lt;&lt; module-name-string[address, length],</span>
<span style="color: #FF8888;">     undo-point</span>
<span style="color: #FF8888;">     reading-stack:*pointer*</span>
<span style="color: #FF8888;">     -- &gt;&gt;</span>

  <span style="color: #93a8c6;">[</span> action,reset-the-stack
    <span style="color: #FF8888;">&lt;&lt; module-name-string[address, length],</span>
<span style="color: #FF8888;">       undo-point</span>
<span style="color: #FF8888;">       reading-stack:*pointer*</span>
<span style="color: #FF8888;">       -- &gt;&gt;</span>
    <span style="color: #f92672; font-weight: bold;">address</span> <span style="color: #fd971f; font-weight: bold;">reading-stack:*pointer*</span> set
    undo
    <span style="color: #e6db74;">"* (load) can not load : "</span> .s .s .l
    <span style="color: #00ffff; font-weight: bold;">end</span> <span style="color: #93a8c6;">]</span>
  <span style="color: #fd971f; font-weight: bold;">'fail-to-load</span> <span style="color: #1ef15f; font-weight: bold;">await</span>

  <span style="color: #5CDD5C; font-weight: bold;">::module-name-string</span> string<span style="color: #b0b1a3;">-&gt;</span>name <span style="color: #FF4C4C; font-weight: bold;">&gt;:module-name-index</span>
  <span style="color: #83EA83; font-weight: bold;">:module-name-index</span> name<span style="color: #b0b1a3;">-&gt;</span>module-prefix <span style="color: #FF4C4C; font-weight: bold;">&gt;:module-prefix</span>

  <span style="color: #83EA83; font-weight: bold;">:module-name-index</span> <span style="color: #ffffff; font-weight: bold;">module-stack:</span>find <span style="color: #f92672; font-weight: bold;">if</span>
    drop
    <span style="color: #e6db74;">"* (load) the following module is already loaded : "</span> .s <span style="color: #5CDD5C; font-weight: bold;">::module-name-string</span> .s .l
    <span style="color: #fd971f; font-weight: bold;">'fail-to-load</span> <span style="color: #00ffff; font-weight: bold;">awake</span>
  <span style="color: #f92672; font-weight: bold;">then</span>

  <span style="color: #83EA83; font-weight: bold;">:module-name-index</span> <span style="color: #ffffff; font-weight: bold;">importing-stack:</span>find <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #e6db74;">"* (load) circular import of : "</span> .s <span style="color: #5CDD5C; font-weight: bold;">::module-name-string</span> .s .l
    <span style="color: #fd971f; font-weight: bold;">'fail-to-load</span> <span style="color: #00ffff; font-weight: bold;">awake</span>
  <span style="color: #f92672; font-weight: bold;">then</span>

  <span style="color: #5CDD5C; font-weight: bold;">::module-name-string</span> <span style="color: #ffffff; font-weight: bold;">moi:</span>find not <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #e6db74;">"* (load) can not find module : "</span> .s <span style="color: #5CDD5C; font-weight: bold;">::module-name-string</span> .s .l
    <span style="color: #fd971f; font-weight: bold;">'fail-to-load</span> <span style="color: #00ffff; font-weight: bold;">awake</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #dc322f; font-weight: bold;">&gt;::module-path</span>

  <span style="color: #fd971f; font-weight: bold;">64</span> <span style="color: #fd971f; font-weight: bold;">1024</span> mul <span style="color: #AE7C3B; font-weight: bold;">allocate-local-memory</span> <span style="color: #FF4C4C; font-weight: bold;">&gt;:buffer</span>

  <span style="color: #83EA83; font-weight: bold;">:buffer</span>
  <span style="color: #fd971f; font-weight: bold;">64</span> <span style="color: #fd971f; font-weight: bold;">1024</span> mul
  <span style="color: #5CDD5C; font-weight: bold;">::module-path</span>
  <span style="color: #ffffff; font-weight: bold;">file:</span>read <span style="color: #FF4C4C; font-weight: bold;">&gt;:length</span>

  <span style="color: #83EA83; font-weight: bold;">:buffer</span> <span style="color: #83EA83; font-weight: bold;">:length</span> <span style="color: #ffffff; font-weight: bold;">module-buffer:</span>good-format? not <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #e6db74;">"* (load) fail to import module : "</span> .s <span style="color: #5CDD5C; font-weight: bold;">::module-name-string</span> .s .l
    <span style="color: #e6db74;">"  for the file is not well formated cicada-nymph source code"</span> .s .l
    <span style="color: #fd971f; font-weight: bold;">'fail-to-load</span> <span style="color: #00ffff; font-weight: bold;">awake</span>
  <span style="color: #f92672; font-weight: bold;">then</span>

  <span style="color: #83EA83; font-weight: bold;">:buffer</span> <span style="color: #83EA83; font-weight: bold;">:length</span> <span style="color: #ffffff; font-weight: bold;">module-buffer:</span>get-meta-string <span style="color: #dc322f; font-weight: bold;">&gt;::meta-string</span>
  <span style="color: #83EA83; font-weight: bold;">:buffer</span> <span style="color: #83EA83; font-weight: bold;">:length</span> <span style="color: #ffffff; font-weight: bold;">module-buffer:</span>get-code-string <span style="color: #dc322f; font-weight: bold;">&gt;::code-string</span>

  <span style="color: #fd971f; font-weight: bold;">false</span>
  <span style="color: #fd971f; font-weight: bold;">module-stack:*pointer*</span>
  <span style="color: #ffffff; font-weight: bold;">module-info:</span>set-tested-flag

  <span style="color: #fd971f; font-weight: bold;">false</span>
  <span style="color: #fd971f; font-weight: bold;">importing-stack:*pointer*</span>
  <span style="color: #ffffff; font-weight: bold;">importing-record:</span>set-testing-flag
  <span style="color: #83EA83; font-weight: bold;">:module-name-index</span>
  <span style="color: #fd971f; font-weight: bold;">importing-stack:*pointer*</span>
  <span style="color: #ffffff; font-weight: bold;">importing-record:</span>set-name
  <span style="color: #fd971f; font-weight: bold;">importing-stack:*unit*</span> <span style="color: #f92672; font-weight: bold;">address</span> <span style="color: #fd971f; font-weight: bold;">importing-stack:*pointer*</span> add-set

  <span style="color: #fd971f; font-weight: bold;">global-naming-stack:*pointer*</span> <span style="color: #FF4C4C; font-weight: bold;">&gt;:global-name-record-before-import</span>

  <span style="color: #fd971f; font-weight: bold;">pre-module:*syntax-rule-set*</span> push-syntax-stack
  <span style="color: #5CDD5C; font-weight: bold;">::meta-string</span> eval-string
  drop-syntax-stack

  <span style="color: #fd971f; font-weight: bold;">global-naming-stack:*pointer*</span> <span style="color: #FF4C4C; font-weight: bold;">&gt;:global-name-record-begin</span>
  <span style="color: #fd971f; font-weight: bold;">syntax-rule-set:*word-interpreter*</span> push-syntax-stack
  <span style="color: #5CDD5C; font-weight: bold;">::code-string</span> eval-string
  drop-syntax-stack
  <span style="color: #fd971f; font-weight: bold;">global-naming-stack:*pointer*</span> <span style="color: #FF4C4C; font-weight: bold;">&gt;:global-name-record-end</span>

  <span style="color: #fd971f; font-weight: bold;">syntax-rule-set:*post-module*</span> push-syntax-stack
  <span style="color: #5CDD5C; font-weight: bold;">::meta-string</span> eval-string
  drop-syntax-stack

  <span style="color: #ffffff; font-weight: bold;">importing-stack:</span>drop

  <span style="color: #fd971f; font-weight: bold;">module-naming-stack:*pointer*</span> <span style="color: #FF4C4C; font-weight: bold;">&gt;:module-name-record-begin</span>
  <span style="color: #83EA83; font-weight: bold;">:global-name-record-begin</span>
  <span style="color: #83EA83; font-weight: bold;">:global-name-record-end</span>
  <span style="color: #83EA83; font-weight: bold;">:module-prefix</span>
  <span style="color: #ffffff; font-weight: bold;">global-naming-stack:</span>prefix-naming
  <span style="color: #fd971f; font-weight: bold;">module-naming-stack:*pointer*</span> <span style="color: #FF4C4C; font-weight: bold;">&gt;:module-name-record-end</span>

  <span style="color: #83EA83; font-weight: bold;">:global-name-record-before-import</span>
  <span style="color: #fd971f; font-weight: bold;">global-naming-stack:*pointer*</span>
  <span style="color: #ffffff; font-weight: bold;">global-naming-stack:</span>clear-naming

  <span style="color: #83EA83; font-weight: bold;">:global-name-record-before-import</span> <span style="color: #f92672; font-weight: bold;">address</span> <span style="color: #fd971f; font-weight: bold;">global-naming-stack:*pointer*</span> set

  <span style="color: #83EA83; font-weight: bold;">:module-name-record-begin</span>
  <span style="color: #fd971f; font-weight: bold;">module-stack:*pointer*</span>
  <span style="color: #ffffff; font-weight: bold;">module-info:</span>set-name-record-begin
  <span style="color: #83EA83; font-weight: bold;">:module-name-record-end</span>
  <span style="color: #fd971f; font-weight: bold;">module-stack:*pointer*</span>
  <span style="color: #ffffff; font-weight: bold;">module-info:</span>set-name-record-end
  <span style="color: #5CDD5C; font-weight: bold;">::meta-string</span>
  <span style="color: #fd971f; font-weight: bold;">module-stack:*pointer*</span>
  <span style="color: #ffffff; font-weight: bold;">module-info:</span>set-meta-string
  <span style="color: #83EA83; font-weight: bold;">:module-name-index</span>
  <span style="color: #fd971f; font-weight: bold;">module-stack:*pointer*</span>
  <span style="color: #ffffff; font-weight: bold;">module-info:</span>set-name
  <span style="color: #fd971f; font-weight: bold;">module-stack:*unit*</span> <span style="color: #f92672; font-weight: bold;">address</span> <span style="color: #fd971f; font-weight: bold;">module-stack:*pointer*</span> add-set


  drop
  drop
  drop2
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org8033100" class="outline-3">
<h3 id="org8033100"><span class="done test">test</span> </h3>
<div class="outline-text-3" id="text-org8033100">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #FF8888;">&lt;&lt; in system shell</span>
<span style="color: #FF8888;">cn moi add hi module/hi.cn</span>
<span style="color: #FF8888;">cn moi add hihi module/hihi.cn</span>
<span style="color: #FF8888;">&gt;&gt;</span>

<span style="color: #e6db74;">"hihi"</span> <span style="color: #a6e22e; font-weight: bold;">load</span>

hihi <span style="color: #FF8888;">&lt;&lt; undefined &gt;&gt;</span>

<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #fd971f; font-weight: bold;">*test-module-info*</span>
  <span style="color: #f92672; font-weight: bold;">name</span> hihi <span style="color: #ffffff; font-weight: bold;">module-stack:</span>find <span style="color: #f92672; font-weight: bold;">if</span>
  <span style="color: #f92672; font-weight: bold;">else</span>
    <span style="color: #e6db74;">"* can not found hihi"</span> .s .l
  <span style="color: #f92672; font-weight: bold;">then</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #a1ab3a; font-weight: bold;">define-variable</span>

<span style="color: #fd971f; font-weight: bold;">*test-module-info*</span> <span style="color: #ffffff; font-weight: bold;">module-info:</span>get-meta-string .s .l
<span style="color: #fd971f; font-weight: bold;">*test-module-info*</span> <span style="color: #ffffff; font-weight: bold;">module-info:</span>get-name name<span style="color: #b0b1a3;">-&gt;</span>string .s .l

hihi <span style="color: #FF8888;">&lt;&lt; undefined &gt;&gt;</span>

<span style="color: #fd971f; font-weight: bold;">*test-module-info*</span> <span style="color: #ffffff; font-weight: bold;">module-info:</span>get-name-record-begin
<span style="color: #fd971f; font-weight: bold;">*test-module-info*</span> <span style="color: #ffffff; font-weight: bold;">module-info:</span>get-name-record-end
<span style="color: #ffffff; font-weight: bold;">module-naming-stack:</span>expose-naming

hihi


<span style="color: #ffffff; font-weight: bold;">report:</span>memory

<span style="color: #e6db74;">"no"</span> <span style="color: #a6e22e; font-weight: bold;">load</span>
<span style="color: #e6db74;">"hihi"</span> <span style="color: #a6e22e; font-weight: bold;">load</span>

<span style="color: #ffffff; font-weight: bold;">report:</span>memory
</pre>
</div>
</div>
</div>

<div id="outline-container-orgfb1d524" class="outline-3">
<h3 id="orgfb1d524">load-with-test</h3>
<div class="outline-text-3" id="text-orgfb1d524">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">load-with-test</span>
  <span style="color: #FF8888;">&lt;&lt; module-name-string[address, length] -- &gt;&gt;</span>
  <span style="color: #dc322f; font-weight: bold;">&gt;::module-name-string</span>

  <span style="color: #5CDD5C; font-weight: bold;">::module-name-string</span>
  <span style="color: #ffffff; font-weight: bold;">undo-point:</span>create
  <span style="color: #fd971f; font-weight: bold;">reading-stack:*pointer*</span>
  <span style="color: #FF8888;">&lt;&lt; module-name-string[address, length],</span>
<span style="color: #FF8888;">     undo-point</span>
<span style="color: #FF8888;">     reading-stack:*pointer*</span>
<span style="color: #FF8888;">     -- &gt;&gt;</span>

  <span style="color: #93a8c6;">[</span> action,reset-the-stack
    <span style="color: #FF8888;">&lt;&lt; module-name-string[address, length],</span>
<span style="color: #FF8888;">       undo-point</span>
<span style="color: #FF8888;">       reading-stack:*pointer*</span>
<span style="color: #FF8888;">       -- &gt;&gt;</span>
    <span style="color: #f92672; font-weight: bold;">address</span> <span style="color: #fd971f; font-weight: bold;">reading-stack:*pointer*</span> set
    undo
    <span style="color: #e6db74;">"* (load-with-test) can not load : "</span> .s .s .l
    <span style="color: #00ffff; font-weight: bold;">end</span> <span style="color: #93a8c6;">]</span>
  <span style="color: #fd971f; font-weight: bold;">'fail-to-load</span> <span style="color: #1ef15f; font-weight: bold;">await</span>

  <span style="color: #5CDD5C; font-weight: bold;">::module-name-string</span> string<span style="color: #b0b1a3;">-&gt;</span>name <span style="color: #FF4C4C; font-weight: bold;">&gt;:module-name-index</span>
  <span style="color: #83EA83; font-weight: bold;">:module-name-index</span> name<span style="color: #b0b1a3;">-&gt;</span>module-prefix <span style="color: #FF4C4C; font-weight: bold;">&gt;:module-prefix</span>

  <span style="color: #83EA83; font-weight: bold;">:module-name-index</span> <span style="color: #ffffff; font-weight: bold;">module-stack:</span>find <span style="color: #f92672; font-weight: bold;">if</span>
    drop
    <span style="color: #e6db74;">"* (load-with-test) the following module is already loaded : "</span> .s <span style="color: #5CDD5C; font-weight: bold;">::module-name-string</span> .s .l
    <span style="color: #fd971f; font-weight: bold;">'fail-to-load</span> <span style="color: #00ffff; font-weight: bold;">awake</span>
  <span style="color: #f92672; font-weight: bold;">then</span>

  <span style="color: #83EA83; font-weight: bold;">:module-name-index</span> <span style="color: #ffffff; font-weight: bold;">importing-stack:</span>find <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #e6db74;">"* (load-with-test) circular import of : "</span> .s <span style="color: #5CDD5C; font-weight: bold;">::module-name-string</span> .s .l
    <span style="color: #fd971f; font-weight: bold;">'fail-to-load</span> <span style="color: #00ffff; font-weight: bold;">awake</span>
  <span style="color: #f92672; font-weight: bold;">then</span>

  <span style="color: #5CDD5C; font-weight: bold;">::module-name-string</span> <span style="color: #ffffff; font-weight: bold;">moi:</span>find not <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #e6db74;">"* (load-with-test) can not find module : "</span> .s <span style="color: #5CDD5C; font-weight: bold;">::module-name-string</span> .s .l
    <span style="color: #fd971f; font-weight: bold;">'fail-to-load</span> <span style="color: #00ffff; font-weight: bold;">awake</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #dc322f; font-weight: bold;">&gt;::module-path</span>

  <span style="color: #fd971f; font-weight: bold;">64</span> <span style="color: #fd971f; font-weight: bold;">1024</span> mul <span style="color: #AE7C3B; font-weight: bold;">allocate-local-memory</span> <span style="color: #FF4C4C; font-weight: bold;">&gt;:buffer</span>

  <span style="color: #83EA83; font-weight: bold;">:buffer</span>
  <span style="color: #fd971f; font-weight: bold;">64</span> <span style="color: #fd971f; font-weight: bold;">1024</span> mul
  <span style="color: #5CDD5C; font-weight: bold;">::module-path</span>
  <span style="color: #ffffff; font-weight: bold;">file:</span>read <span style="color: #FF4C4C; font-weight: bold;">&gt;:length</span>

  <span style="color: #83EA83; font-weight: bold;">:buffer</span> <span style="color: #83EA83; font-weight: bold;">:length</span> <span style="color: #ffffff; font-weight: bold;">module-buffer:</span>good-format? not <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #e6db74;">"* (load-with-test) fail to import module : "</span> .s <span style="color: #5CDD5C; font-weight: bold;">::module-name-string</span> .s .l
    <span style="color: #e6db74;">"  for the file is not well formated cicada-nymph source code"</span> .s .l
    <span style="color: #fd971f; font-weight: bold;">'fail-to-load</span> <span style="color: #00ffff; font-weight: bold;">awake</span>
  <span style="color: #f92672; font-weight: bold;">then</span>

  <span style="color: #83EA83; font-weight: bold;">:buffer</span> <span style="color: #83EA83; font-weight: bold;">:length</span> <span style="color: #ffffff; font-weight: bold;">module-buffer:</span>get-meta-string <span style="color: #dc322f; font-weight: bold;">&gt;::meta-string</span>
  <span style="color: #83EA83; font-weight: bold;">:buffer</span> <span style="color: #83EA83; font-weight: bold;">:length</span> <span style="color: #ffffff; font-weight: bold;">module-buffer:</span>get-code-string <span style="color: #dc322f; font-weight: bold;">&gt;::code-string</span>

  <span style="color: #fd971f; font-weight: bold;">true</span>
  <span style="color: #fd971f; font-weight: bold;">module-stack:*pointer*</span>
  <span style="color: #ffffff; font-weight: bold;">module-info:</span>set-tested-flag
  <span style="color: #fd971f; font-weight: bold;">0</span>
  <span style="color: #fd971f; font-weight: bold;">module-stack:*pointer*</span>
  <span style="color: #ffffff; font-weight: bold;">module-info:</span>set-success-counter
  <span style="color: #fd971f; font-weight: bold;">0</span>
  <span style="color: #fd971f; font-weight: bold;">module-stack:*pointer*</span>
  <span style="color: #ffffff; font-weight: bold;">module-info:</span>set-fail-counter

  <span style="color: #fd971f; font-weight: bold;">true</span>
  <span style="color: #fd971f; font-weight: bold;">importing-stack:*pointer*</span>
  <span style="color: #ffffff; font-weight: bold;">importing-record:</span>set-testing-flag
  <span style="color: #83EA83; font-weight: bold;">:module-name-index</span>
  <span style="color: #fd971f; font-weight: bold;">importing-stack:*pointer*</span>
  <span style="color: #ffffff; font-weight: bold;">importing-record:</span>set-name
  <span style="color: #fd971f; font-weight: bold;">importing-stack:*unit*</span> <span style="color: #f92672; font-weight: bold;">address</span> <span style="color: #fd971f; font-weight: bold;">importing-stack:*pointer*</span> add-set

  <span style="color: #fd971f; font-weight: bold;">global-naming-stack:*pointer*</span> <span style="color: #FF4C4C; font-weight: bold;">&gt;:global-name-record-before-import</span>

  <span style="color: #fd971f; font-weight: bold;">pre-module:*syntax-rule-set*</span> push-syntax-stack
  <span style="color: #5CDD5C; font-weight: bold;">::meta-string</span> eval-string
  drop-syntax-stack

  <span style="color: #fd971f; font-weight: bold;">global-naming-stack:*pointer*</span> <span style="color: #FF4C4C; font-weight: bold;">&gt;:global-name-record-begin</span>
  <span style="color: #fd971f; font-weight: bold;">syntax-rule-set:*word-interpreter*</span> push-syntax-stack
  <span style="color: #5CDD5C; font-weight: bold;">::code-string</span> eval-string
  drop-syntax-stack
  <span style="color: #fd971f; font-weight: bold;">global-naming-stack:*pointer*</span> <span style="color: #FF4C4C; font-weight: bold;">&gt;:global-name-record-end</span>

  <span style="color: #fd971f; font-weight: bold;">syntax-rule-set:*post-module*</span> push-syntax-stack
  <span style="color: #5CDD5C; font-weight: bold;">::meta-string</span> eval-string
  drop-syntax-stack

  <span style="color: #ffffff; font-weight: bold;">importing-stack:</span>drop

  <span style="color: #fd971f; font-weight: bold;">module-naming-stack:*pointer*</span> <span style="color: #FF4C4C; font-weight: bold;">&gt;:module-name-record-begin</span>
  <span style="color: #83EA83; font-weight: bold;">:global-name-record-begin</span>
  <span style="color: #83EA83; font-weight: bold;">:global-name-record-end</span>
  <span style="color: #83EA83; font-weight: bold;">:module-prefix</span>
  <span style="color: #ffffff; font-weight: bold;">global-naming-stack:</span>prefix-naming
  <span style="color: #fd971f; font-weight: bold;">module-naming-stack:*pointer*</span> <span style="color: #FF4C4C; font-weight: bold;">&gt;:module-name-record-end</span>

  <span style="color: #83EA83; font-weight: bold;">:global-name-record-before-import</span>
  <span style="color: #fd971f; font-weight: bold;">global-naming-stack:*pointer*</span>
  <span style="color: #ffffff; font-weight: bold;">global-naming-stack:</span>clear-naming

  <span style="color: #83EA83; font-weight: bold;">:global-name-record-before-import</span> <span style="color: #f92672; font-weight: bold;">address</span> <span style="color: #fd971f; font-weight: bold;">global-naming-stack:*pointer*</span> set

  <span style="color: #83EA83; font-weight: bold;">:module-name-record-begin</span>
  <span style="color: #fd971f; font-weight: bold;">module-stack:*pointer*</span>
  <span style="color: #ffffff; font-weight: bold;">module-info:</span>set-name-record-begin
  <span style="color: #83EA83; font-weight: bold;">:module-name-record-end</span>
  <span style="color: #fd971f; font-weight: bold;">module-stack:*pointer*</span>
  <span style="color: #ffffff; font-weight: bold;">module-info:</span>set-name-record-end
  <span style="color: #5CDD5C; font-weight: bold;">::meta-string</span>
  <span style="color: #fd971f; font-weight: bold;">module-stack:*pointer*</span>
  <span style="color: #ffffff; font-weight: bold;">module-info:</span>set-meta-string
  <span style="color: #83EA83; font-weight: bold;">:module-name-index</span>
  <span style="color: #fd971f; font-weight: bold;">module-stack:*pointer*</span>
  <span style="color: #ffffff; font-weight: bold;">module-info:</span>set-name

  <span style="color: #e6db74;">"* (load-with-test) load : "</span> .s <span style="color: #5CDD5C; font-weight: bold;">::module-name-string</span> .s .l
  <span style="color: #e6db74;">"  success : "</span> .s
  <span style="color: #fd971f; font-weight: bold;">module-stack:*pointer*</span> <span style="color: #ffffff; font-weight: bold;">module-info:</span>get-success-counter
  .i .l
  <span style="color: #e6db74;">"  fali : "</span> .s
  <span style="color: #fd971f; font-weight: bold;">module-stack:*pointer*</span> <span style="color: #ffffff; font-weight: bold;">module-info:</span>get-fail-counter
  .i .l

  <span style="color: #fd971f; font-weight: bold;">module-stack:*unit*</span> <span style="color: #f92672; font-weight: bold;">address</span> <span style="color: #fd971f; font-weight: bold;">module-stack:*pointer*</span> add-set


  drop
  drop
  drop2
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org52ac418" class="outline-3">
<h3 id="org52ac418"><span class="done test">test</span> -function</h3>
<div class="outline-text-3" id="text-org52ac418">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">test-function</span>
  <span style="color: #FF8888;">&lt;&lt; string[address, length] -- &gt;&gt;</span>
  <span style="color: #fd971f; font-weight: bold;">importing-stack:*pointer*</span>
  <span style="color: #fd971f; font-weight: bold;">importing-stack:*unit*</span> sub
  <span style="color: #ffffff; font-weight: bold;">importing-record:</span>get-testing-flag <span style="color: #f92672; font-weight: bold;">if</span>
    define-function
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  drop2
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org51457d0" class="outline-3">
<h3 id="org51457d0"><span class="done test">test</span> -variable</h3>
<div class="outline-text-3" id="text-org51457d0">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">test-variable</span>
  <span style="color: #FF8888;">&lt;&lt; string[address, length] -- &gt;&gt;</span>
  <span style="color: #fd971f; font-weight: bold;">importing-stack:*pointer*</span>
  <span style="color: #fd971f; font-weight: bold;">importing-stack:*unit*</span> sub
  <span style="color: #ffffff; font-weight: bold;">importing-record:</span>get-testing-flag <span style="color: #f92672; font-weight: bold;">if</span>
    define-variable
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  drop2
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org22e70e6" class="outline-3">
<h3 id="org22e70e6"><span class="done test">test</span> -variable,with-tos</h3>
<div class="outline-text-3" id="text-org22e70e6">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">test-variable,with-tos</span>
  <span style="color: #FF8888;">&lt;&lt; string[address, length] -- &gt;&gt;</span>
  <span style="color: #fd971f; font-weight: bold;">importing-stack:*pointer*</span>
  <span style="color: #fd971f; font-weight: bold;">importing-stack:*unit*</span> sub
  <span style="color: #ffffff; font-weight: bold;">importing-record:</span>get-testing-flag <span style="color: #f92672; font-weight: bold;">if</span>
    define-variable,with-tos
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  drop2
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf1886bf" class="outline-3">
<h3 id="orgf1886bf"><span class="done test">test</span> -do</h3>
<div class="outline-text-3" id="text-orgf1886bf">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">test-do</span>
  <span style="color: #FF8888;">&lt;&lt; string[address, length] -- &gt;&gt;</span>
  <span style="color: #fd971f; font-weight: bold;">importing-stack:*pointer*</span>
  <span style="color: #fd971f; font-weight: bold;">importing-stack:*unit*</span> sub
  <span style="color: #ffffff; font-weight: bold;">importing-record:</span>get-testing-flag <span style="color: #f92672; font-weight: bold;">if</span>
    eval-string
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  drop2
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgefe96d4" class="outline-3">
<h3 id="orgefe96d4">the function test</h3>
<div class="outline-text-3" id="text-orgefe96d4">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">test</span>
  <span style="color: #FF8888;">&lt;&lt; bool -- &gt;&gt;</span>
  <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #e6db74;">"  (success)"</span> .s .l
    <span style="color: #fd971f; font-weight: bold;">module-stack:*pointer*</span> <span style="color: #ffffff; font-weight: bold;">module-info:</span>inc-success-counter
  <span style="color: #f92672; font-weight: bold;">else</span>
    <span style="color: #e6db74;">"  (fail)"</span> .s .l
    <span style="color: #fd971f; font-weight: bold;">module-stack:*pointer*</span> <span style="color: #ffffff; font-weight: bold;">module-info:</span>inc-fail-counter
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org34d2ec3" class="outline-3">
<h3 id="org34d2ec3"><span class="done test">test</span> </h3>
<div class="outline-text-3" id="text-org34d2ec3">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #FF8888;">&lt;&lt; in system shell</span>
<span style="color: #FF8888;">cn moi add hi module/hi.cn</span>
<span style="color: #FF8888;">cn moi add hihi module/hihi.cn</span>
<span style="color: #FF8888;">&gt;&gt;</span>

<span style="color: #e6db74;">"hihi"</span> <span style="color: #a6e22e; font-weight: bold;">load-with-test</span>

hihi <span style="color: #FF8888;">&lt;&lt; undefined &gt;&gt;</span>

<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #fd971f; font-weight: bold;">*test-module-info*</span>
  <span style="color: #f92672; font-weight: bold;">name</span> hihi <span style="color: #ffffff; font-weight: bold;">module-stack:</span>find <span style="color: #f92672; font-weight: bold;">if</span>
  <span style="color: #f92672; font-weight: bold;">else</span>
    <span style="color: #e6db74;">"* can not found hihi"</span> .s .l
  <span style="color: #f92672; font-weight: bold;">then</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #a1ab3a; font-weight: bold;">define-variable</span>

<span style="color: #fd971f; font-weight: bold;">*test-module-info*</span> <span style="color: #ffffff; font-weight: bold;">module-info:</span>get-meta-string .s .l
<span style="color: #fd971f; font-weight: bold;">*test-module-info*</span> <span style="color: #ffffff; font-weight: bold;">module-info:</span>get-name name<span style="color: #b0b1a3;">-&gt;</span>string .s .l

hihi <span style="color: #FF8888;">&lt;&lt; undefined &gt;&gt;</span>

<span style="color: #fd971f; font-weight: bold;">*test-module-info*</span> <span style="color: #ffffff; font-weight: bold;">module-info:</span>get-name-record-begin
<span style="color: #fd971f; font-weight: bold;">*test-module-info*</span> <span style="color: #ffffff; font-weight: bold;">module-info:</span>get-name-record-end
<span style="color: #ffffff; font-weight: bold;">module-naming-stack:</span>expose-naming

hihi


<span style="color: #ffffff; font-weight: bold;">report:</span>memory

<span style="color: #e6db74;">"no"</span> <span style="color: #a6e22e; font-weight: bold;">load-with-test</span>
<span style="color: #e6db74;">"hihi"</span> <span style="color: #a6e22e; font-weight: bold;">load-with-test</span>

<span style="color: #ffffff; font-weight: bold;">report:</span>memory
</pre>
</div>
</div>
</div>

<div id="outline-container-orgde6f122" class="outline-3">
<h3 id="orgde6f122"><span class="done test">test</span> with gamber</h3>
<div class="outline-text-3" id="text-orgde6f122">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #e6db74;">"gamber"</span> <span style="color: #a6e22e; font-weight: bold;">load-with-test</span>
</pre>
</div>
</div>
</div>
</div>


<div id="outline-container-orga38a681" class="outline-2">
<h2 id="orga38a681">type</h2>
</div>


<div id="outline-container-orgbf0f042" class="outline-2">
<h2 id="orgbf0f042">report</h2>
<div class="outline-text-2" id="text-orgbf0f042">
</div><div id="outline-container-org9fbff4e" class="outline-3">
<h3 id="org9fbff4e">report:memory</h3>
<div class="outline-text-3" id="text-org9fbff4e">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">report:memory</span>
  <span style="color: #FF8888;">&lt;&lt; -- &gt;&gt;</span>
  <span style="color: #e6db74;">"* *un-initialized-memory*"</span> .s .l
  <span style="color: #e6db74;">"  * size : "</span> .s
       <span style="color: #fd971f; font-weight: bold;">*un-initialized-memory,size*</span>
       . .l
  <span style="color: #e6db74;">"  * used : "</span> .s
       <span style="color: #fd971f; font-weight: bold;">*un-initialized-memory,current-free-address*</span>
       <span style="color: #fd971f; font-weight: bold;">*un-initialized-memory*</span>
       sub . .l
  <span style="color: #e6db74;">"  * free : "</span> .s
       <span style="color: #fd971f; font-weight: bold;">*un-initialized-memory,size*</span>
       <span style="color: #fd971f; font-weight: bold;">*un-initialized-memory,current-free-address*</span>
       <span style="color: #fd971f; font-weight: bold;">*un-initialized-memory*</span>
       sub sub . .l
  <span style="color: #e6db74;">"* *string-area*"</span> .s .l
  <span style="color: #e6db74;">"  * size : "</span> .s
       <span style="color: #fd971f; font-weight: bold;">*string-area,size*</span>
       . .l
  <span style="color: #e6db74;">"  * used : "</span> .s
       <span style="color: #fd971f; font-weight: bold;">*string-area,current-free-address*</span>
       <span style="color: #fd971f; font-weight: bold;">*string-area*</span>
       sub . .l
  <span style="color: #e6db74;">"  * free : "</span> .s
       <span style="color: #fd971f; font-weight: bold;">*string-area,size*</span>
       <span style="color: #fd971f; font-weight: bold;">*string-area,current-free-address*</span>
       <span style="color: #fd971f; font-weight: bold;">*string-area*</span>
       sub sub . .l
  <span style="color: #e6db74;">"* *jojo-area*"</span> .s .l
  <span style="color: #e6db74;">"  * size : "</span> .s
       <span style="color: #fd971f; font-weight: bold;">*jojo-area,size*</span> . .l
  <span style="color: #e6db74;">"  * used : "</span> .s
       <span style="color: #fd971f; font-weight: bold;">*jojo-area,current-free-address*</span>
       <span style="color: #fd971f; font-weight: bold;">*jojo-area*</span>
       sub . .l
  <span style="color: #e6db74;">"  * free : "</span> .s
       <span style="color: #fd971f; font-weight: bold;">*jojo-area,size*</span>
       <span style="color: #fd971f; font-weight: bold;">*jojo-area,current-free-address*</span>
       <span style="color: #fd971f; font-weight: bold;">*jojo-area*</span>
       sub sub . .l
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org73e7c4d" class="outline-3">
<h3 id="org73e7c4d">report:syntax</h3>
<div class="outline-text-3" id="text-org73e7c4d">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">report:syntax</span>
  <span style="color: #FF8888;">&lt;&lt; -- &gt;&gt;</span>
  <span style="color: #e6db74;">"* jojo-compiler:*syntax-rule-set* :"</span> .s .l
     <span style="color: #fd971f; font-weight: bold;">jojo-compiler:*syntax-rule-set*</span> <span style="color: #ffffff; font-weight: bold;">syntax-rule-set:</span>list
  <span style="color: #e6db74;">"* syntax-rule-set:*word-interpreter* :"</span> .s .l
     <span style="color: #fd971f; font-weight: bold;">syntax-rule-set:*word-interpreter*</span> <span style="color: #ffffff; font-weight: bold;">syntax-rule-set:</span>list
  <span style="color: #e6db74;">"* tos-syntax-stack :"</span> .s .l
     tos-syntax-stack <span style="color: #ffffff; font-weight: bold;">syntax-rule-set:</span>list
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org43799f9" class="outline-3">
<h3 id="org43799f9">global-naming-stack:list-by-jo-predicate</h3>
<div class="outline-text-3" id="text-org43799f9">
<ul class="org-ul">
<li><p>最後寫到珠典裏的 被最先打印出來</p></li></ul>
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">global-naming-stack:list-by-jo-predicate,loop</span>
  <span style="color: #FF8888;">&lt;&lt; jo-predicate, counter, cursor -- &gt;&gt;</span>
  dup <span style="color: #fd971f; font-weight: bold;">global-naming-stack:*pointer*</span> <span style="color: #ffffff; font-weight: bold;">equal?</span> <span style="color: #f92672; font-weight: bold;">if</span>
    drop
    drop
    drop
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #FF4C4C; font-weight: bold;">&gt;:cursor</span>
  <span style="color: #FF4C4C; font-weight: bold;">&gt;:counter</span>
  <span style="color: #FF4C4C; font-weight: bold;">&gt;:jo-predicate</span>
  <span style="color: #83EA83; font-weight: bold;">:cursor</span> <span style="color: #ffffff; font-weight: bold;">name-record:</span>get-new-jo
  <span style="color: #83EA83; font-weight: bold;">:jo-predicate</span> apply <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #e6db74;">"  "</span> .s
    <span style="color: #83EA83; font-weight: bold;">:counter</span> .i <span style="color: #e6db74;">". "</span> .s <span style="color: #83EA83; font-weight: bold;">:counter</span> add1 <span style="color: #FF4C4C; font-weight: bold;">&gt;:counter</span>
    <span style="color: #83EA83; font-weight: bold;">:cursor</span> <span style="color: #ffffff; font-weight: bold;">name-record:</span>get-name name<span style="color: #b0b1a3;">-&gt;</span>string .s
    .l
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #83EA83; font-weight: bold;">:jo-predicate</span>
  <span style="color: #83EA83; font-weight: bold;">:counter</span>
  <span style="color: #83EA83; font-weight: bold;">:cursor</span> <span style="color: #fd971f; font-weight: bold;">global-naming-stack:*unit*</span> add
  <span style="color: #00ffff; font-weight: bold;">loop</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>

<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">global-naming-stack:list-by-jo-predicate</span>
  <span style="color: #FF8888;">&lt;&lt; jo-predicate -- &gt;&gt;</span>
  <span style="color: #fd971f; font-weight: bold;">1</span>
  <span style="color: #fd971f; font-weight: bold;">*global-naming-stack*</span>
  <span style="color: #ffffff; font-weight: bold;">global-naming-stack:</span>list-by-jo-predicate,loop
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org994075d" class="outline-3">
<h3 id="org994075d">report:global-naming-stack</h3>
<div class="outline-text-3" id="text-org994075d">
<ul class="org-ul">
<li><p>different types of words in link</p><p>are showed separately</p></li></ul>
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">report:global-naming-stack</span>
  <span style="color: #FF8888;">&lt;&lt; -- &gt;&gt;</span>
  <span style="color: #e6db74;">"* all primitive-function in global-naming-stack :"</span> .s .l
  <span style="color: #f92672; font-weight: bold;">jo</span> <span style="color: #ffffff; font-weight: bold;">primitive-function-jo?</span>
  <span style="color: #ffffff; font-weight: bold;">global-naming-stack:</span>list-by-jo-predicate

  <span style="color: #e6db74;">"* all function in global-naming-stack :"</span> .s .l
  <span style="color: #f92672; font-weight: bold;">jo</span> <span style="color: #ffffff; font-weight: bold;">function-jo?</span>
  <span style="color: #ffffff; font-weight: bold;">global-naming-stack:</span>list-by-jo-predicate

  <span style="color: #e6db74;">"* all variable in global-naming-stack :"</span> .s .l
  <span style="color: #f92672; font-weight: bold;">jo</span> <span style="color: #ffffff; font-weight: bold;">variable-jo?</span>
  <span style="color: #ffffff; font-weight: bold;">global-naming-stack:</span>list-by-jo-predicate
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org961b5fb" class="outline-3">
<h3 id="org961b5fb">report:system</h3>
<div class="outline-text-3" id="text-org961b5fb">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">report:system</span>
  <span style="color: #FF8888;">&lt;&lt; -- &gt;&gt;</span>
  <span style="color: #e6db74;">"* (system) "</span> .s
  <span style="color: #fd971f; font-weight: bold;">*cell-size*</span> <span style="color: #fd971f; font-weight: bold;">8</span> mul .i <span style="color: #e6db74;">"bit"</span> .s
  <span style="color: #e6db74;">" "</span> .s
  platform .s
  .l
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org73632e5" class="outline-2">
<h2 id="org73632e5">hi</h2>
<div class="outline-text-2" id="text-org73632e5">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #fd971f; font-weight: bold;">0</span>
<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #fd971f; font-weight: bold;">*hi,random-base*</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #a1ab3a; font-weight: bold;">define-variable,with-tos</span>

<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">hi,random</span>
  <span style="color: #FF8888;">&lt;&lt; -- random-number &gt;&gt;</span>
  <span style="color: #fd971f; font-weight: bold;">0</span> <span style="color: #fd971f; font-weight: bold;">syscall-number:*times*</span>
  <span style="color: #fd971f; font-weight: bold;">1</span> syscall
  <span style="color: #fd971f; font-weight: bold;">13</span> mod
  <span style="color: #FF8888;">&lt;&lt;</span>
<span style="color: #FF8888;">   *hi,random-base*</span>
<span style="color: #FF8888;">   *hi,random-base* add1 13 mod</span>
<span style="color: #FF8888;">   address *hi,random-base* set</span>
<span style="color: #FF8888;">  &gt;&gt;</span>
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>

<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">hi,say</span>
  <span style="color: #FF8888;">&lt;&lt; number -- &gt;&gt;</span>
  dup <span style="color: #fd971f; font-weight: bold;">0</span> <span style="color: #ffffff; font-weight: bold;">equal?</span> <span style="color: #f92672; font-weight: bold;">if</span> drop <span style="color: #e6db74;">"cica cica da yaya !!!"</span> .s .l <span style="color: #00ffff; font-weight: bold;">end</span> <span style="color: #f92672; font-weight: bold;">then</span>
  dup <span style="color: #fd971f; font-weight: bold;">1</span> <span style="color: #ffffff; font-weight: bold;">equal?</span> <span style="color: #f92672; font-weight: bold;">if</span> drop <span style="color: #e6db74;">"hi ^-^"</span> .s .l <span style="color: #00ffff; font-weight: bold;">end</span> <span style="color: #f92672; font-weight: bold;">then</span>
  dup <span style="color: #fd971f; font-weight: bold;">2</span> <span style="color: #ffffff; font-weight: bold;">equal?</span> <span style="color: #f92672; font-weight: bold;">if</span> drop <span style="color: #e6db74;">"hello :)"</span> .s .l <span style="color: #00ffff; font-weight: bold;">end</span> <span style="color: #f92672; font-weight: bold;">then</span>
  dup <span style="color: #fd971f; font-weight: bold;">3</span> <span style="color: #ffffff; font-weight: bold;">equal?</span> <span style="color: #f92672; font-weight: bold;">if</span> drop <span style="color: #e6db74;">"hey *^-^*"</span> .s .l <span style="color: #00ffff; font-weight: bold;">end</span> <span style="color: #f92672; font-weight: bold;">then</span>
  dup <span style="color: #fd971f; font-weight: bold;">4</span> <span style="color: #ffffff; font-weight: bold;">equal?</span> <span style="color: #f92672; font-weight: bold;">if</span> drop <span style="color: #e6db74;">"hiya \^o^/"</span> .s .l <span style="color: #00ffff; font-weight: bold;">end</span> <span style="color: #f92672; font-weight: bold;">then</span>
  dup <span style="color: #fd971f; font-weight: bold;">5</span> <span style="color: #ffffff; font-weight: bold;">equal?</span> <span style="color: #f92672; font-weight: bold;">if</span> drop <span style="color: #e6db74;">"I wish you a lovely day"</span> .s .l <span style="color: #00ffff; font-weight: bold;">end</span> <span style="color: #f92672; font-weight: bold;">then</span>
  dup <span style="color: #fd971f; font-weight: bold;">6</span> <span style="color: #ffffff; font-weight: bold;">equal?</span> <span style="color: #f92672; font-weight: bold;">if</span> drop <span style="color: #e6db74;">"I wish you a lovely day { or night :P }"</span> .s .l <span style="color: #00ffff; font-weight: bold;">end</span> <span style="color: #f92672; font-weight: bold;">then</span>
  dup <span style="color: #fd971f; font-weight: bold;">7</span> <span style="color: #ffffff; font-weight: bold;">equal?</span> <span style="color: #f92672; font-weight: bold;">if</span> drop <span style="color: #e6db74;">"o.o"</span> .s .l <span style="color: #00ffff; font-weight: bold;">end</span> <span style="color: #f92672; font-weight: bold;">then</span>
  dup <span style="color: #fd971f; font-weight: bold;">8</span> <span style="color: #ffffff; font-weight: bold;">equal?</span> <span style="color: #f92672; font-weight: bold;">if</span> drop <span style="color: #e6db74;">"O.o"</span> .s .l <span style="color: #00ffff; font-weight: bold;">end</span> <span style="color: #f92672; font-weight: bold;">then</span>
  dup <span style="color: #fd971f; font-weight: bold;">9</span> <span style="color: #ffffff; font-weight: bold;">equal?</span> <span style="color: #f92672; font-weight: bold;">if</span> drop <span style="color: #e6db74;">"o.O"</span> .s .l <span style="color: #00ffff; font-weight: bold;">end</span> <span style="color: #f92672; font-weight: bold;">then</span>
                  drop <span style="color: #e6db74;">"lovely ^3^"</span> .s .l <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>

<span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">hi</span>
  <span style="color: #FF8888;">&lt;&lt; -- &gt;&gt;</span>
  hi,random
  hi,say
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org37c1f6b" class="outline-2">
<h2 id="org37c1f6b">help</h2>
<div class="outline-text-2" id="text-org37c1f6b">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">help</span>
  <span style="color: #FF8888;">&lt;&lt; -- &gt;&gt;</span>
  <span style="color: #e6db74;">"* helpful documentations will be written soon"</span> .s .l
  <span style="color: #e6db74;">"  please wait ^-^"</span> .s .l
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org6367c68" class="outline-2">
<h2 id="org6367c68">command line interface</h2>
<div class="outline-text-2" id="text-org6367c68">
</div><div id="outline-container-org12a881e" class="outline-3">
<h3 id="org12a881e">command-function:unknow-function</h3>
<div class="outline-text-3" id="text-org12a881e">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">command-function:unknow-function</span>
  <span style="color: #FF8888;">&lt;&lt; -- &gt;&gt;</span>
  <span style="color: #e6db74;">"* (cicada-nymph) unknow command-line-function : "</span> .s
  get-command-line
  <span style="color: #ffffff; font-weight: bold;">string:</span>word-tail
  <span style="color: #ffffff; font-weight: bold;">string:</span>word .s .l
  <span style="color: #e6db74;">"  good bye ^-^/"</span> .s .l
  <span style="color: #00ffff; font-weight: bold;">bye</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org6ce1b74" class="outline-3">
<h3 id="org6ce1b74">command-function:stack-REPL</h3>
<div class="outline-text-3" id="text-org6ce1b74">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">command-function:stack-REPL</span>
  <span style="color: #FF8888;">&lt;&lt; -- &gt;&gt;</span>
  .l
  <span style="color: #e6db74;">"* (cicada-nymph) "</span> .s hi
  <span style="color: #ffffff; font-weight: bold;">report:</span>system
  <span style="color: #e6db74;">"* (stack-REPL) is where you are now"</span> .s .l
  <span style="color: #e6db74;">"  eval a word print the stack"</span> .s .l
  <span style="color: #ffffff; font-weight: bold;">argument-stack:</span>pretty-print
  <span style="color: #f92672; font-weight: bold;">jo</span> stack-REPL
  <span style="color: #00ffff; font-weight: bold;">reset-top-level-REPL</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc81726d" class="outline-3">
<h3 id="orgc81726d">command-function:basic-REPL</h3>
<div class="outline-text-3" id="text-orgc81726d">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">command-function:basic-REPL</span>
  <span style="color: #FF8888;">&lt;&lt; -- &gt;&gt;</span>
  .l
  <span style="color: #e6db74;">"* (cicada-nymph) "</span> .s hi
  <span style="color: #ffffff; font-weight: bold;">report:</span>system
  <span style="color: #e6db74;">"* (basic-REPL) is where you are now"</span> .s .l
  <span style="color: #e6db74;">"  this REPL does not print any thing automaticly"</span> .s .l
  <span style="color: #f92672; font-weight: bold;">jo</span> basic-REPL
  <span style="color: #00ffff; font-weight: bold;">reset-top-level-REPL</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org2a63621" class="outline-3">
<h3 id="org2a63621">command-function:poi</h3>
<div class="outline-text-3" id="text-org2a63621">
<ul class="org-ul">
<li><p>cn poi add  &lt;name&gt; &lt;relative-path&gt;</p></li>
<li><p>cn poi sub  &lt;name&gt;</p></li>
<li><p>cn poi up   &lt;name&gt; &lt;relative-path&gt;</p></li>
<li><p>cn poi find &lt;name&gt;</p></li>
<li><p>cn poi list</p></li></ul>
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">command-function:poi</span>
  <span style="color: #FF8888;">&lt;&lt; -- &gt;&gt;</span>
  get-command-line
  <span style="color: #ffffff; font-weight: bold;">string:</span>word-tail
  <span style="color: #ffffff; font-weight: bold;">string:</span>word-tail <span style="color: #dc322f; font-weight: bold;">&gt;::command-line</span>

  <span style="color: #5CDD5C; font-weight: bold;">::command-line</span> <span style="color: #ffffff; font-weight: bold;">string:</span>space? <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #ffffff; font-weight: bold;">poi:</span>help
    <span style="color: #00ffff; font-weight: bold;">bye</span>
  <span style="color: #f92672; font-weight: bold;">then</span>

  <span style="color: #5CDD5C; font-weight: bold;">::command-line</span> <span style="color: #ffffff; font-weight: bold;">string:</span>word <span style="color: #dc322f; font-weight: bold;">&gt;::sub-function-name</span>
  <span style="color: #5CDD5C; font-weight: bold;">::command-line</span> <span style="color: #ffffff; font-weight: bold;">string:</span>word-tail <span style="color: #dc322f; font-weight: bold;">&gt;::command-line-arguments</span>

  <span style="color: #5CDD5C; font-weight: bold;">::sub-function-name</span> <span style="color: #e6db74;">"help"</span> <span style="color: #ffffff; font-weight: bold;">string:</span>equal? <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #ffffff; font-weight: bold;">poi:</span>help
    <span style="color: #00ffff; font-weight: bold;">bye</span>
  <span style="color: #f92672; font-weight: bold;">then</span>

  <span style="color: #5CDD5C; font-weight: bold;">::sub-function-name</span> <span style="color: #e6db74;">"add"</span> <span style="color: #ffffff; font-weight: bold;">string:</span>equal? <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #5CDD5C; font-weight: bold;">::command-line-arguments</span> <span style="color: #ffffff; font-weight: bold;">string:</span>word
    <span style="color: #5CDD5C; font-weight: bold;">::command-line-arguments</span> <span style="color: #ffffff; font-weight: bold;">string:</span>word-tail <span style="color: #ffffff; font-weight: bold;">string:</span>word
    <span style="color: #ffffff; font-weight: bold;">poi:</span>add
    <span style="color: #00ffff; font-weight: bold;">bye</span>
  <span style="color: #f92672; font-weight: bold;">then</span>

  <span style="color: #5CDD5C; font-weight: bold;">::sub-function-name</span> <span style="color: #e6db74;">"sub"</span> <span style="color: #ffffff; font-weight: bold;">string:</span>equal? <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #5CDD5C; font-weight: bold;">::command-line-arguments</span> <span style="color: #ffffff; font-weight: bold;">string:</span>word
    <span style="color: #ffffff; font-weight: bold;">poi:</span>sub
    <span style="color: #00ffff; font-weight: bold;">bye</span>
  <span style="color: #f92672; font-weight: bold;">then</span>

  <span style="color: #5CDD5C; font-weight: bold;">::sub-function-name</span> <span style="color: #e6db74;">"up"</span> <span style="color: #ffffff; font-weight: bold;">string:</span>equal? <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #5CDD5C; font-weight: bold;">::command-line-arguments</span> <span style="color: #ffffff; font-weight: bold;">string:</span>word
    <span style="color: #5CDD5C; font-weight: bold;">::command-line-arguments</span> <span style="color: #ffffff; font-weight: bold;">string:</span>word-tail <span style="color: #ffffff; font-weight: bold;">string:</span>word
    <span style="color: #ffffff; font-weight: bold;">poi:</span>up
    <span style="color: #00ffff; font-weight: bold;">bye</span>
  <span style="color: #f92672; font-weight: bold;">then</span>

  <span style="color: #5CDD5C; font-weight: bold;">::sub-function-name</span> <span style="color: #e6db74;">"find"</span> <span style="color: #ffffff; font-weight: bold;">string:</span>equal? <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #5CDD5C; font-weight: bold;">::command-line-arguments</span> <span style="color: #ffffff; font-weight: bold;">string:</span>word
    <span style="color: #ffffff; font-weight: bold;">poi:</span>find <span style="color: #f92672; font-weight: bold;">if</span>
      .s .l
    <span style="color: #f92672; font-weight: bold;">else</span>
      <span style="color: #e6db74;">"no found"</span> .s .l
    <span style="color: #f92672; font-weight: bold;">then</span>
    <span style="color: #00ffff; font-weight: bold;">bye</span>
  <span style="color: #f92672; font-weight: bold;">then</span>

  <span style="color: #5CDD5C; font-weight: bold;">::sub-function-name</span> <span style="color: #e6db74;">"list"</span> <span style="color: #ffffff; font-weight: bold;">string:</span>equal? <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #ffffff; font-weight: bold;">poi:</span>list
    <span style="color: #00ffff; font-weight: bold;">bye</span>
  <span style="color: #f92672; font-weight: bold;">then</span>

  <span style="color: #e6db74;">"* (command-function:poi) meets argument that (command-function:poi) can not understand"</span> .s .l
  <span style="color: #e6db74;">"  it is the following command-line that is confusing (command-function:poi) :"</span> .s .l
  <span style="color: #e6db74;">"    "</span> .s <span style="color: #ffffff; font-weight: bold;">report:</span>command-line .l
  <span style="color: #e6db74;">"  to get some help info  you can type :"</span> .s .l
  <span style="color: #e6db74;">"    cn poi help"</span> .s .l
  <span style="color: #e6db74;">"  good bye ^-^/"</span> .s .l
  <span style="color: #00ffff; font-weight: bold;">bye</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org6c5ba34" class="outline-3">
<h3 id="org6c5ba34">command-function:moi</h3>
<div class="outline-text-3" id="text-org6c5ba34">
<ul class="org-ul">
<li><p>cn module add  &lt;name&gt; &lt;relative-path&gt;</p></li>
<li><p>cn module sub  &lt;name&gt;</p></li>
<li><p>cn module up   &lt;name&gt; &lt;relative-path&gt;</p></li>
<li><p>cn module find &lt;name&gt;</p></li>
<li><p>cn module list</p></li></ul>
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">command-function:moi</span>
  <span style="color: #FF8888;">&lt;&lt; -- &gt;&gt;</span>
  get-command-line
  <span style="color: #ffffff; font-weight: bold;">string:</span>word-tail
  <span style="color: #ffffff; font-weight: bold;">string:</span>word-tail <span style="color: #dc322f; font-weight: bold;">&gt;::command-line</span>

  <span style="color: #5CDD5C; font-weight: bold;">::command-line</span> <span style="color: #ffffff; font-weight: bold;">string:</span>space? <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #ffffff; font-weight: bold;">moi:</span>help
    <span style="color: #00ffff; font-weight: bold;">bye</span>
  <span style="color: #f92672; font-weight: bold;">then</span>

  <span style="color: #5CDD5C; font-weight: bold;">::command-line</span> <span style="color: #ffffff; font-weight: bold;">string:</span>word <span style="color: #dc322f; font-weight: bold;">&gt;::sub-function-name</span>
  <span style="color: #5CDD5C; font-weight: bold;">::command-line</span> <span style="color: #ffffff; font-weight: bold;">string:</span>word-tail <span style="color: #dc322f; font-weight: bold;">&gt;::command-line-arguments</span>

  <span style="color: #5CDD5C; font-weight: bold;">::sub-function-name</span> <span style="color: #e6db74;">"help"</span> <span style="color: #ffffff; font-weight: bold;">string:</span>equal? <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #ffffff; font-weight: bold;">moi:</span>help
    <span style="color: #00ffff; font-weight: bold;">bye</span>
  <span style="color: #f92672; font-weight: bold;">then</span>

  <span style="color: #5CDD5C; font-weight: bold;">::sub-function-name</span> <span style="color: #e6db74;">"add"</span> <span style="color: #ffffff; font-weight: bold;">string:</span>equal? <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #5CDD5C; font-weight: bold;">::command-line-arguments</span> <span style="color: #ffffff; font-weight: bold;">string:</span>word
    <span style="color: #5CDD5C; font-weight: bold;">::command-line-arguments</span> <span style="color: #ffffff; font-weight: bold;">string:</span>word-tail <span style="color: #ffffff; font-weight: bold;">string:</span>word
    <span style="color: #ffffff; font-weight: bold;">moi:</span>add
    <span style="color: #00ffff; font-weight: bold;">bye</span>
  <span style="color: #f92672; font-weight: bold;">then</span>

  <span style="color: #5CDD5C; font-weight: bold;">::sub-function-name</span> <span style="color: #e6db74;">"sub"</span> <span style="color: #ffffff; font-weight: bold;">string:</span>equal? <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #5CDD5C; font-weight: bold;">::command-line-arguments</span> <span style="color: #ffffff; font-weight: bold;">string:</span>word
    <span style="color: #ffffff; font-weight: bold;">moi:</span>sub
    <span style="color: #00ffff; font-weight: bold;">bye</span>
  <span style="color: #f92672; font-weight: bold;">then</span>

  <span style="color: #5CDD5C; font-weight: bold;">::sub-function-name</span> <span style="color: #e6db74;">"up"</span> <span style="color: #ffffff; font-weight: bold;">string:</span>equal? <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #5CDD5C; font-weight: bold;">::command-line-arguments</span> <span style="color: #ffffff; font-weight: bold;">string:</span>word
    <span style="color: #5CDD5C; font-weight: bold;">::command-line-arguments</span> <span style="color: #ffffff; font-weight: bold;">string:</span>word-tail <span style="color: #ffffff; font-weight: bold;">string:</span>word
    <span style="color: #ffffff; font-weight: bold;">moi:</span>up
    <span style="color: #00ffff; font-weight: bold;">bye</span>
  <span style="color: #f92672; font-weight: bold;">then</span>

  <span style="color: #5CDD5C; font-weight: bold;">::sub-function-name</span> <span style="color: #e6db74;">"find"</span> <span style="color: #ffffff; font-weight: bold;">string:</span>equal? <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #5CDD5C; font-weight: bold;">::command-line-arguments</span> <span style="color: #ffffff; font-weight: bold;">string:</span>word
    <span style="color: #ffffff; font-weight: bold;">moi:</span>find <span style="color: #f92672; font-weight: bold;">if</span>
      .s .l
    <span style="color: #f92672; font-weight: bold;">else</span>
      <span style="color: #e6db74;">"no found"</span> .s .l
    <span style="color: #f92672; font-weight: bold;">then</span>
    <span style="color: #00ffff; font-weight: bold;">bye</span>
  <span style="color: #f92672; font-weight: bold;">then</span>

  <span style="color: #5CDD5C; font-weight: bold;">::sub-function-name</span> <span style="color: #e6db74;">"list"</span> <span style="color: #ffffff; font-weight: bold;">string:</span>equal? <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #ffffff; font-weight: bold;">moi:</span>list
    <span style="color: #00ffff; font-weight: bold;">bye</span>
  <span style="color: #f92672; font-weight: bold;">then</span>

  <span style="color: #e6db74;">"* (command-function:moi) meets argument that (command-function:moi) can not understand"</span> .s .l
  <span style="color: #e6db74;">"  it is the following command-line that is confusing (command-function:moi) :"</span> .s .l
  <span style="color: #e6db74;">"    "</span> .s <span style="color: #ffffff; font-weight: bold;">report:</span>command-line .l
  <span style="color: #e6db74;">"  to get some help info  you can type :"</span> .s .l
  <span style="color: #e6db74;">"    cn module help"</span> .s .l
  <span style="color: #e6db74;">"  good bye ^-^/"</span> .s .l
  <span style="color: #00ffff; font-weight: bold;">bye</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org397a37f" class="outline-3">
<h3 id="org397a37f">command-function:load</h3>
<div class="outline-text-3" id="text-org397a37f">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">command-function:load</span>
  <span style="color: #FF8888;">&lt;&lt; -- &gt;&gt;</span>
  get-command-line
  <span style="color: #ffffff; font-weight: bold;">string:</span>word-tail
  <span style="color: #ffffff; font-weight: bold;">string:</span>word-tail <span style="color: #dc322f; font-weight: bold;">&gt;::command-line</span>
  <span style="color: #5CDD5C; font-weight: bold;">::command-line</span> <span style="color: #ffffff; font-weight: bold;">string:</span>space? <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #e6db74;">"* (command-function:load) is called with no argument"</span> .s .l
    <span style="color: #e6db74;">"  it should be called with a name of module"</span> .s .l
    <span style="color: #00ffff; font-weight: bold;">bye</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #5CDD5C; font-weight: bold;">::command-line</span> <span style="color: #ffffff; font-weight: bold;">string:</span>word <span style="color: #a6e22e; font-weight: bold;">load</span>
  <span style="color: #00ffff; font-weight: bold;">bye</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org83f5ad0" class="outline-3">
<h3 id="org83f5ad0">command-function:load-with-test</h3>
<div class="outline-text-3" id="text-org83f5ad0">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">command-function:load-with-test</span>
  <span style="color: #FF8888;">&lt;&lt; -- &gt;&gt;</span>
  get-command-line
  <span style="color: #ffffff; font-weight: bold;">string:</span>word-tail
  <span style="color: #ffffff; font-weight: bold;">string:</span>word-tail <span style="color: #dc322f; font-weight: bold;">&gt;::command-line</span>
  <span style="color: #5CDD5C; font-weight: bold;">::command-line</span> <span style="color: #ffffff; font-weight: bold;">string:</span>space? <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #e6db74;">"* (command-function:load-with-test) is called with no argument"</span> .s .l
    <span style="color: #e6db74;">"  it should be called with a name of module"</span> .s .l
    <span style="color: #00ffff; font-weight: bold;">bye</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #5CDD5C; font-weight: bold;">::command-line</span> <span style="color: #ffffff; font-weight: bold;">string:</span>word <span style="color: #a6e22e; font-weight: bold;">load-with-test</span>
  <span style="color: #00ffff; font-weight: bold;">bye</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org5f7c27d" class="outline-3">
<h3 id="org5f7c27d">command-function:no-function</h3>
<div class="outline-text-3" id="text-org5f7c27d">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">command-function:no-function</span>
  <span style="color: #FF8888;">&lt;&lt; -- &gt;&gt;</span>
  <span style="color: #ffffff; font-weight: bold;">command-function:</span>stack-REPL
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org48579ef" class="outline-3">
<h3 id="org48579ef">command:dispatch</h3>
<div class="outline-text-3" id="text-org48579ef">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffff00; font-weight: bold;">:</span> <span style="color: #ef5939; font-weight: bold;">command:dispatch</span>
  <span style="color: #FF8888;">&lt;&lt; -- &gt;&gt;</span>
  get-command-line
  <span style="color: #ffffff; font-weight: bold;">string:</span>word-tail
  dup2 <span style="color: #ffffff; font-weight: bold;">string:</span>space? <span style="color: #f92672; font-weight: bold;">if</span>
    drop2
    <span style="color: #ffffff; font-weight: bold;">command-function:</span>no-function
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #ffffff; font-weight: bold;">string:</span>word
  <span style="color: #dc322f; font-weight: bold;">&gt;::1st-word</span>
  <span style="color: #5CDD5C; font-weight: bold;">::1st-word</span> <span style="color: #e6db74;">"basic-REPL"</span> <span style="color: #ffffff; font-weight: bold;">string:</span>equal? <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #ffffff; font-weight: bold;">command-function:</span>basic-REPL
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #5CDD5C; font-weight: bold;">::1st-word</span> <span style="color: #e6db74;">"stack-REPL"</span> <span style="color: #ffffff; font-weight: bold;">string:</span>equal? <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #ffffff; font-weight: bold;">command-function:</span>stack-REPL
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #5CDD5C; font-weight: bold;">::1st-word</span> <span style="color: #e6db74;">"poi"</span> <span style="color: #ffffff; font-weight: bold;">string:</span>equal? <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #ffffff; font-weight: bold;">command-function:</span>poi
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #5CDD5C; font-weight: bold;">::1st-word</span> <span style="color: #e6db74;">"moi"</span> <span style="color: #ffffff; font-weight: bold;">string:</span>equal? <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #ffffff; font-weight: bold;">command-function:</span>moi
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #5CDD5C; font-weight: bold;">::1st-word</span> <span style="color: #e6db74;">"load"</span> <span style="color: #ffffff; font-weight: bold;">string:</span>equal? <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #ffffff; font-weight: bold;">command-function:</span>load
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #5CDD5C; font-weight: bold;">::1st-word</span> <span style="color: #e6db74;">"load-with-test"</span> <span style="color: #ffffff; font-weight: bold;">string:</span>equal? <span style="color: #f92672; font-weight: bold;">if</span>
    <span style="color: #ffffff; font-weight: bold;">command-function:</span>load-with-test
    <span style="color: #00ffff; font-weight: bold;">end</span>
  <span style="color: #f92672; font-weight: bold;">then</span>
  <span style="color: #ffffff; font-weight: bold;">command-function:</span>unknow-function
  <span style="color: #00ffff; font-weight: bold;">end</span>
<span style="color: #ffff00; font-weight: bold;">;</span> <span style="color: #ae81ff; font-weight: bold;">define-function</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org1506532" class="outline-2">
<h2 id="org1506532"><b>the story begin</b></h2>
<div class="outline-text-2" id="text-org1506532">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #ffffff; font-weight: bold;">command:</span>dispatch
</pre>
</div>
</div>
</div>



<div id="outline-container-org14b3db5" class="outline-2">
<h2 id="org14b3db5"><span class="done test">test</span> </h2>
<div class="outline-text-2" id="text-org14b3db5">
<div class="org-src-container">

<pre class="src src-cicada-nymph"><span style="color: #e6db74;">"core-test"</span> <span style="color: #a6e22e; font-weight: bold;">load-with-test</span>

<span style="color: #ffffff; font-weight: bold;">report:</span>system
<span style="color: #ffffff; font-weight: bold;">report:</span>memory
<span style="color: #ffffff; font-weight: bold;">report:</span>global-naming-stack
<span style="color: #FF8888;">&lt;&lt;</span>
<span style="color: #FF8888;">report:syntax</span>
<span style="color: #FF8888;">report:command-line</span>
<span style="color: #FF8888;">report:environment-variable</span>
<span style="color: #FF8888;">&gt;&gt;</span>
</pre>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
涕执我乎垂丧兮 懼余生之茫苦
</div>
</body>
</html>
